<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>H3CCloudLab on Kir's Blog</title><link>https://weeaster.github.io/categories/h3ccloudlab/</link><description>Recent content in H3CCloudLab on Kir's Blog</description><generator>Hugo -- gohugo.io</generator><language>en</language><copyright>@kiraster</copyright><lastBuildDate>Wed, 10 May 2023 17:24:57 +0000</lastBuildDate><atom:link href="https://weeaster.github.io/categories/h3ccloudlab/index.xml" rel="self" type="application/rss+xml"/><item><title>H3C 防火墙（v7）提取导出安全策略至表格(textfsm)</title><link>https://weeaster.github.io/posts/cce1f96e/</link><pubDate>Wed, 10 May 2023 17:24:57 +0000</pubDate><guid>https://weeaster.github.io/posts/cce1f96e/</guid><description>&lt;p>去年写过一版这个需求的python代码，使用的是&lt;code>if&lt;/code>判断语句进行匹配获取内容然后写入表格&lt;/p>
&lt;p>&lt;a class="link" href="https://kiraster.github.io/posts/f285fb93.html" target="_blank" rel="noopener"
>H3C 防火墙（v7）提取导出安全策略至表格
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/p>
&lt;p>当时主打一个使用最少的库，最易理解和最长代码原则（哈哈），现在改用&lt;code>textfsm&lt;/code>来实现这个需求&lt;/p>
&lt;h2 id="测试环境">测试环境
&lt;/h2>&lt;ul>
&lt;li>Microsoft Windows 10 Pro 21H2&lt;/li>
&lt;li>Visual studio code Update 1.77.3&lt;/li>
&lt;li>Python 3.10.10&lt;/li>
&lt;li>HCL 5.7.2&lt;/li>
&lt;li>DeviceModel：H3C SecPath F1090&lt;/li>
&lt;/ul>
&lt;h2 id="安装的库">安装的库
&lt;/h2>&lt;p>使用 pip 安装 openpyxl ，pandas ，wcwidth，ntc-templates-elinpf，其他库为第三方库安装时自动安装的依赖（除pip和setuptools外）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Package&lt;/span> &lt;span class="n">Version&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">--------------------&lt;/span> &lt;span class="o">-------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">et&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">xmlfile&lt;/span> &lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">future&lt;/span> &lt;span class="mf">0.18&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ntc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">elinpf&lt;/span> &lt;span class="mf">3.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">numpy&lt;/span> &lt;span class="mf">1.24&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">openpyxl&lt;/span> &lt;span class="mf">3.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">pandas&lt;/span> &lt;span class="mf">1.5&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">pip&lt;/span> &lt;span class="mf">23.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">python&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dateutil&lt;/span> &lt;span class="mf">2.8&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">pytz&lt;/span> &lt;span class="mf">2023.3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">setuptools&lt;/span> &lt;span class="mf">65.5&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">six&lt;/span> &lt;span class="mf">1.16&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">textfsm&lt;/span> &lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tzdata&lt;/span> &lt;span class="mf">2023.3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">wcwidth&lt;/span> &lt;span class="mf">0.2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">6&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="textfsm模板">textfsm模板
&lt;/h2>&lt;p>编写三个&lt;code>textfsm&lt;/code>模板文件，分别处理以下命令的回显内容&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 查看安全策略
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dis security-policy ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 查看地址对象组
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dis object-group ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 查看服务对象组
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dis object-group service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="hp_comware_display_security-policy_ip_localtextfsm">hp_comware_display_security-policy_ip_local.textfsm
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Value Required RULE_ID (\d+)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value RULE_NAME (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value ACTIVE_STATE (Inactive|Active)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value ACTION (pass|drop)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value VRF (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value PROFILE (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value LOGGING (enable|disable)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value List COUNTING (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value TIME_RANGE (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value DESC (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value List SESSION (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value List SRC_ZONE (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value List DEST_ZONE (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value List SRC_IP (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value List DEST_IP (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value List SERVICE (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value List APPLICATION (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value List USER (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Start
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+rule \d+ name \S+ -&amp;gt; Continue
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+rule ${RULE_ID} name ${RULE_NAME} -&amp;gt; Continue
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+rule ${RULE_ID} name ${RULE_NAME} \(${ACTIVE_STATE}\)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+action ${ACTION}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+vrf ${VRF}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+profile ${PROFILE}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+logging ${LOGGING}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+counting ${COUNTING}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+time-range ${TIME_RANGE}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+description ${DESC}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+session ${SESSION}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+source-zone ${SRC_ZONE}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+destination-zone ${DEST_ZONE}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+source-ip ${SRC_IP}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+source-ip\S+ ${SRC_IP}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+destination-ip ${DEST_IP}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+destination-ip\S+ ${DEST_IP}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+service ${SERVICE}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+service-port ${SERVICE}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+application ${APPLICATION}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+user ${USER}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+source-mac ${SRC_IP}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^$$ -&amp;gt; Record
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="hp_comware_display_object-group_ip_localtextfsm">hp_comware_display_object-group_ip_local.textfsm
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Value Required OBJ_GROUP_NAME (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value List OBJ_ITEM (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value REFERENCED (in use|out of use)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value SEC_ZONE (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value DESC (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Start
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^Ip address object group -&amp;gt; Continue
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^Ip address object group ${OBJ_GROUP_NAME}: \d+ objects\(${REFERENCED}\)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^security-zone ${SEC_ZONE}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^&amp;lt; -&amp;gt; NoRecord
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^${DESC}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+object -&amp;gt; NoRecord
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+${OBJ_ITEM}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^$$ -&amp;gt; Record
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="hp_comware_display_object-group_service_localtextfsm">hp_comware_display_object-group_service_local.textfsm
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Value Required OBJ_GROUP_NAME (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value List OBJ_ITEM (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value REFERENCED (in use|out of use)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value DESC (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Start
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^Service object group -&amp;gt; Continue
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^Service object group ${OBJ_GROUP_NAME}: \d+ objects\(${REFERENCED}\)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^&amp;lt; -&amp;gt; NoRecord
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^${DESC}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+object -&amp;gt; NoRecord
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+${OBJ_ITEM}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^$$ -&amp;gt; Record
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="python脚本">python脚本
&lt;/h2>&lt;p>原理是使用textfsm模板对三个命令的回显内容进行处理然后写入表格&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">textfsm&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">TextFSM&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">pandas&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">pd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">openpyxl&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Workbook&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">openpyxl.styles&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">PatternFill&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">openpyxl&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">datetime&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">datetime&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">wcwidth&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">SP2EXCEL&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 初始化一些内容&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="fm">__init__&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">echo_content&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sp_textfsm_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;hp_comware_display_security-policy_ip_local.textfsm&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">obj_ip_textfsm_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;hp_comware_display_object-group_ip_local.textfsm&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">obj_service_textfsm_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;hp_comware_display_object-group_service_local.textfsm&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 回显内容读入内存&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">echo_content&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;r&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">contents&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">read&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 0、字典的value是列表的，将列表拼接为一个以换行符为分隔符的字符串&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">expand_list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">list_dict_res&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">d&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">list_dict_res&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">k&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">v&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">copy&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">items&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nb">isinstance&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">list&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 将列表拼接为一个以换行符为分隔符的字符串&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">obj_item_str&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 写回原字典&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">obj_item_str&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">list_dict_res&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 1、解析 dis security-policy ip 回显内容（安全策略）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">parse_sp&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sp_textfsm_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">template&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">TextFSM&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">template&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ParseTextToDicts&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">contents&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 对没有匹配到内容的设置默认值&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">d&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">res&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ACTIVE_STATE&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ACTIVE_STATE&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;Active&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;VRF&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;VRF&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;public&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;PROFILE&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;PROFILE&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;none&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;LOGGING&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;LOGGING&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;disable&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;COUNTING&amp;#39;&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;COUNTING&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;disable&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;TIME_RANGE&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;TIME_RANGE&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;none&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;DESC&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;DESC&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;none&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;SESSION&amp;#39;&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;SESSION&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;none&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;SRC_ZONE&amp;#39;&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;SRC_ZONE&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;any&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;DEST_ZONE&amp;#39;&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;DEST_ZONE&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;any&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;SRC_IP&amp;#39;&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;SRC_IP&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;any&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;DEST_IP&amp;#39;&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;DEST_IP&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;any&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;SERVICE&amp;#39;&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;SERVICE&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;any&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;APPLICATION&amp;#39;&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;APPLICATION&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;any&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;USER&amp;#39;&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;USER&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;any&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 调用expand_list()处理字典value为列表的键值对&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">expand_list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">df&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">pd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DataFrame&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 安全策略表头&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">df_th&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="s1">&amp;#39;RULE_ID&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;ID&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;RULE_NAME&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;名称&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;ACTIVE_STATE&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;时间段状态&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;ACTION&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;动作&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;VRF&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;公网&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;PROFILE&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;内容安全&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;LOGGING&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;日志&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;COUNTING&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;统计&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;TIME_RANGE&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;时间段&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;DESC&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;描述&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;SESSION&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;会话&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;SRC_ZONE&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;源安全域&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;DEST_ZONE&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;目的安全域&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;SRC_IP&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;源地址&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;DEST_IP&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;目的地址&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;SERVICE&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;服务&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;APPLICATION&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;应用&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;USER&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;用户&amp;#39;&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sp_df&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">df&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rename&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">columns&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">df_th&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 下一步进行解析地址对象组回显内容&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parse_obj_ip&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 2、解析 dis object-group ip address 回显内容（地址对象组）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">parse_obj_ip&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">obj_ip_textfsm_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">template&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">TextFSM&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">template&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ParseTextToDicts&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">contents&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 调用expand_list()处理字典value为列表的键值对&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">expand_list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">df&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">pd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DataFrame&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 地址对象组表头&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">df_th&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="s1">&amp;#39;OBJ_GROUP_NAME&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;对象组名称&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;OBJ_ITEM&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;对象&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;REFERENCED&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;被引用&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;SEC_ZONE&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;安全域&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;DESC&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;描述&amp;#39;&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">obj_ip_df&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">df&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rename&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">columns&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">df_th&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 下一步进行解析服务对象组回显内容&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parse_obj_service&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 3、解析 dis object-group service 回显内容（服务对象组）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">parse_obj_service&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">obj_service_textfsm_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">template&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">TextFSM&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">template&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ParseTextToDicts&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">contents&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 调用expand_list()处理字典value为列表的键值对&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">expand_list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">df&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">pd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DataFrame&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 服务对象组表头&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">df_th&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="s1">&amp;#39;OBJ_GROUP_NAME&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;对象组名称&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;OBJ_ITEM&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;对象&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;REFERENCED&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;被引用&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;DESC&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;描述&amp;#39;&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">obj_service_df&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">df&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rename&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">columns&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">df_th&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 4、表格写入&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">to_excel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 运行以上三个解析内容的函数，一个串一个&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parse_sp&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 文件名时间部分，用于区别新旧&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">create_time&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">datetime&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;%Y%m&lt;/span>&lt;span class="si">%d&lt;/span>&lt;span class="s2">%H%M%S&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">output_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sa">f&lt;/span>&lt;span class="s1">&amp;#39;核心防火墙安全策略统计&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">create_time&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s1">.xlsx&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 创建ExcelWriter对象并指定文件名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="n">pd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ExcelWriter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">output_path&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">writer&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 将三个DataFrame写入不同的工作表中，并且不写入行索引&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sp_df&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to_excel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">writer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sheet_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;安全策略&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">index&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">obj_ip_df&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to_excel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">writer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sheet_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;地址对象组&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">index&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">obj_service_df&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to_excel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">writer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sheet_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;服务对象组&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">index&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 取出wb对象供define_excel_style()使用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">writer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">book&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sheet_names&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sheetnames&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">define_excel_style&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 5、调整表格样式&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">define_excel_style&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 三个sheet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sheet_names&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sheet_names&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sheet_names&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 以单元格中当行最长字符串长度调整列宽&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">sheet_name&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sheet_names&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">worksheet&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">sheet_name&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 遍历所有列，找出最宽的一列并调整列宽&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">col&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">worksheet&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">columns&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">max_width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">column&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">col&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column&lt;/span> &lt;span class="c1"># openpyxl 中的列索引从 1 开始&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 计算每个单元格中最宽行的显示宽度，并选取最宽的一行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">cell&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">col&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lines&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">max_line_width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">line&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">wcwidth&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wcswidth&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">line&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">width&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">max_line_width&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">max_line_width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">width&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">max_line_width&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">max_width&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">max_width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">max_line_width&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 将最宽行的显示宽度设置为该列的列宽&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">worksheet&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">openpyxl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">utils&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_column_letter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">column&lt;/span>&lt;span class="p">)]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">max_width&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 冻结首行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">freeze_panes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;A2&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">freeze_panes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;A2&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">freeze_panes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;A2&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 表头背景色&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">th_color_fill&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">PatternFill&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;solid&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">fgColor&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;D3D3D3&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">col&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">19&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fill&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">th_color_fill&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">col&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fill&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">th_color_fill&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">col&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fill&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">th_color_fill&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 垂直居中&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">sheet_name&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sheet_names&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">worksheet&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">sheet_name&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">r&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">worksheet&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">r&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">alignment&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">openpyxl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">styles&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Alignment&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">vertical&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;center&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">wrapText&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 保存&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">save&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">output_path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="vm">__name__&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 指定回显输出文件路径，同目录下直接 文件名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">echo_content_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;output.log&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 实例化对象&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">obj&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">SP2EXCEL&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">echo_content_path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 执行 4、表格写入&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">obj&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to_excel&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;搞快点--&amp;gt;&amp;gt;搞快点--&amp;gt;&amp;gt;&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="生成的表格文件">生成的表格文件
&lt;/h2>&lt;h3 id="安全策略sheet">安全策略sheet
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/10/UrviOXJ4lNbCqoe.jpg">
&lt;img src="https://s2.loli.net/2023/05/10/UrviOXJ4lNbCqoe.jpg"
loading="lazy"
alt="ScreenCaputure230510175500"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="地址对象组sheet">地址对象组sheet
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/10/91m4Y7PkLqZeSUc.jpg">
&lt;img src="https://s2.loli.net/2023/05/10/91m4Y7PkLqZeSUc.jpg"
loading="lazy"
alt="ScreenCaputure230510175522"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="服务对象组sheet">服务对象组sheet
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/10/RUgkEiZq9rsCdhv.jpg">
&lt;img src="https://s2.loli.net/2023/05/10/RUgkEiZq9rsCdhv.jpg"
loading="lazy"
alt="ScreenCaputure230510180429"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/10/Sw1Rq3xob2WP7lc.png">
&lt;img src="https://s2.loli.net/2023/05/10/Sw1Rq3xob2WP7lc.png"
loading="lazy"
alt="image-20230510181500219"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="最后">最后
&lt;/h2>&lt;ul>
&lt;li>以上使用到的文件见github仓库： &lt;a class="link" href="https://github.com/kiraster/GenerateSp2Excelv2" target="_blank" rel="noopener"
>https://github.com/kiraster/GenerateSp2Excelv2
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨&lt;/li>
&lt;/ul></description></item><item><title>H3C 防火墙（v7）提取导出安全策略至表格</title><link>https://weeaster.github.io/posts/f285fb93/</link><pubDate>Thu, 01 Dec 2022 21:01:44 +0000</pubDate><guid>https://weeaster.github.io/posts/f285fb93/</guid><description>&lt;p>当前日期时间： &lt;code>20221201&lt;/code> 版本:&lt;code>H3C Comware Software, Version 7.1.064, Release 9628P2416&lt;/code>还没有安全策略导出到表格的功能，而有时确实有实际需求导出安全策略到表格，无论是存档还是提交报告&lt;/p>
&lt;p>本文介绍使用&lt;code>python&lt;/code>脚本语言编写一个根据&lt;code>display&lt;/code>回显内容提取安全策略和对象组到表格的方法&lt;/p>
&lt;p>&lt;strong>环境介绍：&lt;/strong>&lt;/p>
&lt;p>{% blockquote %}&lt;/p>
&lt;p>Python 3.9.7&lt;/p>
&lt;p>openpyxl 3.0.10&lt;/p>
&lt;p>HCL 3.0.1 （现网环境都为敏感内容，勉为其难用模拟器）&lt;/p>
&lt;p>VScode 1.73.1&lt;/p>
&lt;p>{% endblockquote %}&lt;/p>
&lt;h2 id="提取工作过程">提取工作过程
&lt;/h2>&lt;h3 id="命令行登陆设备导出display回显内容">命令行登陆设备导出display回显内容
&lt;/h3>&lt;p>利用&lt;code>SecureCRT&lt;/code>的&lt;code>Log Session&lt;/code>(记录日志)功能生成一个包含回显内容的&lt;code>log文件&lt;/code>，放置在与脚本文件相同目录&lt;/p>
&lt;p>本次使用的是&lt;code>205550.log'&lt;/code>，在下面代码中更换为自己的文件名称&lt;/p>
&lt;p>&lt;strong>使用的命令&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 查看安全策略
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dis security-policy ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 查看地址对象组
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dis object-group ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 查看服务对象组
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dis object-group service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;Core_FW&amp;gt;dis security-policy ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Security-policy ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 2 name management-local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone management
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;Core_FW&amp;gt;dis object-group ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ip address object group api.test.com: 1 object(in use)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0 network host name api.test.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;Core_FW&amp;gt;dis object-group service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Service object group A服务器端口服务: 3 objects(in use)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0 service tcp destination eq 1433
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 10 service tcp destination range 300 3010
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 20 service udp destination eq 2222
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Service object group 访问test.comAPI接口: 2 objects(in use)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0 service tcp destination eq 443
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 10 service tcp destination range 9000 9100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;Core_FW&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="运行的代码">运行的代码
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">openpyxl&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Workbook&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">openpyxl.styles&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">PatternFill&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">openpyxl&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">datetime&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">datetime&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">SecPolicy2XLSX&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 初始化参数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="fm">__init__&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 文件名时间部分，用于区别新旧&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">create_time&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">datetime&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;%Y%m&lt;/span>&lt;span class="si">%d&lt;/span>&lt;span class="s2">%H%M%S&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 读取文件，填写同目录从防火墙命令巴拉下来的文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">export_cfg&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;205550.log&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">export_cfg&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;r&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 表格 - 表头数据&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sheet1_th&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;名称&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;ID&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;源安全域&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;目的安全域&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;类型&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;描述&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;源地址&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;目的地址&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;服务&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;用户&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;动作&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;内容安全&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;记录日志&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;策略匹配统计&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;启用&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sheet2_th&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[[&lt;/span>&lt;span class="s1">&amp;#39;对象组名称和被引用&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;对象&amp;#39;&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 表格初始数据&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Workbook&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">active&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;安全策略&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">create_sheet&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;地址对象组&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">create_sheet&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;服务对象组&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 写入表头&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sheet1_th&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sheet2_th&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 提取安全策略信息&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">sp_comtent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 保存单条策略内容的字典&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 保存以下几项内容的字典，原因在于命令行中显示为多个（每个一行）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">src_zone_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dst_zone_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">src_ip_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dst_ip_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">service_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="kc">True&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cfg_line&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">readline&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;rule&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">id&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">()[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;id&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">id&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;source-zone&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">src_zone_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">()[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;profile&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">profile_type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">()[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;_&amp;#39;&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;profile_type&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">profile_type&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;description&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">desc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()[&lt;/span>&lt;span class="mi">12&lt;/span>&lt;span class="p">:]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;desc&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">desc&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;destination-zone&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dst_zone_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">()[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;source-ip&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">src_ip_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;destination-ip&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dst_ip_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;action&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">action&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">()[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;action&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">action&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;logging &amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">logg&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">()[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;logg&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">logg&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;counting &amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">()[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;count&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">count&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;disable&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># enable = cfg_line.strip()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;enable&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;disable&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;service&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">service_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># display 回显的内容 空行分割一条安全策略&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 把最终列表拼接到字符串&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">src_zone&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;,&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">src_zone_list&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dst_zone&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;,&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dst_zone_list&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">src_ip&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;,&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">src_ip_list&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dst_ip&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;,&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dst_ip_list&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">service&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;,&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">service_list&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 把最终列表拼接到字符串写入comtent_dict字典&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;src_zone&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">src_zone&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;dst_zone&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">dst_zone&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;src_ip&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">src_ip&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;dst_ip&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">dst_ip&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;service&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 返回值是单条安全策略的字典&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">comtent_dict&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 提取地址对象组信息&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">ip_obj_comtent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">networw_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="kc">True&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cfg_line&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">readline&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;Ip address object group&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;network &amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">networw_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">networw_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;,&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">networw_list&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;networw_list&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">networw_list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 返回值是单个地址对象组的字典&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">comtent_dict&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 提取服务对象组信息&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">service_obj_comtent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">service_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="kc">True&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cfg_line&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">readline&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;Service object group&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;service tcp&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span> &lt;span class="ow">or&lt;/span> &lt;span class="s1">&amp;#39;service udp&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">service_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">service_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;,&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">service_list&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;service_list&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">service_list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 返回值是单个服务对象组的字典&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">comtent_dict&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 循环 返回全部安全策略的生成器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">more_sp_comtent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 找到文件末 的指针，用于判断是否读取完整个文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">eof&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seek&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seek&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="kc">True&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sp_comtent&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">yield&lt;/span> &lt;span class="n">res&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tell&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="n">eof&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 循环 返回全部地址对象组的生成器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">more_ip_comtent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">eof&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seek&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seek&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="kc">True&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ip_obj_comtent&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">yield&lt;/span> &lt;span class="n">res&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tell&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="n">eof&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 循环 返回全部服务对象组的生成器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">more_service_comtent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">eof&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seek&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seek&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="kc">True&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">service_obj_comtent&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">yield&lt;/span> &lt;span class="n">res&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tell&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="n">eof&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 安全策略，移除和填充内容字典元素&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">sp_fill_task&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 生成器 转 列表套字典&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">more_sp_comtent&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 移除不相干元素，列表套字典中字典不包含 &amp;#39;name&amp;#39; 键的字典&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">index_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">comtent_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">key_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">keys&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">key_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 字典中不包含 &amp;#39;name&amp;#39; 键的字典在comtent_list列表的索引值&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">index_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">comtent_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 索引列表去重--&amp;gt;&amp;gt;降序排列--&amp;gt;&amp;gt;删元素&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">index_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">index_list&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">index_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sort&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">reverse&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">index_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pop&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># comtent_list列表去重&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ret_comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">comtent_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">ret_comtent_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ret_comtent_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 去头&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ret_comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ret_comtent_list&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">:]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 添加一些默认值，一些安全策略值在display回显的内容不显示&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">ret_comtent_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;user&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;Any&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 一般应用安全都是使用默认配置文件中default策略，如有自定义的配置文件就增加一个提取函数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ap_profile&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;default&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">setdefault&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;desc&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;-&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 安全策略没有启用显示disable，启用了display没有显示&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">setdefault&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;enable&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;enable&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># IPv4 网络环境默认&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">setdefault&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;profile_type&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;IPv4&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 命中计数和流量统计，没有启用不在display显示&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">setdefault&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;count&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;disable&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 记录日志&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">setdefault&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;logg&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;enable&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># print(i)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 键的值为空则替换为 Any&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ret_comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[{&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">v&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">v&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">k&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="s1">&amp;#39;desc&amp;#39;&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="s1">&amp;#39;Any&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">k&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">v&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">items&lt;/span>&lt;span class="p">()}&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">ret_comtent_list&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 最后一条拒绝所有策略的描述&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ret_comtent_list&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="s1">&amp;#39;desc&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ret_comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ret_comtent_list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 返回一个完整的列表套字典&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ret_comtent_list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 地址对象组，移除和填充内容字典元素&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">ip_fill_task&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 生成器 转 列表套字典&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">more_ip_comtent&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 列表去重&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ret_comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">comtent_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">ret_comtent_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ret_comtent_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 去头&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ret_comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ret_comtent_list&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">:]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ret_comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ret_comtent_list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ret_comtent_list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">service_fill_task&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 生成器 转 列表套字典&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">more_service_comtent&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 列表去重&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ret_comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">comtent_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">ret_comtent_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ret_comtent_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 去头&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ret_comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ret_comtent_list&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">:]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ret_comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ret_comtent_list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 在此处关闭文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ret_comtent_list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 写入数据到表格 - 安全策略工作表&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">write2ws1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 从第二行开始写入&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">big_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sp_fill_task&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">big_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;id&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;src_zone&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;dst_zone&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;profile_type&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;desc&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;src_ip&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;dst_ip&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">9&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;service&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;user&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">11&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;action&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">12&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ap_profile&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">13&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;logg&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;count&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">15&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;enable&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 写入数据到表格 - 地址对象组工作表&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">write2ws2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">big_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ip_fill_task&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">big_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;networw_list&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 写入数据到表格 - 地址对象组工作表&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">write2ws3&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">big_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">service_fill_task&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">big_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;service_list&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 调整表格显示 保存xlsx表格&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">save_to_file&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 修改ws1列宽&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;A&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">50&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;B&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;C&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">46&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;D&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">38&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;F&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">50&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;G&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">50&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;H&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">50&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;I&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">50&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;N&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 修改ws2列宽&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;A&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">50&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;B&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 修改ws3列宽&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;A&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">50&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;B&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 修改列 垂直居中 自动换行，表头背景色 ，冻结首行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">freeze_panes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;A2&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">freeze_panes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;A2&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">freeze_panes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;A2&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">th_color_fill&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">PatternFill&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;solid&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">fgColor&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;D3D3D3&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">col&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">16&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fill&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">th_color_fill&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">col&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fill&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">th_color_fill&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">col&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fill&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">th_color_fill&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">r&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">r&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">alignment&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">openpyxl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">styles&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Alignment&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">vertical&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;center&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">wrapText&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">r&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws2&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">r&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">alignment&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">openpyxl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">styles&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Alignment&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">vertical&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;center&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">wrapText&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">r&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws3&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">r&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">alignment&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">openpyxl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">styles&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Alignment&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">vertical&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;center&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">wrapText&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 保存并生成文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">save&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s1">&amp;#39;XXX防火墙安全策略统计&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">create_time&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s1">.xlsx&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="vm">__name__&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 类实例化&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">SecPolicy2XLSX&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># res = x.sp_comtent()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># res = x.more_comtent()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># res = x.more_ip_comtent()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># for i in res:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># print(i)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># x.ip_fill_task()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write2ws1&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write2ws2&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write2ws3&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">save_to_file&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;搞快点--&amp;gt;&amp;gt;搞快点--&amp;gt;&amp;gt;&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="导出的表格">导出的表格
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/12/01/cNp1hXCz5uKmWFf.jpg">
&lt;img src="https://s2.loli.net/2022/12/01/cNp1hXCz5uKmWFf.jpg"
loading="lazy"
alt="ScreenCaputure221201214539"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/12/01/WvI5YhTPaqpdbzB.jpg">
&lt;img src="https://s2.loli.net/2022/12/01/WvI5YhTPaqpdbzB.jpg"
loading="lazy"
alt="ScreenCaputure221201214703"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/12/01/TSWYCOPrbImcez3.jpg">
&lt;img src="https://s2.loli.net/2022/12/01/TSWYCOPrbImcez3.jpg"
loading="lazy"
alt="ScreenCaputure221201214728"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/12/01/tygZYhBfMFrmjQS.png">
&lt;img src="https://s2.loli.net/2022/12/01/tygZYhBfMFrmjQS.png"
loading="lazy"
alt="20221201220702"
>
&lt;/a>
&lt;/div>
&lt;/p></description></item><item><title>Ubuntu 22.04 安装iNode管理中心和定制客户端</title><link>https://weeaster.github.io/posts/4eda38e9/</link><pubDate>Sat, 26 Nov 2022 16:34:36 +0000</pubDate><guid>https://weeaster.github.io/posts/4eda38e9/</guid><description>&lt;p>&lt;code>Ubuntu 22.04&lt;/code>安装&lt;code>iNode&lt;/code>管理中心和定制客户端，如题&lt;/p>
&lt;h2 id="官网下载安装文件">官网下载安装文件
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>从官网下载 iNode PC(PC客户端)（https://www.h3c.com/cn/Service/Document_Software/Software_Download/IP_Management/&lt;/p>
&lt;/li>
&lt;li>
&lt;p>解压后将&lt;code>Linux&lt;/code>目录下的&lt;code>iNodeManager_H3C_Linux64_7.30(E0598).tar.gz&lt;/code>上传至 &lt;code>Ubuntu &lt;/code>Downloads目录&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/OL74h15fEz9Wp3D.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/OL74h15fEz9Wp3D.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="解压和安装">解压和安装
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>解压文件，并将解压后的文件夹所有者更改为当前用户，&lt;/p>
&lt;/li>
&lt;li>
&lt;p>移动文件夹至 &lt;code>/home&lt;/code> 目录&lt;/p>
&lt;/li>
&lt;li>
&lt;p>修改文件夹下 &lt;code>install64.sh &lt;/code>的权限&lt;/p>
&lt;/li>
&lt;li>
&lt;p>安装文件&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">执行命令：
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/Downloads$ sudo tar -zxvf iNodeManager_H3C_Linux64_7.30&lt;span class="se">\(&lt;/span>E0598&lt;span class="se">\)&lt;/span>.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/Downloads$ sudo chown -R kir iNodeManager
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/Downloads$ sudo mv iNodeManager /home/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/Downloads$ &lt;span class="nb">cd&lt;/span> /home/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home$ &lt;span class="nb">cd&lt;/span> iNodeManager/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager$ sudo chmod u+x install64.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager$ sudo sh install64.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">操作步骤记录：
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~$
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~$ &lt;span class="nb">pwd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/home/kir
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~$ &lt;span class="nb">cd&lt;/span> Downloads/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/Downloads$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">44368&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">2&lt;/span> kir kir &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 11:40 ./
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-x--- &lt;span class="m">16&lt;/span> kir kir &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 01:51 ../
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir kir &lt;span class="m">45422267&lt;/span> 6月 &lt;span class="m">30&lt;/span> 22:10 &lt;span class="s1">&amp;#39;iNodeManager_H3C_Linux64_7.30(E0598).tar.gz&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/Downloads$
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/Downloads$ sudo tar -zxvf iNodeManager_H3C_Linux64_7.30&lt;span class="se">\(&lt;/span>E0598&lt;span class="se">\)&lt;/span>.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>sudo&lt;span class="o">]&lt;/span> password &lt;span class="k">for&lt;/span> kir:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/7za
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/template/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/template/iNodeClient_Linux64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/install64.sh.bak
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/Resources/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/Resources/Language_en.xml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/Resources/Language_zh.xml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/uninstall64.sh.bak
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/qt_zh_CN.qm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/uninstall64.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/install64.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/makeDeb.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/imageformats/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/imageformats/libqmng.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/imageformats/libqjpeg.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/imageformats/libqsvg.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/imageformats/libqico.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/imageformats/libqtga.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/imageformats/libqwbmp.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/imageformats/libqtiff.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/imageformats/libqgif.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/platforms/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/platforms/libqoffscreen.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/platforms/libqminimal.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/platforms/libqxcb.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/platforms/libqlinuxfb.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/lib64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/iNodeManager
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/iNode.vif
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/Downloads$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">44372&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">3&lt;/span> kir kir &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 13:29 ./
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-x--- &lt;span class="m">16&lt;/span> kir kir &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 01:51 ../
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x &lt;span class="m">6&lt;/span> &lt;span class="m">500&lt;/span> &lt;span class="m">500&lt;/span> &lt;span class="m">4096&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 iNodeManager/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir kir &lt;span class="m">45422267&lt;/span> 6月 &lt;span class="m">30&lt;/span> 22:10 &lt;span class="s1">&amp;#39;iNodeManager_H3C_Linux64_7.30(E0598).tar.gz&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/Downloads$ sudo chown -R kir iNodeManager
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/Downloads$ sudo mv iNodeManager /home/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/Downloads$ &lt;span class="nb">cd&lt;/span> /home/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">16&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">4&lt;/span> root root &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 13:30 ./
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">20&lt;/span> root root &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 01:28 ../
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x &lt;span class="m">6&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">4096&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 iNodeManager/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-x--- &lt;span class="m">16&lt;/span> kir kir &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 01:51 kir/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home$ &lt;span class="nb">cd&lt;/span> iNodeManager/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">19712&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x &lt;span class="m">6&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">4096&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 ./
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">4&lt;/span> root root &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 13:30 ../
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">1125104&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 7za
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x &lt;span class="m">2&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">4096&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 imageformats/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rwxrwxr-x &lt;span class="m">1&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">810603&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 iNodeManager*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">300&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 iNode.vif
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">63&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 install64.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">959&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 install64.sh.bak
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">18079733&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 lib64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">926&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 makeDeb.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x &lt;span class="m">2&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">4096&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 platforms/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">117337&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 qt_zh_CN.qm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x &lt;span class="m">2&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">4096&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 Resources/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x &lt;span class="m">2&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">4096&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 template/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">41&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 uninstall64.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">924&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 uninstall64.sh.bak
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager$ sudo chmod u+x install64.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager$
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager$ sudo sh install64.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5DBus.so.5.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5DBus.so.5.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5DBus.so.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libicudata.so.51.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libicudata.so.51
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libicui18n.so.51.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libicui18n.so.51
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Core.so.5.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Core.so.5.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Core.so.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Gui.so.5.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Xml.so.5.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Xml.so.5.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Xml.so.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libicuuc.so.51.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libicuuc.so.51
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Network.so.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Gui.so.5.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Gui.so.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Widgets.so.5.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Network.so.5.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Widgets.so.5.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Widgets.so.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Network.so.5.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager$
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="启动管理中心和定制客户端">启动管理中心和定制客户端
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>启动管理中心（图形化界面操作），路径位于&lt;code>/home/iNodeManager&lt;/code>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/vAKgpmnkNDEJX1T.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/vAKgpmnkNDEJX1T.jpg"
loading="lazy"
alt="ScreenCaputure221126133607"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>仅勾选 SSL VPN 一项（按需勾选），点击 &lt;code>Advanced&lt;/code>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/S1sOGcjepK2TwdF.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/S1sOGcjepK2TwdF.jpg"
loading="lazy"
alt="ScreenCaputure221126133741"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>添加 网关地址 （与防火墙上配置的网关 SSLVPNGW 一致），点击 &lt;code>OK&lt;/code>，点击 &lt;code>Finish&lt;/code>&lt;/p>
&lt;table>
&lt;tr>
&lt;td>&lt;img src="https://s2.loli.net/2022/11/26/9ZIKPc5pN2zVJjL.jpg">&lt;/td>
&lt;td>&lt;img src="https://s2.loli.net/2022/11/26/Wrno8feNdcQVXvg.jpg">&lt;/td>
&lt;/tr>
&lt;/table>
&lt;/li>
&lt;li>
&lt;p>填写一个标题，勾选第一项&lt;/p>
&lt;table>
&lt;tr>
&lt;td>&lt;img src="https://s2.loli.net/2022/11/26/vsLUmVpIjHY9aFN.jpg">&lt;/td>
&lt;td>&lt;img src="https://s2.loli.net/2022/11/26/jGFohdwHKceC1Vk.jpg">&lt;/td>
&lt;/tr>
&lt;/table>
&lt;table>
&lt;tr>
&lt;td>&lt;img src="https://s2.loli.net/2022/11/26/367FWRI9YAbTCQf.jpg">&lt;/td>
&lt;td>&lt;img src="https://s2.loli.net/2022/11/26/TsykZ6xc2qaMzUL.jpg">&lt;/td>
&lt;/tr>
&lt;/table>
&lt;/li>
&lt;li>
&lt;p>定制完成后 生成的客户端文件位于&lt;code>/home/iNodeManager/iNodeSetup&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager$ &lt;span class="nb">cd&lt;/span> iNodeSetup/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager/iNodeSetup$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">25260&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x &lt;span class="m">2&lt;/span> kir kir &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 13:39 ./
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x &lt;span class="m">11&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 13:39 ../
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir kir &lt;span class="m">25857547&lt;/span> 11月 &lt;span class="m">26&lt;/span> 13:39 &lt;span class="s1">&amp;#39;iNodeClient_Linux64_7.3 (E0598).tar.gz&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager/iNodeSetup$
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="安装-inode-客户端">安装 iNode 客户端
&lt;/h2>&lt;ol>
&lt;li>将&lt;code>iNodeClient_Linux64_7.3 (E0598).tar.gz&lt;/code>文件解压，并移动&lt;code> iNodeClient&lt;/code> 文件夹至&lt;code>/home&lt;/code>目录&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager/iNodeSetup$
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager/iNodeSetup$ sudo tar -zxvf iNodeClient_Linux64_7.3&lt;span class="se">\ \(&lt;/span>E0598&lt;span class="se">\)&lt;/span>.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager/iNodeSetup$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">25264&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x &lt;span class="m">3&lt;/span> kir kir &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 13:44 ./
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x &lt;span class="m">11&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 13:39 ../
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">9&lt;/span> kir kir &lt;span class="m">4096&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:07 iNodeClient/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir kir &lt;span class="m">25857547&lt;/span> 11月 &lt;span class="m">26&lt;/span> 13:39 &lt;span class="s1">&amp;#39;iNodeClient_Linux64_7.3 (E0598).tar.gz&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager/iNodeSetup$ sudo mv iNodeClient /home/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager/iNodeSetup$ &lt;span class="nb">cd&lt;/span> /home/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">5&lt;/span> root root &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 13:46 ./
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">20&lt;/span> root root &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 01:28 ../
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">9&lt;/span> kir kir &lt;span class="m">4096&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:07 iNodeClient/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x &lt;span class="m">11&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 13:39 iNodeManager/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-x--- &lt;span class="m">16&lt;/span> kir kir &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 01:51 kir/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home$
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>
&lt;p>切换至&lt;code>iNodeClient &lt;/code>文件夹 ，执行&lt;code> sh install_64.sh&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">kir@kir:/home$ &lt;span class="nb">cd&lt;/span> iNodeClient/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeClient$ sudo sh install_64.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Nothing special &lt;span class="k">for&lt;/span> Ubuntu 22.04.1 LTS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="se">\l&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Starting AuthenMngService: OK
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="启动-inode-客户端">启动 iNode 客户端
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>图形界面 进入&lt;code>/home/iNodeClient/.iNode&lt;/code>目录（看不到&lt;code>.iNode &lt;/code>文件夹，先勾选显示隐藏文件）&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/M3O8v12pEfXNYUI.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/M3O8v12pEfXNYUI.jpg"
loading="lazy"
alt="ScreenCaputure221126134844"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/MfgB95kP7UC4yib.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/MfgB95kP7UC4yib.jpg"
loading="lazy"
alt="ScreenCaputure221126134939"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>双击&lt;code>iNodeClient&lt;/code>启动，创建一个连接（填写name,Username,Password)&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/gBDXQ95F4whp3RS.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/gBDXQ95F4whp3RS.jpg"
loading="lazy"
alt="ScreenCaputure221126135901"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/ZRIyCsTw6mjMXOF.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/ZRIyCsTw6mjMXOF.jpg"
loading="lazy"
alt="ScreenCaputure221126145223"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>SSLVPN 拨号&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/3nfAhOgMoV1d6Xr.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/3nfAhOgMoV1d6Xr.jpg"
loading="lazy"
alt="ScreenCaputure221126141137"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>查看获取到的客户端地址，并测试&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/UrCdGAZOYIV7Rqh.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/UrCdGAZOYIV7Rqh.jpg"
loading="lazy"
alt="ScreenCaputure221126141240"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/QMwqivFmZukJTzB.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/QMwqivFmZukJTzB.jpg"
loading="lazy"
alt="ScreenCaputure221126141546"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/DORpjqgZY2L6VPw.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/DORpjqgZY2L6VPw.jpg"
loading="lazy"
alt="ScreenCaputure221126142757"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="防火墙查看-sslvpn-会话信息">防火墙查看 SSLVPN 会话信息
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/cPgnirQuTqz81wI.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/cPgnirQuTqz81wI.jpg"
loading="lazy"
alt="ScreenCaputure221126142906"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="最后">最后
&lt;/h2>&lt;ul>
&lt;li>我电脑Windows + Ubuntu 22.04 双系统，在现网环境中都可正常使用 SSLVPN&lt;/li>
&lt;li>Ubuntu 截图和写Markdown发博客不方便（最重要的 HCL 没有Linux版本），所以拉了个虚拟机&lt;/li>
&lt;li>按照官方的安装指导手册以普通用户安装，最后定制生成客户端会&lt;code>无法生成文件&lt;/code>，需要在解压后将&lt;code>iNodeManager&lt;/code>文件夹所有者更改为当前普通用户&lt;/li>
&lt;li>在客户端创建新连接时，认证类型要选择 &lt;code>Local&lt;/code>，否则拨号后提示网关参数错误&lt;/li>
&lt;li>在定制客户端最后一步有三个选项
&lt;ul>
&lt;li>Generate customized client setup program(生成一个安装包，常用)&lt;/li>
&lt;li>Generate customized client upgrade package(升级包，使用前本地已经安装有旧版本，理解为增量升级包)&lt;/li>
&lt;li>Generate lightweight client upgrade package(用于放在服务端，在防火墙的&lt;code>SSL VPN&lt;/code>&amp;ndash;&amp;raquo;&lt;code>全局配置&lt;/code>&amp;ndash;&amp;raquo;&lt;code>上传客户端文件&lt;/code>位置，在浏览器输入&lt;code>SSLVPNGW:4443&lt;/code>可已打开页面，底下一行有下载的链接，就是下载这个文件)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul></description></item><item><title>H3C 防火墙（v7）SSLVPN 实验配置</title><link>https://weeaster.github.io/posts/ed57c1e2/</link><pubDate>Sat, 26 Nov 2022 15:12:31 +0000</pubDate><guid>https://weeaster.github.io/posts/ed57c1e2/</guid><description>&lt;p>本文使用华三 HCL 模拟器搭建拓扑，实现 H3C 防火墙（v7）SSLVPN 实验&lt;/p>
&lt;p>后一篇文章中描述 在 &lt;code>Ubuntu 22.04&lt;/code> 中安装 &lt;code>iNode&lt;/code> 客户端拨号测试&lt;/p>
&lt;p>本来只想写 Ubuntu 安装 iNode 的，想想还是一起记录下来&lt;/p>
&lt;p>文中的所有操作方法都可在华三官网和搜索引擎找到&lt;/p>
&lt;h2 id="拓扑图">拓扑图
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/PgNxjMhaKEzsO2i.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/PgNxjMhaKEzsO2i.jpg"
loading="lazy"
alt="ScreenCaputure221126120646"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="基操">基操
&lt;/h2>&lt;ol>
&lt;li>配置接口 IP 地址&lt;/li>
&lt;li>接口划入安全域（untrust，trust），新建安全域 SSLVPN&lt;/li>
&lt;li>配置路由（FW&amp;ndash;&amp;raquo; ROUTER:172.16.1.0/24，ROUTER&amp;ndash;&amp;raquo;FW:0.0.0.0/0）&lt;/li>
&lt;li>配置安全策略互通（any）&lt;/li>
&lt;/ol>
&lt;h2 id="防火墙配置-sslvpn">防火墙配置 SSLVPN
&lt;/h2>&lt;h3 id="配置-sslvpn-网关">配置 SSLVPN 网关
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>Gateway Name: SSLVPNGW&lt;/p>
&lt;/li>
&lt;li>
&lt;p>IP Address: 172.31.100.234&lt;/p>
&lt;/li>
&lt;li>
&lt;p>port: 4443&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/2P1gsbxBkRCm3af.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/2P1gsbxBkRCm3af.jpg"
loading="lazy"
alt="ScreenCaputure221126121833"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="配置-ip-接入接口">配置 IP 接入接口
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>安全域： SSLVPN&lt;/p>
&lt;/li>
&lt;li>
&lt;p>指定IP地址：172.31.200.254/24&lt;/p>
&lt;/li>
&lt;li>
&lt;p>本机接收可不选&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/vHMoJfWuPDIN8mQ.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/vHMoJfWuPDIN8mQ.jpg"
loading="lazy"
alt="ScreenCaputure221126121924"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/D19bwngVfWil3rQ.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/D19bwngVfWil3rQ.jpg"
loading="lazy"
alt="ScreenCaputure221126122310"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="创建ssl--vpn客户端地址池">创建SSL VPN客户端地址池
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>地址池名称： SSLVPNPOOL&lt;/p>
&lt;/li>
&lt;li>
&lt;p>172.31.200.10 - 172.31.200.100&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/9StT357Dfmk2lj8.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/9StT357Dfmk2lj8.jpg"
loading="lazy"
alt="ScreenCaputure221126122347"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="配置ssl-vpn访问实例">配置SSL VPN访问实例
&lt;/h3>&lt;ul>
&lt;li>访问实例： KIRIP&lt;/li>
&lt;li>关联网关：SSLVPNGW&lt;/li>
&lt;li>url acl: None&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/CJVZL3STvasDp2G.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/CJVZL3STvasDp2G.jpg"
loading="lazy"
alt="ScreenCaputure221126122432"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/e6ghlcyE2nKuYkj.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/e6ghlcyE2nKuYkj.jpg"
loading="lazy"
alt="ScreenCaputure221126122521"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>
&lt;p>IP业务：&lt;/p>
&lt;ul>
&lt;li>
&lt;p>​ IP接入接口：SSLVPN-AC1 INTERFACE&lt;/p>
&lt;/li>
&lt;li>
&lt;p>​ 客户端地址池：SSLVPNPOOL&lt;/p>
&lt;/li>
&lt;li>
&lt;p>IP接入资源：添加要被VPN接入客户端访问的网络 : ROUTERLIST:&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>​ 172.16.1.0/24&lt;/p>
&lt;p>​ ……&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/tpb9CPyxr3kuRsI.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/tpb9CPyxr3kuRsI.jpg"
loading="lazy"
alt="ScreenCaputure221126122536"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/KhsJiqZn4afRIQ1.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/KhsJiqZn4afRIQ1.jpg"
loading="lazy"
alt="ScreenCaputure221126122634"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/iynU2qlutawKPsF.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/iynU2qlutawKPsF.jpg"
loading="lazy"
alt="ScreenCaputure221126122716"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/MWqR9i7eynPNrAH.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/MWqR9i7eynPNrAH.jpg"
loading="lazy"
alt="ScreenCaputure221126122723"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/ukL5VOaitIjWpch.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/ukL5VOaitIjWpch.jpg"
loading="lazy"
alt="ScreenCaputure221126122747"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>
&lt;p>不配置快捷方式，next&lt;/p>
&lt;/li>
&lt;li>
&lt;p>配置资源组&lt;/p>
&lt;ul>
&lt;li>资源组名称：RESOURCEGROUP&lt;/li>
&lt;li>指定路由接入VPN：子网资源&lt;/li>
&lt;li>客户端地址池：SSLVPNPOOL&lt;/li>
&lt;li>客户端掩码：24&lt;/li>
&lt;li>acl：3999 (新建acl，rule permit ip)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>完成配置，使能访问实例（勾上）&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/zoRQuITFqvtxka4.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/zoRQuITFqvtxka4.jpg"
loading="lazy"
alt="ScreenCaputure221126122917"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="创建-sslvpn-用户">创建 SSLVPN 用户
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>填写用户名&amp;ndash;&amp;raquo;勾选SSL VPN&lt;/p>
&lt;/li>
&lt;li>
&lt;p>授权属性： SSL VPN 策略组： resourcegroup&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/1Imh2gkDJCzUjZ5.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/1Imh2gkDJCzUjZ5.jpg"
loading="lazy"
alt="ScreenCaputure221126124924"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/n6vmYPWJdAyFX8D.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/n6vmYPWJdAyFX8D.jpg"
loading="lazy"
alt="ScreenCaputure221126124934"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="windows平台-inode-客户端测试">Windows平台 iNode 客户端测试
&lt;/h2>&lt;ul>
&lt;li>新建场景&amp;ndash;&amp;raquo;创建连接&lt;/li>
&lt;/ul>
&lt;table>
&lt;tr>
&lt;td>&lt;img src="https://s2.loli.net/2022/11/26/YIEbLd4NcaSzHFm.jpg">&lt;/td>
&lt;td>&lt;img src="https://s2.loli.net/2022/11/26/fd7ImtU6VzkhTvg.png">&lt;/td>
&lt;/tr>
&lt;/table>
&lt;ul>
&lt;li>查看连接状态和分配到的客户端地址&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/rfRhxltUH9MN2AX.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/rfRhxltUH9MN2AX.jpg"
loading="lazy"
alt="ScreenCaputure221126125942"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>访问资源和跟踪路径&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/C3F8pRToXzd9yi2.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/C3F8pRToXzd9yi2.jpg"
loading="lazy"
alt="ScreenCaputure221126130413"
>
&lt;/a>
&lt;/div>
&lt;/p></description></item><item><title>HCL_FW_IRF_LAB</title><link>https://weeaster.github.io/posts/a89a05d3/</link><pubDate>Tue, 03 May 2022 01:09:15 +0000</pubDate><guid>https://weeaster.github.io/posts/a89a05d3/</guid><description>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/05/03/5tMa692q4rmN1Yu.png">
&lt;img src="https://s2.loli.net/2022/05/03/5tMa692q4rmN1Yu.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="实验目的">实验目的
&lt;/h2>&lt;ul>
&lt;li>验证 H3C 防火墙 IRF 堆叠和主备模式&lt;/li>
&lt;li>基于项目中部分核心网络的模拟器测试&lt;/li>
&lt;li>线路交叉互联的问题&lt;/li>
&lt;/ul>
&lt;h2 id="实验描述">实验描述
&lt;/h2>&lt;h3 id="ip-地址规划和端口互联">IP 地址规划和端口互联
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: left">互联设备&lt;/th>
&lt;th style="text-align: left">&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: left">核心防火墙&amp;lt;&amp;ndash;&amp;gt;核心交换机&lt;/td>
&lt;td style="text-align: left">10.1.1.0/30&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">核心防火墙&amp;lt;&amp;ndash;&amp;gt;服务器汇聚&lt;/td>
&lt;td style="text-align: left">10.1.1.4/30&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">核心防火墙&amp;lt;&amp;ndash;&amp;gt;外联交换机&lt;/td>
&lt;td style="text-align: left">VLAN10:192.168.10.254&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>A端设备&lt;/th>
&lt;th>端口&lt;/th>
&lt;th>B端设备&lt;/th>
&lt;th>端口&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>FW1&lt;/td>
&lt;td>GE0/23&lt;/td>
&lt;td>FW2&lt;/td>
&lt;td>GE0/23&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FW1&lt;/td>
&lt;td>GE0/1&lt;/td>
&lt;td>SW5&lt;/td>
&lt;td>GE0/1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FW1&lt;/td>
&lt;td>GE0/2&lt;/td>
&lt;td>SW6&lt;/td>
&lt;td>GE0/2&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FW1&lt;/td>
&lt;td>GE0/3&lt;/td>
&lt;td>SW3&lt;/td>
&lt;td>GE0/3&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FW1&lt;/td>
&lt;td>GE0/4&lt;/td>
&lt;td>SW4&lt;/td>
&lt;td>GE0/4&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FW1&lt;/td>
&lt;td>GE0/11&lt;/td>
&lt;td>SW7&lt;/td>
&lt;td>GE0/1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FW2&lt;/td>
&lt;td>GE0/1&lt;/td>
&lt;td>SW6&lt;/td>
&lt;td>GE0/1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FW2&lt;/td>
&lt;td>GE0/2&lt;/td>
&lt;td>SW5&lt;/td>
&lt;td>GE0/2&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FW2&lt;/td>
&lt;td>GE0/3&lt;/td>
&lt;td>SW4&lt;/td>
&lt;td>GE0/3&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FW2&lt;/td>
&lt;td>GE0/4&lt;/td>
&lt;td>SW3&lt;/td>
&lt;td>GE0/4&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FW2&lt;/td>
&lt;td>GE0/11&lt;/td>
&lt;td>SW7&lt;/td>
&lt;td>GE0/2&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="防火墙安全域划分">防火墙安全域划分
&lt;/h3>&lt;p>核心交换机：Trust&lt;/p>
&lt;p>服务器汇聚：Server&lt;/p>
&lt;p>外联交换机：Untrust&lt;/p>
&lt;h2 id="配置思路">配置思路
&lt;/h2>&lt;ol>
&lt;li>FW1 与 FW2 之间 IRF 堆叠；SW3 与 SW4 之间 IRF 堆叠；SW5 与 SW6 之间 IRF 堆叠；&lt;/li>
&lt;li>设备互联的端口聚合配置，配置系统优先级和端口优先级，使流量优先流经“主”用设备&lt;/li>
&lt;li>配置互联地址，确保逻辑直连的互通&lt;/li>
&lt;li>配置防火墙安全域和安全策略&lt;/li>
&lt;li>配置 PC IP地址确保与网关的连通性&lt;/li>
&lt;li>配置静态路由确保网络互通&lt;/li>
&lt;li>进行倒换倒回观察网络连通性&lt;/li>
&lt;li>模拟线路故障观察网络连通性&lt;/li>
&lt;/ol>
&lt;h2 id="配置文件">配置文件
&lt;/h2>&lt;ul>
&lt;li>见文末&lt;/li>
&lt;/ul>
&lt;h2 id="聊点什么">聊点什么
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>就线路交叉互联问题，与老友交谈，据他说这种互联方式可能导致丢包现象，例如，流量分别从SW3的G0/3接口和SW4的G0/4接口进入FW1，G0/4的流量会被认为非法流量而丢弃，盲猜是因为会话状态机模式设为严格模式，而运行中出现了来回路径不一致的问题导致丢包。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>就这个交叉互联问题与华三400聊了近半小时，对方给出的方案是按完美的主备处理方式进行组网，（在网络正常的情况下）即流量永远只走一边，只要防火墙上有一个端口出现故障，冗余组全部切换到备。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>主备模式下，设置冗余组，主成员下的端口有任一出现问题，就会整体切换到备，而备设备如在整体切换就有部分端口故障，此时主成员设备的UP状态的端口会在 DOWN 和 DOWN(redundancy down) 之间反复恒跳，而Status出现两个 Secondary，Slot1 的Track优先级也会随着端口的两个 DOWN 状态不同而变化。注意，此时网络并没有中断。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Redundancy group 11 (ID 1):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Node ID Slot Priority Status Track weight
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 Slot1 1 Secondary -1020
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2 Slot2 1 Secondary -255
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>要严格控制流量走一边的情况，就需要接入层网上的设备互联都使用双线互联。而万一“主”设备上联到上一层“主”设备的线路故障了，那么恭喜你可能网络瘫痪了，举个例子，拓扑中SW3与SW11的G0/1接口down，因为SW11上联的两根线路做了聚合，SW11上联的流量会通过G0/2向上走，相当于在核心交换机的SW4上接了一台 PC ，你觉得流量再往上层该怎么走？走到FW2备成员？而FW2是备用状态不处理流量。写到这我才想起来原来华三400建议做两个聚合组是有道理的，SW4 G0/4和G0/3做一个聚合组，就可以人为限制流量又走到FW1，秒啊。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>继续上一条，不使用两组聚合的方式，关闭IRF的本地优先转发，核心交换机上就出现跨框流量，即进入SW4的流量要往上走，要绕道SW3上去，这明显不合理了。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>继续上一条，假如使用核心交换机上联防火墙4根线做一个三层聚合组，FW1往下回流量的时候，由于负载分担的方式，又有可能把流量回给SW4。综合一下，在聚合组配置selected-port maximum 1 同时配置lacp的端口优先级呢，是不是觉得这个方法又蠢又无奈又有用。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>对于要把外联区（SW7）的网关设置在防火墙上的问题，还有一种方式是用 RETH 接口，但是我模拟器配置了，且SW7 查看arp都能看到网关的条目了，就是不通，希望是模拟器bug了，有机会去真机上测试一下再回来聊聊。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>不知道是不是我的错觉，用HCL模拟器做这种冗余类实验，老是出现一些不能理解的问题，这边十万八千里shutdown个端口，那边会受影响那种。&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="ending">Ending
&lt;/h2>&lt;ul>
&lt;li>文中可能有些配置未提及或内容术语表述的不规范，请见谅。&lt;/li>
&lt;li>配置存阿里云盘了，这是链接：[&lt;a class="link" href="https://www.aliyundrive.com/s/1waTfsXdwdm" target="_blank" rel="noopener"
>分享的文件
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>]&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨。&lt;/li>
&lt;/ul></description></item><item><title>HCL_VPN不同实例互通实验</title><link>https://weeaster.github.io/posts/eb7e5d69/</link><pubDate>Tue, 27 Apr 2021 11:35:32 +0000</pubDate><guid>https://weeaster.github.io/posts/eb7e5d69/</guid><description>&lt;p>&lt;strong>实验拓扑和需求&lt;/strong>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/04/27/Zf26CX97SRQzrvu.jpg">
&lt;img src="https://i.loli.net/2021/04/27/Zf26CX97SRQzrvu.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>实验模拟的是一个总部和一个分支站点的网络，网络中总部和分支相同 VPN 实例网络互通，不同 VPN 实例网络相互隔离，总部 VPN2 中特殊主机 PC_8 需要访问位于分支网络中的 VPN1 网络&lt;/p>
&lt;hr>
&lt;h2 id="思路和解决方法">&lt;strong>思路和解决方法&lt;/strong>
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>网络设备中配置 VPN instance 用来隔离不同网络数据&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在不做特殊配置的情况下，不同 VPN 实例的网络是不能互相通信的&lt;/p>
&lt;/li>
&lt;li>
&lt;p>然而在设备上 VPN 实例引入其他 VPN 实例网络又会造成不同实例间网络能互通的情况，进而要做各种 ACL 限制&lt;/p>
&lt;/li>
&lt;li>
&lt;p>实验中并不涉及 MPLS VPN 的场景，有点类似 H3C 文档中 MCE 的情况，但是不涉及 CE、PE、RD、RT……&lt;/p>
&lt;/li>
&lt;li>
&lt;p>RD 是用来做路由区分的，RT 是 BGP 协议中团体属性的内容，本实验中都不涉及，本来也考虑使用 MPLS VPN 的方式做，但是就当前这个场景完全不需要，客户只需要把原有不同的几套网络隔离，还要考虑到设备特性，设备性能等等&lt;/p>
&lt;/li>
&lt;li>
&lt;p>实验中在路由经过的下一跳的设备上都要配置 VPN 实例，核心下联的二层设备不需要配置&lt;/p>
&lt;/li>
&lt;li>
&lt;p>由于不使用引入其他 VPN 实例的方式，需要在总部路由器和总部交换机上配置 VPN 静态路由&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="具体配置">&lt;strong>具体配置&lt;/strong>
&lt;/h2>&lt;h3 id="site_sw">&lt;strong>SITE_SW&lt;/strong>
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sysname SITE_SW
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 配置rip 100 绑定VPN1，宣告与总部互联的网络和分支VPN1的网络
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rip 100 vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> undo summary
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> version 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 10.1.1.1 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.10.254 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 配置rip 200 绑定VPN2，宣告与总部互联的网络和分支VPN2的网络
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rip 200 vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> undo summary
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> version 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 20.1.1.1 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.20.254 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 不重要的dhcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vlan 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vlan 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 不重要的dhcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dhcp server ip-pool vlan10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gateway-list 172.16.10.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.10.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 不重要的dhcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dhcp server ip-pool vlan20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gateway-list 172.16.20.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.20.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Vlan-interface10为VPN1网络网关
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan-interface10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 172.16.10.254 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Vlan-interface20为VPN1网络网关
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan-interface20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 172.16.20.254 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 与总部互联物理接口
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port link-mode route
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 使用子接口与总部互联，绑定VPN1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/3.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.1.1.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 使用子接口与总部互联，绑定VPN2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/3.20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 20.1.1.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 不重要
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port access vlan 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> stp edged-port
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 不重要
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port access vlan 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> stp edged-port
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h3 id="hq_router">&lt;strong>HQ_ROUTER&lt;/strong>
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sysname HQ_ROUTER
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 配置rip 100 绑定VPN1，宣告与分支互联的网络，与HQ_SW互联的网络，引入手动配置的去往PC_8主机的路由
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rip 100 vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> undo summary
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> version 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 10.1.1.2 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.1.1.1 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> import-route static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 配置rip 200 绑定VPN2，宣告与分支互联的网络，与HQ_SW互联的网络
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rip 200 vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> undo summary
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> version 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 20.1.1.2 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.1.1.1 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vlan 111
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vlan 222
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 与HQ_SW VPN1 互联vlanif接口
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan-interface111
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 100.1.1.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 与HQ_SW VPN2 互联vlanif接口
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan-interface222
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 100.1.1.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 与分支互联物理接口
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port link-mode route
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> combo enable copper
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 使用子接口与分支互联，绑定VPN1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.1.1.2 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vlan-type dot1q vid 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 使用子接口与分支互联，绑定VPN2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0.20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 20.1.1.2 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vlan-type dot1q vid 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 与HQ_SW互联的物理接口
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port link-mode bridge
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port link-type trunk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port trunk permit vlan all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> combo enable copper
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 在vpn1网络中配置的去往PC_8主机的路由
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip route-static vpn-instance vpn1 192.168.40.200 32 vpn-instance vpn2 100.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h3 id="hq_sw">&lt;strong>HQ_SW&lt;/strong>
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sysname HQ_SW
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 配置rip 100 绑定VPN1，宣告与HQ_ROUTER互联的网络和总部VPN1的网络，注意有一条路由过滤，因为在HQ_ROUTER中引入了手动配置的静态的路由，而在HQ_SW VPN1网络中不需要
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rip 100 vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> undo summary
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> version 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.1.1.2 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 192.168.30.254 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> filter-policy prefix-list filter_192.168.40.200 import
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 配置rip 200 绑定VPN2，宣告与HQ_ROUTER互联的网络和总部VPN2的网络
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rip 200 vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> undo summary
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> version 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.1.1.2 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 192.168.40.254 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 不重要的dhcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vlan 30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vlan 40
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vlan 111
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vlan 222
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 不重要的dhcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dhcp server ip-pool vlan30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gateway-list 192.168.30.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 192.168.30.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 不重要的dhcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dhcp server ip-pool vlan40
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gateway-list 192.168.40.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 192.168.40.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> forbidden-ip 192.168.40.200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># vlan30为VPN1网络网关
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan-interface30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.30.254 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># vlan40为VPN1网络网关
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan-interface40
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.40.254 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> packet-filter 3001 inbound
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 与HQ_ROUTER VPN1 互联vlanif接口
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan-interface111
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 100.1.1.2 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 与HQ_ROUTER VPN2 互联vlanif接口
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan-interface222
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 100.1.1.2 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 与HQ_ROUTER互联的物理接口
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port link-mode bridge
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port link-type trunk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port trunk permit vlan all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> combo enable fiber
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 配置前缀列表，过滤从HQ_ROUTER学习到的特殊主机路由
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip prefix-list filter_192.168.40.200 index 10 deny 192.168.40.2 32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip prefix-list filter_192.168.40.200 index 20 permit 0.0.0.0 0 less-equal 32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 配置总部VPN2网络到分支VPN1网络的路由
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip route-static vpn-instance vpn2 172.16.10.0 24 vpn-instance vpn1 100.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 限制除PC_8外去往分支VPN1网络的流量
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl advanced 3001
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 0 permit ip source 192.168.40.200 0 destination 172.16.10.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 5 deny ip source 192.168.40.0 0.0.0.255 destination 172.16.10.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 10 permit ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>HCL_路由器双出口策略配置实验</title><link>https://weeaster.github.io/posts/4e82271c/</link><pubDate>Mon, 01 Feb 2021 14:22:41 +0000</pubDate><guid>https://weeaster.github.io/posts/4e82271c/</guid><description>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/02/01/YN6r5C1xyvfmETd.png">
&lt;img src="https://i.loli.net/2021/02/01/YN6r5C1xyvfmETd.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="路由器出口策略配置说明">路由器出口策略配置说明
&lt;/h2>&lt;h3 id="nqa">NQA
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 配置探测电信DNS的NQA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nqa entry admin isp_telecom_test
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type icmp-echo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination ip 202.103.224.68 //探测远端DNS地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> frequency 2000 //每间隔2秒探测一次
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> history-record enable //开启NQA历史记录保存功能
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> history-record number 5 //保存的最大历史记录个数为5条
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> next-hop ip 101.1.1.2 //探测报文经过的下一跳
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> probe count 5 //每次探测检测5次
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> probe timeout 1000 //检测超时时间1秒
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reaction 1 checked-element probe-fail threshold-type consecutive 5 action-type trigger-only //连续探测失败5次，触发其他模块联动
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source ip 101.1.1.1 //探测报文源地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 配置探测联通DNS的NQA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nqa entry admin isp_unicom_test
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type icmp-echo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination ip 211.138.240.100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> frequency 2000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> history-record enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> history-record number 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> next-hop ip 202.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> probe count 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> probe timeout 1000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reaction 1 checked-element probe-fail threshold-type consecutive 5 action-type trigger-only
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source ip 202.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 当前时间起永久启用NQA监测
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nqa schedule admin isp_telecom_test start-time now lifetime forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nqa schedule admin isp_unicom_test start-time now lifetime forever
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="track-关联-nqa">track 关联 NQA
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">track 100 nqa entry admin isp_telecom_test reaction 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">track 200 nqa entry admin isp_unicom_test reaction 1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="策略路由配置联动">策略路由配置，联动
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl advanced 3002
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 0 permit ip source 192.168.20.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 指定下一跳时与track 200联动，当NQA监测失败结果时，策略路由失效，流量根据路由表转发流量
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">policy-based-route to_isp_policy permit node 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if-match acl 3002
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> apply next-hop 202.1.1.2 track 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 默认路由与track 100联动，当NQA监测失败结果时，该条默认路由失效，优先级为80的默认路由加载路由表，流量根据路由表转发流量
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip route-static 0.0.0.0 0 101.1.1.2 track 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip route-static 0.0.0.0 0 202.1.1.2 preference 80
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 内网流量入接口下调用策略路由
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip policy-based-route to_isp_policy
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="测试说明">测试说明：
&lt;/h2>&lt;p>外网网络正常情况，查看 nqa 监测结果，探测发出的数据包和收到的数据包数量一致&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/02/01/HvybjOQ13LX5nCd.png">
&lt;img src="https://i.loli.net/2021/02/01/HvybjOQ13LX5nCd.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>通过 debug 查看 NAT 转换信息，vlan10 去往互联网 DNS 地址的流量走101.1.1.2下一跳地址，vlan20 去往互联网 DNS 地址的流量走 202.1.1.2 下一跳地址&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/02/01/6jezdH7ZCBkfVxG.png">
&lt;img src="https://i.loli.net/2021/02/01/6jezdH7ZCBkfVxG.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="当电信网络不可用时">当电信网络不可用时
&lt;/h3>&lt;p>当电信网络不可用时，路由器日志提示 prob-fail，此时 NQA 探测收到的 icmp-reply 数据包为 0&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/02/01/QTfK8veUMG9NFnk.png">
&lt;img src="https://i.loli.net/2021/02/01/QTfK8veUMG9NFnk.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/02/01/1zrq6wU7BJvs5kS.png">
&lt;img src="https://i.loli.net/2021/02/01/1zrq6wU7BJvs5kS.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>路由表中，默认路由的下一跳为 202.1.1.2&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/02/01/EvY1ARqf8XWuNye.png">
&lt;img src="https://i.loli.net/2021/02/01/EvY1ARqf8XWuNye.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>查看 NAT 会话表，有 vlan10，vlan20 的流量会话&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/02/01/5iHdByYflu6XtOG.png">
&lt;img src="https://i.loli.net/2021/02/01/5iHdByYflu6XtOG.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>通过 debug 查看 NAT 转换信息，所有流量走联通网络出口&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/02/01/Cv84ktVDedW9sYx.png">
&lt;img src="https://i.loli.net/2021/02/01/Cv84ktVDedW9sYx.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="当联通网络不可用时">当联通网络不可用时
&lt;/h3>&lt;p>当联通网络不可用时，路由器日志提示 prob-fail，此时 NQA 探测收到的 icmp-reply 数据包为0&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/02/01/xuc7PRo9FBYpIVE.png">
&lt;img src="https://i.loli.net/2021/02/01/xuc7PRo9FBYpIVE.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/02/01/57eGLloi4RWnFkh.png">
&lt;img src="https://i.loli.net/2021/02/01/57eGLloi4RWnFkh.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>查看 NAT 会话表，有 vlan10，vlan20 的流量会话&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/02/01/8XskBLebAmqJohc.png">
&lt;img src="https://i.loli.net/2021/02/01/8XskBLebAmqJohc.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>通过 debug 查看 NAT 转换信息，所有流量走电信网络出口&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/02/01/bXINu8lvyMYDkjo.png">
&lt;img src="https://i.loli.net/2021/02/01/bXINu8lvyMYDkjo.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="路由器配置">路由器配置：
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sysname&lt;/span> &lt;span class="n">Router&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">track&lt;/span> &lt;span class="mi">100&lt;/span> &lt;span class="n">nqa&lt;/span> &lt;span class="n">entry&lt;/span> &lt;span class="n">admin&lt;/span> &lt;span class="n">isp_telecom_test&lt;/span> &lt;span class="n">reaction&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">track&lt;/span> &lt;span class="mi">200&lt;/span> &lt;span class="n">nqa&lt;/span> &lt;span class="n">entry&lt;/span> &lt;span class="n">admin&lt;/span> &lt;span class="n">isp_unicom_test&lt;/span> &lt;span class="n">reaction&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">system&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">working&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mode&lt;/span> &lt;span class="n">standard&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">xbar&lt;/span> &lt;span class="nb">load&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">single&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">password&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">recovery&lt;/span> &lt;span class="n">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lpu&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">series&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">vlan&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">policy&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">based&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">route&lt;/span> &lt;span class="n">to_isp_policy&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="n">node&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">match&lt;/span> &lt;span class="n">acl&lt;/span> &lt;span class="mi">3002&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">apply&lt;/span> &lt;span class="n">next&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">hop&lt;/span> &lt;span class="mf">202.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span> &lt;span class="n">track&lt;/span> &lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nqa&lt;/span> &lt;span class="n">entry&lt;/span> &lt;span class="n">admin&lt;/span> &lt;span class="n">isp_telecom_test&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span> &lt;span class="n">icmp&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">echo&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">destination&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="mf">202.103&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">224.68&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">frequency&lt;/span> &lt;span class="mi">2000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">history&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">record&lt;/span> &lt;span class="n">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">history&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">record&lt;/span> &lt;span class="n">number&lt;/span> &lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">next&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">hop&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="mf">101.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">probe&lt;/span> &lt;span class="n">count&lt;/span> &lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">probe&lt;/span> &lt;span class="n">timeout&lt;/span> &lt;span class="mi">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reaction&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">checked&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">element&lt;/span> &lt;span class="n">probe&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">fail&lt;/span> &lt;span class="n">threshold&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">consecutive&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="n">action&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">trigger&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">only&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">source&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="mf">101.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nqa&lt;/span> &lt;span class="n">entry&lt;/span> &lt;span class="n">admin&lt;/span> &lt;span class="n">isp_unicom_test&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span> &lt;span class="n">icmp&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">echo&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">destination&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="mf">211.138&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">240.100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">frequency&lt;/span> &lt;span class="mi">2000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">history&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">record&lt;/span> &lt;span class="n">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">history&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">record&lt;/span> &lt;span class="n">number&lt;/span> &lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">next&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">hop&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="mf">202.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">probe&lt;/span> &lt;span class="n">count&lt;/span> &lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">probe&lt;/span> &lt;span class="n">timeout&lt;/span> &lt;span class="mi">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reaction&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">checked&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">element&lt;/span> &lt;span class="n">probe&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">fail&lt;/span> &lt;span class="n">threshold&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">consecutive&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="n">action&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">trigger&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">only&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">source&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="mf">202.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nqa&lt;/span> &lt;span class="n">schedule&lt;/span> &lt;span class="n">admin&lt;/span> &lt;span class="n">isp_telecom_test&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">time&lt;/span> &lt;span class="n">now&lt;/span> &lt;span class="n">lifetime&lt;/span> &lt;span class="n">forever&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nqa&lt;/span> &lt;span class="n">schedule&lt;/span> &lt;span class="n">admin&lt;/span> &lt;span class="n">isp_unicom_test&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">time&lt;/span> &lt;span class="n">now&lt;/span> &lt;span class="n">lifetime&lt;/span> &lt;span class="n">forever&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Serial1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Serial2&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Serial3&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Serial4&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">NULL0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">port&lt;/span> &lt;span class="n">link&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mode&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">combo&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="n">copper&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">policy&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">based&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">route&lt;/span> &lt;span class="n">to_isp_policy&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">port&lt;/span> &lt;span class="n">link&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mode&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">combo&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="n">copper&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">101.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nat&lt;/span> &lt;span class="n">outbound&lt;/span> &lt;span class="mi">3001&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">port&lt;/span> &lt;span class="n">link&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mode&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">combo&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="n">copper&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">202.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nat&lt;/span> &lt;span class="n">outbound&lt;/span> &lt;span class="mi">3001&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet5&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">port&lt;/span> &lt;span class="n">link&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mode&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">combo&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="n">copper&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet5&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">port&lt;/span> &lt;span class="n">link&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mode&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">combo&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="n">copper&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet6&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">port&lt;/span> &lt;span class="n">link&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mode&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">combo&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="n">copper&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet6&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">port&lt;/span> &lt;span class="n">link&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mode&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">combo&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="n">copper&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">scheduler&lt;/span> &lt;span class="n">logfile&lt;/span> &lt;span class="n">size&lt;/span> &lt;span class="mi">16&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">line&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="n">aux&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">user&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span> &lt;span class="n">network&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">operator&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">line&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="n">console&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">user&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span> &lt;span class="n">network&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">admin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">line&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="n">tty&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">user&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span> &lt;span class="n">network&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">operator&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">line&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="n">vty&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">user&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span> &lt;span class="n">network&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">operator&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">line&lt;/span> &lt;span class="n">aux&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">user&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span> &lt;span class="n">network&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">operator&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">line&lt;/span> &lt;span class="n">con&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">user&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span> &lt;span class="n">network&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">admin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">line&lt;/span> &lt;span class="n">vty&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">63&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">user&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span> &lt;span class="n">network&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">operator&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mf">101.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span> &lt;span class="n">track&lt;/span> &lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mf">202.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span> &lt;span class="n">preference&lt;/span> &lt;span class="mi">80&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">10.0&lt;/span> &lt;span class="mi">24&lt;/span> &lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">20.0&lt;/span> &lt;span class="mi">24&lt;/span> &lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">acl&lt;/span> &lt;span class="n">advanced&lt;/span> &lt;span class="mi">3001&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rule&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="n">ip&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">acl&lt;/span> &lt;span class="n">advanced&lt;/span> &lt;span class="mi">3002&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rule&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">20.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">domain&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">domain&lt;/span> &lt;span class="n">default&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="n">system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">3&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">4&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">5&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">6&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">6&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">7&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">7&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">8&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">9&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">9&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">10&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">11&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">12&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">13&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">13&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">14&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">14&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">user&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">group&lt;/span> &lt;span class="n">system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">return&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Router&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>HCL_一个小实验的思路</title><link>https://weeaster.github.io/posts/c7ac5477/</link><pubDate>Thu, 21 Jan 2021 08:31:24 +0000</pubDate><guid>https://weeaster.github.io/posts/c7ac5477/</guid><description>&lt;p>&lt;strong>实验说明：&lt;/strong>&lt;/p>
&lt;p>&lt;strong>设备互联线路，IP 地址、路由协议、可靠性等配置自定义&lt;/strong>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/01/21/1x5uRqEXDlGcigv.jpg">
&lt;img src="https://i.loli.net/2021/01/21/1x5uRqEXDlGcigv.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="实验效果">实验效果：
&lt;/h2>&lt;ul>
&lt;li>PC_1 网段流量经R1出互联网&lt;/li>
&lt;li>PC_2 网段流量经R2出互联网&lt;/li>
&lt;li>当任意互联网线路故障后，全部流量走另一线路出互联网&lt;/li>
&lt;/ul>
&lt;h2 id="解决思路">解决思路：
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>设备互联，IP地址规划如图&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/01/21/mHXfo1pLUrneKgs.png">
&lt;img src="https://i.loli.net/2021/01/21/mHXfo1pLUrneKgs.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Core_SW1、Core_SW2 做堆叠，F1/0/53 to F1/0/54堆叠口，Ten 1/0/50为 BFD 检测线&lt;/strong>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;Core_SW1&amp;gt;dis irf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">MemberID Role Priority CPU-Mac Description
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *+1 Master 15 72f0-e201-0504 ---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2 Standby 10 72f0-e6bc-0604 ---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * indicates the device is the master.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> + indicates the device through which the user logs in.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;Core_SW1&amp;gt;dis irf topology
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Topology Info
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IRF-Port1 IRF-Port2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> MemberID Link neighbor Link neighbor Belong To
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 DIS --- UP 2 72f0-e201-0504
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2 UP 1 DIS --- 72f0-e201-0504
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>核心交换机 Core_SW 与 R1, R2 之间启用三层聚合链路&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;Core_SW1&amp;gt;dis link-aggregation summary
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Aggregation Interface Type:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BAGG -- Bridge-Aggregation, BLAGG -- Blade-Aggregation, RAGG -- Route-Aggregation, SCH-B -- Schannel-Bundle
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Aggregation Mode: S -- Static, D -- Dynamic
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Loadsharing Type: Shar -- Loadsharing, NonS -- Non-Loadsharing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Actor System ID: 0x8000, 72f0-e201-0500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">AGG AGG Partner ID Selected Unselected Individual Share
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Interface Mode Ports Ports Ports Type
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BAGG3 S None 2 0 0 Shar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RAGG1 S None 2 0 0 Shar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RAGG2 S None 2 0 0 Shar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;Core_SW1&amp;gt;dis ip int b
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*down: administratively down
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(s): spoofing (l): loopback
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Interface Physical Protocol IP Address Description
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE1/0/1 up up -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE1/0/2 up up -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE2/0/1 up up -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE2/0/2 up up -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">MGE0/0/0 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RAGG1 up up 10.1.1.1 --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RAGG2 up up 10.1.1.5 --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Vlan10 up up 192.168.10.254 --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Vlan20 up up 192.168.20.254 --
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;R1&amp;gt;dis link-aggregation verbose
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Loadsharing Type: Shar -- Loadsharing, NonS -- Non-Loadsharing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Port: A -- Auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Port Status: S -- Selected, U -- Unselected, I -- Individual
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Flags: A -- LACP_Activity, B -- LACP_Timeout, C -- Aggregation,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> D -- Synchronization, E -- Collecting, F -- Distributing,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> G -- Defaulted, H -- Expired
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Aggregate Interface: Route-Aggregation1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Aggregation Mode: Static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Loadsharing Type: Shar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Port Status Priority Oper-Key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> GE0/1 S 32768 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> GE0/2 S 32768 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;R1&amp;gt;dis ip int b
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*down: administratively down
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(s): spoofing (l): loopback
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Interface Physical Protocol IP Address Description
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE0/0 up up 101.1.1.1 --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE0/1 up up -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE0/2 up up -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE5/0 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE5/1 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE6/0 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE6/1 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RAGG1 up up 10.1.1.2 --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ser1/0 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ser2/0 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ser3/0 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ser4/0 down down -- --
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;R2&amp;gt;dis link-aggregation verbose
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Loadsharing Type: Shar -- Loadsharing, NonS -- Non-Loadsharing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Port: A -- Auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Port Status: S -- Selected, U -- Unselected, I -- Individual
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Flags: A -- LACP_Activity, B -- LACP_Timeout, C -- Aggregation,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> D -- Synchronization, E -- Collecting, F -- Distributing,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> G -- Defaulted, H -- Expired
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Aggregate Interface: Route-Aggregation1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Aggregation Mode: Static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Loadsharing Type: Shar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Port Status Priority Oper-Key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> GE0/1 S 32768 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> GE0/2 S 32768 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;R2&amp;gt;dis ip int b
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*down: administratively down
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(s): spoofing (l): loopback
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Interface Physical Protocol IP Address Description
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE0/0 up up 201.1.1.1 --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE0/1 up up -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE0/2 up up -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE5/0 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE5/1 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE6/0 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE6/1 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RAGG1 up up 10.1.1.6 --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ser1/0 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ser2/0 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ser3/0 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ser4/0 down down -- --
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;strong>核心交换机 Core_SW 与 SW3 之间启用二层聚合链路&lt;/strong>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;SW3&amp;gt;dis link-aggregation verbose
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Loadsharing Type: Shar -- Loadsharing, NonS -- Non-Loadsharing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Port: A -- Auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Port Status: S -- Selected, U -- Unselected, I -- Individual
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Flags: A -- LACP_Activity, B -- LACP_Timeout, C -- Aggregation,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> D -- Synchronization, E -- Collecting, F -- Distributing,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> G -- Defaulted, H -- Expired
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Aggregate Interface: Bridge-Aggregation1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Aggregation Mode: Static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Loadsharing Type: Shar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Port Status Priority Oper-Key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> GE1/0/1 S 32768 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> GE1/0/2 S 32768 1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;strong>核心交换机 Core_SW 配置静态路由；R1、R2 配置默认路由下一跳指向 ISP 设备地址、配置回程静态路由指向 Core_SW 三层聚合接口地址&lt;/strong>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;Core_SW1&amp;gt;dis cur | inc route
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">policy-based-route vlan20nexthop permit node 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip policy-based-route vlan20nexthop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port link-mode route
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port link-mode route
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port link-mode route
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port link-mode route
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip route-static 0.0.0.0 0 10.1.1.2 track 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip route-static 0.0.0.0 0 10.1.1.6 preference 80
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;R1&amp;gt;dis ip routing-table pro static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Summary count : 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Static Routing table status : &amp;lt;Active&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Summary count : 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Destination/Mask Proto Pre Cost NextHop Interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">0.0.0.0/0 Static 60 0 101.1.1.2 GE0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.10.0/24 Static 60 0 10.1.1.1 RAGG1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.20.0/24 Static 60 0 10.1.1.1 RAGG1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Static Routing table status : &amp;lt;Inactive&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Summary count : 0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;R2&amp;gt;dis ip routing-table pro static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Summary count : 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Static Routing table status : &amp;lt;Active&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Summary count : 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Destination/Mask Proto Pre Cost NextHop Interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">0.0.0.0/0 Static 60 0 201.1.1.2 GE0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.10.0/24 Static 60 0 10.1.1.5 RAGG1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.20.0/24 Static 60 0 10.1.1.5 RAGG1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Static Routing table status : &amp;lt;Inactive&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Summary count : 0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;strong>核心交换机 Core_SW 配置 NQA，检测 ISP_1, ISP_2 可达性，关联 Track 与静态路由、策略路由联动&lt;/strong>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nqa entry admin isp_1_test
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type icmp-echo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination ip 101.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> frequency 2000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> history-record enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> history-record number 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> next-hop ip 10.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> probe count 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> probe timeout 1000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reaction 1 checked-element probe-fail threshold-type consecutive 3 action-type trigger-only
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source ip 10.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nqa entry admin isp_2_test
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type icmp-echo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination ip 201.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> frequency 2000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> history-record enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> history-record number 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> next-hop ip 10.1.1.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> probe count 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> probe timeout 1000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reaction 1 checked-element probe-fail threshold-type consecutive 3 action-type trigger-only
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source ip 10.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nqa schedule admin isp_1_test start-time now lifetime forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nqa schedule admin isp_2_test start-time now lifetime forever
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">track 1 nqa entry admin isp_2_test reaction 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">track 2 nqa entry admin isp_1_test reaction 1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip route-static 0.0.0.0 0 10.1.1.2 track 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip route-static 0.0.0.0 0 10.1.1.6 preference 80
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">policy-based-route vlan20nexthop permit node 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if-match acl 3001
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> apply next-hop 10.1.1.6 track 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl advanced 3001
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 5 deny ip source 192.168.20.0 0.0.0.255 destination 192.168.10.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 10 permit ip source 192.168.20.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;strong>ISP 网络设备配置 OSPF&lt;/strong>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;ISP_NETWORK&amp;gt;dis ip routing-table protocol ospf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Summary count : 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OSPF Routing table status : &amp;lt;Active&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Summary count : 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Destination/Mask Proto Pre Cost NextHop Interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">101.1.1.0/30 O_INTRA 10 2 101.1.1.5 GE0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">201.1.1.0/30 O_INTRA 10 2 201.1.1.5 GE0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OSPF Routing table status : &amp;lt;Inactive&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Summary count : 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Destination/Mask Proto Pre Cost NextHop Interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1.2.3.4/32 O_INTRA 10 0 0.0.0.0 Loop0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">101.1.1.4/30 O_INTRA 10 1 0.0.0.0 GE0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">201.1.1.4/30 O_INTRA 10 1 0.0.0.0 GE0/2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>
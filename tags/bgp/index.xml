<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>BGP on Kir's Blog</title><link>https://weeaster.github.io/tags/bgp/</link><description>Recent content in BGP on Kir's Blog</description><generator>Hugo -- gohugo.io</generator><language>en</language><copyright>@kiraster</copyright><lastBuildDate>Thu, 01 Feb 2024 16:57:52 +0000</lastBuildDate><atom:link href="https://weeaster.github.io/tags/bgp/index.xml" rel="self" type="application/rss+xml"/><item><title>MPLS排错练习题-故障排除</title><link>https://weeaster.github.io/posts/464b24f1/</link><pubDate>Thu, 01 Feb 2024 16:57:52 +0000</pubDate><guid>https://weeaster.github.io/posts/464b24f1/</guid><description>&lt;p>在51cto博客https://blog.51cto.com/dashu666/2163481 看到达叔的这份MPLS排错练习题分享文章，心痒痒决定手搓玩一玩&lt;/p>
&lt;p>MPLS 环境如下图，现由于前面负责实施的工程师离职，留下烂尾工程，请按下面截图找出目前配置存在的错误并修复，要求项目部署完毕之后所有检查命令输出要和下面截图一致。
要求R7 和R8两个站点通信必须经过R6的全局处理、要求R6 的 vrfA 和 R7、R8能够直接通信&lt;/p>
&lt;p>同时要求交一份排除故障的文档。
要求在文档中指出配置错误的地方，以及产生的影响，解决的方案。
不能使用任何静态路由、不允许修改 R4、R5 的 VRF 配置、不允许修改 R6的BGP配置&lt;/p>
&lt;hr>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/02/01/cmZPLOSuElAsx3N.jpg">
&lt;img src="https://s2.loli.net/2024/02/01/cmZPLOSuElAsx3N.jpg"
loading="lazy"
alt="ScreenCaputure240201002259"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="排查r1到1011232的mpls标签转发问题">排查R1到10.1.1.2/32的MPLS标签转发问题
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>在R1上输入命令ping mpls ipv4 10.1.1.2/32 source 10.1.1.1，验证R1到10.1.1.2/32的MPLS标签转发过程问题存在&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1#ping mpls ipv4 10.1.1.2/32 source 10.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.2/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.....
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 0 percent (0/5)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>在R1上使用命令show mpls forwarding-table 查看LFIB&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1#show mpls forwarding-table
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Local Outgoing Prefix Bytes Label Outgoing Next Hop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Label Label or Tunnel Id Switched interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">102 Pop Label 10.1.1.3/32 0 Et0/0 13.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">103 304 10.1.1.2/32 0 Et0/0 13.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">104 307 10.1.1.5/32 0 Et0/0 13.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">105 306 10.1.1.4/32 0 Et0/0 13.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">106 No Label 10.6.6.6/32[V] 0 Et0/1.1 16.1.1.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">107 No Label 0.0.0.0/0[V] 0 Et0/1.2 16.1.2.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">108 No Label 10.6.6.6/32[V] 0 Et0/1.2 16.1.2.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R1去往R2的10.1.1.2有出方向标签，下一步检查R3设备的LFIB&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R3上使用命令show mpls forwarding-table 查看LFIB&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3#sh mpls forwarding-table
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Local Outgoing Prefix Bytes Label Outgoing Next Hop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Label Label or Tunnel Id Switched interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">300 No Label 13.1.1.0/24 0 drop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">301 No Label 23.1.1.0/24 0 drop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">302 No Label 34.1.1.0/24 0 drop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">303 No Label 35.1.1.0/24 0 drop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">304 No Label 10.1.1.2/32 0 drop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">305 No Label 10.1.1.1/32 0 drop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">306 No Label 10.1.1.4/32 0 drop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">307 No Label 10.1.1.5/32 0 drop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R3没有去往10.1.1.1/32和10.1.1.2/32的出方向标签，下一步检查R3上的LDP邻居关系&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R3上使用命令show mpls ldp neighbor 查看LDP邻居&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3#show mpls ldp neighbor
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Peer LDP Ident: 10.1.1.1:0; Local LDP Ident 10.1.1.3:0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> TCP connection: 10.1.1.1.646 - 10.1.1.3.59329
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> State: Oper; Msgs sent/rcvd: 56/52; Downstream
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Up time: 00:37:37
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> LDP discovery sources:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Ethernet0/0, Src IP addr: 13.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Addresses bound to peer LDP Ident:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 13.1.1.1 10.1.1.1 16.1.3.1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R3上有与R1的LDP邻居，没有与R2建立LDP邻居，下一步检查R3上LDP进程&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R3上使用命令show mpls ldp discovery 查看LDP进程信息&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3#show mpls ldp discovery
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Local LDP Identifier:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 10.1.1.3:0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Discovery Sources:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Interfaces:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Ethernet0/0 (ldp): xmit/recv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> LDP Id: 10.1.1.1:0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Ethernet0/1 (ldp): xmit/recv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> LDP Id: 10.22.22.22:0; no route
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Ethernet0/2 (ldp): xmit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Ethernet0/3 (ldp): xmit
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R3使用10.1.1.3为LDP router-id与对端建立LDP邻居，在Ethernet0/1收到 LDP ID为10.22.22.22的LDP报文且提示没有路由到达，而Ethernet0/1连接的是R2，怀疑R2上手动指定了10.22.22.22为LDP的router-id或LDP自动选举了该地址作为router-id，且该地址没有宣告底层IGP协议；R3与R1能建立LDP邻居，下一步检查R3的cef特性是否启用&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R3上使用用命令show ip cef 查看cef是否启用&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3#show ip cef
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">%IPv4 CEF not running
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R3没有启用cef特性，而FIB的形成依赖cef特性，因此需要启用设备的cef特性&lt;/p>
&lt;p>在R3上使用命令ip cef 启用cef&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3(config)#ip cef
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>在R3上使用命令show mpls forwarding-table 查看LFIB&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3#sh mpls forwarding-table
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Local Outgoing Prefix Bytes Label Outgoing Next Hop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Label Label or Tunnel Id Switched interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">304 No Label 10.1.1.2/32 0 Et0/1 23.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">305 Pop Label 10.1.1.1/32 0 Et0/0 13.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">306 No Label 10.1.1.5/32 0 Et0/3 35.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">307 No Label 10.1.1.4/32 0 Et0/2 34.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R3上已经有去往10.1.1.1/32的出方向标签，下一步检查R2的LDP配置&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R上使用命令show mpls ldp discovery 查看LDP进程信息&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2#show mpls ldp discovery
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Local LDP Identifier:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 10.22.22.22:0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Discovery Sources:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Interfaces:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Ethernet0/1 (ldp): xmit/recv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> LDP Id: 10.1.1.3:0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R2使用10.22.22.22作为LDP的router-id，下一步检查R2上是否手动指定了10.22.22.22为LDP的router-id或LDP自动选举了该地址作为router-id&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R2上使用命令show run | include router-id查看是否手动指定了LDP的router-id&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2#show run | include router-id
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls ldp router-id Loopback1 force
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R2上手动指定了Loopback1接口地址为router-id，下一步查看R2的所有环回接口地址配置&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R2上使用命令show ip interface brief | include Loopback 查看环回接口地址配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2#show ip interface brief | include Loopback
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Loopback0 10.1.1.2 YES TFTP up up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Loopback1 10.22.22.22 YES TFTP up up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>继续使用命令show running-config interface loopback 0 和 show running-config interface loopback 1 查看两个环回接口的配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2#show running-config interface loopback 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Building configuration...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Current configuration : 82 bytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Loopback0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.1.1.2 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf 110 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#show running-config interface loopback 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Building configuration...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Current configuration : 67 bytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Loopback1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.22.22.22 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>综合以上结果显示，R2使用了手动设置LDP的router-id，这样手动指定router-id的配置本身没有问题，然而Loopback1并没有宣告进OSPF 110 进程，导致R3上没有10.22.22.22/32的路由，双方不能形成LDP邻居关系；&lt;/p>
&lt;p>LDP邻居关系的建立是标签相互学习的的前提，需要解决R2和R3的LDP邻居建立问题&lt;/p>
&lt;p>解决方案：&lt;/p>
&lt;p>在R3使用命令手动指定Loopback0接口为LDP的router-id&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2(config)#mpls ldp router-id Loopback0 force
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>从命令show running-config interface loopback 0查看到的结果显示Loopback0配置24位掩码的地址，在ospf网络中思科路由器会默认认为环回接口的ospf网络类型为LOOPBACK，无论环回接口是否配置32位掩码地址都会以32位掩码地址宣告进ospf进程中&lt;/p>
&lt;p>R2本地LDP标签分配会为10.1.1.0/24分配标签，并不会为R2上不存在的10.1.1.2/32分配标签，R3虽然本地为10.1.1.2/32分配的本地标签，但是没有从R2上学习到10.1.1.2/32的标签&lt;/p>
&lt;p>解决方案如下&lt;/p>
&lt;p>R2上修改Loopback0的地址掩码为32位掩码&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2(config)#interface loopback 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2(config-if)# ip address 10.1.1.2 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2(config-if)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>在R1上输入命令ping mpls ipv4 10.1.1.2/32 source 10.1.1.1，验证R1到10.1.1.2/32的MPLS标签转发过程问题是否存在&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1#ping mpls ipv4 10.1.1.2/32 source 10.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.2/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 38/138/181 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R1到10.1.1.2/32的MPLS标签转发过程问题已经解决&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="排查mpls网络中其他设备标签转发问题">排查MPLS网络中其他设备标签转发问题
&lt;/h2>&lt;p>在上一步骤中在R3查看到没有R4和R5的LDP邻居，MPLS网络中IGP网络的标签转发出现问题，客户CE设备流量进入MPLS网络将不能转发到远端目的地。&lt;/p>
&lt;ol>
&lt;li>
&lt;p>检查R4的LDP配置&lt;/p>
&lt;ol>
&lt;li>
&lt;p>R4上使用show mpls ldp discovery 检查LDP进程&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4#show mpls ldp discovery
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示没有信息，下一步检查接口是否启用mpls ip和是否全局启用mpls ip&lt;/p>
&lt;/li>
&lt;li>
&lt;p>R4上使用show mpls interfaces 检查LDP接口信息&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4#show mpls interfaces
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Interface IP Tunnel BGP Static Operational
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R4的Ethernet0/2接口没有启用mpls ip，下一步在R4将接口启用mpls ip&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R4上使用命令mpls ip将ethernet 0/2启用LDP&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4(config)#interface ethernet 0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config-if)#mpls ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config-if)#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 30 17:52:31.200: %LDP-5-NBRCHG: LDP Neighbor 10.1.1.3:0 (1) is UP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config-if)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R4与10.1.1.3建立LDP邻居，下一步检查R4是否学习到MPLS网络中其他设备的出接口标签&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R4上使用命令show mpls forwarding-table 查看FLIB&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4#show mpls forwarding-table
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Local Outgoing Prefix Bytes Label Outgoing Next Hop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Label Label or Tunnel Id Switched interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">400 305 10.1.1.1/32 0 Et0/2 34.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">401 302 10.1.1.2/32 0 Et0/2 34.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">402 Pop Label 10.1.1.3/32 0 Et0/2 34.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">403 306 10.1.1.5/32 0 Et0/2 34.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R4上有到MPLS网络中其他设备的出接口标签&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>
&lt;p>检查R5的LDP配置&lt;/p>
&lt;ol>
&lt;li>
&lt;p>在R5上使用命令show mpls ldp discovery 检查LDP进程&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5#show mpls ldp discovery
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Local LDP Identifier:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 10.1.1.5:0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Discovery Sources:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Interfaces:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Ethernet0/3 (tdp): xmit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R5的Ethernet0/3使用标签协议为tdp，而R3上使用的是LDP协议，下一步修改R5使用LDP协议&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R5上使用命令mpls label protocol ldp 修改标签协议为LDP&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5(config)#mpls label protocol ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config)#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 30 18:07:49.748: %LDP-5-NBRCHG: LDP Neighbor 10.1.1.3:0 (1) is UP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示在R5上修改标签协议后已经和10.1.1.3建立了邻居，下一步检查R5是否学习到MPLS网络中其他设备的出接口标签&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R5上使用命令show mpls forwarding-table 查看LFIB&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5#show mpls forwarding-table
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Local Outgoing Prefix Bytes Label Outgoing Next Hop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Label Label or Tunnel Id Switched interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">501 307 10.1.1.4/32 0 Et0/3 35.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">502 Pop Label 10.1.1.3/32 0 Et0/3 35.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">503 302 10.1.1.2/32 0 Et0/3 35.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">504 305 10.1.1.1/32 0 Et0/3 35.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R5上有到MPLS网络中其他设备的出接口标签&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>
&lt;p>检查各PE设备环回接口之间的标签转发是否正常&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1#ping mpls ipv4 10.1.1.2/32 source 10.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.2/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 113/170/211 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#ping mpls ipv4 10.1.1.3/32 source 10.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.3/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 53/214/497 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#ping mpls ipv4 10.1.1.4/32 source 10.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.4/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 144/193/312 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#ping mpls ipv4 10.1.1.5/32 source 10.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.5/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 166/227/293 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2#ping mpls ipv4 10.1.1.1/32 source 10.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.1/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 81/167/201 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#ping mpls ipv4 10.1.1.3/32 source 10.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.3/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 69/144/169 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#ping mpls ipv4 10.1.1.4/32 source 10.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.4/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 47/205/442 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#ping mpls ipv4 10.1.1.5/32 source 10.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.5/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 26/146/196 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3#ping mpls ipv4 10.1.1.1/32 source 10.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.1/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 186/201/231 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3#ping mpls ipv4 10.1.1.2/32 source 10.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.2/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 191/218/281 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3#ping mpls ipv4 10.1.1.4/32 source 10.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.4/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 192/201/213 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3#ping mpls ipv4 10.1.1.5/32 source 10.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.5/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 189/224/314 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4#ping mpls ip 10.1.1.1/32 source 10.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.1/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 187/221/309 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#ping mpls ip 10.1.1.2/32 source 10.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.2/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 187/224/273 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#ping mpls ip 10.1.1.3/32 source 10.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.3/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 193/201/210 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#ping mpls ip 10.1.1.5/32 source 10.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.5/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 193/216/230 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5#ping mpls ip 10.1.1.1/32 source 10.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.1/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 64/177/230 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5#ping mpls ip 10.1.1.2/32 source 10.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.2/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 103/213/464 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5#ping mpls ip 10.1.1.3/32 source 10.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.3/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 62/154/187 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5#ping mpls ip 10.1.1.4/32 source 10.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.4/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 173/278/642 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R1，R2，R3，R4，R5的标签转发为正常状态&lt;/p>
&lt;/li>
&lt;li>
&lt;p>MPLS优化&lt;/p>
&lt;ol>
&lt;li>
&lt;p>手动指定LDP的router-id&lt;/p>
&lt;p>R1，R3，R4，R5的LDP router-id为自动选举，当后续在这些路由器上创建的IP地址比loopback 0地址大时，LDP进程重启或设备重启，这些设备将自动选举地址大的环回接口为router-id，而这些环回接口地址很可能没有宣告进OSPF 100 ，这会导致LDP邻居不能建立从而产生MPLS标签断裂问题&lt;/p>
&lt;p>在R1，R3，R4，R5上使用命令mpls ldp router-id Loopback0 force手动指定LDP的router-id&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1(config)#mpls ldp router-id loopback 0 force
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3(config)#mpls ldp router-id loopback 0 force
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4(config)#mpls ldp router-id loopback 0 force
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5(config)#mpls ldp router-id loopback 0 force
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>R5上使用命令show running-config interface e 0/3查看Ethernet0/3接口配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5#show running-config interface e 0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Building configuration...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Current configuration : 182 bytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 35.1.1.5 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf network point-to-point
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf demand-circuit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf 110 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> duplex auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls propagate-cos
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示该接口下配置了mpls propagate-cos，该命令用于在PE-CE接口的出口处启用，此命令从MPLS报头中的EXP值派生IP DSCP值，然后在IP报头中重写此值。由于拓扑中的MPLS网络没有配置QoS内容，删除该命令不会对现有网络造成影响&lt;/p>
&lt;p>在R5上使用命令no mpls propagate-cos 删除该配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5(config)#interface ethernet 0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config-if)#no mpls propagate-cos
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config-if)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="排查r6r7和r8的路由问题">排查R6，R7和R8的路由问题
&lt;/h2>&lt;p>要求R7 和R8两个站点通信必须经过R6的全局处理、要求R6 的 vrfA 和 R7、R8能够直接通信&lt;/p>
&lt;p>不能使用任何静态路由、不允许修改 R4、R5 的 VRF 配置、不允许修改 R6的BGP配置&lt;/p>
&lt;h3 id="流量模型分析">流量模型分析
&lt;/h3>&lt;p>要求R7 和R8两个站点通信必须经过R6的全局处理&lt;/p>
&lt;ol>
&lt;li>根据需求可以判断出这是一个HUB-SPOKE组网结构，R6为HUB，R7和R8为SPOKE&lt;/li>
&lt;li>PE学习到总部CE和分支CE的路由，然后通过MPLS VPNV4传递到对端PE，总部CE和分支CE再从PE学习路由&lt;/li>
&lt;li>总部和分支同时使用BGP 200 AS号码，根据as-path防环原则，总部不会学习到分支路由，分支也不会学习到总部路由，需要在PE上设置as-override或在CE设备配置 allowas-in&lt;/li>
&lt;li>R7和R8处于BGP 200，且同时接入相同BGP 100 的不同PE，需要考虑R7和R8之间的不合理次优路径问题&lt;/li>
&lt;/ol>
&lt;h3 id="排查步骤">排查步骤
&lt;/h3>&lt;ol>
&lt;li>排查R1，R4和R5是否学习到客户CE上的路由&lt;/li>
&lt;li>排查R1，R4和R5是否能学习对应PE的路由&lt;/li>
&lt;li>排查R7和R8是否存在次优路径&lt;/li>
&lt;/ol>
&lt;h3 id="排查r1r4和r5是否学习到客户ce上的路由">排查R1，R4和R5是否学习到客户CE上的路由
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>在R1上使用命令show bgp vpnv4 unicast all 查看VPNV4路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1#show bgp vpnv4 unicast all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 4, local router ID is 10.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status codes: s suppressed, d damped, h history, * valid, &amp;gt; best, i - internal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> x best-external, a additional-path, c RIB-compressed,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> t secondary path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Origin codes: i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RPKI validation codes: V valid, I invalid, N Not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop Metric LocPrf Weight Path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 100:200 (default for vrf SPOKE)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 0.0.0.0 16.1.2.6 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.6.6.6/32 16.1.2.6 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 200:100 (default for vrf HUB)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.6.6.6/32 16.1.1.6 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R1学习到了R6上的10.6.6.6/32路由，下一步检查R4和R5&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R4上使用命令show bgp vpnv4 unicast all 查看VPNV4路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4#show bgp vpnv4 unicast all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 4, local router ID is 10.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status codes: s suppressed, d damped, h history, * valid, &amp;gt; best, i - internal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> x best-external, a additional-path, c RIB-compressed,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> t secondary path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Origin codes: i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RPKI validation codes: V valid, I invalid, N Not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop Metric LocPrf Weight Path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 100:200 (default for vrf A)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.7.7.7/32 47.1.1.7 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.8.8.8/32 10.1.1.5 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R4上学习到R7和R8上的路由，下一步检查R3上的VPNV4路由&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R3上使用命令show bgp vpnv4 unicast all 查看VPNV4路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3#show bgp vpnv4 unicast all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 18, local router ID is 10.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status codes: s suppressed, d damped, h history, * valid, &amp;gt; best, i - internal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> x best-external, a additional-path, c RIB-compressed,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> t secondary path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Origin codes: i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RPKI validation codes: V valid, I invalid, N Not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop Metric LocPrf Weight Path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 100:200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 0.0.0.0 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.6.6.6/32 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.7.7.7/32 10.1.1.4 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.8.8.8/32 10.1.1.5 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 200:100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.6.6.6/32 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R3上能学习到R6，R7和R8的路由，这说明R3与R1，R4和R5的VPNV4邻居关系正常，怀疑是R1，R4和R5上的VRF RT配置有问题，下一步检查R1，R4和R5上的VRF RT配置&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R1上使用命令&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1#show running-config | section vrf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vrf HUB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rd 200:100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vrf SPOKE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rd 100:200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip vrf forwarding HUB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip vrf forwarding SPOKE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> address-family ipv4 vrf HUB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 16.1.1.6 remote-as 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 16.1.1.6 activate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> address-family ipv4 vrf SPOKE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 16.1.2.6 remote-as 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 16.1.2.6 activate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R1上没有没有配置export RT和import RT，下一步查看R4和R5上的RT，然后在R1上配置RT&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R4和R5上分别使用命令show running-config | section vrf 查看VRF配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-zed" data-lang="zed">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R4&lt;/span>&lt;span class="nv">#show&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">running&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">section&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">definition&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">A&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">rd&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">100&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="err">200&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">address&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">family&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ipv4&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">export&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">47&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="err">47&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">16&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="err">16&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">26&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="err">26&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">58&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="err">58&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">exit&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">address&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">family&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">forwarding&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">A&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">address&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">family&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ipv4&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">A&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">neighbor&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">47&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="err">1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="err">1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="err">7&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">remote&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">200&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">neighbor&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">47&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="err">1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="err">1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="err">7&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activate&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">R4&lt;/span>&lt;span class="err">#&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R5&lt;/span>&lt;span class="c1">#show running-config | section vrf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">A&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rd&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="mi">58&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">58&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="n">import&lt;/span> &lt;span class="mi">16&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">16&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="n">import&lt;/span> &lt;span class="mi">26&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">26&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="n">import&lt;/span> &lt;span class="mi">47&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">47&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">A&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">address&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">family&lt;/span> &lt;span class="n">ipv4&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">A&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">neighbor&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.8&lt;/span> &lt;span class="n">remote&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">as&lt;/span> &lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">neighbor&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.8&lt;/span> &lt;span class="n">activate&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R5&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R4和R5上配置了RT，下一步需要在R1上添加RT配置&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R1上使用命令route-target export/import ASN:nn配置RT&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#ip vrf HUB&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#route-target import 47:47&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#route-target import 58:58 &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#ip vrf SPOKE&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#route-target export 16:16&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>在R1上使用命令show bgp vpnv4 unicast all查看VPNV4路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1#show bgp vpnv4 unicast all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 10, local router ID is 10.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status codes: s suppressed, d damped, h history, * valid, &amp;gt; best, i - internal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> x best-external, a additional-path, c RIB-compressed,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> t secondary path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Origin codes: i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RPKI validation codes: V valid, I invalid, N Not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop Metric LocPrf Weight Path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 100:200 (default for vrf SPOKE)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 0.0.0.0 16.1.2.6 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.6.6.6/32 16.1.2.6 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.7.7.7/32 10.1.1.4 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.8.8.8/32 10.1.1.5 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 200:100 (default for vrf HUB)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.6.6.6/32 16.1.1.6 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.7.7.7/32 10.1.1.4 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.8.8.8/32 10.1.1.5 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示在配置RT后，R1可以学习到R4和R5传递过来的路由&lt;/p>
&lt;p>在R4和R5上分别使用命令show bgp vpnv4 unicast all查看VPNV4路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4#show bgp vpnv4 unicast all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 8, local router ID is 10.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status codes: s suppressed, d damped, h history, * valid, &amp;gt; best, i - internal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> x best-external, a additional-path, c RIB-compressed,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> t secondary path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Origin codes: i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RPKI validation codes: V valid, I invalid, N Not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop Metric LocPrf Weight Path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 100:200 (default for vrf A)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 0.0.0.0 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.6.6.6/32 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.7.7.7/32 47.1.1.7 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.8.8.8/32 10.1.1.5 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5#show bgp vpnv4 unicast all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 8, local router ID is 10.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status codes: s suppressed, d damped, h history, * valid, &amp;gt; best, i - internal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> x best-external, a additional-path, c RIB-compressed,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> t secondary path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Origin codes: i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RPKI validation codes: V valid, I invalid, N Not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop Metric LocPrf Weight Path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 100:200 (default for vrf A)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 0.0.0.0 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.6.6.6/32 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.7.7.7/32 10.1.1.4 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.8.8.8/32 58.1.1.8 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R1，R4和R5上都学习到了PE传递过来的VPNV4路由，下一步检查R6，R7和R8上的路由学习情况&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R6，R7和R8上分布使用命令show ip route bgp 查看bgp路由学习情况&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R6&lt;/span>&lt;span class="c1">#show ip route bgp &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">6.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">6.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">16.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">3.1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">31&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">13&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R6&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R7&lt;/span>&lt;span class="c1">#sh ip route bgp &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R7&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R8&lt;/span>&lt;span class="c1">#sh ip route b&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R8&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示，R6，R7和R8上没有从PE上学习的路由不符合要求，下一步检查PE和CE上是否配置as-override和 allowas-in&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在PE和CE设备上使用命令show running-config | include as-override和show running-config | include allowas-in 检查设备是否设置了as-override和 allowas-in&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1#show running-config | include as-override
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#show running-config | include allowas-in
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R上没有配置as-override和 allowas-in，经检查R1，R4，R5，R7，R8均没有设置这两项参数&lt;/p>
&lt;p>在当前组网情况下，有两种解决方案&lt;/p>
&lt;p>方案一：在R1，R4和R5上针对CE的BGP邻居设置as-override&lt;/p>
&lt;p>方案二：在R1上针对CE的BGP邻居设置as-override，在R7和R8上针对PE的BGP邻居设置allowas-in&lt;/p>
&lt;p>结合组网情况，本次使用方案一，下一步在R1，R4和R5上针对CE的BGP邻居设置as-override&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R1，R4和R5上使用命令neighbor x.x.x.x as-override&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1(config)#router bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1(config-router)# address-family ipv4 vrf HUB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1(config-router-af)# neighbor 16.1.1.6 as-override
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1(config-router-af)#exit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1(config-router)# address-family ipv4 vrf SPOKE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1(config-router-af)# neighbor 16.1.2.6 as-override
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1(config-router-af)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4(config)#router bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config-router)# address-family ipv4 vrf A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config-router-af)# neighbor 47.1.1.7 as-override
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config-router-af)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5(config)#router bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config-router)# address-family ipv4 vrf A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config-router-af)# neighbor 58.1.1.8 as-override
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config-router-af)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>在R6，R7和R8上分布使用命令show ip route bgp 查看bgp路由学习情况&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R6&lt;/span>&lt;span class="c1">#show ip route bgp &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">6.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">6.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">16.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">3.1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">47&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">49&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">10.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.7&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">7.7&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">16.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">02&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">31&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.8&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.8&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">16.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">02&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">31&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R6&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R7&lt;/span>&lt;span class="c1">#sh ip route bgp &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">54&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">10.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">54&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.8&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.8&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">54&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R7&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R8&lt;/span>&lt;span class="c1">#show ip route bgp &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">51&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">10.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">51&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.7&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">7.7&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">51&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R8&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R6，R7和R8已经从对应PE学习到路由，下一步traceroute测试R7到R8的10.8.8.8&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R7#traceroute 10.8.8.8 source loopback 0 numeric
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Tracing the route to 10.8.8.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">VRF info: (vrf in name/id, vrf out name/id)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 47.1.1.4 [AS 100] 1 msec 3 msec 1 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2 34.1.1.3 [AS 100] [MPLS: Labels 307/500 Exp 0] 5 msec 5 msec 6 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3 58.1.1.5 [AS 100] [MPLS: Label 500 Exp 0] 3 msec 3 msec 3 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 4 58.1.1.8 [AS 100] 5 msec * 11 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R7#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R7到R8的10.8.8.8连通性正常，但是不符合R7 和R8两个站点通信必须经过R6的全局处理设计要求&lt;/p>
&lt;p>按照拓扑图显示R7和R8应该建立IBGP邻居关系，给出的预配缺少配置，我猜这里考察的客户双CE接入同一AS不同PE的SOO防环知识点&lt;/p>
&lt;p>而添加IBGP配置后R7和R8互相通信又会走IBGP或IGP，又要配置策略阻止R7和R8的互相学习，我就不自己加戏了&lt;/p>
&lt;p>如果按照提供的预配来解决方案，只能在R4和R5编写route-map将R7和R8上的路由进行过滤，经过过滤后R4上不能学习到R8上的路由，R5上不能学习到R7的路由，最后结果符合设计要求&lt;/p>
&lt;p>下一步在R4和R5上配置route-map对路由进行过滤的解决方案&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R4和R5上配置route-map对路由进行过滤&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4(config)#ip prefix-list DENY-R8 permit 10.8.8.8/32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config)#route-map DENY-R8 deny 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config-route-map)#match ip address prefix-list DENY-R8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config-route-map)#route-map DENY-R8 permit 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config-route-map)#exit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config)#router bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config-router)#address-family vpnv4 unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config-router-af)#neighbor 10.1.1.3 route-map DENY-R8 in
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config-router-af)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5(config)#ip prefix-list DENY-R7 permit 10.7.7.7/32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config)#route-map DENY-R7 deny 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config-route-map)#match ip address prefix-list DENY-R7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config-route-map)#route-map DENY-R7 permit 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config-route-map)#exit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config)#router bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config-router)#address-family vpnv4 unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config-router-af)#nei 10.1.1.3 route-map DENY-R7 in
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config-router-af)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>在R4和R5上分别使用命令show bgp vpnv4 unicast all查看VPNV4路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4#show bgp vpnv4 unicast all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 10, local router ID is 10.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status codes: s suppressed, d damped, h history, * valid, &amp;gt; best, i - internal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> x best-external, a additional-path, c RIB-compressed,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> t secondary path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Origin codes: i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RPKI validation codes: V valid, I invalid, N Not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop Metric LocPrf Weight Path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 100:200 (default for vrf A)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 0.0.0.0 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.6.6.6/32 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.7.7.7/32 47.1.1.7 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5#sh run | s route-m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 10.1.1.3 route-map DENY-R7 in
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map DENY-R7 deny 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address prefix-list DENY-R7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map DENY-R7 permit 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5#show bgp vpnv4 unicast all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 10, local router ID is 10.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status codes: s suppressed, d damped, h history, * valid, &amp;gt; best, i - internal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> x best-external, a additional-path, c RIB-compressed,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> t secondary path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Origin codes: i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RPKI validation codes: V valid, I invalid, N Not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop Metric LocPrf Weight Path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 100:200 (default for vrf A)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 0.0.0.0 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.6.6.6/32 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.8.8.8/32 58.1.1.8 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示经过过滤后R4上不能学习到R8上的路由，R5上不能学习到R7的路由&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R7和R8上分布使用命令show ip route bgp 查看bgp路由学习情况&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R7&lt;/span>&lt;span class="c1">#show ip route bgp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">19&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">47&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">10.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">19&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">47&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R7&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R8&lt;/span>&lt;span class="c1">#show ip route bgp &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">19&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">10.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">19&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R8&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R7和R8不再通过PE学习到对端的路由，下一步traceroute测试R7到R8的10.8.8.8&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R7上使用命令traceroute 10.8.8.8 source loopback 0 numeric 进行traceroute测试&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R7#traceroute 10.8.8.8 source loopback 0 numeric
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Tracing the route to 10.8.8.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">VRF info: (vrf in name/id, vrf out name/id)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 47.1.1.4 [AS 100] 1 msec 2 msec 1 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2 34.1.1.3 [AS 100] [MPLS: Labels 306/106 Exp 0] 18 msec 5 msec 5 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3 16.1.2.1 [AS 100] [MPLS: Label 106 Exp 0] 5 msec 6 msec 5 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 4 16.1.2.6 [AS 100] 6 msec 5 msec 5 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 5 16.1.1.1 [AS 100] 5 msec 5 msec 6 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 6 13.1.1.3 [AS 100] [MPLS: Labels 307/500 Exp 0] 10 msec 14 msec 11 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 7 58.1.1.5 [AS 100] [MPLS: Label 500 Exp 0] 10 msec 9 msec 10 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 8 58.1.1.8 [AS 100] 10 msec * 14 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R7#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示符合设计要求，R7以loopback 0 测试到10.8.8.8 的路径从R4进入MPLS网络到达R6再穿过MPLS网络到底R8，数据流量穿越MPLS网络中的标签值不符合截图输出没有影响,这是由于设备本地自主分配然后LDP邻居学习到的&lt;/p>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="排查ce路由表未完全学习r6上路由">排查CE路由表未完全学习R6上路由
&lt;/h2>&lt;p>经过前面步骤的排查，R1，R3，R4，R5，R6，R7和R8并没有学习到10.66.66.66和26.1.1.0的路由，下一步在R2上检查是否通过S1/1接口学习到R6的路由条目&lt;/p>
&lt;ol>
&lt;li>
&lt;p>在R2上使用命令show ip route vrf A查看路由表&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R2&lt;/span>&lt;span class="c1">#show ip route vrf A&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Routing&lt;/span> &lt;span class="n">Table&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">A&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R2&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R2上没有学习到R6的路由，且连直连接口路由都没有，下一步检查R2的S1/1接口配置&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R2上使用命令show running-config interface serial 1/1查看接口配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2#show running-config interface serial 1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Building configuration...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Current configuration : 169 bytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Serial1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip vrf forwarding A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 26.1.1.2 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> encapsulation ppp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf 1 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ppp authentication chap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> serial restart-delay 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示该接口已经划入VRF A，启用了OSPF 1，并且配置了chap认证，下一步检查S1/1接口状态&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R2上使用命令show interfaces serial 1/1检查S1/1接口状态&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R2&lt;/span>&lt;span class="c1">#show interfaces serial 1/1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Serial1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">up&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">line&lt;/span> &lt;span class="n">protocol&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">down&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Hardware&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">M4T&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Internet&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="mf">26.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MTU&lt;/span> &lt;span class="mi">1500&lt;/span> &lt;span class="n">bytes&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">BW&lt;/span> &lt;span class="mi">1544&lt;/span> &lt;span class="n">Kbit&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">sec&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">DLY&lt;/span> &lt;span class="mi">20000&lt;/span> &lt;span class="n">usec&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reliability&lt;/span> &lt;span class="mi">255&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">255&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">txload&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">255&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">rxload&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Encapsulation&lt;/span> &lt;span class="n">PPP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">LCP&lt;/span> &lt;span class="n">Closed&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">crc&lt;/span> &lt;span class="mi">16&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">loopback&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Keepalive&lt;/span> &lt;span class="n">set&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span> &lt;span class="n">sec&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Restart&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Delay&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">secs&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Last&lt;/span> &lt;span class="n">input&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">output&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">output&lt;/span> &lt;span class="n">hang&lt;/span> &lt;span class="n">never&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Last&lt;/span> &lt;span class="n">clearing&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="s2">&amp;#34;show interface&amp;#34;&lt;/span> &lt;span class="n">counters&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">15&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="ne">Input&lt;/span> &lt;span class="n">queue&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">75&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">max&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">drops&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">flushes&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="n">Total&lt;/span> &lt;span class="n">output&lt;/span> &lt;span class="n">drops&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Queueing&lt;/span> &lt;span class="n">strategy&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">fifo&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Output&lt;/span> &lt;span class="n">queue&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">40&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">max&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">5&lt;/span> &lt;span class="n">minute&lt;/span> &lt;span class="n">input&lt;/span> &lt;span class="n">rate&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">bits&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">sec&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">packets&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">sec&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">5&lt;/span> &lt;span class="n">minute&lt;/span> &lt;span class="n">output&lt;/span> &lt;span class="n">rate&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">bits&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">sec&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">packets&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">sec&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">1689&lt;/span> &lt;span class="n">packets&lt;/span> &lt;span class="n">input&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">33540&lt;/span> &lt;span class="n">bytes&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">no&lt;/span> &lt;span class="n">buffer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Received&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">broadcasts&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="ne">IP&lt;/span> &lt;span class="n">multicasts&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">0&lt;/span> &lt;span class="n">runts&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">giants&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">throttles&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">0&lt;/span> &lt;span class="n">input&lt;/span> &lt;span class="n">errors&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">CRC&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">frame&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">overrun&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">ignored&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">abort&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">2102&lt;/span> &lt;span class="n">packets&lt;/span> &lt;span class="n">output&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">45387&lt;/span> &lt;span class="n">bytes&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">underruns&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">0&lt;/span> &lt;span class="n">output&lt;/span> &lt;span class="n">errors&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">collisions&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">410&lt;/span> &lt;span class="n">interface&lt;/span> &lt;span class="n">resets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">0&lt;/span> &lt;span class="n">unknown&lt;/span> &lt;span class="n">protocol&lt;/span> &lt;span class="n">drops&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">0&lt;/span> &lt;span class="n">output&lt;/span> &lt;span class="n">buffer&lt;/span> &lt;span class="n">failures&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">output&lt;/span> &lt;span class="n">buffers&lt;/span> &lt;span class="n">swapped&lt;/span> &lt;span class="n">out&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">410&lt;/span> &lt;span class="n">carrier&lt;/span> &lt;span class="n">transitions&lt;/span> &lt;span class="n">DCD&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">up&lt;/span> &lt;span class="n">DSR&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">up&lt;/span> &lt;span class="n">DTR&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">up&lt;/span> &lt;span class="n">RTS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">up&lt;/span> &lt;span class="n">CTS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">up&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R2&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示line protocol is down ，该结果显示链路层故障，联系到上一步骤中查看到ppp封装和chap认证，怀疑是认证出现了问题，下一步检查R6和R1之间的串口链路认证&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R2上使用debug ppp authentication 查看ppp认证交互信息，同时准备命令no debug all 随时终止debug消息&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2#debug ppp authentication
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PPP authentication debugging is on
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:10.131: Se1/1 PPP: Using default call direction
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:10.131: Se1/1 PPP: Treating connection as a dedicated line
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:10.131: Se1/1 PPP: Session handle[B200026C] Session id[620]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:10.168: Se1/1 CHAP: O CHALLENGE id 1 len 23 from &amp;#34;R2&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:10.183: Se1/1 CHAP: I RESPONSE id 1 len 23 from &amp;#34;R6&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:10.183: Se1/1 PPP: Sent CHAP LOGIN Request
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:10.183: Se1/1 PPP: Received LOGIN Response FAIL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:10.183: Se1/1 CHAP: O FAILURE id 1 len 25 msg is &amp;#34;Authentication failed&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:12.223: Se1/1 PPP: Using default call direction
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:12.223: Se1/1 PPP: Treating connection as a dedicated line
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:12.223: Se1/1 PPP: Session handle[FD00026D] Session id[621]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:12.251: Se1/1 CHAP: O CHALLENGE id 1 len 23 from &amp;#34;R2&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:12.268: Se1/1 CHAP: I RESPONSE id 1 len 23 from &amp;#34;R6&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:12.268: Se1/1 PPP: Sent CHAP LOGIN Request
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:12.268: Se1/1 PPP: Received LOGIN Response FAIL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:12.268: Se1/1 CHAP: O FAILURE id 1 len 25 msg is &amp;#34;Authentication failed&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#no debu
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:14.329: Se1/1 PPP: Using default call direction
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:14.329: Se1/1 PPP: Treating connection as a dedicated line
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:14.329: Se1/1 PPP: Session handle[E600026E] Session id[622]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:14.367: Se1/1 CHAP: O CHALLENGE id 1 len 23 from &amp;#34;R2&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:14.385: Se1/1 CHAP: I RESPONSE id 1 len 23 from &amp;#34;R6&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:14.385: Se1/1 PPP: Sent CHAP LOGIN Request
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:14.385: Se1/1 PPP: Received LOGIN Response FAIL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:14.385: Se1/1 CHAP: O FAILURE id 1 len 25 msg is &amp;#34;Authentication failed&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#no debu
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#no debug all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">All possible debugging has been turned off
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示S1/1接口Authentication failed，下一步检查R2和R6上的chap认证密码配置&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R2和R6上使用命令show running-config | section user 检查用户名密码配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2#show running-config | section user
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">username R6 password 0 cisco
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R6#show running-config | section user
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">username R2 password 0 cisc0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R6#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示两端密码不一致，虽然R6的S1/1接口配置了与R2相同的密码，但是思科路由器会优先使用全局配置的密码进行认证流程&lt;/p>
&lt;p>处理该认证失败故障有如下两种解决方案&lt;/p>
&lt;p>方案一：在R2上修改密码为cisc0&lt;/p>
&lt;p>方案二：在R6上修改密码为cisco&lt;/p>
&lt;p>本次故障排除采用方案一，在R2上使用命令username R6 password 0 cisc0修改密码&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2(config)#username R6 password 0 cisc0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 15:08:27.909: %SYS-5-CONFIG_I: Configured from console by console
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 15:08:27.926: %LINEPROTO-5-UPDOWN: Line protocol on Interface Serial1/1, changed state to up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 15:08:28.024: %OSPF-5-ADJCHG: Process 1, Nbr 10.66.66.66 on Serial1/1 from LOADING to FULL, Loading Done
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2(config)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示修改密码后，S1/1的链路层协议UP，且R2与R6的OSPF邻居已经建立，下一步检查R2的路由学习情况&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R2上使用命令show bgp vpnv4 unicast all 查看VPNV4路由标&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2#show bgp vpnv4 unicast all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 11, local router ID is 10.22.22.22
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status codes: s suppressed, d damped, h history, * valid, &amp;gt; best, i - internal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> x best-external, a additional-path, c RIB-compressed,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> t secondary path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Origin codes: i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RPKI validation codes: V valid, I invalid, N Not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop Metric LocPrf Weight Path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 100:200 (default for vrf A)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.66.66.66/32 26.1.1.6 65 32768 ?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 26.1.1.0/24 0.0.0.0 0 32768 ?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R2已经学习到R6的路由，且VRF A的路由已经重分布进BGP，下一步检查其他PE是否学习到R2的VPNV4路由&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R4上使用命令show bgp vpnv4 unicast all 查看VPNV4路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4#show bgp vpnv4 unicast all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 10, local router ID is 10.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status codes: s suppressed, d damped, h history, * valid, &amp;gt; best, i - internal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> x best-external, a additional-path, c RIB-compressed,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> t secondary path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Origin codes: i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RPKI validation codes: V valid, I invalid, N Not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop Metric LocPrf Weight Path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 100:200 (default for vrf A)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 0.0.0.0 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.6.6.6/32 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.7.7.7/32 47.1.1.7 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R4没有学习到R2上的VPNV4路由，下一步检查R2的VRF RT配置&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R2上使用命令show running-config | section vrf查看VRF配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2#show running-config | section vrf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vrf A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rd 100:200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip vrf forwarding A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 1 vrf A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> redistribute bgp 100 subnets
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> address-family ipv4 vrf A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> redistribute ospf 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示VRF A没有配置RT，下一步配置R2的RT&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R2上使用命令route-target export/import ASN:nn配置RT&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#ip vrf A&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#route-target export 26:26&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#route-target import 16:16&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#route-target import 47:47&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#route-target import 58:58&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>在R4上使用命令show bgp vpnv4 unicast all 查看VPNV4路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4#show bgp vpnv4 unicast all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 14, local router ID is 10.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status codes: s suppressed, d damped, h history, * valid, &amp;gt; best, i - internal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> x best-external, a additional-path, c RIB-compressed,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> t secondary path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Origin codes: i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RPKI validation codes: V valid, I invalid, N Not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop Metric LocPrf Weight Path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 100:200 (default for vrf A)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 0.0.0.0 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.6.6.6/32 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.7.7.7/32 47.1.1.7 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.66.66.66/32 10.1.1.2 65 100 0 ?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 26.1.1.0/24 10.1.1.2 0 100 0 ?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R4已经学习到R2上的VPNV4路由，下一步检查R6，R7和R8上的路由学习情况&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R7和R8上使用命令show ip route bgp查看路由学习&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R7&lt;/span>&lt;span class="c1">#show ip route bgp &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">01&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">53&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">10.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">01&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">53&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.66&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">66.66&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">04&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">31&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">26.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">26.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">04&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">31&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R7&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R8&lt;/span>&lt;span class="c1">#show ip route bgp &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">01&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">53&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">10.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">01&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">53&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.66&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">66.66&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">04&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">51&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">26.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">26.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">04&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">51&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R8&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R7和R8学习到了对应的路由条目，且符合要求&lt;/p>
&lt;p>下一步配置R1上的VRF RT，之前排查PE路由学习的时候没有添加针对R2的 RT import 配置&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R1上使用命令route-target import ASN:nn配置RT&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1(config)#ip vrf HUB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1(config-vrf)# route-target import 26:26
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1(config-vrf)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>在R1上使用命令show bgp vpnv4 unicast all 查看VPNV4路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1#show bgp vpnv4 unicast all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 20, local router ID is 10.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status codes: s suppressed, d damped, h history, * valid, &amp;gt; best, i - internal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> x best-external, a additional-path, c RIB-compressed,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> t secondary path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Origin codes: i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RPKI validation codes: V valid, I invalid, N Not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop Metric LocPrf Weight Path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 100:200 (default for vrf SPOKE)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 0.0.0.0 16.1.2.6 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.6.6.6/32 16.1.2.6 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.7.7.7/32 10.1.1.4 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.8.8.8/32 10.1.1.5 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.66.66.66/32 10.1.1.2 65 100 0 ?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 26.1.1.0/24 10.1.1.2 0 100 0 ?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 200:100 (default for vrf HUB)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.6.6.6/32 16.1.1.6 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.7.7.7/32 10.1.1.4 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.8.8.8/32 10.1.1.5 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.66.66.66/32 10.1.1.2 65 100 0 ?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 26.1.1.0/24 10.1.1.2 0 100 0 ?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R1已经学习到R2的VPNV4路由条目，下一步检查R6是否学习到路由条目&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R6上使用命令show ip route bgp查看路由学习&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R6&lt;/span>&lt;span class="c1">#show ip route bgp &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">6.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">6.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">16.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">3.1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">02&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">57&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">10.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.7&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">7.7&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">16.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">02&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">45&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.8&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.8&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">16.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">02&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">45&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.66&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">66.66&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">16.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">01&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">57&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">26.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">26.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">16.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">01&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">57&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R6&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R6已经学习到对应路由条目，且符合要求&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R6上使用命令show ip route vrf A ospf查看路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R6&lt;/span>&lt;span class="c1">#show ip route vrf A ospf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Routing&lt;/span> &lt;span class="n">Table&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">A&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R6&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示没有路由条目，下一步在R2上检查是否把BGP路由重分布进VRF A 所在的路由协议&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R2上使用命令sh run | s r o 查看路由重复分布&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2#sh run | s r o
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 1 vrf A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> redistribute bgp 100 subnets
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 110
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> prefix-suppression
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示已经将BGP路由重分布进OSPF 1进程&lt;/p>
&lt;p>能学习到R6的路由说明R2与R6的邻居建立没有问题，且在R2上没有发现针对R6的路由过滤，&lt;/p>
&lt;p>在R6和R2上发现使用划入VRF的接口进行互联，且将BGP重分布进ospf进程，这种组网情况要在PE上的ospf进程下启用vrf-lite&lt;/p>
&lt;p>思科的OSPF防环机制当绑定到 VRF 的 OSPF 进程在收到邻居的5类LSA或7类LSA会检查Tag，当Tag与VPN-TAG时，这些5类LSA或7类LSA不会参与SFP算法计算路由&lt;/p>
&lt;p>在R2使用命令capability vrf-lite 启用vrf-lite&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2(config)# router ospf 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2(config-router)#capability vrf-lite
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2(config-router)#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 15:46:59.140: %OSPF-5-ADJCHG: Process 1, Nbr 10.66.66.66 on Serial1/1 from FULL to DOWN, Neighbor Down: Interface down or detached
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 15:46:59.204: %OSPF-5-ADJCHG: Process 1, Nbr 10.66.66.66 on Serial1/1 from LOADING to FULL, Loading Done
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2(config-router)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示启用vrf-lite 后，R2与R6的ospf邻居重置，下一步检查R6是否学习到路由条目&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R6上使用命令show ip route vrf A ospf查看路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R6&lt;/span>&lt;span class="c1">#show ip route vrf A ospf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Routing&lt;/span> &lt;span class="n">Table&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">A&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">10.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">10.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">26.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">24&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">28&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Serial1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">10.7&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">7.7&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">26.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">24&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">28&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Serial1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">10.8&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.8&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">26.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">24&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">28&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Serial1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R6&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R6与学习到对应路由条目，下一步在R2的OSPF 1 进程下发默认路由&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R2上使用命令default-information originate 下发ospf默认路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2(config)# router ospf 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2(config-router)#default-information originate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2(config-router)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>在R6上使用命令show ip route vrf A ospf查看路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R6&lt;/span>&lt;span class="c1">#show ip route vrf A ospf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Routing&lt;/span> &lt;span class="n">Table&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">A&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="mf">26.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">E2&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">26.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">01&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Serial1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">10.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">10.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">26.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">29&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">54&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Serial1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">10.7&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">7.7&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">26.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">29&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">54&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Serial1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">10.8&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.8&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">26.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">29&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">54&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Serial1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R6&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R6已经学习到默认路由，且所以OSPF路由条目符合要求&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R6上使用命令traceroute vrf A 10.7.7.7 source loopback 1 numeric 跟踪路径&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R6#traceroute vrf A 10.7.7.7 source loopback 1 numeric
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Tracing the route to 10.7.7.7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">VRF info: (vrf in name/id, vrf out name/id)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 26.1.1.2 [AS 100] 13 msec 16 msec 16 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2 23.1.1.3 [MPLS: Labels 304/405 Exp 0] 20 msec 21 msec 16 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3 47.1.1.4 [MPLS: Label 405 Exp 0] 14 msec 19 msec 16 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 4 47.1.1.7 21 msec * 19 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R6#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示符合要求&lt;/p>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="总结">总结
&lt;/h2>&lt;ul>
&lt;li>这份拓扑中包含了MP-BGP的大部分知识点&lt;/li>
&lt;li>完成MPLS网络的vpnv4邻居建立，接下来就靠VRF的RT控制接收和发送路由条目&lt;/li>
&lt;li>熟悉查看vpnv4的路由表很重要&lt;/li>
&lt;li>其实早几年我是玩过这个排错拓扑的，奈何脑子不够用学过等于又还回去了&lt;/li>
&lt;li>不知道大家对这种学习过的技术，而工作中又接触不到这些项目，技术的知识点淡忘如何看待&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨。&lt;/li>
&lt;/ul></description></item><item><title>BGP综合实验拓扑</title><link>https://weeaster.github.io/posts/48f55792/</link><pubDate>Fri, 25 Feb 2022 01:32:49 +0000</pubDate><guid>https://weeaster.github.io/posts/48f55792/</guid><description>&lt;p>在B站看了一个UP主（&lt;a class="link" href="https://space.bilibili.com/455975406" target="_blank" rel="noopener"
>155和150
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>）上传的视频，感觉挺有意思的，就搭拓扑玩一玩。现在这个视频已经不见了，视频里使用的eNSP模拟器搭建的，我用PNET搭建，模拟器类型不关键。已经删减了一些内容，并加了一些实验需求。&lt;/p>
&lt;p>实验主要涉及到的BGP技术的运用，包括有BGP邻居建立、路由加载、路由传递、BGP联盟、路由聚合、路由拆分、团体属性、路由选路、正则表达式、路由过滤、BGP特性、路由阻尼等。&lt;/p>
&lt;p>拓扑如图：&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/02/24/6S5qGjeiQCaPcHb.jpg">
&lt;img src="https://s2.loli.net/2022/02/24/6S5qGjeiQCaPcHb.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="实验需求">实验需求
&lt;/h2>&lt;h3 id="bgp邻居建立">BGP邻居建立
&lt;/h3>&lt;ol>
&lt;li>eBGP之间使用接口建立(联盟内部子AS eBGP除外)，iBGP使用环回接口Lo0建立&lt;/li>
&lt;li>R2、R7、R9使用对等体组方式配置&lt;/li>
&lt;li>R4、R7、R9为路由反射器&lt;/li>
&lt;/ol>
&lt;h3 id="bgp路由加载">BGP路由加载
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>R5将ISIS重分布进BGP，R6、R7、R8将ISIS重分布进BGP&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> redistribute isis level-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R6、R7、R8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> redistribute isis level-2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>R5能够正常接收到100.1.1.X的路由，R4不能使用next-hop-self&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map SET_NH permit 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set ip next-hop 120.1.4.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor iBGP route-map SET_NH out
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="bgp路由传递">BGP路由传递
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>100.1.1.x之间可以通信&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">neighbor 200.1.103.10 as-override
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">neighbor 200.1.116.11 as-override
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">neighbor 200.1.127.12 as-override
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>R3、R6、R7针对AS 64520移除私有AS号&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.103.10 remove-private-as all replace-as
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.116.11 remove-private-as all replace-as
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.127.12 remove-private-as all replace-as
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AS 64540 内部联邦配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R11
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64530
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp log-neighbor-changes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp confederation identifier 64540
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp confederation peers 64531
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.12 remote-as 64531
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.12 disable-connected-check
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.12 update-source Loopback0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.12 next-hop-self
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.116.6 remote-as 64200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R12
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64531
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp log-neighbor-changes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp confederation identifier 64540
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp confederation peers 64530
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> redistribute eigrp 90
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.11 remote-as 64530
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.11 disable-connected-check
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.11 update-source Loopback0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.11 next-hop-self
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.13 remote-as 64531
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.13 update-source Loopback0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.13 next-hop-self
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.127.7 remote-as 64200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R13
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64531
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp log-neighbor-changes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp confederation identifier 64540
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 111.1.2.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 111.1.3.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> aggregate-address 111.1.0.0 255.255.0.0 as-set summary-only
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.12 remote-as 64531
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.12 update-source Loopback0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="bgp路由聚合路由拆分">BGP路由聚合、路由拆分
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>R5、R6、R7、R8对AS内的互联地址与主机路由汇总为子网掩码为16位的聚合路由（例如：120.1.0.0/16），并防止路由回愦&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> aggregate-address 123.1.0.0 255.255.0.0 as-set summary-only
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> aggregate-address 120.1.0.0 255.255.0.0 as-set summary-only
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R6、R7、R8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> aggregate-address 145.1.0.0 255.255.0.0 as-set summary-only
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> aggregate-address 140.1.0.0 255.255.0.0 as-set summary-only
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>R5的汇总主机路由，不抑制120.1.4.4/32和 120.1.5.5/32&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip prefix-list UNSUPPRESS seq 5 permit 120.1.4.4/32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip prefix-list UNSUPPRESS seq 10 permit 120.1.5.5/32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map UNSUPPRESS permit 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address prefix-list UNSUPPRESS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 120.1.4.4 unsuppress-map UNSUPPRESS
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>R6、R7、R8的汇总主机路由，仅抑制145.1.9.9/32 ，并调整聚合路由起源属性为 igp&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R6、R7、R8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip prefix-list SUPPRESS seq 5 permit 140.1.9.9/32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map SUPPRESS permit 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address prefix-list SUPPRESS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map SET_IGP permit 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set origin igp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> aggregate-address 140.1.0.0 255.255.0.0 as-set summary-only attribute-map SET_IGP suppress-map SUPPRESS
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>R1去往111.1.0.0/24和111.1.1.0/24下一跳走R5；R2去往111.1.2.0/24和111.1.3.0/24下一跳走R8&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">SOURCE_AS64100&lt;/span> &lt;span class="n">seq&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">15.5&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">huizong&lt;/span> &lt;span class="n">seq&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">111.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">16&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">mingxi&lt;/span> &lt;span class="n">seq&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">111.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">mingxi&lt;/span> &lt;span class="n">seq&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">111.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">mingxi&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">set&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">mingxi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">set&lt;/span> &lt;span class="n">community&lt;/span> &lt;span class="n">no&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">export&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">huizong&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">match&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">huizong&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">match&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">source&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">SOURCE_AS64100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">router&lt;/span> &lt;span class="n">bgp&lt;/span> &lt;span class="mi">64520&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bgp&lt;/span> &lt;span class="n">inject&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">mingxi&lt;/span> &lt;span class="n">exist&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">huizong&lt;/span> &lt;span class="n">copy&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">attributes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">SOURCE_AS64200&lt;/span> &lt;span class="n">seq&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">28.8&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">huizong&lt;/span> &lt;span class="n">seq&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">111.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">16&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">mingxi&lt;/span> &lt;span class="n">seq&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">111.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">2.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">mingxi&lt;/span> &lt;span class="n">seq&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">111.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">3.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">mingxi&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">set&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">mingxi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">set&lt;/span> &lt;span class="n">community&lt;/span> &lt;span class="n">no&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">export&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">huizong&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">match&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">huizong&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">match&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">source&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">SOURCE_AS64200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">router&lt;/span> &lt;span class="n">bgp&lt;/span> &lt;span class="mi">64520&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bgp&lt;/span> &lt;span class="n">inject&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">mingxi&lt;/span> &lt;span class="n">exist&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">huizong&lt;/span> &lt;span class="n">copy&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">attributes&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="bgp选路medas-pathlocal-pref">BGP选路(MED、AS-Path、Local-Pref)
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>R8上配置，实现AS 64200访问 120.1.X.X，X为偶数，走R4和R8互联链路；X为奇数，走R3和R6互联链路&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">access-list 10 permit 120.1.0.0 0.0.254.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">access-list 20 permit 120.1.1.1 0.0.254.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map SET_LP permit 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set local-preference 120
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map SET_LP permit 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set local-preference 99
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map SET_LP permit 30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.48.4 route-map SET_LP in
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>R6、R8上配置，实现AS 64100 访问 140.1.X.X/32，X为偶数，走R4和R8互联链路；X为奇数，走R3和R6互联链路&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">access-list 30 permit 140.1.0.0 0.0.254.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">access-list 40 permit 140.1.1.1 0.0.254.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map SET_MED permit 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address 30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set metric 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map SET_MED permit 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address 40
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set metric 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map SET_MED permit 30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.36.3 route-map SET_MED out
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">access-list 30 permit 140.1.0.0 0.0.254.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">access-list 40 permit 140.1.1.1 0.0.254.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map SET_MED permit 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address 30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set metric 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map SET_MED permit 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address 40
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set metric 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map SET_MED permit 30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.48.4 route-map SET_MED out
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>R1上对起始于AS 64540的任意前缀，AS 64520总是通过R2转发（路由拆分的明细条目除外）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">配置 ip as-path列表，匹配AS 64540 开头的路径路由条目，route-map 设置追加AS号使路径变长
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip as-path access-list 100 permit _64540$
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map AS_PREPEND permit 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match as-path 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set as-path prepend last-as 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64520
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.15.5 route-map AS_PREPEND in
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="bgp路由过滤">BGP路由过滤
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>R6、R7仅通告 200.1.XY.0/24 与 100.1.1.X/32的路由到 R11、R12&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">route-map 设置匹配，向R11，R12通告路由进行过滤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip prefix-list ADV_TO_64540 seq 5 permit 200.1.0.0/16 le 24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip prefix-list ADV_TO_64540 seq 10 permit 100.1.1.0/24 le 32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map ADV_TO_64540 permit 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address prefix-list ADV_TO_64540
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.116.11 route-map ADV_TO_64540 out
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip prefix-list ADV_TO_64540 seq 5 permit 200.1.0.0/16 le 24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip prefix-list ADV_TO_64540 seq 10 permit 100.1.1.0/24 le 32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map ADV_TO_64540 permit 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address prefix-list ADV_TO_64540
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.127.12 route-map ADV_TO_64540 out
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>R3、R10上配置ORF，使AS 64100仅通告 200.1.XY.0/24 与 100.1.1.X/32的前缀到R10&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">通过向对等体通告ORF能力可以激活这一feature。表示接受从对等体来的，前缀列表，并把这个前缀列表应用到针对对等体的出站方向。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip prefix-list FROM_64100 seq 5 permit 200.1.0.0/16 le 24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip prefix-list FROM_64100 seq 10 permit 100.1.1.0/24 le 32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64540
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.103.3 capability orf prefix-list send
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.103.3 prefix-list FROM_64100 in
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.103.10 capability orf prefix-list receive
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="bgp-特性">BGP 特性
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>AS 64520 不作为传输型AS 不能使用BGP路由过滤&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">no&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">export团体属性&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">SET_COMM&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">set&lt;/span> &lt;span class="n">community&lt;/span> &lt;span class="n">no&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">export&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">router&lt;/span> &lt;span class="n">bgp&lt;/span> &lt;span class="mi">64520&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">neighbor&lt;/span> &lt;span class="mf">10.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">2.2&lt;/span> &lt;span class="n">send&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">community&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">neighbor&lt;/span> &lt;span class="mf">10.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">2.2&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">SET_COMM&lt;/span> &lt;span class="n">out&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">SET_COMM&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">set&lt;/span> &lt;span class="n">community&lt;/span> &lt;span class="n">no&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">export&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">router&lt;/span> &lt;span class="n">bgp&lt;/span> &lt;span class="mi">64520&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">neighbor&lt;/span> &lt;span class="mf">10.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span> &lt;span class="n">send&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">community&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">neighbor&lt;/span> &lt;span class="mf">10.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">SET_COMM&lt;/span> &lt;span class="n">out&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>R1与R2之间的iBGP邻居启用MD5认证，密码为cisco&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">neighbor 10.1.1.1 password cisco
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">neighbor 10.1.2.2 password cisco
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>R3上配置，若100.1.1.10/32不稳定，震荡2次抑制传递，并在5min后自动恢复&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">配置BGP路由惩罚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip prefix-list DAMPENING seq 5 permit 100.1.1.10/32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map DAMPENING permit 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address prefix-list DAMPENING
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set dampening 4 750 2000 16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp dampening route-map DAMPENING
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>R1上配置，若100.1.1.10路由条目存在，通告默认路由到R2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">EXIST_10&lt;/span> &lt;span class="n">seq&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">100.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.10&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">DEFAULT_CONDITION&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">match&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">EXIST_10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">set&lt;/span> &lt;span class="n">community&lt;/span> &lt;span class="n">no&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">export&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">router&lt;/span> &lt;span class="n">bgp&lt;/span> &lt;span class="mi">64520&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">neighbor&lt;/span> &lt;span class="mf">10.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">2.2&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">originate&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">DEFAULT_CONDITION&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="ending">Ending
&lt;/h3>&lt;ul>
&lt;li>文中可能有些配置未提及或内容术语表述的不规范，请见谅。&lt;/li>
&lt;li>配置存阿里云盘了，这是链接：[&lt;a class="link" href="https://www.aliyundrive.com/s/ekTf1JRqVFa" target="_blank" rel="noopener"
>分享的文件
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>]&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨。&lt;/li>
&lt;/ul></description></item></channel></rss>
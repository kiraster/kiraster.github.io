<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>H3C on Kir's Blog</title><link>https://kiraster.github.io/tags/h3c/</link><description>Recent content in H3C on Kir's Blog</description><generator>Hugo -- gohugo.io</generator><language>en</language><copyright>@kiraster</copyright><lastBuildDate>Sun, 16 Apr 2023 23:33:58 +0000</lastBuildDate><atom:link href="https://kiraster.github.io/tags/h3c/index.xml" rel="self" type="application/rss+xml"/><item><title>一个使用nornir框架编写的跑脚本工具</title><link>https://kiraster.github.io/posts/9571d5ee.html/</link><pubDate>Sun, 16 Apr 2023 23:33:58 +0000</pubDate><guid>https://kiraster.github.io/posts/9571d5ee.html/</guid><description>&lt;p>一个使用&lt;code>nornir&lt;/code>框架编写的跑脚本工具。之前写过一版这个菜单式跑python脚本的工具，简直臃肿的不堪入目，后面发现需要添加改进功能真让我头大。了解&lt;code>nornir&lt;/code>后，一直就想把功能移植过来，现在搞的差不多了，分享一下&lt;/p>
&lt;blockquote>
&lt;p>在32位windows系统中无法使用本脚本，原因是有几个第三方库从某个版本开始不再开发和维护32位系统的代码，而库的依赖最低版本大于最后发布的32位版本，或者装不上，亦或装上了无法用。So……&lt;/p>
&lt;/blockquote>
&lt;h2 id="介绍">介绍
&lt;/h2>&lt;ul>
&lt;li>在nornir 3.3.0框架上进行功能编写&lt;/li>
&lt;li>使用&lt;code>nornir&lt;/code>自带的并发机制，专注于功能的实现&lt;/li>
&lt;li>&lt;code>nornir&lt;/code>具有与其他开源模块的联动功能，如&lt;code>netbox&lt;/code>、&lt;code>sql&lt;/code>、&lt;code>scrapli&lt;/code>、&lt;code>napalm&lt;/code>等，具有强扩展性&lt;/li>
&lt;li>&lt;code>main&lt;/code>分支是在windows平台下运行的脚本&lt;/li>
&lt;li>&lt;code>ubuntu-branch&lt;/code>分支是在ubuntu server下运行的脚本（其他linux发行版，应该也可以）&lt;/li>
&lt;/ul>
&lt;h2 id="测试环境">测试环境
&lt;/h2>&lt;h3 id="windows">windows
&lt;/h3>&lt;ul>
&lt;li>Microsoft Windows 10 Pro 21H2&lt;/li>
&lt;li>Visual studio code Update 1.77.3&lt;/li>
&lt;li>Python 3.10.10&lt;/li>
&lt;li>nornir==3.3.0&lt;/li>
&lt;/ul>
&lt;h3 id="ubuntu">Ubuntu
&lt;/h3>&lt;ul>
&lt;li>Ubuntu 22.04.2 LTS&lt;/li>
&lt;li>Python 3.10.6&lt;/li>
&lt;li>nornir==3.3.0&lt;/li>
&lt;/ul>
&lt;h3 id="simulation-software">Simulation Software
&lt;/h3>&lt;ul>
&lt;li>HCL 5.7.2&lt;/li>
&lt;li>DeviceModel：H3C S5820V2-54QS-GE&lt;/li>
&lt;/ul>
&lt;h3 id="topology">Topology
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/05/L7nI9fTp3zEk6Rq.png">
&lt;img src="https://s2.loli.net/2023/05/05/L7nI9fTp3zEk6Rq.png"
loading="lazy"
alt="lab_test"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="运行界面">运行界面
&lt;/h2>&lt;h3 id="脚本启动界面">脚本启动界面
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/12/lFHy2EX741Ukucv.gif">
&lt;img src="https://s2.loli.net/2023/05/12/lFHy2EX741Ukucv.gif"
loading="lazy"
alt="01-startup"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="批量备份配置">批量备份配置
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/13/yWnmzFcgOACQLub.gif">
&lt;img src="https://s2.loli.net/2023/05/13/yWnmzFcgOACQLub.gif"
loading="lazy"
alt="02-export-conf.gif"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="批量修改配置">批量修改配置
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/12/7G4OLUnh1mPZyFt.gif">
&lt;img src="https://s2.loli.net/2023/05/12/7G4OLUnh1mPZyFt.gif"
loading="lazy"
alt="03-modify-conf"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="筛选--执行">筛选&amp;ndash;&amp;gt;执行
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/13/2ZHrXjtWL9MP8Cy.gif">
&lt;img src="https://s2.loli.net/2023/05/13/2ZHrXjtWL9MP8Cy.gif"
loading="lazy"
alt="04-filter-run"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="获取交换机-端口-mac地址-和-搜索mac地址对应设备">获取交换机 端口-MAC地址 和 搜索MAC地址对应设备
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/13/uS3BwMOZiPzFhnf.gif">
&lt;img src="https://s2.loli.net/2023/05/13/uS3BwMOZiPzFhnf.gif"
loading="lazy"
alt="05-get-mac-search.gif"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="批量snmp轮询">批量snmp轮询
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/12/HXq4kr5RgdENSmC.gif">
&lt;img src="https://s2.loli.net/2023/05/12/HXq4kr5RgdENSmC.gif"
loading="lazy"
alt="06-snmp"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="批量ssh可达性测试">批量ssh可达性测试
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/12/VujiXYQF8DBJ4lc.gif">
&lt;img src="https://s2.loli.net/2023/05/12/VujiXYQF8DBJ4lc.gif"
loading="lazy"
alt="07-ssh"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="批量ping可达性测试">批量ping可达性测试
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/13/FdADRmT7ijzwHkE.gif">
&lt;img src="https://s2.loli.net/2023/05/13/FdADRmT7ijzwHkE.gif"
loading="lazy"
alt="08-ping"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="批量保存配置">批量保存配置
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/12/aQxUnHKLV1Cdv7l.gif">
&lt;img src="https://s2.loli.net/2023/05/12/aQxUnHKLV1Cdv7l.gif"
loading="lazy"
alt="09-save"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="查看设备清单">查看设备清单
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/12/SEPBO96jQLzfAru.gif">
&lt;img src="https://s2.loli.net/2023/05/12/SEPBO96jQLzfAru.gif"
loading="lazy"
alt="10-all-device"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="导出诊断信息和日志tftp">导出诊断信息和日志（TFTP）
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/12/25vYimxPfXryE98.gif">
&lt;img src="https://s2.loli.net/2023/05/12/25vYimxPfXryE98.gif"
loading="lazy"
alt="11-diag"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="生成的文件">生成的文件
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/13/YjHq6JEcClrmv4F.gif">
&lt;img src="https://s2.loli.net/2023/05/13/YjHq6JEcClrmv4F.gif"
loading="lazy"
alt="12-file-saved"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="文件根目录">文件根目录
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/13/3fpAmPkHUjLeQhM.jpg">
&lt;img src="https://s2.loli.net/2023/05/13/3fpAmPkHUjLeQhM.jpg"
loading="lazy"
alt="ScreenCaputure230512235941"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="功能说明">功能说明
&lt;/h2>&lt;ol>
&lt;li>批量备份配置
&lt;ul>
&lt;li>根据加载的设备清单，读取ssh登陆信息登陆设备，执行display列中的display命令，将回显内容写入到&lt;code>EXPORT\当天日期\export_conf&lt;/code>文件夹下，每个设备的回显内容分别记录在一个txt文件(格式：name + ip + 当前时间.txt)，运行结果记录在&lt;code>EXPORT\当天日期\result_当天日期.log&lt;/code>文件&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>批量修改配置
&lt;ul>
&lt;li>根据加载的设备清单，读取ssh登陆信息登陆设备，执行config列中的config命令，将回显内容写入到&lt;code>EXPORT\当天日期\modify_conf&lt;/code>文件夹下，每个设备的回显内容分别记录在一个txt文件(格式：name + ip + 当前时间.txt)，运行结果记录在&lt;code>EXPORT\当天日期\result_当天日期.log&lt;/code>文件&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>筛选&amp;ndash;&amp;gt;执行
&lt;ul>
&lt;li>选择该功能选项后，会在二级菜单显示主菜单中的1、2、6、7、8、9功能&lt;/li>
&lt;li>选择对应功能后进入筛选菜单&lt;/li>
&lt;li>筛选菜单：
&lt;ul>
&lt;li>IP地址-筛选&lt;/li>
&lt;li>平台-筛选&lt;/li>
&lt;li>设备型号-筛选&lt;/li>
&lt;li>区域-筛选&lt;/li>
&lt;li>组合筛选&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>获取交换机 端口-MAC地址
&lt;ul>
&lt;li>该功能通过获取交换机MAC地址表和trunk接口信息，求差集获取到非trunk接口的MAC地址表，表格文件存储到&lt;code>EXPORT\当天日期\generate_table&lt;/code>，格式为：&lt;code>当天日期_当前时间_MAC地址表.xlsx&lt;/code>&lt;/li>
&lt;li>强烈建议在代码&lt;code>task.run&lt;/code>前进行filter过滤接入交换机的&lt;code>nr对象&lt;/code>&lt;/li>
&lt;li>运行结果记录在&lt;code>EXPORT\当天日期\result_当天日期.log&lt;/code>文件&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>搜索MAC地址对应设备
&lt;ul>
&lt;li>本功能依赖功能4中生成的MAC地址表，需要使用本功能先执行功能4&lt;/li>
&lt;li>输入的MAC地址格式任意，可以是全匹配如：4426-0f92-0d06，也可以是其中部分如：0d06 或 4426，或者任意字符（没有意义）&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>批量snmp轮询
&lt;ul>
&lt;li>根据加载的设备清单，执行snmp_get操作，将获取到的结果写入到SNMP轮询结果表，表格文件存储到&lt;code>EXPORT\当天日期\generate_table&lt;/code>，格式为：&lt;code>当天日期_当前时间_snmp轮询结果表.xlsx&lt;/code>&lt;/li>
&lt;li>运行结果记录在&lt;code>EXPORT\当天日期\result_当天日期.log&lt;/code>文件&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>批量ssh可达性测试
&lt;ul>
&lt;li>根据加载的设备清单，读取ssh登陆信息登陆设备，以获取到设备的&lt;code>prompt&lt;/code>作为依据判断ssh可达，运行结果记录在&lt;code>EXPORT\当天日期\result_当天日期.log&lt;/code>文件&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>批量ping可达性测试
&lt;ul>
&lt;li>根据加载的设备清单，执行ping操作，以没有异常作为依据判断ping可达，运行结果记录在&lt;code>EXPORT\当天日期\result_当天日期.log&lt;/code>文件&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>批量保存配置
&lt;ul>
&lt;li>根据加载的设备清单，执行&lt;code>netmiko_save_config&lt;/code>操作，以没有异常作为依据判断保存成功，运行结果记录在&lt;code>EXPORT\当天日期\result_当天日期.log&lt;/code>文件&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>显示设备清单
&lt;ul>
&lt;li>根据加载的设备清单，列出[&amp;rsquo;name&amp;rsquo;, &amp;lsquo;ip&amp;rsquo;, &amp;lsquo;platform&amp;rsquo;, &amp;lsquo;model&amp;rsquo;, &amp;lsquo;device_type&amp;rsquo;, &amp;lsquo;area&amp;rsquo;, &amp;rsquo;location&amp;rsquo;, &amp;lsquo;version&amp;rsquo;, &amp;lsquo;sn&amp;rsquo;]等内容&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>导出诊断信息和日志（TFTP）
&lt;ul>
&lt;li>根据&lt;code>nr.filter(hostname=device_ip)&lt;/code>过滤单台设备，对设备的诊断信息文件，诊断日志文件和日志文件上传到 TFTP 服务器&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h2 id="如何使用">如何使用
&lt;/h2>&lt;h3 id="下载">下载
&lt;/h3>&lt;p>&lt;code>Github&lt;/code>仓库地址：https://github.com/kiraster/netops_v2.0_beta&lt;/p>
&lt;h3 id="虚拟环境">虚拟环境
&lt;/h3>&lt;p>由于正常运行需要安装很多第三方库，且有些库的依赖需要降级版本才能正常运行，或可能与你当前python环境会有冲突，建议在虚拟环境下运行&lt;/p>
&lt;p>以&lt;code>vscode&lt;/code>软件举例:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>代码编辑打开目录并控制台切换到代码根目录&lt;/p>
&lt;/li>
&lt;li>
&lt;p>创建虚拟环境&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">python -m venv venv
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>激活虚拟环境&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">.\venv\Scripts\Activate.ps1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="安装-python-库">安装 python 库
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">pip install -r requirements.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>安装库的时候可能遇到&lt;code>timeout&lt;/code>提示，检查网络；如遇报错看提示去Google&lt;/p>
&lt;h2 id="运行前说明">运行前说明
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>查看&lt;code>nornir.yaml&lt;/code>文件，发现&lt;code>plugin: ExcelInventory&lt;/code>，是因为本代码使用了&lt;a class="link" href="https://github.com/jiujing/nornir_table_inventory" target="_blank" rel="noopener"
>【nornir_table_inventory 插件】
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>excel_file: &amp;quot;inventory/inventory_unprotected.xlsx&amp;quot;&lt;/code>，这行配置指示了需要的excel文件，注意看文件名（unprotected），这是一个不带保护密码的excel文件，具体说明见&lt;code>README&lt;/code>文件&lt;/p>
&lt;/li>
&lt;li>
&lt;p>inventory文件夹下还有一个&lt;code>inventory_protected.xlsx&lt;/code>文件，这是一个有保护密码的文件&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>inventory_protected.xlsx&lt;/code>文件需要自行制作并设置一个保护密码，以下是本机环境中的格式，可参照插件作者的示例增删改&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/13/8GgzxanbZYiEW9C.jpg">
&lt;img src="https://s2.loli.net/2023/05/13/8GgzxanbZYiEW9C.jpg"
loading="lazy"
alt="ScreenCaputure230513003040"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>inventory_protected.xlsx&lt;/code>文件中&lt;code>dispaly&lt;/code>和&lt;code>config&lt;/code>列的内容是查看命令和配置命令，每个命令之间使用逗号&lt;code>,&lt;/code>分隔；如在单元格内使用手动换行(换行符&lt;code>\n&lt;/code>)需要修改代码中&lt;code>cmds = task.host.get('display').split(',')&lt;/code>和&lt;code>cmds = task.host.get('config').split(',')&lt;/code>的&lt;code>split(',')&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>可以根据实际情况修改&lt;code>num_workers&lt;/code>并发进程数和日志记录&lt;/p>
&lt;/li>
&lt;li>
&lt;p>如修改inventory路径和excel文件名，自行更新代码中对应的路径变量&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="代码执行逻辑">代码执行逻辑
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/13/VXpg4r7GjTeOny8.jpg">
&lt;img src="https://s2.loli.net/2023/05/13/VXpg4r7GjTeOny8.jpg"
loading="lazy"
alt="ScreenCaputure230513004510"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="最后">最后
&lt;/h2>&lt;ul>
&lt;li>总有不足之处，可以提，但不一定改&lt;/li>
&lt;li>我总觉得使用display和show等命令去采集设备信息不是一个很妥的方式，特别是配合textfsm形成列表套字典再写入表格；且不说速度慢，每一个命令对应一个模板导致代码结构不简洁和繁多，每个厂商的命令也不尽相同，有时同厂商同命令的回显也有差异导致要修改模板；同一源IP地址过度使用ssh登陆可能会被安全设备记录异常行为，特别是设备不可达或密码错会被识别为爆破攻击。&lt;/li>
&lt;li>采集就由专业的snmp去干就好，速度快。很多公共的OID一轮询就得出结果。实在不济可以弄得专业点写个针对厂商和型号的snmp轮询模板（我不会），再专业点可以去下载设备的MIB文件鼓捣鼓捣（你来），很多厂商的网管平台号称可以纳管友商设备靠的不就是这个&lt;/li>
&lt;li>对于批量修改配置，我的看法是慎用，特别是涉及控制层面的配置；如果要使用尽量在风险可控的前提下使用，如改个设备名称，添加描述，设备开局的批量调试等等；如确实要跑脚本建议先验证再验证，先小范围跑一两台设备，重要设备就手敲；随时做好提桶跑路。&lt;/li>
&lt;li>现网运行业务的时候不要乱搞，看过一个运维的采购文件，中断一次扣多少钱，多长时间内不能恢复又扣钱，看的胆战心惊的，这很大程度上让我理解了为什么一个看似不大规模的运维项目最终报价高的离谱，可能也许包含了一部分这些风险&lt;/li>
&lt;li>欢乐的时光总是特别短，又到时候讲byebye&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨。&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>&lt;strong>20230513 更新了此文章内容&lt;/strong>&lt;/p>
&lt;/blockquote></description></item><item><title>基于Django编写的SNMP轮询Demo</title><link>https://kiraster.github.io/posts/d70f2b4c.html/</link><pubDate>Mon, 13 Mar 2023 14:12:11 +0000</pubDate><guid>https://kiraster.github.io/posts/d70f2b4c.html/</guid><description>&lt;p>一个基于&lt;code>Django&lt;/code>编写的&lt;code>SNMP&lt;/code>轮询Demo，可以对设备（代码内置了H3C OID部分规则）进行&lt;code>SNMP&lt;/code>轮询，&lt;code>icmp&lt;/code>连通性检测，并将结果写入数据库，前端页面读取数据库数据进行直观的展示。效果图可点击本页面导航栏的&lt;code>Gallery&lt;/code>相册查看。&lt;/p>
&lt;h2 id="一个视频">一个视频
&lt;/h2>&lt;p>&lt;strong>无解说无字幕，嫌BGM太吵可静音&lt;/strong>&lt;/p>
&lt;div class="video-wrapper">
&lt;iframe src="https://player.bilibili.com/player.html?as_wide=1&amp;amp;high_quality=1&amp;amp;page=1&amp;bvid=BV1d24y147SC"
scrolling="no"
frameborder="no"
framespacing="0"
allowfullscreen="true"
>
&lt;/iframe>
&lt;/div>
&lt;hr>
&lt;h2 id="缘由">缘由
&lt;/h2>&lt;p>&lt;strong>声明：我不是搞软件的&lt;/strong>&lt;/p>
&lt;p>当初仅为了在项目实施中显示设备的上线情况和快速查找到需要变更配置的设备；后来越搞越多，像首页，设备导出，修改页，查看配置，计划任务，清空数据等功能并不是我当初有计划要制作的；最后及时刹车，许多脑中风暴的功能没有继续写，也没有继续添加功能的计划。&lt;/p>
&lt;h2 id="代码组成及工作流">代码组成及工作流
&lt;/h2>&lt;p>&lt;strong>框架&lt;/strong>&lt;/p>
&lt;p>&lt;code>Bootstrap-3.3.7&lt;/code>+&lt;code>Django4.0.7&lt;/code>+&lt;code>MySql-5.7.39&lt;/code>（或&lt;code>sqlite&lt;/code>）&lt;/p>
&lt;p>&lt;strong>工作流&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>设备初始参数写入数据库&lt;/li>
&lt;li>设备的轮询，并对结果进行写入数据库&lt;/li>
&lt;li>前端页面对数据的展示&lt;/li>
&lt;/ol>
&lt;h2 id="页面及功能">页面及功能
&lt;/h2>&lt;ol>
&lt;li>首页
&lt;ol>
&lt;li>设备类型统计显示&lt;/li>
&lt;li>设备在线/离线、CPU使用率、内存使用率概览饼状图显示&lt;/li>
&lt;li>设备CPU使用率、内存使用率 TOP 10 显示&lt;/li>
&lt;li>关于&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>设备管理
&lt;ol>
&lt;li>设备数据显示&lt;/li>
&lt;li>设备添加
&lt;ol>
&lt;li>snmp测试&lt;/li>
&lt;li>继续添加&lt;/li>
&lt;li>添加并返回&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>设备导出&lt;/li>
&lt;li>设备详情
&lt;ol>
&lt;li>刷新&lt;/li>
&lt;li>执行查看配置&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>设备参数修改、同步、删除&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>计划任务
&lt;ol>
&lt;li>定时任务&lt;/li>
&lt;li>手动任务&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>更多操作
&lt;ol>
&lt;li>批量导入&lt;/li>
&lt;li>清空数据&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;h2 id="如何使用">如何使用
&lt;/h2>&lt;p>&lt;strong>clone 仓库代码至本地或使用浏览器下载压缩包&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">git clone https://github.com/kiraster/ndgv_demo.git
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>或 &lt;a class="link" href="https://github.com/kiraster/ndgv_demo" target="_blank" rel="noopener"
>https://github.com/kiraster/ndgv_demo
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a> &lt;strong>Code&lt;/strong> &amp;ndash;&amp;raquo; &lt;strong>Download ZIP&lt;/strong>&lt;/p>
&lt;h3 id="本地处理">本地处理
&lt;/h3>&lt;p>使用任意支持Python 的 IDE工具，将代码目录添加&lt;/p>
&lt;h3 id="安装环境">安装环境
&lt;/h3>&lt;p>&lt;strong>为了不影响你电脑的python环境，建议使用虚拟环境运行本代码&lt;/strong>（以下用&lt;strong>Visual Studio Code&lt;/strong> 软件举例）&lt;/p>
&lt;ol>
&lt;li>
&lt;p>IDE工具控制台切换到代码根目录&lt;/p>
&lt;/li>
&lt;li>
&lt;p>创建虚拟环境&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">python -m venv venv
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>激活虚拟环境&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">.\venv\Scripts\Activate.ps1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>可能遇到不能执行脚本的错误，可以以管理员身份打开&lt;code>powershell&lt;/code>，执行&lt;code> set-executionpolicy remotesigned&lt;/code>，选择&lt;code>y&lt;/code>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h4 id="安装python库">安装python 库
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">pip install -r requirements.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="初始化数据库">初始化数据库
&lt;/h3>&lt;ol>
&lt;li>修改&lt;code>ndgv1/settings.py &lt;/code>文件(78行开始)（以下是使用&lt;code>sqlite&lt;/code>数据的配置，如需使用&lt;code>MySQL&lt;/code>，把&lt;code>sqlite&lt;/code>部分注释，再把&lt;code>MySQL&lt;/code>注释部分取消即可）&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">DATABASES = {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;default&amp;#39;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;ENGINE&amp;#39;: &amp;#39;django.db.backends.sqlite3&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;NAME&amp;#39;: BASE_DIR / &amp;#39;db.sqlite3&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # &amp;#39;default&amp;#39;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # &amp;#39;ENGINE&amp;#39;: &amp;#39;django.db.backends.mysql&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # &amp;#39;NAME&amp;#39;: &amp;#39;ndgv1.3&amp;#39;, # 数据库名称
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # &amp;#39;USER&amp;#39;: &amp;#39;root&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # &amp;#39;PASSWORD&amp;#39;: &amp;#39;xxxxxxxx&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # &amp;#39;HOST&amp;#39;: &amp;#39;127.0.0.1&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # &amp;#39;PORT&amp;#39;: 3306,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # &amp;#39;CHARSET&amp;#39;: &amp;#39;utf8&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>
&lt;p>删除&lt;code>device_app/migrations&lt;/code> 和 &lt;code>scheduler_app/migrations&lt;/code> 除&lt;code>_init_.py &lt;/code>外的所有文件&lt;/p>
&lt;/li>
&lt;li>
&lt;p>删除 &lt;code>db.sqlite3&lt;/code> 文件&lt;/p>
&lt;/li>
&lt;li>
&lt;p>执行数据库迁移命令&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">python manage.py makemigrations
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">python manage.py migrate
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="修改清空数据功能代码">修改&lt;code>清空数据&lt;/code>功能代码
&lt;/h3>&lt;p>修改&lt;code>device_app/views&lt;/code>文件(683行开始)，以下是使用&lt;code>sqlite&lt;/code>数据的配置，如需使用&lt;code>MySQL&lt;/code>，把&lt;code>sqlite&lt;/code>部分注释，再把&lt;code>MySQL&lt;/code>注释部分取消即可&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">只直接使用原生 sql 语句 更快
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">from django.db import connection
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># sqlite 数据库
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sqlite_db = connection.cursor()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># MySQL 数据库
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># mysql_db = connection.cursor()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 执行 命令 重置 自增ID
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sqlite_db.execute(&amp;#39;DELETE FROM sqlite_sequence&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sqlite_db.execute(&amp;#39;DELETE FROM device_app_device&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sqlite_db.execute(&amp;#39;DELETE FROM device_app_devicedetail&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sqlite_db.execute(&amp;#39;DELETE FROM device_app_devicestate&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sqlite_db.execute(&amp;#39;DELETE FROM device_app_devicelocation&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sqlite_db.execute(&amp;#39;DELETE FROM scheduler_app_schedulerdetail&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sqlite_db.execute(&amp;#39;DELETE FROM django_apscheduler_djangojob&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sqlite_db.execute(&amp;#39;DELETE FROM django_apscheduler_djangojobexecution&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sqlite_db.execute(&amp;#39;DELETE FROM sqlite_sequence&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 取消外键约束
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># mysql_db.execute(&amp;#39;SET FOREIGN_KEY_CHECKS=0&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># mysql_db.execute(&amp;#39;truncate table device_app_device&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># mysql_db.execute(&amp;#39;truncate table device_app_devicedetail&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># mysql_db.execute(&amp;#39;truncate table device_app_devicestate&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># mysql_db.execute(&amp;#39;truncate table device_app_devicelocation&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># mysql_db.execute(&amp;#39;truncate table scheduler_app_schedulerdetail&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># mysql_db.execute(&amp;#39;truncate table django_apscheduler_djangojob&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># mysql_db.execute(&amp;#39;truncate table django_apscheduler_djangojobexecution&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 设置外键约束
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># mysql_db.execute(&amp;#39;SET FORE
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="运行代码">运行代码
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">python .\manage.py runserver
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="代码弊端">代码弊端
&lt;/h2>&lt;ol>
&lt;li>代码写死华三设备的oid&lt;/li>
&lt;li>代码中写死设备命名规则&lt;/li>
&lt;li>定时任务写死轮询时间&lt;/li>
&lt;li>前端页面展示以1080P分辨率屏幕编写&lt;/li>
&lt;li>首页展示，类别显示的规则写死华三设备型号&lt;/li>
&lt;li>……&lt;/li>
&lt;/ol>
&lt;h2 id="可能的问题或错误">可能的问题或错误
&lt;/h2>&lt;ol>
&lt;li>&lt;code>PermissionError: [WinError 10013] &lt;/code>以一种访问权限不允许的方式做了一个访问套接字的尝试。
&lt;ol>
&lt;li>使用管理员权限运行IDE编辑器&lt;/li>
&lt;li>检查是否端口占用&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>设备管理页面显示的数据不正确
&lt;ol>
&lt;li>由于是内置华三部分设备的&lt;code>OID&lt;/code>，有些设备的&lt;code>OID&lt;/code>值没有添加到代码&lt;/li>
&lt;li>有些数据根据设备命名规则解析出来的，如果设备名称不符合命名规则会显示不正确&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>设备同步后显示同步成功，但是没有数据
&lt;ol>
&lt;li>可能是snmp团体字不正确，或IP地址不可达&lt;/li>
&lt;li>或者本机防火墙限制&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>批量导入失败
&lt;ol>
&lt;li>上传文件中格式不准确或数据有误&lt;/li>
&lt;li>上传文件中数据与已有数据冲突，可使用清空数据再进行导入&lt;/li>
&lt;li>由于没有加入Django事务，对于已导入正确数据并不会进行回退&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>首页中类型统计不正确
&lt;ol>
&lt;li>统计规则是根据华三的设备型号中关键字定义的&lt;/li>
&lt;li>其他厂商设备不通用&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>页面显示不全或内容挤压
&lt;ol>
&lt;li>编写时候是以1080P分辨率屏幕显示为准&lt;/li>
&lt;li>没有对其他分辨率屏幕做调整&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol></description></item><item><title>H3C_连接L2TP的客户端设置(图片)</title><link>https://kiraster.github.io/posts/ab889e59.html/</link><pubDate>Sat, 16 Oct 2021 11:49:23 +0000</pubDate><guid>https://kiraster.github.io/posts/ab889e59.html/</guid><description>&lt;h2 id="inode-客户端设置">iNode 客户端设置
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/6tObaIvM4sT8LQH.jpg">
&lt;img src="https://i.loli.net/2021/10/16/6tObaIvM4sT8LQH.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/Dfh7wak1BMEGAzF.jpg">
&lt;img src="https://i.loli.net/2021/10/16/Dfh7wak1BMEGAzF.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/xeio4aJEXTwj32c.jpg">
&lt;img src="https://i.loli.net/2021/10/16/xeio4aJEXTwj32c.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/Nr5fvnBb1iMymWX.jpg">
&lt;img src="https://i.loli.net/2021/10/16/Nr5fvnBb1iMymWX.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/u9LWMGB8kblwQNc.jpg">
&lt;img src="https://i.loli.net/2021/10/16/u9LWMGB8kblwQNc.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/uqZ67QnwrOc3Pb9.jpg">
&lt;img src="https://i.loli.net/2021/10/16/uqZ67QnwrOc3Pb9.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/2udqBsEzFVnJWpw.jpg">
&lt;img src="https://i.loli.net/2021/10/16/2udqBsEzFVnJWpw.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/MtpabHJN3GWx6sQ.jpg">
&lt;img src="https://i.loli.net/2021/10/16/MtpabHJN3GWx6sQ.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/ahRQEToFxqCgjYw.jpg">
&lt;img src="https://i.loli.net/2021/10/16/ahRQEToFxqCgjYw.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="windows-端配置网络中心添加">windows 端配置—网络中心添加
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/sc7ZTg9qI4z6QGC.jpg">
&lt;img src="https://i.loli.net/2021/10/16/sc7ZTg9qI4z6QGC.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/qnu39EMLNT5YWsH.jpg">
&lt;img src="https://i.loli.net/2021/10/16/qnu39EMLNT5YWsH.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/9VFMLRE4DkuCKTe.jpg">
&lt;img src="https://i.loli.net/2021/10/16/9VFMLRE4DkuCKTe.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/MTipvRdDfh5ztJS.jpg">
&lt;img src="https://i.loli.net/2021/10/16/MTipvRdDfh5ztJS.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/7KN6uextv8WQyLO.jpg">
&lt;img src="https://i.loli.net/2021/10/16/7KN6uextv8WQyLO.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/KceAM7gHX6IESUR.jpg">
&lt;img src="https://i.loli.net/2021/10/16/KceAM7gHX6IESUR.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/6VDYJ5jbspS9wiu.jpg">
&lt;img src="https://i.loli.net/2021/10/16/6VDYJ5jbspS9wiu.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/pa1LGCK3qebd4fy.jpg">
&lt;img src="https://i.loli.net/2021/10/16/pa1LGCK3qebd4fy.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/dG2CNP1lnI94AxH.jpg">
&lt;img src="https://i.loli.net/2021/10/16/dG2CNP1lnI94AxH.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/iLPUBrnG8hyaNvV.jpg">
&lt;img src="https://i.loli.net/2021/10/16/iLPUBrnG8hyaNvV.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p></description></item><item><title>H3C_SecureCRT巡检脚本</title><link>https://kiraster.github.io/posts/21b002a6.html/</link><pubDate>Sun, 18 Apr 2021 06:58:53 +0000</pubDate><guid>https://kiraster.github.io/posts/21b002a6.html/</guid><description>&lt;h4 id="脚本介绍和使用">&lt;strong>脚本介绍和使用&lt;/strong>
&lt;/h4>&lt;ul>
&lt;li>这是一个巡检脚本，使用 CRT 软件登陆H3C设备，点击 “Script” &amp;ndash;&amp;gt; &amp;ldquo;Run&amp;rdquo; 选择脚本，运行脚本可得到需要收集的信息（当然你要打开 log 记录日志，相信你懂）&lt;/li>
&lt;li>可以根据你的实际需要修改 “Send” 后面的内容&lt;/li>
&lt;li>好久不更博客了，最近干了一些小项目，能写的我尽量写写……&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#$language = &amp;#34;VBScript&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#$interface = &amp;#34;1.0&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">crt.Screen.Synchronous = True
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;#39; This automatically generated script may need to be
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;#39; edited in order to work correctly.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sub Main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;#start right now&amp;#34;&amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.WaitForString &amp;#34;&amp;gt;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;screen-length disable&amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;display cur &amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;display ip interface brief&amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;display interface brief des&amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;display vlan&amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;display vlan brief&amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;display ip routing-table&amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;display version&amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;display cpu-usage&amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;display memory&amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;display device manuinfo&amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;save force&amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;save force&amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">End Sub
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>
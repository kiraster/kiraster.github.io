<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>ICT on Kir's Blog</title><link>https://weeaster.github.io/tags/ict/</link><description>Recent content in ICT on Kir's Blog</description><generator>Hugo -- gohugo.io</generator><language>en</language><copyright>@kiraster</copyright><lastBuildDate>Wed, 24 Jul 2024 16:16:07 +0000</lastBuildDate><atom:link href="https://weeaster.github.io/tags/ict/index.xml" rel="self" type="application/rss+xml"/><item><title>2022-2023华为ICT大赛（全国）实验题研究</title><link>https://weeaster.github.io/posts/8f2ea734/</link><pubDate>Wed, 24 Jul 2024 16:16:07 +0000</pubDate><guid>https://weeaster.github.io/posts/8f2ea734/</guid><description>&lt;p>上一篇文整了个大阵仗（内容太多，浏览器好像有些受不了）&lt;/p>
&lt;p>经过在搜索引擎遨游，最终发现这些题其实在华为的ICT学院课程网站上有&lt;/p>
&lt;p>&lt;a class="link" href="https://talent.shixizhi.huawei.com" target="_blank" rel="noopener"
>https://talent.shixizhi.huawei.com
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a> &amp;ndash;&amp;raquo; 搜索ICT &amp;ndash;&amp;raquo; 华为ICT大赛 - 网络赛道学习空间（中国区）&lt;/p>
&lt;p>还有其他内容，有兴趣可以点击看看&lt;/p>
&lt;p>本次研究研究，搓一搓的图如标题所示&lt;/p>
&lt;p>文章末尾，附上ensp拓扑文件和配置导出文件&lt;/p>
&lt;h2 id="说明">说明
&lt;/h2>&lt;ul>
&lt;li>ensp版本：1.3.00.100 V100R003C00SPC100&lt;/li>
&lt;li>电脑：Win10 ltsc （CPU：不配拥有名称，RAM=16GB）&lt;/li>
&lt;li>我电脑跑这图是真的卡&lt;/li>
&lt;li>遇到FW启动错误代码40，建议先启动FW，再启动其他设备&lt;/li>
&lt;li>AR路由器我整不出G0/0/3接口，使用G3/0/0代替&lt;/li>
&lt;/ul>
&lt;h2 id="实验拓扑">实验拓扑
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/24/n4ubkLNCS3E2PXa.jpg">
&lt;img src="https://s2.loli.net/2024/07/24/n4ubkLNCS3E2PXa.jpg"
loading="lazy"
alt="ENSP拓扑"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="配置">配置
&lt;/h2>&lt;h3 id="任务1vlan">任务1：VLAN
&lt;/h3>&lt;ul>
&lt;li>按照给出的表格数据配置对应设备的vlan、Trunk、Access&lt;/li>
&lt;li>路由器接口注意配置子接口dot1q termination vid xx ，arp broadcast enable&lt;/li>
&lt;li>防火墙接口注意配置 vlan-type dot1q xx&lt;/li>
&lt;/ul>
&lt;h3 id="任务2ip地址">任务2：IP地址
&lt;/h3>&lt;ul>
&lt;li>按照给出的表格数据配置对应设备的IP地址&lt;/li>
&lt;/ul>
&lt;h3 id="任务3mstp配置">任务3：MSTP配置
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>SW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stp mode mstp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stp region-configuration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> region-name RG1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> instance 1 vlan 2 to 9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> instance 2 vlan 10 to 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> active region-configuration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> stp edged-port enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> stp edged-port enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>SW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stp mode mstp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stp region-configuration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> region-name RG1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> instance 1 vlan 2 to 9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> instance 2 vlan 10 to 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> active region-configuration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stp instance 1 priority 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stp instance 2 priority 4096
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> stp root-protection
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> stp disable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>SW3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stp mode mstp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stp region-configuration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> region-name RG1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> instance 1 vlan 2 to 9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> instance 2 vlan 10 to 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> active region-configuration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stp instance 1 priority 4096
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stp instance 2 priority 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> stp edged-port enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> stp root-protection
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> stp disable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>验证: dis stp&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="任务4防火墙安全域配置">任务4：防火墙安全域配置
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>FW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/5.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/5.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/3.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone dmz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/5.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/5.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/3.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone dmz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>验证：dis zone interface&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="任务5防火墙vrrp双机热备和安全策略配置">任务5：防火墙VRRP、双机热备和安全策略配置
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>FW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/5.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 1 virtual-ip 192.168.1.254 active
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/5.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 2 virtual-ip 192.168.2.254 standby
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hrp enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hrp interface GigabitEthernet1/0/1 remote 15.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hrp mirror session enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">security-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name web
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 192.168.1.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 100.1.1.1 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service protocol tcp destination-port 8080
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name Wireless
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 192.168.2.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/5.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 1 virtual-ip 192.168.1.254 standby
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/5.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 2 virtual-ip 192.168.2.254 active
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hrp enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hrp interface GigabitEthernet1/0/1 remote 15.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hrp mirror session enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 配置hrp后，安全策略配置从HRP_M[FW1]同步，不能在HRP_S[FW2]配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nat server 0 protocol tcp global 100.1.1.1 8080 inside 172.16.1.1 www
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">security-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name web
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 172.16.1.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service http
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>验证&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="任务6公网静态路由配置">任务6：公网静态路由配置
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>FW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 10.2.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 100.1.1.1 255.255.255.255 10.2.2.2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 10.3.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 100.1.1.1 255.255.255.255 10.3.2.2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 20.1.3.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 100.1.1.1 255.255.255.255 NULL0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>PE1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ip route-static 192.168.2.0 255.255.255.0 10.2.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 192.168.2.0 255.255.255.0 10.3.1.1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h3 id="任务7公网动态路由配置">任务7：公网动态路由配置
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>PE1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">isis 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> is-level level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network-entity 01.0000.0010.0100.1001.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> domain-authentication-mode md5 cipher ICTEXAM
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 1.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2.2.2.2 as-number 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2.2.2.2 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>PE2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">isis 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> is-level level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network-entity 01.0000.0020.0200.2002.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> domain-authentication-mode md5 cipher ICTEXAM
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 3.3.3.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2.2.2.2 as-number 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2.2.2.2 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 20.1.4.2 as-number 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>P&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">isis 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> is-level level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network-entity 01.0000.0030.0300.3003.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> domain-authentication-mode md5 cipher ICTEXAM
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 2.2.2.2 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 2.2.2.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> group ibgpv4 internal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.1 as-number 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.1 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 3.3.3.3 as-number 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 3.3.3.3 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 reflect-client
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.1 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 3.3.3.3 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>Internet&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 16.16.16.16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 20.1.4.1 as-number 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 16.16.16.16 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default-route-advertise
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> area 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 30.1.1.1 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ospf network-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>DC-GW&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ospf network-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ospf 100 router-id 11.11.11.11
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> area 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 11.11.11.11 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 30.1.1.2 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 30.1.2.1 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 30.1.3.1 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>Leaf1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ospf 100 router-id 12.12.12.12
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> area 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 12.12.12.12 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 30.1.2.2 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.1.254 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>Leaf2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ospf 100 router-id 13.13.13.13
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> area 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 13.13.13.13 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 30.1.3.2 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>验证&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="任务8mpls-vpn">任务8：MPLS VPN
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>PE1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> import-route static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family vpnv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2.2.2.2 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls lsr-id 1.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance ToDC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> route-distinguisher 100:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn-target 200:1 both
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance ToDC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.2.2.2 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet3/0/0.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance ToDC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.3.2.2 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static vpn-instance ToDC 192.168.0.0 255.255.0.0 10.2.2.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static vpn-instance ToDC 192.168.0.0 255.255.0.0 10.3.2.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family vpn-instance ToDC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> import-route static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>PE2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2.2.2.2 next-hop-local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family vpnv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2.2.2.2 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls lsr-id 3.3.3.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance ToDC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> route-distinguisher 100:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn-target 200:1 both
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance ToDC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 20.1.3.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family vpn-instance ToDC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 20.1.3.2 as-number 300
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>P&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family vpnv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> undo policy vpn-target
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 reflect-client
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.1 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 3.3.3.3 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls lsr-id 2.2.2.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 300
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 20.1.3.1 as-number 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> import-route static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis bgp vpnv4 all peer&lt;/p>
&lt;/li>
&lt;li>
&lt;p>dis mpls ldp int&lt;/p>
&lt;/li>
&lt;li>
&lt;p>dis mpls ldp peer&lt;/p>
&lt;/li>
&lt;li>
&lt;p>dis ip vpn-instance verbose&lt;/p>
&lt;/li>
&lt;li>
&lt;p>dis bgp vpnv4 all routing-table&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="任务9gre">任务9：GRE
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>Leaf1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 173.1.2.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel-protocol gre
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source 12.12.12.12
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination 13.13.13.13
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 172.16.2.0 255.255.255.0 173.1.2.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>Leaf2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 173.1.2.2 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel-protocol gre
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source 13.13.13.13
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination 12.12.12.12
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 172.16.3.0 255.255.255.0 173.1.2.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h3 id="任务10wlan">任务10：WLAN
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>FW1/FW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/5.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service-manage ping permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/5.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service-manage ping permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AC&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vlan batch 19 to 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dhcp enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip pool For_AP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gateway-list 192.168.19.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 192.168.19.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip pool STA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gateway-list 192.168.2.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 192.168.2.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> excluded-ip-address 192.168.2.1 192.168.2.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlanif19
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.19.254 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp select global
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlanif20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.2.1 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp select global
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">capwap source interface vlanif19
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wlan
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security-profile name s1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security wpa-wpa2 psk pass-phrase Huawei@123 aes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssid-profile name s1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssid ICT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vap-profile name p1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> forward-mode tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service-vlan vlan-id 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssid-profile s1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security-profile s1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-group name default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> radio 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vap-profile p1 wlan 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-id 1 type-id 56 ap-mac 00e0-fcef-0250 ap-sn 2102354483100961AE61
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-group default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="综合测试">综合测试
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>Web-Client访问Web-Server&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/24/bpNLtzCIxgWQ4S9.png">
&lt;img src="https://s2.loli.net/2024/07/24/bpNLtzCIxgWQ4S9.png"
loading="lazy"
alt="image-20240724115158242"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>FW3查看会话&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;FW3&amp;gt;dis firewall session table verbose
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024-07-24 03:54:01.520
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Current Total Sessions : 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> http VPN: public --&amp;gt; public ID: c487fdedb993138324f66a07acf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Zone: untrust --&amp;gt; trust TTL: 00:00:10 Left: 00:00:05
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Recv Interface: GigabitEthernet1/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Interface: GigabitEthernet1/0/1 NextHop: 30.1.1.2 MAC: 00e0-fc45-0d43
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;--packets: 5 bytes: 515 --&amp;gt; packets: 6 bytes: 399
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 192.168.1.1:2050 --&amp;gt; 100.1.1.1:8080[172.16.1.1:80] PolicyName: web
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> TCP State: close
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp VPN: public --&amp;gt; public ID: c487fdedb99d128393566a074da
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Zone: untrust --&amp;gt; local TTL: 00:20:00 Left: 00:20:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Recv Interface: GigabitEthernet1/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Interface: InLoopBack0 NextHop: 127.0.0.1 MAC: 0000-0000-0000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;--packets: 64 bytes: 3,158 --&amp;gt; packets: 68 bytes: 3,404
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 20.1.3.1:49928 --&amp;gt; 20.1.3.2:179 PolicyName: ---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> TCP State: established
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;FW3&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>VM1和VM2互相ping测试&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/24/mFkQPCidowfUa4I.png">
&lt;img src="https://s2.loli.net/2024/07/24/mFkQPCidowfUa4I.png"
loading="lazy"
alt="image-20240724120153111"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>无线客户端PC1 ping测试&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/24/H7yilKcuSU4jg69.png">
&lt;img src="https://s2.loli.net/2024/07/24/H7yilKcuSU4jg69.png"
loading="lazy"
alt="image-20240724120408833"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="最后">最后
&lt;/h2>&lt;ul>
&lt;li>个人觉得整个拓扑的就必上一篇文的规模小多了，量也没那么大，技术要点也不考察那么细致&lt;/li>
&lt;li>貌似模拟器的USG防火墙有bug，拓扑中FW3与PE2建立EBGP，FW3与DC-GW建立OSPF，均不用配置安全策略就能建立起邻居关系&lt;/li>
&lt;li>就不过多总结了，都在敲击键盘的过程中了&lt;/li>
&lt;li>把文中的配置复制粘贴进对应设备最终就能实现综合测试的结果&lt;/li>
&lt;li>……&lt;/li>
&lt;li>可能有更好的实现需求的配置答案（山外有山）&lt;/li>
&lt;li>文件存阿里云盘了，这是链接：[&lt;a class="link" href="https://www.alipan.com/s/6HwHnenuSqn" target="_blank" rel="noopener"
>分享的文件
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>]&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨。&lt;/li>
&lt;/ul></description></item><item><title>2021-2022华为ICT大赛（全球）实验题研究</title><link>https://weeaster.github.io/posts/e6429fe7/</link><pubDate>Fri, 19 Jul 2024 15:54:31 +0000</pubDate><guid>https://weeaster.github.io/posts/e6429fe7/</guid><description>&lt;p>在公众号【易联无界】看到文章 [&lt;a class="link" href="https://mp.weixin.qq.com/s/uMLXHcPn-ke4HpI7IddU-g" target="_blank" rel="noopener"
>华为2021-2022全球总决赛实验题
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>]&lt;/p>
&lt;p>研究研究，搓一搓&lt;/p>
&lt;p>文章很长，建议电脑端网页查看&lt;/p>
&lt;p>文章末尾，附上ensp拓扑文件和配置导出文件&lt;/p>
&lt;h2 id="说明">说明
&lt;/h2>&lt;ul>
&lt;li>ensp版本：1.3.00.100 V100R003C00SPC100&lt;/li>
&lt;li>电脑：Win10 ltsc （CPU：不配拥有名称，RAM=16GB）&lt;/li>
&lt;li>FW桥接网卡只是直观查看会话和状态&lt;/li>
&lt;li>我电脑跑这图是真的卡&lt;/li>
&lt;li>遇到FW启动错误代码40，建议先启动两台FW，再启动其他设备&lt;/li>
&lt;li>AR路由器我整不出G0/0/3接口，使用G3/0/0代替&lt;/li>
&lt;li>Video server 地址修改为100.1.100.2&lt;/li>
&lt;li>PC4手动配置IPv6地址 2001:200:1:200::254/64&lt;/li>
&lt;/ul>
&lt;h2 id="实验拓扑">实验拓扑
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/oPik8cpRV5KH2Fw.jpg">
&lt;img src="https://s2.loli.net/2024/07/19/oPik8cpRV5KH2Fw.jpg"
loading="lazy"
alt="ENSP拓扑图"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="需求分析和配置">需求分析和配置
&lt;/h2>&lt;h3 id="41-task-1-basic-data-configuration">4.1 Task 1: Basic Data Configuration
&lt;/h3>&lt;h4 id="411-configuring-vlans">4.1.1 Configuring VLANs
&lt;/h4>&lt;ul>
&lt;li>按照给出的表格数据配置对应设备的vlan、Trunk、Access&lt;/li>
&lt;li>路由器接口注意配置子接口dot1q termination vid xx ，arp broadcast enable&lt;/li>
&lt;li>防火墙接口注意配置 vlan-type dot1q xx&lt;/li>
&lt;/ul>
&lt;h4 id="412-configuring-ip-addresses">4.1.2 Configuring IP Addresses
&lt;/h4>&lt;ul>
&lt;li>按照给出的表格数据配置对应设备的IP地址、IPv6地址&lt;/li>
&lt;li>对于vrf接口和防火墙vsys接口，可先配置description描述&lt;/li>
&lt;li>配置必要的接口描述（后续配置静态路由时快速查看和检查）&lt;/li>
&lt;/ul>
&lt;h3 id="42-task-2-route-deployment-on-the-man">4.2 Task 2: Route Deployment on the MAN
&lt;/h3>&lt;h4 id="421-configuring-igp">4.2.1 Configuring IGP
&lt;/h4>&lt;ul>
&lt;li>配置IS-IS，进程号100，区域ID 86.0010，level-2路由器，系统ID的换算，直连不选举DIS&lt;/li>
&lt;li>配置接口cost，（设置cost-style wide）&lt;/li>
&lt;li>IS-IS收敛参数，spf计算参数，lsp 快速泛洪&lt;/li>
&lt;li>IS-IS hello md5认证&lt;/li>
&lt;li>IPv6 IS-IS，IPv6的IS-IS cost&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>AR1/AR2/AR3/AR4/CR1/CR2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 区域ID + 系统ID换算
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">AR1:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">network-entity 86.0010.0010.0100.1001.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">AR2:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">network-entity 86.0010.0010.0100.1002.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">AR3:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">network-entity 86.0010.0010.0100.1003.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">AR4:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">network-entity 86.0010.0010.0100.1004.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CR1:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">network-entity 86.0010.0010.0100.1005.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CR2:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">network-entity 86.0010.0010.0100.1006.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># AR1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bfd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">isis 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # level-2路由器
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> is-level level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # 设置IS-IS设备接收和发送路由的开销类型，默认narro的值范围为1-63，wide的值范围1-16777215
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cost-style wide
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # IS-IS收敛参数
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timer lsp-generation 1 50 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # lsp 快速泛洪
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> flash-flood level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # bfd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bfd all-interfaces enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network-entity 86.0010.0010.0100.1001.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # spf计算参数
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timer spf 1 20 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # IPv6拓扑类型
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable topology ipv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># loopback 0 接口运行isis
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 200 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 200 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 200 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 200 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 200 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 200 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR4&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 200 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 200 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>CR1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 300 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 300 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>CR2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 300 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 300 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>验证&lt;/p>
&lt;ul>
&lt;li>
&lt;p>dis ip routing-table protocol isis （配置完成6台路由器，查看路由表学到其他5台路由器的loopback0地址）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">AR1&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">dis&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">routing&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">table&lt;/span> &lt;span class="n">protocol&lt;/span> &lt;span class="n">isis&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Route&lt;/span> &lt;span class="n">Flags&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">relay&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">download&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">fib&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">------------------------------------------------------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Public&lt;/span> &lt;span class="n">routing&lt;/span> &lt;span class="n">table&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">ISIS&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Destinations&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">Routes&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ISIS&lt;/span> &lt;span class="n">routing&lt;/span> &lt;span class="n">table&lt;/span> &lt;span class="n">status&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Active&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Destinations&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">Routes&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Destination&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Mask&lt;/span> &lt;span class="n">Proto&lt;/span> &lt;span class="n">Pre&lt;/span> &lt;span class="n">Cost&lt;/span> &lt;span class="n">Flags&lt;/span> &lt;span class="n">NextHop&lt;/span> &lt;span class="n">Interface&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">ISIS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">L2&lt;/span> &lt;span class="mi">15&lt;/span> &lt;span class="mi">200&lt;/span> &lt;span class="n">D&lt;/span> &lt;span class="mf">10.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">2.2&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.3&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">ISIS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">L2&lt;/span> &lt;span class="mi">15&lt;/span> &lt;span class="mi">200&lt;/span> &lt;span class="n">D&lt;/span> &lt;span class="mf">10.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">5.1&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">ISIS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">L2&lt;/span> &lt;span class="mi">15&lt;/span> &lt;span class="mi">400&lt;/span> &lt;span class="n">D&lt;/span> &lt;span class="mf">10.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">5.1&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">ISIS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">L2&lt;/span> &lt;span class="mi">15&lt;/span> &lt;span class="mi">100&lt;/span> &lt;span class="n">D&lt;/span> &lt;span class="mf">10.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">5.1&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.6&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">ISIS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">L2&lt;/span> &lt;span class="mi">15&lt;/span> &lt;span class="mi">300&lt;/span> &lt;span class="n">D&lt;/span> &lt;span class="mf">10.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">2.2&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ISIS&lt;/span> &lt;span class="n">routing&lt;/span> &lt;span class="n">table&lt;/span> &lt;span class="n">status&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Inactive&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Destinations&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">Routes&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">AR1&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis ipv routing-table protocol isis （IPv6）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;CR2&amp;gt;dis ipv routing-table protocol isis | i 2022::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Public Routing Table : ISIS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Summary Count : 11
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ISIS Routing Table&amp;#39;s Status : &amp;lt; Active &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Summary Count : 11
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Destination : 2022::1 PrefixLength : 128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Destination : 2022::2 PrefixLength : 128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Destination : 2022::3 PrefixLength : 128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Destination : 2022::4 PrefixLength : 128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Destination : 2022::5 PrefixLength : 128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ISIS Routing Table&amp;#39;s Status : &amp;lt; Inactive &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Summary Count : 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;CR2&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="422-configuring-bgp">4.2.2 Configuring BGP
&lt;/h4>&lt;ul>
&lt;li>配置MAN IBGP，AS64812，CR1和CR2为RR反射器（v4,vpnv4,v6），使用对等体组命令，使用loopback0作为源&lt;/li>
&lt;li>配置与DataCenter的EBGP，AS62022，使用loopback0（EBGP多跳）（v4,v6），LSW1和LSW2配置指向CR1,CR2的默认路由（后边有配置静态路由的需求）&lt;/li>
&lt;li>配置CR1,CR2 的v4 EBGP邻居md5认证&lt;/li>
&lt;li>配置CR1,CR2路由阻尼dampening&lt;/li>
&lt;li>配置CR1和CR2条件通告默认路由到AR1-AR4&lt;/li>
&lt;li>配置AR1,和AR3优选下一跳CR1，AR2和AR4优选下一跳CR2&lt;/li>
&lt;li>配置BGP network组播源服务器网段&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>CR1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 1.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> group ibgpv4 internal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> group ibgpv6 internal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv6 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.1 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.2 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.3 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.4 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::1 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::2 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::3 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::4 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::6 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.8 as-number 62022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.8 ebgp-max-hop 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.8 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.8 password cipher Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::8 as-number 62022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::8 ebgp-max-hop 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::8 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reflector cluster-id 56.56.56.56
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dampening 10 2000 3000 10000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.1.100.0 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 reflect-client
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 next-hop-local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 default-route-advertise conditional-route-match-all 100.1.200.0 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> undo peer 1.1.1.6 default-route-advertise
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.8 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reflector cluster-id 56.56.56.56
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dampening 10 2000 3000 10000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::8 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv6 reflect-client
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv6 next-hop-local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::1 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::2 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::3 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::4 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::6 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family vpnv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reflector cluster-id 56.56.56.56
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> undo policy vpn-target
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 reflect-client
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.1 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.2 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.3 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.4 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 1.1.1.8 255.255.255.255 10.5.8.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 route-static 2022::8 128 2001:5:8::1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>CR2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 1.1.1.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> group ibgpv4 internal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> group ibgpv6 internal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv6 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.1 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.2 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.3 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.4 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::1 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::2 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::3 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::4 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::5 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.9 as-number 62022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.9 ebgp-max-hop 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.9 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.9 password cipher Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::9 as-number 62022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::9 ebgp-max-hop 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::9 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reflector cluster-id 56.56.56.56
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dampening 10 2000 3000 10000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.1.100.0 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 reflect-client
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 next-hop-local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 default-route-advertise conditional-route-match-all 100.1.200.0 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> undo peer 1.1.1.5 default-route-advertise
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.9 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reflector cluster-id 56.56.56.56
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dampening 10 2000 3000 10000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::9 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv6 reflect-client
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv6 next-hop-local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::1 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::2 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::3 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::4 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::5 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family vpnv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reflector cluster-id 56.56.56.56
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> undo policy vpn-target
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 reflect-client
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.1 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.2 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.3 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.4 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 1.1.1.9 255.255.255.255 10.6.9.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 route-static 2022::9 128 2001:6:9::1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR1/AR2/AR3/AR4/，注意修改各路由器的router-id&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># AR1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 1.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 as-number 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 as-number 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::5 as-number 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::5 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::6 as-number 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::6 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 next-hop-local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 next-hop-local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::5 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::5 next-hop-local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::6 next-hop-local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family vpnv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> policy vpn-target
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR1/AR3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 preferred-value 2000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 preferred-value 1000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR2/AR4&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 preferred-value 1000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 preferred-value 2000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 10.5.8.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 route-static :: 0 2001:5:8::2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 62022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 1.1.1.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 as-number 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 ebgp-max-hop 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 password cipher Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::5 as-number 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::5 ebgp-max-hop 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::5 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::5 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 10.6.9.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 route-static :: 0 2001:6:9::2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 62022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 1.1.1.9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 as-number 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 ebgp-max-hop 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 password cipher Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::6 as-number 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::6 ebgp-max-hop 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::6 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>验证&lt;/p>
&lt;ul>
&lt;li>
&lt;p>dis bgp peer （IPv4peer）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;AR1&amp;gt;dis bgp peer
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> BGP local router ID : 1.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Local AS number : 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total number of peers : 2 Peers in established state : 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Peer V AS MsgRcvd MsgSent OutQ Up/Down State PrefRcv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1.1.1.5 4 64812 15 14 0 00:12:14 Established 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1.1.1.6 4 64812 15 14 0 00:12:14 Established 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;AR1&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis bgp ipv6 peer （IPv6 peer）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;AR2&amp;gt;dis bgp ipv6 peer
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> BGP local router ID : 1.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Local AS number : 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total number of peers : 2 Peers in established state : 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Peer V AS MsgRcvd MsgSent OutQ Up/Down State PrefRcv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2022::5 4 64812 12 12 0 00:10:23 Established 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2022::6 4 64812 12 12 0 00:10:22 Established 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;AR2&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis bgp vpnv4 all peer （vpnv4 peer）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;CR1&amp;gt;dis bgp vpnv4 all peer
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> BGP local router ID : 1.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Local AS number : 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total number of peers : 4 Peers in established state : 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Peer V AS MsgRcvd MsgSent OutQ Up/Down State PrefRcv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1.1.1.1 4 64812 21 23 0 00:19:24 Established 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1.1.1.2 4 64812 19 21 0 00:17:19 Established 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1.1.1.3 4 64812 19 21 0 00:17:52 Established 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1.1.1.4 4 64812 18 20 0 00:16:52 Established 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;CR1&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis bgp routing-table&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;AR4&amp;gt;dis bgp routing-table
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> BGP Local router ID is 1.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Status codes: * - valid, &amp;gt; - best, d - damped,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> h - history, i - internal, s - suppressed, S - Stale
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Origin : i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total Number of Routes: 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network NextHop MED LocPrf PrefVal Path/Ogn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 100.1.100.0/30 1.1.1.5 0 100 2000 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * i 1.1.1.5 0 100 1000 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;AR4&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis bgp routing-table 100.1.100.0&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;AR4&amp;gt;dis bgp routing-table 100.1.100.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> BGP local router ID : 1.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Local AS number : 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Paths: 2 available, 1 best, 1 select
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> BGP routing table entry information of 100.1.100.0/30:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> From: 1.1.1.6 (1.1.1.6)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Route Duration: 00h03m40s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Relay IP Nexthop: 10.3.4.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Relay IP Out-Interface: GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Original nexthop: 1.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Qos information : 0x0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> AS-path Nil, origin igp, MED 0, localpref 100, pref-val 2000, valid, internal, best, select, active, pre 255, IGP cost 300
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Originator: 1.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Cluster list: 56.56.56.56
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Not advertised to any peer yet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> BGP routing table entry information of 100.1.100.0/30:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> From: 1.1.1.5 (1.1.1.5)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Route Duration: 00h03m40s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Relay IP Nexthop: 10.3.4.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Relay IP Out-Interface: GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Original nexthop: 1.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Qos information : 0x0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> AS-path Nil, origin igp, MED 0, localpref 100, pref-val 1000, valid, internal, pre 255, IGP cost 300, not preferred for PreVal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Not advertised to any peer yet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;AR4&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="43-task-3-data-center-internet-service-deployment">4.3 Task 3: Data Center Internet Service Deployment
&lt;/h3>&lt;h4 id="431-connecting-the-web-server-to-the-network">4.3.1 Connecting the Web Server to the Network
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>配置LSW1,LSW2的eth-trunk 12，静态lacp，src-mac 负载均衡&lt;/p>
&lt;/li>
&lt;li>
&lt;p>创建vrf intvpn，不传vpnv4用不到RD和RT&lt;/p>
&lt;/li>
&lt;li>
&lt;p>vlan200,下配置vrrp，vrid 2，virtual-ip 192.168.200.1/24，LSW2为master，优先级120，抢占延迟20s，track接口G0/0/2状态，失效优先级减21成为backup&lt;/p>
&lt;/li>
&lt;li>
&lt;p>配置nqa探测，LSW1-CR1,LSW2-CR2，类型icmp，5s间隔周期探测时间，&lt;/p>
&lt;/li>
&lt;li>
&lt;p>配置出向静态路由，backup路由优先级90，看示意图，LSW1-CR1，LSW2-CR2 的默认路由track nqa，配置默认路由备份路由指向 LSW1 LSW2&lt;/p>
&lt;/li>
&lt;li>
&lt;p>配置入向静态路由，看示意图&lt;/p>
&lt;/li>
&lt;li>
&lt;p>FW1配置安全策略，看示意图&lt;/p>
&lt;/li>
&lt;li>
&lt;p>FW1配置NAT映射，策略包含80端口，放行icmp&lt;/p>
&lt;/li>
&lt;li>
&lt;p>LSW1和LSW2之间的备份路由在出口全部宕机的情况下的环路处理&lt;/p>
&lt;/li>
&lt;li>
&lt;p>BGP network （web服务器公网映射网段路由）&lt;/p>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>LSW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">undo&lt;/span> &lt;span class="n">eth&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">trunk&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">undo&lt;/span> &lt;span class="n">eth&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">trunk&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Eth&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Trunk12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">lacp&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">load&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">balance&lt;/span> &lt;span class="n">src&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mac&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">eth&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">trunk&lt;/span> &lt;span class="mi">12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">eth&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">trunk&lt;/span> &lt;span class="mi">12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">vpn&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">intvpn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ipv4&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">family&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Vlanif200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">VPN&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">intvpn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">binding&lt;/span> &lt;span class="n">vpn&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">intvpn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">200.8&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">vrrp&lt;/span> &lt;span class="n">vrid&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">virtual&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ip&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">200.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">vrrp&lt;/span> &lt;span class="n">vrid&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">preempt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mode&lt;/span> &lt;span class="n">timer&lt;/span> &lt;span class="n">delay&lt;/span> &lt;span class="mi">20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Vlanif30&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">VPN&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">intvpn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">binding&lt;/span> &lt;span class="n">vpn&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">intvpn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">3.1&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nqa&lt;/span> &lt;span class="n">test&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">toCR&lt;/span> &lt;span class="n">toCR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">test&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">icmp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">destination&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">address&lt;/span> &lt;span class="n">ipv4&lt;/span> &lt;span class="mf">10.5&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">frequency&lt;/span> &lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">interval&lt;/span> &lt;span class="n">seconds&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">probe&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">count&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">start&lt;/span> &lt;span class="n">now&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">10.5&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.2&lt;/span> &lt;span class="n">track&lt;/span> &lt;span class="n">nqa&lt;/span> &lt;span class="n">toCR&lt;/span> &lt;span class="n">toCR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">9.2&lt;/span> &lt;span class="n">preference&lt;/span> &lt;span class="mi">90&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">100.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">200.0&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.0&lt;/span> &lt;span class="mf">100.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">4.2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="n">vpn&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">intvpn&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">3.2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bgp&lt;/span> &lt;span class="mi">62022&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ipv4&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">family&lt;/span> &lt;span class="n">unicast&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">network&lt;/span> &lt;span class="mf">100.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">200.0&lt;/span> &lt;span class="mi">24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 阻止LSW1-LSW2备份路由形成的环路&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nqa&lt;/span> &lt;span class="n">test&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">PREVENT_LOOP&lt;/span> &lt;span class="n">PREVENT_LOOP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">test&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">icmp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">destination&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">address&lt;/span> &lt;span class="n">ipv4&lt;/span> &lt;span class="mf">10.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">9.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">frequency&lt;/span> &lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">interval&lt;/span> &lt;span class="n">seconds&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">probe&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">count&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">start&lt;/span> &lt;span class="n">now&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">10.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">9.1&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.255&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">9.2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">9.2&lt;/span> &lt;span class="n">preference&lt;/span> &lt;span class="mi">90&lt;/span> &lt;span class="n">track&lt;/span> &lt;span class="n">nqa&lt;/span> &lt;span class="n">PREVENT_LOOP&lt;/span> &lt;span class="n">PREVENT_LOOP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">undo&lt;/span> &lt;span class="n">eth&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">trunk&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">undo&lt;/span> &lt;span class="n">eth&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">trunk&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Eth&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Trunk12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">port&lt;/span> &lt;span class="n">link&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">trunk&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">port&lt;/span> &lt;span class="n">trunk&lt;/span> &lt;span class="n">allow&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">pass&lt;/span> &lt;span class="n">vlan&lt;/span> &lt;span class="mi">90&lt;/span> &lt;span class="mi">100&lt;/span> &lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">lacp&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">load&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">balance&lt;/span> &lt;span class="n">src&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mac&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">eth&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">trunk&lt;/span> &lt;span class="mi">12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">eth&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">trunk&lt;/span> &lt;span class="mi">12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">vpn&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">intvpn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ipv4&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">family&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Vlanif200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">VPN&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">intvpn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">binding&lt;/span> &lt;span class="n">vpn&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">intvpn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">200.9&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">vrrp&lt;/span> &lt;span class="n">vrid&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">virtual&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ip&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">200.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">vrrp&lt;/span> &lt;span class="n">vrid&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">priority&lt;/span> &lt;span class="mi">120&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">vrrp&lt;/span> &lt;span class="n">vrid&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">preempt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mode&lt;/span> &lt;span class="n">timer&lt;/span> &lt;span class="n">delay&lt;/span> &lt;span class="mi">20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">vrrp&lt;/span> &lt;span class="n">vrid&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">track&lt;/span> &lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="n">reduced&lt;/span> &lt;span class="mi">21&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Vlanif30&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">VPN&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">intvpn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">binding&lt;/span> &lt;span class="n">vpn&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">intvpn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">30.1&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nqa&lt;/span> &lt;span class="n">test&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">toCR&lt;/span> &lt;span class="n">toCR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">test&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">icmp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">destination&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">address&lt;/span> &lt;span class="n">ipv4&lt;/span> &lt;span class="mf">10.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">9.2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">frequency&lt;/span> &lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">interval&lt;/span> &lt;span class="n">seconds&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">probe&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">count&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">start&lt;/span> &lt;span class="n">now&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">10.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">9.2&lt;/span> &lt;span class="n">track&lt;/span> &lt;span class="n">nqa&lt;/span> &lt;span class="n">toCR&lt;/span> &lt;span class="n">toCR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">9.1&lt;/span> &lt;span class="n">preference&lt;/span> &lt;span class="mi">90&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">100.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">200.0&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.0&lt;/span> &lt;span class="mf">100.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">40.2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="n">vpn&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">intvpn&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">30.2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bgp&lt;/span> &lt;span class="mi">62022&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ipv4&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">family&lt;/span> &lt;span class="n">unicast&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">network&lt;/span> &lt;span class="mf">100.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">200.0&lt;/span> &lt;span class="mi">24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 阻止LSW1-LSW2备份路由形成的环路&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nqa&lt;/span> &lt;span class="n">test&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">PREVENT_LOOP&lt;/span> &lt;span class="n">PREVENT_LOOP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">test&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">icmp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">destination&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">address&lt;/span> &lt;span class="n">ipv4&lt;/span> &lt;span class="mf">10.5&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">frequency&lt;/span> &lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">interval&lt;/span> &lt;span class="n">seconds&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">probe&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">count&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">start&lt;/span> &lt;span class="n">now&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">10.5&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.1&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.255&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">9.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">9.1&lt;/span> &lt;span class="n">preference&lt;/span> &lt;span class="mi">90&lt;/span> &lt;span class="n">track&lt;/span> &lt;span class="n">nqa&lt;/span> &lt;span class="n">PREVENT_LOOP&lt;/span> &lt;span class="n">PREVENT_LOOP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 100.1.40.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 100.1.4.1 preference 90
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 192.168.200.0 255.255.255.0 192.168.30.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 192.168.200.0 255.255.255.0 192.168.3.1 preference 90
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/1.40
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/2.40
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone dmz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/1.30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/2.30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">security-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name untrust2dmz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone dmz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 192.168.200.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nat server web_server protocol tcp global 100.1.200.254 www inside 192.168.200.254 www
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nat server icmp_server protocol icmp global 100.1.200.254 inside 192.168.200.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR4&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 200.1.200.0 24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>PC4 ping测试和Http Client 测试&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/qFvnT38SRItHifa.png">
&lt;img src="https://s2.loli.net/2024/07/19/qFvnT38SRItHifa.png"
loading="lazy"
alt="image-004420171"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="432-connecting-the-simulated-ipv6-servers-to-the-network">4.3.2 Connecting the Simulated IPv6 Servers to the Network
&lt;/h4>&lt;ul>
&lt;li>LSW1和LSW2创建loopback1，配置IPv6地址&lt;/li>
&lt;li>配置ospfv3，进程号200，vlanif90 建立邻居，改网络类型不选DR&lt;/li>
&lt;li>BGP 仅 import 两loopback1 IPv6地址，挂上route-map ，prefix配置&lt;/li>
&lt;li>配置路由聚合，112掩码&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>LSW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ospfv3 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 1.1.1.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface LoopBack1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address 2001:100:1:200::8/128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ospfv3 200 area 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlanif90
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ospfv3 200 area 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ospfv3 network-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip ipv6-prefix V6_SERVER permit 2001:100:1:200::8 128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip ipv6-prefix V6_SERVER permit 2001:100:1:200::9 128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-policy V6_SERVER permit node 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if-match ipv6 address prefix-list V6_SERVER
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 62022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> aggregate 2001:100:1:200:: 112 detail-suppressed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> import-route ospfv3 200 route-policy V6_SERVER
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ospfv3 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 1.1.1.9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface LoopBack1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address 2001:100:1:200::9/128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ospfv3 200 area 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlanif90
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ospfv3 200 area 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ospfv3 network-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip ipv6-prefix V6_SERVER permit 2001:100:1:200::8 128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip ipv6-prefix V6_SERVER permit 2001:100:1:200::9 128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-policy V6_SERVER permit node 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if-match ipv6 address prefix-list V6_SERVER
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 62022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> aggregate 2001:100:1:200:: 112 detail-suppressed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> import-route ospfv3 200 route-policy V6_SERVER
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR4&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 2001:200:1:200:: 64
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>PC4 配置IPv6地址-2001:200:1:200::254/64； IPv6网关-2001:200:1:200::1&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/RxG8AWwrXqpVNtT.png">
&lt;img src="https://s2.loli.net/2024/07/19/RxG8AWwrXqpVNtT.png"
loading="lazy"
alt="image-140018166"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>PC4 ping测试&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/HqWUsa9yk1YZtfu.png">
&lt;img src="https://s2.loli.net/2024/07/19/HqWUsa9yk1YZtfu.png"
loading="lazy"
alt="image-013227537"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/kib3dspezqgWt1c.png">
&lt;img src="https://s2.loli.net/2024/07/19/kib3dspezqgWt1c.png"
loading="lazy"
alt="image-013202951"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="433-configuring-security-protection-on-the-firewall">4.3.3 Configuring Security Protection on the Firewall
&lt;/h4>&lt;ul>
&lt;li>拉黑200.1.200.200地址&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>FW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[FW1]firewall blacklist enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[FW1]firewall blacklist item source-ip 200.1.200.200
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h3 id="44-task-4-enterprise-hq-network-deployment">4.4 Task 4: Enterprise HQ Network Deployment
&lt;/h3>&lt;h4 id="441-configuring-a-layer-2-network">4.4.1 Configuring a Layer 2 Network
&lt;/h4>&lt;ul>
&lt;li>端口安全，动态安全地址，mac 抖动，最大mac地址2，aging time 1200m&lt;/li>
&lt;li>端口学习mac地址的优先级&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>LSW3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mac-learning priority 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port-security enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port-security protect-action shutdown
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port-security max-mac-num 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port-security mac-address sticky
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port-security aging-time 1200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW4&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mac-learning priority 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port-security enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port-security protect-action shutdown
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port-security max-mac-num 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port-security mac-address sticky
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port-security aging-time 1200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h4 id="442-configuring-basic-services-on-the-firewall">4.4.2 Configuring Basic Services on the Firewall
&lt;/h4>&lt;ul>
&lt;li>配置安全策略，HQ 172.16.100.0/24和Branch172.17.100.0/24上互联网（NAT need）&lt;/li>
&lt;li>配置安全策略，HQ 172.16.101.0/24 访问OA 192.168.100.0/24（FW1上做了映射公网）&lt;/li>
&lt;li>配置ip-link ,FW2-AR1, FW2-AR2，搭配后续的出向默认路由使用&lt;/li>
&lt;li>出向静态路由&lt;/li>
&lt;li>入向静态路由，AR1和AR2 （200.1.100.0/24）指向 FW2；FW2配置特定主备路由指向LSW3 LSW4&lt;/li>
&lt;li>配置NAT，接入互联网，最终ping通WEB服务器和Video服务器需要这个，转换地址池200.1.100.2 - 200.1.100.10&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>FW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/3.30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/4.40
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/3.60
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/4.70
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip-link check enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip-link name toar1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination 200.1.6.1 interface GigabitEthernet1/0/3.60 mode arp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip-link name toar2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination 200.1.7.1 interface GigabitEthernet1/0/4.70 mode arp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">security-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name trust2untrust01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.16.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.17.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name trust2untrust02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.16.101.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 192.168.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 200.1.6.1 track ip-link toar1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 200.1.7.1 track ip-link toar2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 172.16.100.0 255.255.255.0 172.16.3.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 172.16.100.0 255.255.255.0 172.16.4.1 preference 90
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 172.16.101.0 255.255.255.0 172.16.4.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 172.16.101.0 255.255.255.0 172.16.3.1 preference 90
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 172.17.100.0 255.255.255.0 172.16.3.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 172.17.100.0 255.255.255.0 172.16.4.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nat address-group addressgroup1 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mode pat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> section 0 200.1.100.2 200.1.100.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nat-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name policy_nat1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.16.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.17.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 100.1.0.0 mask 255.255.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action source-nat address-group addressgroup1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 172.16.3.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW4&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 172.16.4.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 200.1.100.0 255.255.255.0 200.1.6.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> import-route static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 200.1.100.0 255.255.255.0 200.1.7.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> import-route static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>验证&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/7F9dWlTxU3eag6q.png">
&lt;img src="https://s2.loli.net/2024/07/19/7F9dWlTxU3eag6q.png"
loading="lazy"
alt="image-124106425"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/1J4VLSmGzk7ZYsq.png">
&lt;img src="https://s2.loli.net/2024/07/19/1J4VLSmGzk7ZYsq.png"
loading="lazy"
alt="image-124147896"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="443-configuring-url-filtering-on-the-firewall">4.4.3 Configuring URL Filtering on the Firewall
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>url-filter profile的配置，去网页点点看&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profile type url-filter name url_profile_deny
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add blacklist url www.example1.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add blacklist url www.example2.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> category pre-defined control-level medium
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> https-filter enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h4 id="444-configuring-the-ips-function-on-the-firewall">4.4.4 Configuring the IPS Function on the Firewall
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>ips profile的配置，去网页点点看&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profile type ips name Profile_ips_pc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> collect-attack-evidence enable # 依赖硬盘，ensp不起作用
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> signature-set name filter_web
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> target client
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> severity high
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> protocol HTTP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">security-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name trust2untrust01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> profile ips Profile_ips_pc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h4 id="445-configuring-traffic-management-on-the-firewall">4.4.5 Configuring Traffic Management on the Firewall
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>配置流量管理，去网页点点看&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> time-range work_time
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> period-range 09:00:00 to 18:00:00 working-day
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">traffic-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> profile profile_p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bandwidth maximum-bandwidth whole both 50000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bandwidth connection-limit whole both 2000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> profile profile_email
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bandwidth guaranteed-bandwidth whole both 100000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bandwidth priority 7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name policy_p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address address-set 172.16.100.0&amp;amp;172.17.100.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application app BT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application app YouKu
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action qos profile profile_p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name policy_email
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.16.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.17.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application app LotusNotes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application app OWA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application category Business_Systems sub-category Email
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action qos profile profile_email
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h3 id="45-task-5-enterprise-branch-network-deployment">4.5 Task 5: Enterprise Branch Network Deployment
&lt;/h3>&lt;h4 id="451-configuring-dhcp">4.5.1 Configuring DHCP
&lt;/h4>&lt;ul>
&lt;li>LSW5配置DHCP，此DHCP Server后续的无线sta获取地址也需要用到&lt;/li>
&lt;li>DHCP参数，vlanif100接口，dns 8.8.8.8，lease 2d&lt;/li>
&lt;li>LSW6，配置DHCP snooping，上联dhcp server接口trusted&lt;/li>
&lt;li>可能的bug（PC3和STA1获取不到IP地址，在LSW5去掉DHCP配置再重新刷入配置解决）&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>LSW5&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dhcp enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlanif100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp select interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp server lease day 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp server dns-list 8.8.8.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW6&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dhcp enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dhcp snooping enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">arp dhcp-snooping-detect enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp snooping check dhcp-rate enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp snooping check dhcp-rate 80
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port trunk pvid vlan 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp snooping check dhcp-rate enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp snooping check dhcp-rate 80
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp snooping enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp snooping trusted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h4 id="452-configuring-a-wlan">4.5.2 Configuring a WLAN
&lt;/h4>&lt;ul>
&lt;li>配置旁挂二层直接转发+ vrrp热备冗余+hsb状态同步&lt;/li>
&lt;li>黑名单拉黑sta2接入&lt;/li>
&lt;li>动态拉黑攻击者mac&lt;/li>
&lt;li>流量模板限速&lt;/li>
&lt;li>ensp要是支持配置同步功能就厉害了&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>AC1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dhcp enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 下面这行说dhcp信息可以从文件恢复，很重要么这点信息？
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># dhcp server database enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlanif200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 172.17.200.2 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 1 virtual-ip 172.17.200.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> admin-vrrp vrid 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 1 priority 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp select interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp server excluded-ip-address 172.17.200.1 172.17.200.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">capwap source ip-address 172.17.200.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wlan
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 流量模板
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> traffic-profile name wlan-traffic
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rate-limit client up 5000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rate-limit vap up 100000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rate-limit client down 10000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rate-limit vap down 500000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 安全模板
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security-profile name wlan-security
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security wpa-wpa2 psk pass-phrase Huawei@123 aes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 黑名单拉黑sta2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sta-blacklist-profile name sta-blacklist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sta-mac 5489-988a-0449
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 空白的白名单
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sta-whitelist-profile name sta-whitelist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># SSID模板
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssid-profile name wlan-ssid
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssid ICT2022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># VAP模板
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vap-profile name wlan-vap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service-vlan vlan-id 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sta-access-mode whitelist sta-whitelist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssid-profile wlan-ssid
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security-profile wlan-security
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> traffic-profile wlan-traffic
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># WIDS模板
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> wids-profile name wlan-wids
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> brute-force-detect interval 80
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> brute-force-detect threshold 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> brute-force-detect quiet-time 800
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dynamic-blacklist enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># AP系统模板
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-system-profile name wlan-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dynamic-blacklist aging-time 300
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sta-access-mode blacklist sta-blacklist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># AP组
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-group name ap-group
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-system-profile wlan-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> wids-profile wlan-wids
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> radio 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vap-profile wlan-vap wlan 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-id 0 type-id 61 ap-mac 00e0-fcf8-2fb0 ap-sn 2102354483106349735D
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-name AP1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-group ap-group
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hsb-service 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service-ip-port local-ip 172.17.200.2 peer-ip 172.17.200.3 local-data-port 10241 peer-data-port 10241
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hsb-group 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> track vrrp vrid 1 interface Vlanif200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bind-service 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hsb enable # 配置完成其他配置再启用查看状态
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hsb-service-type access-user hsb-group 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hsb-service-type dhcp hsb-group 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hsb-service-type ap hsb-group 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AC2 ，修改参数即可，wlan配置与AC 1 一致，粘贴注意有时需要输入 Y 确认&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dhcp enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlanif200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 172.17.200.3 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 1 virtual-ip 172.17.200.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> admin-vrrp vrid 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp select interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp server excluded-ip-address 172.17.200.1 172.17.200.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">capwap source ip-address 172.17.200.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wlan
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 流量模板
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> traffic-profile name wlan-traffic
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rate-limit client up 5000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rate-limit vap up 100000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rate-limit client down 10000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rate-limit vap down 500000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 安全模板
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security-profile name wlan-security
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security wpa-wpa2 psk pass-phrase Huawei@123 aes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 黑名单拉黑sta2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sta-blacklist-profile name sta-blacklist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sta-mac 5489-988a-0449
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 空白的白名单
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sta-whitelist-profile name sta-whitelist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># SSID模板
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssid-profile name wlan-ssid
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssid ICT2022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># VAP模板
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vap-profile name wlan-vap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service-vlan vlan-id 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sta-access-mode whitelist sta-whitelist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssid-profile wlan-ssid
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security-profile wlan-security
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> traffic-profile wlan-traffic
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># WIDS模板
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> wids-profile name wlan-wids
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> brute-force-detect interval 80
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> brute-force-detect threshold 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> brute-force-detect quiet-time 800
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dynamic-blacklist enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># AP系统模板
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-system-profile name wlan-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dynamic-blacklist aging-time 300
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sta-access-mode blacklist sta-blacklist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># AP组
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-group name ap-group
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-system-profile wlan-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> wids-profile wlan-wids
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> radio 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vap-profile wlan-vap wlan 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-id 0 type-id 61 ap-mac 00e0-fcf8-2fb0 ap-sn 2102354483106349735D
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-name AP1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-group ap-group
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hsb-service 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service-ip-port local-ip 172.17.200.3 peer-ip 172.17.200.2 local-data-port 10241 peer-data-port 10241
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hsb-group 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> track vrrp vrid 1 interface Vlanif200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bind-service 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hsb enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hsb-service-type access-user hsb-group 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hsb-service-type dhcp hsb-group 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hsb-service-type ap hsb-group 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>校验&lt;/p>
&lt;ul>
&lt;li>
&lt;p>dis vrrp&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[AC1]dis vrrp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Vlanif200 | Virtual Router 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> State : Master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Virtual IP : 172.17.200.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Master IP : 172.17.200.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PriorityRun : 222
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PriorityConfig : 222
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> MasterPriority : 222
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Preempt : YES Delay Time : 0 s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> TimerRun : 1 s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> TimerConfig : 1 s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Auth type : NONE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Virtual MAC : 0000-5e00-0101
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Check TTL : YES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Config type : admin-vrrp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Backup-forward : disabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Create time : 2024-07-16 21:14:14 UTC-05:13
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Last change time : 2024-07-16 21:14:27 UTC-05:13
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC1]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC2]dis vrrp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Vlanif200 | Virtual Router 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> State : Backup
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Virtual IP : 172.17.200.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Master IP : 172.17.200.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PriorityRun : 111
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PriorityConfig : 111
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> MasterPriority : 222
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Preempt : YES Delay Time : 0 s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> TimerRun : 1 s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> TimerConfig : 1 s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Auth type : NONE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Virtual MAC : 0000-5e00-0101
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Check TTL : YES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Config type : admin-vrrp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Backup-forward : disabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Create time : 2024-07-16 20:19:15 UTC-05:13
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Last change time : 2024-07-16 21:14:58 UTC-05:13
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis hsb-group 0&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[AC1]dis hsb-group 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Hot Standby Group Information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> HSB-group ID : 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Vrrp Group ID : 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Vrrp Interface : Vlanif200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Service Index : 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Group Vrrp Status : Master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Group Status : Active
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Group Backup Process : Realtime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Peer Group Device Name : AC6005
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Peer Group Software Version : V200R007C10SPC300B220
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Group Backup Modules : Access-user
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> DHCP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> AP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC1]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC2]dis hsb-group 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Hot Standby Group Information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> HSB-group ID : 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Vrrp Group ID : 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Vrrp Interface : Vlanif200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Service Index : 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Group Vrrp Status : Backup
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Group Status : Inactive
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Group Backup Process : Realtime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Peer Group Device Name : AC6005
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Peer Group Software Version : V200R007C10SPC300B220
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Group Backup Modules : Access-user
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> DHCP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> AP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC2]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis hsb-service 0&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[AC1]dis hsb-service 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Hot Standby Service Information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Local IP Address : 172.17.200.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Peer IP Address : 172.17.200.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Source Port : 10241
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Destination Port : 10241
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Keep Alive Times : 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Keep Alive Interval : 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Service State : Connected
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Service Batch Modules :
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC1]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC2]dis hsb-service 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Hot Standby Service Information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Local IP Address : 172.17.200.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Peer IP Address : 172.17.200.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Source Port : 10241
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Destination Port : 10241
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Keep Alive Times : 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Keep Alive Interval : 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Service State : Connected
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Service Batch Modules :
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC2]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis ap all&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[AC1]dis ap all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Info: This operation may take a few seconds. Please wait for a moment.done.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total AP information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nor : normal [1]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ID MAC Name Group IP Type State STA Uptime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">0 00e0-fcf8-2fb0 AP1 ap-group 172.17.200.132 AP4050DN-E nor 1 22M:17S
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC1]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC2]dis ap all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Info: This operation may take a few seconds. Please wait for a moment.done.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total AP information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stdby: standby [1]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ID MAC Name Group IP Type State STA Uptime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">0 00e0-fcf8-2fb0 AP1 ap-group 172.17.200.132 AP4050DN-E stdby 0 -
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC2]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis station all&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[AC1]dis station all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Rf/WLAN: Radio ID/WLAN ID
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Rx/Tx: link receive rate/link transmit rate(Mbps)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----------------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">STA MAC AP ID Ap name Rf/WLAN Band Type Rx/Tx RSSI VLAN IP address SSID
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----------------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5489-9811-592c 0 AP1 0/1 2.4G - -/- - 100 172.17.100.254 ICT2022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----------------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total: 1 2.4G: 1 5G: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC1]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC2]dis station all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Rf/WLAN: Radio ID/WLAN ID
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Rx/Tx: link receive rate/link transmit rate(Mbps)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">STA MAC AP ID Ap name Rf/WLAN Band Type Rx/Tx RSSI VLAN IP address SSID
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total: 0 2.4G: 0 5G: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC2]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis station online-fail-record all&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[AC1]dis station online-fail-record all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Rf/WLAN: Radio ID/WLAN ID
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">STA MAC AP ID Ap name Rf/WLAN Last record time
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Reason
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5489-988a-0449 0 AP1 0/1 2024-07-19/10:35:02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> The STA is in the global blacklist.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total stations: 1 Total records: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC1]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="46-task-6-service-deployment-for-communication-between-the-enterprise-hq-and-branch">4.6 Task 6: Service Deployment for Communication Between the Enterprise HQ and Branch
&lt;/h3>&lt;h4 id="461-configuring-an-mplsvpn">4.6.1 Configuring an MPLSVPN
&lt;/h4>&lt;ul>
&lt;li>配置ldp，loopback0接口地址为lsr-id，&lt;/li>
&lt;li>AR1/AR2/AR3/AR4，配置vrf entvpn，需要配置RD，RT&lt;/li>
&lt;li>AR1/AR2/LSW3/LSW4配置ospf，进程号100，area0，LSW3/LSW4下发默认路由，面向PC的vlanif接口配置passive被动接口&lt;/li>
&lt;li>LSW5/AR3/AR4/配置EBGP，AS62012，branch使用network起源宣告网段&lt;/li>
&lt;li>vpnv4的反射器，AR1/AR2重分布默认路由进BGP vpn地址族&lt;/li>
&lt;li>配置AS-PATH添加，route-map，对收到的路由进行选路干预&lt;/li>
&lt;li>LSW5收到的默认路由负载均衡，最大优选路径设置2&lt;/li>
&lt;li>当HQ两条出口链路中断，LSW3/LSW4的去往branch 172.17.100.0/24的不走FW2的默认路由 ，track默认路由检测互联AR1/AR2的链路&lt;/li>
&lt;li>AR路由器的故障快速切换，在VPN路由收敛前切换&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>AR1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls lsr-id 1.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> route-distinguisher 64812:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn frr route-policy VPN-FRR
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn-target 64812:345 both
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 172.16.1.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ospf 100 router-id 1.1.1.1 vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> import-route bgp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> area 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.1.1 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default-route imported
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> import-route ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-policy VPN-FRR permit node 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> apply backup-nexthop auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls lsr-id 1.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> route-distinguisher 64812:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn frr route-policy VPN-FRR
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn-target 64812:345 both
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2.20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 172.16.2.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ospf 100 router-id 1.1.1.2 vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> import-route bgp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> area 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.2.1 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default-route imported
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> import-route ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-policy VPN-FRR permit node 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> apply backup-nexthop auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls lsr-id 1.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> route-distinguisher 64812:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn frr route-policy VPN-FRR
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn-target 64812:345 both
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 172.17.1.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 172.17.1.2 as-number 62012
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-policy VPN-FRR permit node 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> apply backup-nexthop auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR4&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls lsr-id 1.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> route-distinguisher 64812:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn frr route-policy VPN-FRR
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn-target 64812:345 both
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet3/0/0.20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 172.17.2.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 172.17.2.2 as-number 62012
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-policy VPN-FRR permit node 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> apply backup-nexthop auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>CR1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls lsr-id 1.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>CR2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls lsr-id 1.1.1.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default-route-advertise
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> silent-interface Vlanif100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> area 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.1.2 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.5.1 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.100.1 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nqa test-instance toAR1 toAR1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> test-type icmp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address ipv4 172.16.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> frequency 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> interval seconds 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> probe-count 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> start now
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 172.16.3.2 track nqa toAR1 toAR1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW4&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default-route-advertise
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> silent-interface Vlanif101
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> area 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.2.2 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.5.2 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.101.1 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nqa test-instance toAR2 toAR2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> test-type icmp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address ipv4 172.16.2.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> frequency 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> interval seconds 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> probe-count 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> start now
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 172.16.4.2 track nqa toAR2 toAR2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW5&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bgp&lt;/span> &lt;span class="mi">62012&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">peer&lt;/span> &lt;span class="mf">172.17&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span> &lt;span class="n">as&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">number&lt;/span> &lt;span class="mi">64812&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">peer&lt;/span> &lt;span class="mf">172.17&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">2.1&lt;/span> &lt;span class="n">as&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">number&lt;/span> &lt;span class="mi">64812&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ipv4&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">family&lt;/span> &lt;span class="n">unicast&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">network&lt;/span> &lt;span class="mf">172.17&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">100.0&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">maximum&lt;/span> &lt;span class="nb">load&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">balancing&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">peer&lt;/span> &lt;span class="mf">172.17&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">policy&lt;/span> &lt;span class="n">AS_PATH_ODD&lt;/span> &lt;span class="n">import&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">peer&lt;/span> &lt;span class="mf">172.17&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">2.1&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">policy&lt;/span> &lt;span class="n">AS_PATH_EVEN&lt;/span> &lt;span class="n">import&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">policy&lt;/span> &lt;span class="n">AS_PATH_EVEN&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="n">node&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">match&lt;/span> &lt;span class="n">acl&lt;/span> &lt;span class="mi">2010&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">apply&lt;/span> &lt;span class="n">as&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">path&lt;/span> &lt;span class="mi">100&lt;/span> &lt;span class="n">additive&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">policy&lt;/span> &lt;span class="n">AS_PATH_EVEN&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="n">node&lt;/span> &lt;span class="mi">20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">policy&lt;/span> &lt;span class="n">AS_PATH_ODD&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="n">node&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">match&lt;/span> &lt;span class="n">acl&lt;/span> &lt;span class="mi">2020&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">apply&lt;/span> &lt;span class="n">as&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">path&lt;/span> &lt;span class="mi">100&lt;/span> &lt;span class="n">additive&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">policy&lt;/span> &lt;span class="n">AS_PATH_ODD&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="n">node&lt;/span> &lt;span class="mi">20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">acl&lt;/span> &lt;span class="n">number&lt;/span> &lt;span class="mi">2010&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rule&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="mf">172.16&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">254.255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">acl&lt;/span> &lt;span class="n">number&lt;/span> &lt;span class="mi">2020&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rule&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="mf">172.16&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">254.255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>验证&lt;/p>
&lt;ul>
&lt;li>
&lt;p>PC3 172.17.100.0/24 去往HQ的流量路径&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/c5FrskDQpWo9xHa.png">
&lt;img src="https://s2.loli.net/2024/07/19/c5FrskDQpWo9xHa.png"
loading="lazy"
alt="image-124208233"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>PC3 172.17.100.0/24 访问internet&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/5pzSk7K6GmJawCO.png">
&lt;img src="https://s2.loli.net/2024/07/19/5pzSk7K6GmJawCO.png"
loading="lazy"
alt="image-124336943"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>AR3查看FRR&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">AR3&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="n">dis&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">rou&lt;/span> &lt;span class="n">vpn&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">entvpn&lt;/span> &lt;span class="mf">172.16&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">100.0&lt;/span> &lt;span class="n">v&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Route&lt;/span> &lt;span class="n">Flags&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">relay&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">download&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">fib&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">------------------------------------------------------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Routing&lt;/span> &lt;span class="n">Table&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">entvpn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Summary&lt;/span> &lt;span class="n">Count&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Destination&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">172.16&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">100.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Protocol&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">IBGP&lt;/span> &lt;span class="n">Process&lt;/span> &lt;span class="n">ID&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Preference&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">255&lt;/span> &lt;span class="n">Cost&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">NextHop&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span> &lt;span class="n">Neighbour&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">State&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Active&lt;/span> &lt;span class="n">Adv&lt;/span> &lt;span class="n">Relied&lt;/span> &lt;span class="n">Age&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="n">h01m41s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Tag&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">Priority&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">low&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="ne">Label&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1054&lt;/span> &lt;span class="n">QoSInfo&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mh">0x0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">IndirectID&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mh">0x10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RelayNextHop&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">10.3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">5.1&lt;/span> &lt;span class="n">Interface&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TunnelID&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mh">0x1&lt;/span> &lt;span class="n">Flags&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">RD&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">BkNextHop&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span> &lt;span class="n">BkInterface&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">BkLabel&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1053&lt;/span> &lt;span class="n">SecTunnelID&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mh">0x0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">BkPETunnelID&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mh">0x3&lt;/span> &lt;span class="n">BkPESecTunnelID&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mh">0x0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">BkIndirectID&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mh">0x14&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">AR3&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="47-task-7-service-deployment-for-communication-between-the-enterprise-and-data-center-servers">4.7 Task 7: Service Deployment for Communication Between the Enterprise and Data Center Servers
&lt;/h3>&lt;h4 id="471-configuring-a-virtual-system-on-the-firewall">4.7.1 Configuring a Virtual System on the Firewall
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>FW1配置vsys，服务OA server，鼠标点点也挺快&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vsys enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">resource-class ent_resource
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resource-item-limit session reserved-number 1000 maximum 5000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resource-item-limit bandwidth 8 outbound
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resource-item-limit policy reserved-number 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resource-item-limit user reserved-number 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resource-item-limit l2tp-tunnel reserved-number 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resource-item-limit ipsec-tunnel reserved-number 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 绑定vpn-instance，重新配置IP地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vsys name entvsys
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> assign interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> assign interface GigabitEthernet1/0/1.50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> assign interface GigabitEthernet1/0/1.60
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> assign interface GigabitEthernet1/0/2.50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> assign interface GigabitEthernet1/0/2.60
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> assign resource-class ent_resource
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/1.50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/2.50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/1.60
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/2.60
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h4 id="472-connecting-the-oa-server-to-the-network">4.7.2 Connecting the OA Server to the Network
&lt;/h4>&lt;ul>
&lt;li>LSW1/LSW2配置vrf entvpn，vlanif100 划入entvpn&lt;/li>
&lt;li>vrrp配置，virtual-ip 192.168.100.1/24，LSW1 master，优先级120，抢占延迟20s&lt;/li>
&lt;li>LSW1 track G0/0/1 接口，中断后优先级减21，LSW2抢占为master&lt;/li>
&lt;li>配置出向路由，交换机默认路由指向FW1；FW1的vsys entvsys，配置出向的主备份路由&lt;/li>
&lt;li>配置入向路由，交换机配置指向100.1.1.10/32 的静态路由指向FW1；FW1配置去往OA192.168.100.0/24的主备路由&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>LSW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlanif100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> description VPN-entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.100.8 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 1 virtual-ip 192.168.100.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 1 priority 120
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 1 preempt-mode timer delay 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 1 track interface GigabitEthernet0/0/1 reduced 21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlanif50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> description VPN-entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.5.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 100.1.1.10 255.255.255.255 100.1.6.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static vpn-instance entvpn 0.0.0.0 0.0.0.0 192.168.5.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlanif100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> description VPN-entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.100.9 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 1 virtual-ip 192.168.100.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 1 preempt-mode timer delay 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlanif50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> description VPN-entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.50.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 100.1.1.10 255.255.255.255 100.1.60.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static vpn-instance entvpn 0.0.0.0 0.0.0.0 192.168.50.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">switch vsys entvsys
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 100.1.6.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 100.1.60.1 preference 90
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 192.168.100.0 255.255.255.0 192.168.5.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 192.168.100.0 255.255.255.0 192.168.50.1 preference 90
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h4 id="473-configuring-ipsec-tunnels">4.7.3 Configuring IPsec Tunnels
&lt;/h4>&lt;ul>
&lt;li>配置172.16.100.0/24和172.17.100.0/24 走ipsec访问OA 192.168.100.0/24&lt;/li>
&lt;li>使用IKE 协商模式&lt;/li>
&lt;li>自动触发建立隧道&lt;/li>
&lt;li>看图表设置参数&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>AR1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 200.1.6.0 255.255.255.252
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 200.1.7.0 255.255.255.252
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp 62022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.1.6.0 255.255.255.252
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp 62022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.1.60.0 255.255.255.252
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl number 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 5 permit ip source 192.168.100.0 0.0.0.255 destination 172.16.100.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 10 permit ip source 192.168.100.0 0.0.0.255 destination 172.17.100.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipsec proposal ipsec_proposal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> esp authentication-algorithm sha2-256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> esp encryption-algorithm aes-256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ike proposal 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> encryption-algorithm aes-256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dh group14
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> authentication-algorithm sha2-256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> authentication-method pre-share
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> integrity-algorithm hmac-sha2-256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> prf hmac-sha2-256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ike peer fw0201
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pre-shared-key Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ike-proposal 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> remote-id-type any
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> remote-address 200.1.6.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ike peer fw0202
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pre-shared-key Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ike-proposal 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> remote-id-type any
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> remote-address 200.1.7.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipsec policy ipsec01 10 isakmp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security acl 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ike-peer fw0201
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proposal ipsec_proposal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipsec policy ipsec02 10 isakmp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security acl 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ike-peer fw0202
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proposal ipsec_proposal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # undo policy enable # 策略禁用命令
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/1.60
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipsec policy ipsec01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/2.60
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipsec policy ipsec02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">security-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name ipsec_in_sp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 200.1.6.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 200.1.7.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name ipsec_out_sp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 200.1.6.2 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 200.1.7.2 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name trust2untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 192.168.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 172.16.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 172.17.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name untrust2trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.16.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.17.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 192.168.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl number 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 5 permit ip source 172.16.100.0 0.0.0.255 destination 192.168.100.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 10 permit ip source 172.17.100.0 0.0.0.255 destination 192.168.100.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipsec proposal ipsec_proposal # 使用默认值，不用敲以下2行命令
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> esp authentication-algorithm sha2-256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> esp encryption-algorithm aes-256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ike proposal 10 # 使用默认值，不用敲以下6行命令
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> encryption-algorithm aes-256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dh group14
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> authentication-algorithm sha2-256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> authentication-method pre-share
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> integrity-algorithm hmac-sha2-256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> prf hmac-sha2-256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ike peer fw0101
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pre-shared-key Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ike-proposal 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> remote-id-type any
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> remote-address 100.1.6.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ike peer fw0102
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pre-shared-key Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ike-proposal 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> remote-id-type any
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> remote-address 100.1.60.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipsec policy ipsec01 10 isakmp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security acl 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ike-peer fw0101
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proposal ipsec_proposal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipsec policy ipsec02 10 isakmp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security acl 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ike-peer fw0102
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proposal ipsec_proposal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/3.60
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipsec policy ipsec01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/4.70
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipsec policy ipsec02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">security-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name trust2untrust01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.16.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.17.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> profile ips Profile_ips_pc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name trust2untrust02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.16.101.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 192.168.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name ipsec_out_sp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 100.1.6.2 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 100.1.60.2 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name ipsec_in_sp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 100.1.6.2 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 100.1.60.2 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name untrust2trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 192.168.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 172.16.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 172.17.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>校验&lt;/p>
&lt;ul>
&lt;li>
&lt;p>dis ipsec sa&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[FW1-entvsys]dis ipsec sa
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024-07-17 09:00:34.530
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipsec sa information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">===============================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Interface: GigabitEthernet1/0/1.60
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">===============================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IPSec policy name: &amp;#34;ipsec01&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Sequence number : 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl group : 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl rule : 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Mode : ISAKMP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Connection ID : 7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Encapsulation mode: Tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Holding time : 0d 1h 12m 55s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel local : 100.1.6.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel remote : 200.1.6.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow source : 192.168.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow destination : 172.16.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Outbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 199477355 (0xbe3c86b)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485721/2324
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max sent sequence-number: 665
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA encrypted packets (number/bytes): 664/39936
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Inbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 187864131 (0xb329443)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485760/2324
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max received sequence-number: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA decrypted packets (number/bytes): 0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay : Enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay window size: 1024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IPSec policy name: &amp;#34;ipsec01&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Sequence number : 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl group : 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl rule : 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Mode : ISAKMP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Connection ID : 6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Encapsulation mode: Tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Holding time : 0d 0h 39m 25s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel local : 100.1.6.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel remote : 200.1.6.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow source : 192.168.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow destination : 172.17.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Outbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 192541812 (0xb79f474)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485722/1237
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max sent sequence-number: 666
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA encrypted packets (number/bytes): 665/39900
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Inbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 186945386 (0xb248f6a)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485754/1237
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max received sequence-number: 64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA decrypted packets (number/bytes): 106/6360
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay : Enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay window size: 1024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">===============================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Interface: GigabitEthernet1/0/2.60
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">===============================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IPSec policy name: &amp;#34;ipsec02&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Sequence number : 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl group : 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl rule : 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Mode : ISAKMP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Connection ID : 8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Encapsulation mode: Tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Holding time : 0d 0h 53m 39s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel local : 100.1.60.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel remote : 200.1.7.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow source : 192.168.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow destination : 172.16.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Outbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 195126685 (0xba1659d)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485760/3407
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max sent sequence-number: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA encrypted packets (number/bytes): 0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Inbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 195412318 (0xba5c15e)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485753/3407
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max received sequence-number: 128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA decrypted packets (number/bytes): 133/7980
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay : Enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay window size: 1024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IPSec policy name: &amp;#34;ipsec02&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Sequence number : 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl group : 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl rule : 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Mode : ISAKMP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Connection ID : 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Encapsulation mode: Tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Holding time : 0d 0h 42m 10s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel local : 100.1.60.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel remote : 200.1.7.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow source : 192.168.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow destination : 172.17.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Outbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 184686406 (0xb021746)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485760/1071
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max sent sequence-number: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA encrypted packets (number/bytes): 0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Inbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 187927920 (0xb338d70)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485699/1071
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max received sequence-number: 1216
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA decrypted packets (number/bytes): 1044/63024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay : Enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay window size: 1024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[FW1-entvsys]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis ipsec sa&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[FW2]dis ipsec sa
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024-07-17 09:01:41.270
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipsec sa information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">===============================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Interface: GigabitEthernet1/0/3.60
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">===============================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IPSec policy name: &amp;#34;ipsec01&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Sequence number : 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl group : 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl rule : 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Mode : ISAKMP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Connection ID : 47
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Encapsulation mode: Tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Holding time : 0d 1h 14m 2s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel local : 200.1.6.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel remote : 100.1.6.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow source : 172.16.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow destination : 192.168.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Outbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 187864131 (0xb329443)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485760/2257
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max sent sequence-number: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA encrypted packets (number/bytes): 0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Inbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 199477355 (0xbe3c86b)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485719/2257
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max received sequence-number: 704
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA decrypted packets (number/bytes): 708/42576
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay : Enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay window size: 1024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IPSec policy name: &amp;#34;ipsec01&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Sequence number : 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl group : 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl rule : 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Mode : ISAKMP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Connection ID : 45
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Encapsulation mode: Tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Holding time : 0d 0h 40m 31s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel local : 200.1.6.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel remote : 100.1.6.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow source : 172.17.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow destination : 192.168.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Outbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 186945386 (0xb248f6a)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485754/1170
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max sent sequence-number: 107
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA encrypted packets (number/bytes): 106/6360
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Inbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 192541812 (0xb79f474)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485719/1170
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max received sequence-number: 704
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA decrypted packets (number/bytes): 707/42420
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay : Enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay window size: 1024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">===============================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Interface: GigabitEthernet1/0/4.70
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">===============================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IPSec policy name: &amp;#34;ipsec02&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Sequence number : 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl group : 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl rule : 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Mode : ISAKMP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Connection ID : 48
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Encapsulation mode: Tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Holding time : 0d 0h 54m 40s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel local : 200.1.7.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel remote : 100.1.60.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow source : 172.16.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow destination : 192.168.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Outbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 195412318 (0xba5c15e)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485750/3347
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max sent sequence-number: 178
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA encrypted packets (number/bytes): 177/10620
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Inbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 195126685 (0xba1659d)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485760/3347
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max received sequence-number: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA decrypted packets (number/bytes): 0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay : Enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay window size: 1024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IPSec policy name: &amp;#34;ipsec02&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Sequence number : 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl group : 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl rule : 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Mode : ISAKMP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Connection ID : 44
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Encapsulation mode: Tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Holding time : 0d 0h 43m 11s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel local : 200.1.7.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel remote : 100.1.60.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow source : 172.17.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow destination : 192.168.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Outbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 187927920 (0xb338d70)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485683/1011
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max sent sequence-number: 1317
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA encrypted packets (number/bytes): 1316/79344
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Inbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 184686406 (0xb021746)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485760/1011
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max received sequence-number: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA decrypted packets (number/bytes): 0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay : Enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay window size: 1024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[FW2]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>PC1 ping OA&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/KslP3dvnjWorawu.png">
&lt;img src="https://s2.loli.net/2024/07/19/KslP3dvnjWorawu.png"
loading="lazy"
alt="image-170314062"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>PC3 ping OA&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/pGxZKakoYJ7ldiC.png">
&lt;img src="https://s2.loli.net/2024/07/19/pGxZKakoYJ7ldiC.png"
loading="lazy"
alt="image-170423691"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="474-configuring-an-l2tp-over-ipsec-tunnel">4.7.4 Configuring an L2TP over IPsec Tunnel
&lt;/h4>&lt;ul>
&lt;li>配置l2tp over ipsec&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>FW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 切换虚拟系统，以下配置都在entvsys下配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">switch vsys entvsys
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 创建user001，每次启动都需要操作一次，产品手册中指示存于数据库中，而模拟器没硬盘没这货
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user-manage user user0001
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">password Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Virtual-Template0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ppp authentication-mode chap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> remote address 30.30.30.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 30.30.30.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone dmz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface Virtual-Template0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">l2tp enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">l2tp-group 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel password cipher Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel name lns
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> allow l2tp virtual-template 0 remote lac
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl number 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 15 permit udp source-port eq 1701
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">security-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name trust2dmz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone dmz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 192.168.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 30.30.30.0 mask 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name dmz2trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone dmz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 30.30.30.0 mask 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 192.168.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name untrust2local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 200.1.1.11 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 100.1.1.10 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name any
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> l2tp enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">l2tp-group 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel password cipher Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel name lac
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel source LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> start l2tp ip 100.1.1.10 fullusername user001
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Virtual-Template0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ppp authentication-mode chap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ppp chap user user001
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ppp chap password cipher Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address ppp-negotiate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> call-lns local-user user001
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">policy-based-route
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name l2tp 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.16.101.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 192.168.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action pbr egress-interface Virtual-Template0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nat-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name l2tp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> egress-interface Virtual-Template0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.16.101.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 192.168.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action source-nat easy-ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl number 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 15 permit udp destination-port eq 1701
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">security-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name trust2dmz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone dmz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.16.101.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 192.168.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name dmz2trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone dmz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 30.30.30.2 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 172.16.101.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name local2untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 200.1.1.11 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 100.1.1.10 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>验证&lt;/p>
&lt;ul>
&lt;li>
&lt;p>PC1 PC2 PC3 ping OA 192.168.100.254&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/HyokRSbtgxev79u.png">
&lt;img src="https://s2.loli.net/2024/07/19/HyokRSbtgxev79u.png"
loading="lazy"
alt="image-042024690"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>FW2查看l2tp隧道&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[FW2]dis l2tp tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024-07-18 20:01:48.860
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">L2TP::Total Tunnel: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> LocalTID RemoteTID RemoteAddress Port Sessions RemoteName VpnInstance
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 1 100.1.1.10 1701 1 lns
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total 1, 1 printed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[FW2]dis l2tp session
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024-07-18 20:01:51.360
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">L2TP::Total Session: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> LocalSID RemoteSID LocalTID RemoteTID UserID UserName VpnInstance
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 69 41 1 1 user001
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total 1, 1 printed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[FW2]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW2查看加密计数&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[FW2]dis ipsec statistics
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024-07-18 20:21:08.960
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IPSec statistics information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Number of IPSec tunnels: 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Number of standby IPSec tunnels: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> the security packet statistics:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input/output security packets: 5082/5457
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input/output security bytes: 335843/362318
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input/output dropped security packets: 4/7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> the encrypt packet statistics:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> send chip: 5457, recv chip: 5457, send err: 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> local cpu: 5457, other cpu: 0, recv other cpu: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> intact packet: 5457, first slice: 0, after slice: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> the decrypt packet statistics:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> send chip: 5082, recv chip: 5082, send err: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> local cpu: 5082, other cpu: 0, recv other cpu: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reass first slice: 0, after slice: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dropped security packet detail:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> can not find SA: 0, wrong SA: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> authentication: 0, replay: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> front recheck: 0, after recheck: 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> change cpu enc: 0, dec change cpu: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fib search: 0, output l3: 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> flow err: 5, slice err: 0, byte limit: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slave drop: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> negotiate about packet statistics:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IKE fwd packet ok: 46, err: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IKE ctrl packet inbound ok: 46, outbound ok: 68
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SoftExpr: 0, HardExpr: 0, DPDOper: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> trigger ok: 29, switch sa: 12, sync sa: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> recv IKE nat keepalive: 0, IKE input: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[FW2]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW查看ipsec状态&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/PqFutpOGhkfn9ig.png">
&lt;img src="https://s2.loli.net/2024/07/19/PqFutpOGhkfn9ig.png"
loading="lazy"
alt="image-042144749"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="48-task-8-multicast-service-deployment-on-the-man">4.8 Task 8: Multicast Service Deployment on the MAN
&lt;/h3>&lt;h4 id="481-configuring-the-multicast-service">4.8.1 Configuring the Multicast Service
&lt;/h4>&lt;ul>
&lt;li>配置MAN网络的组播网络，AR4 igmpv2，&lt;/li>
&lt;li>CR1/CR2的loopback0接口选举bsr，配置优先级确保CR1成为bsr&lt;/li>
&lt;li>配置anycast RP，创建loopback10 0100.100.100./32，loopback10地址为c-rp&lt;/li>
&lt;li>配置msdp组播源发现协议&lt;/li>
&lt;li>AR4的g0/0/01.100，限制组播地址&lt;/li>
&lt;li>igmp加速离组&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>AR1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> multicast routing-enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> multicast routing-enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> multicast routing-enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR4&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> multicast routing-enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl number 2000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 5 permit source 224.1.1.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1.100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> igmp enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> igmp group-policy 2000 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> igmp prompt-leave group-policy 2000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>CR1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> multicast routing-enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet1/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface LoopBack10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 100.100.100.100 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.100.100.100 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pim
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> c-bsr hash-length 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> c-bsr priority 255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> c-bsr LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> c-rp LoopBack10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">msdp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> originating-rp LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>CR2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> multicast routing-enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface LoopBack10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 100.100.100.100 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.100.100.100 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pim
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> c-bsr hash-length 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> c-bsr LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> c-rp LoopBack10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">msdp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> originating-rp LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>验证&lt;/p>
&lt;ul>
&lt;li>
&lt;p>dis pim rp-info&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[AR4]dis pim bsr-info
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> VPN-Instance: public net
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Elected AdminScoped BSR Count: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Elected BSR Address: 1.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Priority: 255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Hash mask length: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> State: Accept Preferred
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Scope: Not scoped
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Uptime: 00:00:50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Expires: 00:01:20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> C-RP Count: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AR4]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AR4]dis pim rp-info
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> VPN-Instance: public net
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PIM-SM BSR RP Number:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Group/MaskLen: 224.0.0.0/4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RP: 100.100.100.100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Priority: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Uptime: 00:00:56
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Expires: 00:01:34
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AR4]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis pim routing-table&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[CR1]dis pim routing-table
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> VPN-Instance: public net
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total 0 (*, G) entry; 1 (S, G) entry
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> (100.1.100.2, 224.1.1.1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RP: 100.100.100.100 (local)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Protocol: pim-sm, Flag: SPT 2MSDP LOC ACT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UpTime: 00:03:16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Upstream interface: Ethernet1/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Upstream neighbor: NULL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RPF prime neighbor: NULL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Downstream interface(s) information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total number of downstreams: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1: GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Protocol: pim-sm, UpTime: 00:03:16, Expires: 00:03:14
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[CR1]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[CR2]dis pim routing-table
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> VPN-Instance: public net
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total 1 (*, G) entry; 1 (S, G) entry
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> (*, 224.1.1.1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RP: 100.100.100.100 (local)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Protocol: pim-sm, Flag: WC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UpTime: 00:17:28
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Upstream interface: Register
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Upstream neighbor: NULL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RPF prime neighbor: NULL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Downstream interface(s) information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total number of downstreams: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1: GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Protocol: pim-sm, UpTime: 00:17:28, Expires: 00:03:02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> (100.1.100.2, 224.1.1.1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RP: 100.100.100.100 (local)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Protocol: pim-sm, Flag: SPT MSDP ACT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UpTime: 00:03:41
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Upstream interface: GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Upstream neighbor: 10.5.6.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RPF prime neighbor: 10.5.6.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Downstream interface(s) information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total number of downstreams: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1: GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Protocol: pim-sm, UpTime: 00:03:41, Expires: 00:02:49
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[CR2]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AR4]dis pim routing-table
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> VPN-Instance: public net
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total 1 (*, G) entry; 1 (S, G) entry
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> (*, 224.1.1.1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RP: 100.100.100.100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Protocol: pim-sm, Flag: WC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UpTime: 00:17:42
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Upstream interface: GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Upstream neighbor: 10.4.6.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RPF prime neighbor: 10.4.6.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Downstream interface(s) information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total number of downstreams: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1: GigabitEthernet0/0/1.100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Protocol: igmp, UpTime: 00:17:42, Expires: -
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> (100.1.100.2, 224.1.1.1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RP: 100.100.100.100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Protocol: pim-sm, Flag: SPT ACT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UpTime: 00:03:55
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Upstream interface: GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Upstream neighbor: 10.4.6.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RPF prime neighbor: 10.4.6.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Downstream interface(s) information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total number of downstreams: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1: GigabitEthernet0/0/1.100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Protocol: pim-sm, UpTime: 00:03:55, Expires: -
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AR4]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>电脑安装vlc，ensp选择vlc安装路径，启动组播源服务器和PC4接收视频&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/cS86XbI1GBgy4dH.png">
&lt;img src="https://s2.loli.net/2024/07/19/cS86XbI1GBgy4dH.png"
loading="lazy"
alt="image-152518086"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="最后">最后
&lt;/h2>&lt;ul>
&lt;li>个人觉得整个拓扑的配置项还是挺多的，涉及的协议、框架、模型也挺多，有一定挑战&lt;/li>
&lt;li>现场8个小时给我整，我是整不出来，在没有做充足准备的前提下&lt;/li>
&lt;li>毕竟是实验，没有整防火墙双机热备&lt;/li>
&lt;li>毕竟是实验，RR还能跑数据和接入EBGP对等体&lt;/li>
&lt;li>毕竟是实验，AC与AC之间没有物理连线做状态监测&lt;/li>
&lt;li>毕竟是实验，单线路多逻辑互联&lt;/li>
&lt;li>……&lt;/li>
&lt;li>可能有更好的实现需求的配置答案（山外有山）&lt;/li>
&lt;li>文件存阿里云盘了，这是链接：[&lt;a class="link" href="https://www.alipan.com/s/sKaEyJg38HD" target="_blank" rel="noopener"
>分享的文件
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>]&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨。&lt;/li>
&lt;/ul></description></item></channel></rss>
<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Local.repo on Kir's Blog</title><link>https://kiraster.github.io/tags/local.repo/</link><description>Recent content in Local.repo on Kir's Blog</description><generator>Hugo -- gohugo.io</generator><language>en</language><copyright>@kiraster</copyright><lastBuildDate>Sat, 20 May 2023 18:18:21 +0000</lastBuildDate><atom:link href="https://kiraster.github.io/tags/local.repo/index.xml" rel="self" type="application/rss+xml"/><item><title>CentOS-8.0.1905 安装配置图形化桌面环境和TigerVNC(离线安装)</title><link>https://kiraster.github.io/posts/f652ccc4/</link><pubDate>Sat, 20 May 2023 18:18:21 +0000</pubDate><guid>https://kiraster.github.io/posts/f652ccc4/</guid><description>&lt;p>上一篇文描述的是在线安装，这篇文挑战一下离线安装，下载 &lt;code>Server with GUI&lt;/code>组件及其依赖项和&lt;code>TigerVNC&lt;/code>后上传服务器进行安装&lt;/p>
&lt;p>&lt;strong>操作流程：&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>先给虚拟机创建一个快照&lt;/li>
&lt;li>使用虚拟机下载安装软件包然后打包导出到本地&lt;/li>
&lt;li>还原快照&lt;/li>
&lt;li>上传软件包到虚拟机&lt;/li>
&lt;li>安装软件&lt;/li>
&lt;li>测试&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>环境说明&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Microsoft Windows 10 Pro 21H2&lt;/li>
&lt;li>VMware® Workstation 15.0.0&lt;/li>
&lt;li>OS: CentOS Linux 8&lt;/li>
&lt;li>IMG: CentOS-8-x86_64-1905-dvd1.iso&lt;/li>
&lt;li>Xvnc TigerVNC 1.11.0 - built Jul 21 2021 11:25:16&lt;/li>
&lt;/ul>
&lt;h2 id="配置华为云centos-vault-yum源">配置华为云CentOS-Vault yum源
&lt;/h2>&lt;p>使用华为云CentOS-Vault&lt;/p>
&lt;p>官网链接： &lt;a class="link" href="https://mirrors.huaweicloud.com/home" target="_blank" rel="noopener"
>https://mirrors.huaweicloud.com/home
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/20/TmgzICPbDUkwQMF.jpg">
&lt;img src="https://s2.loli.net/2023/05/20/TmgzICPbDUkwQMF.jpg"
loading="lazy"
alt="ScreenCaputure230518002717"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="备份etcyumreposd-目录下的文件">备份/etc/yum.repos.d 目录下的文件
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> cp -a /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>或&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> mkdir /etc/yum.repos.d/backup_repo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mv /etc/yum.repos.d/*.repo /etc/yum.repos.d/backup_repo/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="配置华为云centos-vault-yum源-1">配置华为云CentOS-Vault yum源
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> wget -O /etc/yum.repos.d/CentOS-Base.repo https://repo.huaweicloud.com/repository/conf/CentOS-8-reg.repo
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>执行&lt;strong>yum clean all&lt;/strong>清除原有yum缓存。&lt;/p>
&lt;p>执行&lt;strong>yum makecache&lt;/strong>（刷新缓存）或者&lt;strong>yum repolist all&lt;/strong>（查看所有配置可以使用的文件，会自动刷新缓存）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> yum clean all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> yum makecache
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="下载软件包和导出软件包到本地">下载软件包和导出软件包到本地
&lt;/h2>&lt;h3 id="创建一个目录来保存软件包创建-rootpackages-目录">创建一个目录来保存软件包。创建 &lt;code>/root/packages&lt;/code> 目录
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> mkdir /root/packages
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>运行以下命令以下载 &amp;ldquo;Server with GUI&amp;rdquo; 组件及其所有依赖项和TigerVNC 组件及其依赖项&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> dnf -y group install &lt;span class="s2">&amp;#34;Server with GUI&amp;#34;&lt;/span> --downloadonly --downloaddir&lt;span class="o">=&lt;/span>/root/packages
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dnf -y install tigervnc-server --downloadonly --downloaddir&lt;span class="o">=&lt;/span>/root/packages
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="打包tar导出软件包到本地">打包tar，导出软件包到本地
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> tar -cvf packages.tar /root/packages/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>使用工具将&lt;code>packages.tar&lt;/code>导出到本地存储上&lt;/p>
&lt;h3 id="还原快照和上传软件包">还原快照和上传软件包
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/21/LUjqTFuv4bJtXg9.jpg">
&lt;img src="https://s2.loli.net/2023/05/21/LUjqTFuv4bJtXg9.jpg"
loading="lazy"
alt="ScreenCaputure230521051856"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/21/lmgV6IwjMNSenJz.jpg">
&lt;img src="https://s2.loli.net/2023/05/21/lmgV6IwjMNSenJz.jpg"
loading="lazy"
alt="ScreenCaputure230521051752"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;hr>
&lt;h2 id="安装软件包和配置服务">安装软件包和配置服务
&lt;/h2>&lt;h3 id="关闭selinux后面配置完成再启用">关闭SELINUX，后面配置完成再启用
&lt;/h3>&lt;p>使用命令&lt;code> nano /etc/selinux/config&lt;/code>编辑该文件，将&lt;strong>SELINUX&lt;/strong>设置为&lt;strong>disabled&lt;/strong>，然后 &lt;strong>reboot&lt;/strong> 重启&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">SELINUX&lt;/span>&lt;span class="o">=&lt;/span>disabled
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>使用命令&lt;code> sestatus&lt;/code>查看防火墙状态，输出结果如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">SELinux status: disabled
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="将上传的packagestar解压">将上传的&lt;code>packages.tar&lt;/code>解压
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> tar -xvf /root/packages.tar
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="在rootpackages-目录下创建-localrepo-文件">在/root/packages 目录下创建 local.repo 文件
&lt;/h3>&lt;p>使用命令&lt;code> nano /root/packages/local.repo&lt;/code>创建文件，添加以下内容&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[packages]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">name=Local Repository
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">baseurl=file:///root/packages
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">enabled=1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gpgcheck=0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="运行以下命令以安装组件及其依赖项">运行以下命令以安装组件及其依赖项
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> dnf -c /root/packages/local.repo install /root/packages/*.rpm -y
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>在安装完以上软件包后，我的虚拟机貌似出问题了，执行之后步骤提示权限不足，明明是root用户下的操作，&lt;strong>强制重启&lt;/strong>虚拟机后再进行以下步骤&lt;/p>
&lt;h3 id="设置图形界面为默认运行级别">设置图形界面为默认运行级别
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> systemctl set-default graphical.target
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="启动图形界面">启动图形界面
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> systemctl start graphical.target
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="查看看服务状态">查看看服务状态
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> systemctl status graphical.target
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="重启">重启
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> reboot
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="重启后进入图形化桌面">重启后进入图形化桌面
&lt;/h2>&lt;h3 id="检查graphicaltarget服务">检查graphical.target服务
&lt;/h3>&lt;p>重启后发现没能自动进入图形化桌面，检查&lt;code>systemctl status graphical.target&lt;/code>输出结果是&lt;code>Active&lt;/code>&lt;/p>
&lt;h3 id="检查gdm-服务设置">检查GDM 服务设置
&lt;/h3>&lt;p>检查 GDM 服务的设置。使用以下命令检查 GDM 服务是否已启用：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> systemctl is-enabled gdm.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>如果输出结果为 &lt;code>disabled&lt;/code>，请使用以下命令启用 GDM 服务：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> systemctl &lt;span class="nb">enable&lt;/span> gdm.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>我的环境操作下启用GDM服务后reboot重启，可以进入图形化桌面&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/21/qtECgPLpSUzH139.jpg">
&lt;img src="https://s2.loli.net/2023/05/21/qtECgPLpSUzH139.jpg"
loading="lazy"
alt="ScreenCaputure230521035750"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>接下来的步骤与上一篇文的步骤一致，不多耗费篇幅&lt;/p>
&lt;h2 id="截图">截图
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/21/Is4ejZHX8Woihbu.jpg">
&lt;img src="https://s2.loli.net/2023/05/21/Is4ejZHX8Woihbu.jpg"
loading="lazy"
alt="ScreenCaputure230521042304"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/21/pnHIKCo9XtAkdDc.jpg">
&lt;img src="https://s2.loli.net/2023/05/21/pnHIKCo9XtAkdDc.jpg"
loading="lazy"
alt="ScreenCaputure230521042318"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/21/Txmqoa9A34tjNkg.jpg">
&lt;img src="https://s2.loli.net/2023/05/21/Txmqoa9A34tjNkg.jpg"
loading="lazy"
alt="ScreenCaputure230521042357"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="最后">最后
&lt;/h2>&lt;ul>
&lt;li>发现即使指定要求只下载&lt;code>Server with GUI&lt;/code>，但安装时查看到软件包列表还是发现很多包一并安装了，这可能会对已有运行服务产生影响，慎重使用，起码懂得回退的操作&lt;/li>
&lt;li>现在服务器操作系统一般都上虚拟化了，操作这些安装升级的时候要记得做个快照，备份之类的&lt;/li>
&lt;li>配置完成后别忘了开防火墙策略SELINUX=enforcing，重开SELINUX真耗时间&lt;/li>
&lt;li>业余选手，勿喷&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨&lt;/li>
&lt;/ul></description></item></channel></rss>
<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="在公众号【易联无界】看到文章 [华为2021-2022全球总决赛实验题 ]\n研究研究，搓一搓\n"><title>2021-2022华为ICT大赛（全球）实验题研究</title>
<link rel=canonical href=https://weeaster.github.io/posts/e6429fe7/><link rel=stylesheet href=/scss/style.min.655b8db05b082413bbbb47617eac892a6a33c4f697e079bf8c9ee93cfba90fa3.css><meta property='og:title' content="2021-2022华为ICT大赛（全球）实验题研究"><meta property='og:description' content="在公众号【易联无界】看到文章 [华为2021-2022全球总决赛实验题 ]\n研究研究，搓一搓\n"><meta property='og:url' content='https://weeaster.github.io/posts/e6429fe7/'><meta property='og:site_name' content="Kir's Blog"><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='ICT'><meta property='article:tag' content='ensp实验'><meta property='article:tag' content='解题'><meta property='article:tag' content='华为'><meta property='article:tag' content='vsys'><meta property='article:tag' content='真的卡'><meta property='article:published_time' content='2024-07-19T15:54:31+00:00'><meta property='article:modified_time' content='2024-07-19T15:54:31+00:00'><meta name=twitter:title content="2021-2022华为ICT大赛（全球）实验题研究"><meta name=twitter:description content="在公众号【易联无界】看到文章 [华为2021-2022全球总决赛实验题 ]\n研究研究，搓一搓\n"><link rel="shortcut icon" href=/favicon.ico><script src=https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css><script src=https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js></script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu16060348347131247650.jpg width=300 height=283 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Kir's Blog</a></h1><h2 class=site-description>@kiraster</h2></div></header><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/gallery/><svg viewBox="0 0 24 24" fill="none" width="24" height="24" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" stroke="currentcolor"><path d="M15 8h.01"/><path d="M12.5 21H6a3 3 0 01-3-3V6a3 3 0 013-3h12a3 3 0 013 3v6.5"/><path d="M3 16l5-5c.928-.893 2.072-.893 3 0l4 4"/><path d="M14 14l1-1c.67-.644 1.45-.824 2.182-.54"/><path d="M16 19h6"/><path d="M19 16v6"/></svg>
<span>Gallery</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/about/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#说明>说明</a></li><li><a href=#实验拓扑>实验拓扑</a></li><li><a href=#需求分析和配置>需求分析和配置</a><ol><li><a href=#41-task-1-basic-data-configuration>4.1 Task 1: Basic Data Configuration</a><ol><li><a href=#411-configuring-vlans>4.1.1 Configuring VLANs</a></li><li><a href=#412-configuring-ip-addresses>4.1.2 Configuring IP Addresses</a></li></ol></li><li><a href=#42-task-2-route-deployment-on-the-man>4.2 Task 2: Route Deployment on the MAN</a><ol><li><a href=#421-configuring-igp>4.2.1 Configuring IGP</a></li><li><a href=#422-configuring-bgp>4.2.2 Configuring BGP</a></li></ol></li><li><a href=#43-task-3-data-center-internet-service-deployment>4.3 Task 3: Data Center Internet Service Deployment</a><ol><li><a href=#431-connecting-the-web-server-to-the-network>4.3.1 Connecting the Web Server to the Network</a></li><li><a href=#432-connecting-the-simulated-ipv6-servers-to-the-network>4.3.2 Connecting the Simulated IPv6 Servers to the Network</a></li><li><a href=#433-configuring-security-protection-on-the-firewall>4.3.3 Configuring Security Protection on the Firewall</a></li></ol></li><li><a href=#44-task-4-enterprise-hq-network-deployment>4.4 Task 4: Enterprise HQ Network Deployment</a><ol><li><a href=#441-configuring-a-layer-2-network>4.4.1 Configuring a Layer 2 Network</a></li><li><a href=#442-configuring-basic-services-on-the-firewall>4.4.2 Configuring Basic Services on the Firewall</a></li><li><a href=#443-configuring-url-filtering-on-the-firewall>4.4.3 Configuring URL Filtering on the Firewall</a></li><li><a href=#444-configuring-the-ips-function-on-the-firewall>4.4.4 Configuring the IPS Function on the Firewall</a></li><li><a href=#445-configuring-traffic-management-on-the-firewall>4.4.5 Configuring Traffic Management on the Firewall</a></li></ol></li><li><a href=#45-task-5-enterprise-branch-network-deployment>4.5 Task 5: Enterprise Branch Network Deployment</a><ol><li><a href=#451-configuring-dhcp>4.5.1 Configuring DHCP</a></li><li><a href=#452-configuring-a-wlan>4.5.2 Configuring a WLAN</a></li></ol></li><li><a href=#46-task-6-service-deployment-for-communication-between-the-enterprise-hq-and-branch>4.6 Task 6: Service Deployment for Communication Between the Enterprise HQ and Branch</a><ol><li><a href=#461-configuring-an-mplsvpn>4.6.1 Configuring an MPLSVPN</a></li></ol></li><li><a href=#47-task-7-service-deployment-for-communication-between-the-enterprise-and-data-center-servers>4.7 Task 7: Service Deployment for Communication Between the Enterprise and Data Center Servers</a><ol><li><a href=#471-configuring-a-virtual-system-on-the-firewall>4.7.1 Configuring a Virtual System on the Firewall</a></li><li><a href=#472-connecting-the-oa-server-to-the-network>4.7.2 Connecting the OA Server to the Network</a></li><li><a href=#473-configuring-ipsec-tunnels>4.7.3 Configuring IPsec Tunnels</a></li><li><a href=#474-configuring-an-l2tp-over-ipsec-tunnel>4.7.4 Configuring an L2TP over IPsec Tunnel</a></li></ol></li><li><a href=#48-task-8-multicast-service-deployment-on-the-man>4.8 Task 8: Multicast Service Deployment on the MAN</a><ol><li><a href=#481-configuring-the-multicast-service>4.8.1 Configuring the Multicast Service</a></li></ol></li></ol></li><li><a href=#最后>最后</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/huawei/ style=background-color:#add8e6;color:#fff>Huawei</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/posts/e6429fe7/>2021-2022华为ICT大赛（全球）实验题研究</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jul 19, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>36 minute read</time></div></footer></div></header><section class=article-content><p>在公众号【易联无界】看到文章 [<a class=link href=https://mp.weixin.qq.com/s/uMLXHcPn-ke4HpI7IddU-g target=_blank rel=noopener>华为2021-2022全球总决赛实验题
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span>
</a>]</p><p>研究研究，搓一搓</p><p>文章很长，建议电脑端网页查看</p><p>文章末尾，附上ensp拓扑文件和配置导出文件</p><h2 id=说明>说明</h2><ul><li>ensp版本：1.3.00.100 V100R003C00SPC100</li><li>电脑：Win10 ltsc （CPU：不配拥有名称，RAM=16GB）</li><li>FW桥接网卡只是直观查看会话和状态</li><li>我电脑跑这图是真的卡</li><li>遇到FW启动错误代码40，建议先启动两台FW，再启动其他设备</li><li>AR路由器我整不出G0/0/3接口，使用G3/0/0代替</li><li>Video server 地址修改为100.1.100.2</li><li>PC4手动配置IPv6地址 2001:200:1:200::254/64</li></ul><h2 id=实验拓扑>实验拓扑</h2><p><div class=post-img-view><a data-fancybox=gallery href=https://s2.loli.net/2024/07/19/oPik8cpRV5KH2Fw.jpg><img src=https://s2.loli.net/2024/07/19/oPik8cpRV5KH2Fw.jpg loading=lazy alt=ENSP拓扑图></a></div></p><h2 id=需求分析和配置>需求分析和配置</h2><h3 id=41-task-1-basic-data-configuration>4.1 Task 1: Basic Data Configuration</h3><h4 id=411-configuring-vlans>4.1.1 Configuring VLANs</h4><ul><li>按照给出的表格数据配置对应设备的vlan、Trunk、Access</li><li>路由器接口注意配置子接口dot1q termination vid xx ，arp broadcast enable</li><li>防火墙接口注意配置 vlan-type dot1q xx</li></ul><h4 id=412-configuring-ip-addresses>4.1.2 Configuring IP Addresses</h4><ul><li>按照给出的表格数据配置对应设备的IP地址、IPv6地址</li><li>对于vrf接口和防火墙vsys接口，可先配置description描述</li><li>配置必要的接口描述（后续配置静态路由时快速查看和检查）</li></ul><h3 id=42-task-2-route-deployment-on-the-man>4.2 Task 2: Route Deployment on the MAN</h3><h4 id=421-configuring-igp>4.2.1 Configuring IGP</h4><ul><li>配置IS-IS，进程号100，区域ID 86.0010，level-2路由器，系统ID的换算，直连不选举DIS</li><li>配置接口cost，（设置cost-style wide）</li><li>IS-IS收敛参数，spf计算参数，lsp 快速泛洪</li><li>IS-IS hello md5认证</li><li>IPv6 IS-IS，IPv6的IS-IS cost</li></ul><hr><ul><li><p>AR1/AR2/AR3/AR4/CR1/CR2</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 区域ID + 系统ID换算
</span></span><span class=line><span class=cl>AR1:
</span></span><span class=line><span class=cl>network-entity 86.0010.0010.0100.1001.00
</span></span><span class=line><span class=cl>AR2:
</span></span><span class=line><span class=cl>network-entity 86.0010.0010.0100.1002.00
</span></span><span class=line><span class=cl>AR3:
</span></span><span class=line><span class=cl>network-entity 86.0010.0010.0100.1003.00
</span></span><span class=line><span class=cl>AR4:
</span></span><span class=line><span class=cl>network-entity 86.0010.0010.0100.1004.00
</span></span><span class=line><span class=cl>CR1:
</span></span><span class=line><span class=cl>network-entity 86.0010.0010.0100.1005.00
</span></span><span class=line><span class=cl>CR2:
</span></span><span class=line><span class=cl>network-entity 86.0010.0010.0100.1006.00
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl># AR1
</span></span><span class=line><span class=cl>bfd
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>isis 100
</span></span><span class=line><span class=cl> # level-2路由器
</span></span><span class=line><span class=cl> is-level level-2
</span></span><span class=line><span class=cl> # 设置IS-IS设备接收和发送路由的开销类型，默认narro的值范围为1-63，wide的值范围1-16777215
</span></span><span class=line><span class=cl> cost-style wide
</span></span><span class=line><span class=cl> # IS-IS收敛参数
</span></span><span class=line><span class=cl> timer lsp-generation 1 50 100 level-2
</span></span><span class=line><span class=cl> # lsp 快速泛洪
</span></span><span class=line><span class=cl> flash-flood level-2
</span></span><span class=line><span class=cl> # bfd
</span></span><span class=line><span class=cl> bfd all-interfaces enable
</span></span><span class=line><span class=cl> network-entity 86.0010.0010.0100.1001.00
</span></span><span class=line><span class=cl> # spf计算参数
</span></span><span class=line><span class=cl> timer spf 1 20 100
</span></span><span class=line><span class=cl> # IPv6拓扑类型
</span></span><span class=line><span class=cl> ipv6 enable topology ipv6
</span></span><span class=line><span class=cl> #
</span></span><span class=line><span class=cl># loopback 0 接口运行isis
</span></span><span class=line><span class=cl>interface LoopBack0
</span></span><span class=line><span class=cl> isis enable 100
</span></span><span class=line><span class=cl> isis ipv6 enable 100
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>AR1</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/0
</span></span><span class=line><span class=cl> isis enable 100
</span></span><span class=line><span class=cl> isis ipv6 enable 100
</span></span><span class=line><span class=cl> isis circuit-type p2p
</span></span><span class=line><span class=cl> isis authentication-mode md5 Huawei@123
</span></span><span class=line><span class=cl> isis ipv6 cost 200 level-2
</span></span><span class=line><span class=cl> isis cost 200 level-2
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/1
</span></span><span class=line><span class=cl> isis enable 100
</span></span><span class=line><span class=cl> isis ipv6 enable 100
</span></span><span class=line><span class=cl> isis circuit-type p2p
</span></span><span class=line><span class=cl> isis authentication-mode md5 Huawei@123
</span></span><span class=line><span class=cl> isis ipv6 cost 100 level-2
</span></span><span class=line><span class=cl> isis cost 100 level-2
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>AR2</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/0 
</span></span><span class=line><span class=cl> isis enable 100
</span></span><span class=line><span class=cl> isis ipv6 enable 100
</span></span><span class=line><span class=cl> isis circuit-type p2p
</span></span><span class=line><span class=cl> isis authentication-mode md5 Huawei@123
</span></span><span class=line><span class=cl> isis ipv6 cost 200 level-2
</span></span><span class=line><span class=cl> isis cost 200 level-2
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/1
</span></span><span class=line><span class=cl> isis enable 100
</span></span><span class=line><span class=cl> isis ipv6 enable 100
</span></span><span class=line><span class=cl> isis circuit-type p2p
</span></span><span class=line><span class=cl> isis authentication-mode md5 Huawei@123
</span></span><span class=line><span class=cl> isis ipv6 cost 100 level-2
</span></span><span class=line><span class=cl> isis cost 100 level-2
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>AR3</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/0
</span></span><span class=line><span class=cl> isis enable 100
</span></span><span class=line><span class=cl> isis ipv6 enable 100
</span></span><span class=line><span class=cl> isis circuit-type p2p
</span></span><span class=line><span class=cl> isis authentication-mode md5 Huawei@123
</span></span><span class=line><span class=cl> isis ipv6 cost 200 level-2
</span></span><span class=line><span class=cl> isis cost 200 level-2
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/2 
</span></span><span class=line><span class=cl> isis enable 100
</span></span><span class=line><span class=cl> isis ipv6 enable 100
</span></span><span class=line><span class=cl> isis circuit-type p2p
</span></span><span class=line><span class=cl> isis authentication-mode md5 Huawei@123
</span></span><span class=line><span class=cl> isis ipv6 cost 100 level-2
</span></span><span class=line><span class=cl> isis cost 100 level-2
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>AR4</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/0
</span></span><span class=line><span class=cl> isis enable 100
</span></span><span class=line><span class=cl> isis ipv6 enable 100
</span></span><span class=line><span class=cl> isis circuit-type p2p
</span></span><span class=line><span class=cl> isis authentication-mode md5 Huawei@123
</span></span><span class=line><span class=cl> isis ipv6 cost 200 level-2
</span></span><span class=line><span class=cl> isis cost 200 level-2
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/2
</span></span><span class=line><span class=cl> isis enable 100
</span></span><span class=line><span class=cl> isis ipv6 enable 100
</span></span><span class=line><span class=cl> isis circuit-type p2p
</span></span><span class=line><span class=cl> isis authentication-mode md5 Huawei@123
</span></span><span class=line><span class=cl> isis ipv6 cost 100 level-2
</span></span><span class=line><span class=cl> isis cost 100 level-2
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>CR1</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/0
</span></span><span class=line><span class=cl> isis enable 100
</span></span><span class=line><span class=cl> isis ipv6 enable 100
</span></span><span class=line><span class=cl>  isis circuit-type p2p
</span></span><span class=line><span class=cl> isis authentication-mode md5 Huawei@123
</span></span><span class=line><span class=cl> isis ipv6 cost 300 level-2
</span></span><span class=line><span class=cl> isis cost 300 level-2 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/1
</span></span><span class=line><span class=cl> isis enable 100
</span></span><span class=line><span class=cl> isis ipv6 enable 100
</span></span><span class=line><span class=cl> isis circuit-type p2p
</span></span><span class=line><span class=cl> isis authentication-mode md5 Huawei@123
</span></span><span class=line><span class=cl> isis ipv6 cost 100 level-2
</span></span><span class=line><span class=cl> isis cost 100 level-2
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/2
</span></span><span class=line><span class=cl> isis enable 100
</span></span><span class=line><span class=cl> isis ipv6 enable 100
</span></span><span class=line><span class=cl> isis circuit-type p2p
</span></span><span class=line><span class=cl> isis authentication-mode md5 Huawei@123
</span></span><span class=line><span class=cl> isis ipv6 cost 100 level-2
</span></span><span class=line><span class=cl> isis cost 100 level-2
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>CR2</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/0
</span></span><span class=line><span class=cl> isis enable 100
</span></span><span class=line><span class=cl> isis ipv6 enable 100
</span></span><span class=line><span class=cl> isis circuit-type p2p
</span></span><span class=line><span class=cl> isis authentication-mode md5 Huawei@123
</span></span><span class=line><span class=cl> isis ipv6 cost 300 level-2
</span></span><span class=line><span class=cl> isis cost 300 level-2
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/1
</span></span><span class=line><span class=cl> isis enable 100
</span></span><span class=line><span class=cl> isis ipv6 enable 100
</span></span><span class=line><span class=cl> isis circuit-type p2p
</span></span><span class=line><span class=cl> isis authentication-mode md5 Huawei@123
</span></span><span class=line><span class=cl> isis ipv6 cost 100 level-2
</span></span><span class=line><span class=cl> isis cost 100 level-2
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/2
</span></span><span class=line><span class=cl> isis enable 100
</span></span><span class=line><span class=cl> isis ipv6 enable 100
</span></span><span class=line><span class=cl> isis circuit-type p2p
</span></span><span class=line><span class=cl> isis authentication-mode md5 Huawei@123
</span></span><span class=line><span class=cl> isis ipv6 cost 100 level-2
</span></span><span class=line><span class=cl> isis cost 100 level-2
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>验证</p><ul><li><p>dis ip routing-table protocol isis （配置完成6台路由器，查看路由表学到其他5台路由器的loopback0地址）</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>&lt;</span><span class=n>AR1</span><span class=o>&gt;</span><span class=n>dis</span> <span class=n>ip</span> <span class=n>routing</span><span class=o>-</span><span class=n>table</span> <span class=n>protocol</span> <span class=n>isis</span> <span class=o>|</span> <span class=n>i</span> <span class=mf>1.1</span><span class=o>.</span><span class=mf>1.</span>
</span></span><span class=line><span class=cl><span class=n>Route</span> <span class=n>Flags</span><span class=p>:</span> <span class=n>R</span> <span class=o>-</span> <span class=n>relay</span><span class=p>,</span> <span class=n>D</span> <span class=o>-</span> <span class=n>download</span> <span class=n>to</span> <span class=n>fib</span>
</span></span><span class=line><span class=cl><span class=o>------------------------------------------------------------------------------</span>
</span></span><span class=line><span class=cl><span class=n>Public</span> <span class=n>routing</span> <span class=n>table</span> <span class=p>:</span> <span class=n>ISIS</span>
</span></span><span class=line><span class=cl>         <span class=n>Destinations</span> <span class=p>:</span> <span class=mi>10</span>       <span class=n>Routes</span> <span class=p>:</span> <span class=mi>11</span>       
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ISIS</span> <span class=n>routing</span> <span class=n>table</span> <span class=n>status</span> <span class=p>:</span> <span class=o>&lt;</span><span class=n>Active</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>         <span class=n>Destinations</span> <span class=p>:</span> <span class=mi>10</span>       <span class=n>Routes</span> <span class=p>:</span> <span class=mi>11</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Destination</span><span class=o>/</span><span class=n>Mask</span>    <span class=n>Proto</span>   <span class=n>Pre</span>  <span class=n>Cost</span>      <span class=n>Flags</span> <span class=n>NextHop</span>         <span class=n>Interface</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>1.1</span><span class=o>.</span><span class=mf>1.2</span><span class=o>/</span><span class=mi>32</span>  <span class=n>ISIS</span><span class=o>-</span><span class=n>L2</span> <span class=mi>15</span>   <span class=mi>200</span>         <span class=n>D</span>   <span class=mf>10.1</span><span class=o>.</span><span class=mf>2.2</span>        <span class=n>GigabitEthernet0</span><span class=o>/</span><span class=mi>0</span><span class=o>/</span><span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=mf>1.1</span><span class=o>.</span><span class=mf>1.3</span><span class=o>/</span><span class=mi>32</span>  <span class=n>ISIS</span><span class=o>-</span><span class=n>L2</span> <span class=mi>15</span>   <span class=mi>200</span>         <span class=n>D</span>   <span class=mf>10.1</span><span class=o>.</span><span class=mf>5.1</span>        <span class=n>GigabitEthernet0</span><span class=o>/</span><span class=mi>0</span><span class=o>/</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=mf>1.1</span><span class=o>.</span><span class=mf>1.4</span><span class=o>/</span><span class=mi>32</span>  <span class=n>ISIS</span><span class=o>-</span><span class=n>L2</span> <span class=mi>15</span>   <span class=mi>400</span>         <span class=n>D</span>   <span class=mf>10.1</span><span class=o>.</span><span class=mf>5.1</span>        <span class=n>GigabitEthernet0</span><span class=o>/</span><span class=mi>0</span><span class=o>/</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=mf>1.1</span><span class=o>.</span><span class=mf>1.5</span><span class=o>/</span><span class=mi>32</span>  <span class=n>ISIS</span><span class=o>-</span><span class=n>L2</span> <span class=mi>15</span>   <span class=mi>100</span>         <span class=n>D</span>   <span class=mf>10.1</span><span class=o>.</span><span class=mf>5.1</span>        <span class=n>GigabitEthernet0</span><span class=o>/</span><span class=mi>0</span><span class=o>/</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=mf>1.1</span><span class=o>.</span><span class=mf>1.6</span><span class=o>/</span><span class=mi>32</span>  <span class=n>ISIS</span><span class=o>-</span><span class=n>L2</span> <span class=mi>15</span>   <span class=mi>300</span>         <span class=n>D</span>   <span class=mf>10.1</span><span class=o>.</span><span class=mf>2.2</span>        <span class=n>GigabitEthernet0</span><span class=o>/</span><span class=mi>0</span><span class=o>/</span><span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ISIS</span> <span class=n>routing</span> <span class=n>table</span> <span class=n>status</span> <span class=p>:</span> <span class=o>&lt;</span><span class=n>Inactive</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>         <span class=n>Destinations</span> <span class=p>:</span> <span class=mi>0</span>        <span class=n>Routes</span> <span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=n>AR1</span><span class=o>&gt;</span>
</span></span></code></pre></div></li><li><p>dis ipv routing-table protocol isis （IPv6）</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;CR2&gt;dis ipv routing-table protocol isis | i 2022::
</span></span><span class=line><span class=cl>Public Routing Table : ISIS
</span></span><span class=line><span class=cl>Summary Count : 11
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ISIS Routing Table&#39;s Status : &lt; Active &gt;
</span></span><span class=line><span class=cl>Summary Count : 11 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> Destination  : 2022::1                         PrefixLength : 128
</span></span><span class=line><span class=cl> Destination  : 2022::2                         PrefixLength : 128
</span></span><span class=line><span class=cl> Destination  : 2022::3                         PrefixLength : 128
</span></span><span class=line><span class=cl> Destination  : 2022::4                         PrefixLength : 128
</span></span><span class=line><span class=cl> Destination  : 2022::5                         PrefixLength : 128
</span></span><span class=line><span class=cl>ISIS Routing Table&#39;s Status : &lt; Inactive &gt;
</span></span><span class=line><span class=cl>Summary Count : 0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;CR2&gt;
</span></span></code></pre></div></li></ul></li></ul><h4 id=422-configuring-bgp>4.2.2 Configuring BGP</h4><ul><li>配置MAN IBGP，AS64812，CR1和CR2为RR反射器（v4,vpnv4,v6），使用对等体组命令，使用loopback0作为源</li><li>配置与DataCenter的EBGP，AS62022，使用loopback0（EBGP多跳）（v4,v6），LSW1和LSW2配置指向CR1,CR2的默认路由（后边有配置静态路由的需求）</li><li>配置CR1,CR2 的v4 EBGP邻居md5认证</li><li>配置CR1,CR2路由阻尼dampening</li><li>配置CR1和CR2条件通告默认路由到AR1-AR4</li><li>配置AR1,和AR3优选下一跳CR1，AR2和AR4优选下一跳CR2</li><li>配置BGP network组播源服务器网段</li></ul><hr><ul><li><p>CR1</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>bgp 64812
</span></span><span class=line><span class=cl> router-id 1.1.1.5
</span></span><span class=line><span class=cl> group ibgpv4 internal
</span></span><span class=line><span class=cl> peer ibgpv4 connect-interface LoopBack0
</span></span><span class=line><span class=cl> group ibgpv6 internal
</span></span><span class=line><span class=cl> peer ibgpv6 connect-interface LoopBack0
</span></span><span class=line><span class=cl> peer 1.1.1.1 group ibgpv4 
</span></span><span class=line><span class=cl> peer 1.1.1.2 group ibgpv4 
</span></span><span class=line><span class=cl> peer 1.1.1.3 group ibgpv4 
</span></span><span class=line><span class=cl> peer 1.1.1.4 group ibgpv4 
</span></span><span class=line><span class=cl> peer 1.1.1.6 group ibgpv4 
</span></span><span class=line><span class=cl> peer 2022::1 group ibgpv6 
</span></span><span class=line><span class=cl> peer 2022::2 group ibgpv6 
</span></span><span class=line><span class=cl> peer 2022::3 group ibgpv6 
</span></span><span class=line><span class=cl> peer 2022::4 group ibgpv6 
</span></span><span class=line><span class=cl> peer 2022::6 group ibgpv6 
</span></span><span class=line><span class=cl> peer 1.1.1.8 as-number 62022 
</span></span><span class=line><span class=cl> peer 1.1.1.8 ebgp-max-hop 2 
</span></span><span class=line><span class=cl> peer 1.1.1.8 connect-interface LoopBack0
</span></span><span class=line><span class=cl> peer 1.1.1.8 password cipher Huawei@123
</span></span><span class=line><span class=cl> peer 2022::8 as-number 62022 
</span></span><span class=line><span class=cl> peer 2022::8 ebgp-max-hop 2 
</span></span><span class=line><span class=cl> peer 2022::8 connect-interface LoopBack0
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl> ipv4-family unicast
</span></span><span class=line><span class=cl>  reflector cluster-id 56.56.56.56
</span></span><span class=line><span class=cl>  dampening 10 2000 3000 10000
</span></span><span class=line><span class=cl>  network 100.1.100.0 255.255.255.252 
</span></span><span class=line><span class=cl>  peer ibgpv4 reflect-client
</span></span><span class=line><span class=cl>  peer ibgpv4 next-hop-local
</span></span><span class=line><span class=cl>  peer ibgpv4 default-route-advertise conditional-route-match-all 100.1.200.0 255.255.255.0
</span></span><span class=line><span class=cl>  undo peer 1.1.1.6 default-route-advertise
</span></span><span class=line><span class=cl>  peer 1.1.1.8 enable
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl> ipv6-family unicast
</span></span><span class=line><span class=cl>  reflector cluster-id 56.56.56.56
</span></span><span class=line><span class=cl>  dampening 10 2000 3000 10000
</span></span><span class=line><span class=cl>  peer 2022::8 enable
</span></span><span class=line><span class=cl>  peer ibgpv6 enable
</span></span><span class=line><span class=cl>  peer ibgpv6 reflect-client
</span></span><span class=line><span class=cl>  peer ibgpv6 next-hop-local
</span></span><span class=line><span class=cl>  peer 2022::1 group ibgpv6 
</span></span><span class=line><span class=cl>  peer 2022::2 group ibgpv6 
</span></span><span class=line><span class=cl>  peer 2022::3 group ibgpv6 
</span></span><span class=line><span class=cl>  peer 2022::4 group ibgpv6 
</span></span><span class=line><span class=cl>  peer 2022::6 group ibgpv6 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl> ipv4-family vpnv4
</span></span><span class=line><span class=cl>  reflector cluster-id 56.56.56.56
</span></span><span class=line><span class=cl>  undo policy vpn-target
</span></span><span class=line><span class=cl>  peer ibgpv4 enable
</span></span><span class=line><span class=cl>  peer ibgpv4 reflect-client
</span></span><span class=line><span class=cl>  peer 1.1.1.1 group ibgpv4 
</span></span><span class=line><span class=cl>  peer 1.1.1.2 group ibgpv4 
</span></span><span class=line><span class=cl>  peer 1.1.1.3 group ibgpv4 
</span></span><span class=line><span class=cl>  peer 1.1.1.4 group ibgpv4 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ip route-static 1.1.1.8 255.255.255.255 10.5.8.1
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ipv6 route-static 2022::8 128 2001:5:8::1 
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>CR2</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>bgp 64812
</span></span><span class=line><span class=cl> router-id 1.1.1.6
</span></span><span class=line><span class=cl> group ibgpv4 internal
</span></span><span class=line><span class=cl> peer ibgpv4 connect-interface LoopBack0
</span></span><span class=line><span class=cl> group ibgpv6 internal
</span></span><span class=line><span class=cl> peer ibgpv6 connect-interface LoopBack0
</span></span><span class=line><span class=cl> peer 1.1.1.1 group ibgpv4 
</span></span><span class=line><span class=cl> peer 1.1.1.2 group ibgpv4 
</span></span><span class=line><span class=cl> peer 1.1.1.3 group ibgpv4 
</span></span><span class=line><span class=cl> peer 1.1.1.4 group ibgpv4 
</span></span><span class=line><span class=cl> peer 1.1.1.5 group ibgpv4 
</span></span><span class=line><span class=cl> peer 2022::1 group ibgpv6 
</span></span><span class=line><span class=cl> peer 2022::2 group ibgpv6 
</span></span><span class=line><span class=cl> peer 2022::3 group ibgpv6 
</span></span><span class=line><span class=cl> peer 2022::4 group ibgpv6 
</span></span><span class=line><span class=cl> peer 2022::5 group ibgpv6 
</span></span><span class=line><span class=cl> peer 1.1.1.9 as-number 62022 
</span></span><span class=line><span class=cl> peer 1.1.1.9 ebgp-max-hop 2 
</span></span><span class=line><span class=cl> peer 1.1.1.9 connect-interface LoopBack0
</span></span><span class=line><span class=cl> peer 1.1.1.9 password cipher Huawei@123
</span></span><span class=line><span class=cl> peer 2022::9 as-number 62022 
</span></span><span class=line><span class=cl> peer 2022::9 ebgp-max-hop 2 
</span></span><span class=line><span class=cl> peer 2022::9 connect-interface LoopBack0
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl> ipv4-family unicast
</span></span><span class=line><span class=cl>  reflector cluster-id 56.56.56.56
</span></span><span class=line><span class=cl>  dampening 10 2000 3000 10000
</span></span><span class=line><span class=cl>  network 100.1.100.0 255.255.255.252 
</span></span><span class=line><span class=cl>  peer ibgpv4 reflect-client
</span></span><span class=line><span class=cl>  peer ibgpv4 next-hop-local
</span></span><span class=line><span class=cl>  peer ibgpv4 default-route-advertise conditional-route-match-all 100.1.200.0 255.255.255.0
</span></span><span class=line><span class=cl>  undo peer 1.1.1.5 default-route-advertise
</span></span><span class=line><span class=cl>  peer 1.1.1.9 enable
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl> ipv6-family unicast
</span></span><span class=line><span class=cl>  reflector cluster-id 56.56.56.56
</span></span><span class=line><span class=cl>  dampening 10 2000 3000 10000
</span></span><span class=line><span class=cl>  peer 2022::9 enable
</span></span><span class=line><span class=cl>  peer ibgpv6 enable
</span></span><span class=line><span class=cl>  peer ibgpv6 reflect-client
</span></span><span class=line><span class=cl>  peer ibgpv6 next-hop-local
</span></span><span class=line><span class=cl>  peer 2022::1 group ibgpv6 
</span></span><span class=line><span class=cl>  peer 2022::2 group ibgpv6 
</span></span><span class=line><span class=cl>  peer 2022::3 group ibgpv6 
</span></span><span class=line><span class=cl>  peer 2022::4 group ibgpv6 
</span></span><span class=line><span class=cl>  peer 2022::5 group ibgpv6 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl> ipv4-family vpnv4
</span></span><span class=line><span class=cl>  reflector cluster-id 56.56.56.56
</span></span><span class=line><span class=cl>  undo policy vpn-target
</span></span><span class=line><span class=cl>  peer ibgpv4 enable
</span></span><span class=line><span class=cl>  peer ibgpv4 reflect-client
</span></span><span class=line><span class=cl>  peer 1.1.1.1 group ibgpv4 
</span></span><span class=line><span class=cl>  peer 1.1.1.2 group ibgpv4 
</span></span><span class=line><span class=cl>  peer 1.1.1.3 group ibgpv4 
</span></span><span class=line><span class=cl>  peer 1.1.1.4 group ibgpv4 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ip route-static 1.1.1.9 255.255.255.255 10.6.9.1
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ipv6 route-static 2022::9 128 2001:6:9::1 
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>AR1/AR2/AR3/AR4/，注意修改各路由器的router-id</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># AR1
</span></span><span class=line><span class=cl>bgp 64812
</span></span><span class=line><span class=cl> router-id 1.1.1.1
</span></span><span class=line><span class=cl> peer 1.1.1.5 as-number 64812 
</span></span><span class=line><span class=cl> peer 1.1.1.5 connect-interface LoopBack0
</span></span><span class=line><span class=cl> peer 1.1.1.6 as-number 64812 
</span></span><span class=line><span class=cl> peer 1.1.1.6 connect-interface LoopBack0
</span></span><span class=line><span class=cl> peer 2022::5 as-number 64812 
</span></span><span class=line><span class=cl> peer 2022::5 connect-interface LoopBack0
</span></span><span class=line><span class=cl> peer 2022::6 as-number 64812 
</span></span><span class=line><span class=cl> peer 2022::6 connect-interface LoopBack0
</span></span><span class=line><span class=cl> #
</span></span><span class=line><span class=cl> ipv4-family unicast
</span></span><span class=line><span class=cl>  peer 1.1.1.5 next-hop-local 
</span></span><span class=line><span class=cl>  peer 1.1.1.6 next-hop-local 
</span></span><span class=line><span class=cl> #
</span></span><span class=line><span class=cl> ipv6-family unicast
</span></span><span class=line><span class=cl>  peer 2022::5 enable
</span></span><span class=line><span class=cl>  peer 2022::5 next-hop-local 
</span></span><span class=line><span class=cl>  peer 2022::6 enable
</span></span><span class=line><span class=cl>  peer 2022::6 next-hop-local 
</span></span><span class=line><span class=cl> # 
</span></span><span class=line><span class=cl> ipv4-family vpnv4
</span></span><span class=line><span class=cl>  policy vpn-target
</span></span><span class=line><span class=cl>  peer 1.1.1.5 enable
</span></span><span class=line><span class=cl>  peer 1.1.1.6 enable
</span></span><span class=line><span class=cl> #
</span></span></code></pre></div></li><li><p>AR1/AR3</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>bgp 64812
</span></span><span class=line><span class=cl> #
</span></span><span class=line><span class=cl> ipv4-family unicast
</span></span><span class=line><span class=cl>  peer 1.1.1.5 preferred-value 2000  
</span></span><span class=line><span class=cl>  peer 1.1.1.6 preferred-value 1000 
</span></span><span class=line><span class=cl> #
</span></span></code></pre></div></li><li><p>AR2/AR4</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>bgp 64812
</span></span><span class=line><span class=cl> #
</span></span><span class=line><span class=cl> ipv4-family unicast
</span></span><span class=line><span class=cl>  peer 1.1.1.5 preferred-value 1000 
</span></span><span class=line><span class=cl>  peer 1.1.1.6 preferred-value 2000 
</span></span><span class=line><span class=cl> #
</span></span></code></pre></div></li><li><p>LSW1</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ip route-static 0.0.0.0 0.0.0.0 10.5.8.2
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ipv6 route-static :: 0 2001:5:8::2 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>bgp 62022
</span></span><span class=line><span class=cl> router-id 1.1.1.8
</span></span><span class=line><span class=cl> peer 1.1.1.5 as-number 64812 
</span></span><span class=line><span class=cl> peer 1.1.1.5 ebgp-max-hop 2 
</span></span><span class=line><span class=cl> peer 1.1.1.5 connect-interface LoopBack0
</span></span><span class=line><span class=cl> peer 1.1.1.5 password cipher Huawei@123
</span></span><span class=line><span class=cl> peer 2022::5 as-number 64812 
</span></span><span class=line><span class=cl> peer 2022::5 ebgp-max-hop 2 
</span></span><span class=line><span class=cl> peer 2022::5 connect-interface LoopBack0
</span></span><span class=line><span class=cl> #
</span></span><span class=line><span class=cl> ipv4-family unicast
</span></span><span class=line><span class=cl>  peer 1.1.1.5 enable
</span></span><span class=line><span class=cl> #
</span></span><span class=line><span class=cl> ipv6-family unicast
</span></span><span class=line><span class=cl>  peer 2022::5 enable
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>LSW2</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ip route-static 0.0.0.0 0.0.0.0 10.6.9.2
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ipv6 route-static :: 0 2001:6:9::2 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>bgp 62022
</span></span><span class=line><span class=cl> router-id 1.1.1.9
</span></span><span class=line><span class=cl> peer 1.1.1.6 as-number 64812 
</span></span><span class=line><span class=cl> peer 1.1.1.6 ebgp-max-hop 2 
</span></span><span class=line><span class=cl> peer 1.1.1.6 connect-interface LoopBack0
</span></span><span class=line><span class=cl> peer 1.1.1.6 password cipher Huawei@123
</span></span><span class=line><span class=cl> peer 2022::6 as-number 64812 
</span></span><span class=line><span class=cl> peer 2022::6 ebgp-max-hop 2 
</span></span><span class=line><span class=cl> peer 2022::6 connect-interface LoopBack0
</span></span><span class=line><span class=cl> #
</span></span><span class=line><span class=cl> ipv4-family unicast
</span></span><span class=line><span class=cl>  peer 1.1.1.6 enable
</span></span><span class=line><span class=cl> #
</span></span><span class=line><span class=cl> ipv6-family unicast
</span></span><span class=line><span class=cl>  peer 2022::6 enable
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>验证</p><ul><li><p>dis bgp peer （IPv4peer）</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;AR1&gt;dis bgp peer 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> BGP local router ID : 1.1.1.1
</span></span><span class=line><span class=cl> Local AS number : 64812
</span></span><span class=line><span class=cl> Total number of peers : 2                Peers in established state : 2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State PrefRcv
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  1.1.1.5         4       64812       15       14     0 00:12:14 Established       1
</span></span><span class=line><span class=cl>  1.1.1.6         4       64812       15       14     0 00:12:14 Established       1
</span></span><span class=line><span class=cl>&lt;AR1&gt;
</span></span></code></pre></div></li><li><p>dis bgp ipv6 peer （IPv6 peer）</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;AR2&gt;dis bgp ipv6 peer 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> BGP local router ID : 1.1.1.2
</span></span><span class=line><span class=cl> Local AS number : 64812
</span></span><span class=line><span class=cl> Total number of peers : 2                Peers in established state : 2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State PrefRcv
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  2022::5         4       64812       12       12     0 00:10:23 Established       0
</span></span><span class=line><span class=cl>  2022::6         4       64812       12       12     0 00:10:22 Established       0
</span></span><span class=line><span class=cl>&lt;AR2&gt;
</span></span></code></pre></div></li><li><p>dis bgp vpnv4 all peer （vpnv4 peer）</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;CR1&gt;dis bgp vpnv4 all peer 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> BGP local router ID : 1.1.1.5
</span></span><span class=line><span class=cl> Local AS number : 64812
</span></span><span class=line><span class=cl> Total number of peers : 4                Peers in established state : 4
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State PrefRcv
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  1.1.1.1         4       64812       21       23     0 00:19:24 Established       0
</span></span><span class=line><span class=cl>  1.1.1.2         4       64812       19       21     0 00:17:19 Established       0
</span></span><span class=line><span class=cl>  1.1.1.3         4       64812       19       21     0 00:17:52 Established       0
</span></span><span class=line><span class=cl>  1.1.1.4         4       64812       18       20     0 00:16:52 Established       0
</span></span><span class=line><span class=cl>&lt;CR1&gt;
</span></span></code></pre></div></li><li><p>dis bgp routing-table</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;AR4&gt;dis bgp routing-table
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> BGP Local router ID is 1.1.1.4 
</span></span><span class=line><span class=cl> Status codes: * - valid, &gt; - best, d - damped,
</span></span><span class=line><span class=cl>               h - history,  i - internal, s - suppressed, S - Stale
</span></span><span class=line><span class=cl>               Origin : i - IGP, e - EGP, ? - incomplete
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> Total Number of Routes: 2
</span></span><span class=line><span class=cl>      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> *&gt;i  100.1.100.0/30     1.1.1.5         0          100        2000   i
</span></span><span class=line><span class=cl> * i                     1.1.1.5         0          100        1000   i
</span></span><span class=line><span class=cl>&lt;AR4&gt;
</span></span></code></pre></div></li><li><p>dis bgp routing-table 100.1.100.0</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;AR4&gt;dis bgp routing-table 100.1.100.0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> BGP local router ID : 1.1.1.4
</span></span><span class=line><span class=cl> Local AS number : 64812
</span></span><span class=line><span class=cl> Paths:   2 available, 1 best, 1 select
</span></span><span class=line><span class=cl> BGP routing table entry information of 100.1.100.0/30:
</span></span><span class=line><span class=cl> From: 1.1.1.6 (1.1.1.6)
</span></span><span class=line><span class=cl> Route Duration: 00h03m40s  
</span></span><span class=line><span class=cl> Relay IP Nexthop: 10.3.4.1
</span></span><span class=line><span class=cl> Relay IP Out-Interface: GigabitEthernet0/0/0
</span></span><span class=line><span class=cl> Original nexthop: 1.1.1.5
</span></span><span class=line><span class=cl> Qos information : 0x0
</span></span><span class=line><span class=cl> AS-path Nil, origin igp, MED 0, localpref 100, pref-val 2000, valid, internal, best, select, active, pre 255, IGP cost 300
</span></span><span class=line><span class=cl> Originator:  1.1.1.5
</span></span><span class=line><span class=cl> Cluster list: 56.56.56.56
</span></span><span class=line><span class=cl> Not advertised to any peer yet
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> BGP routing table entry information of 100.1.100.0/30:
</span></span><span class=line><span class=cl> From: 1.1.1.5 (1.1.1.5)
</span></span><span class=line><span class=cl> Route Duration: 00h03m40s  
</span></span><span class=line><span class=cl> Relay IP Nexthop: 10.3.4.1
</span></span><span class=line><span class=cl> Relay IP Out-Interface: GigabitEthernet0/0/0
</span></span><span class=line><span class=cl> Original nexthop: 1.1.1.5
</span></span><span class=line><span class=cl> Qos information : 0x0
</span></span><span class=line><span class=cl> AS-path Nil, origin igp, MED 0, localpref 100, pref-val 1000, valid, internal, pre 255, IGP cost 300, not preferred for PreVal
</span></span><span class=line><span class=cl> Not advertised to any peer yet
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;AR4&gt;
</span></span></code></pre></div></li></ul></li></ul><h3 id=43-task-3-data-center-internet-service-deployment>4.3 Task 3: Data Center Internet Service Deployment</h3><h4 id=431-connecting-the-web-server-to-the-network>4.3.1 Connecting the Web Server to the Network</h4><ul><li><p>配置LSW1,LSW2的eth-trunk 12，静态lacp，src-mac 负载均衡</p></li><li><p>创建vrf intvpn，不传vpnv4用不到RD和RT</p></li><li><p>vlan200,下配置vrrp，vrid 2，virtual-ip 192.168.200.1/24，LSW2为master，优先级120，抢占延迟20s，track接口G0/0/2状态，失效优先级减21成为backup</p></li><li><p>配置nqa探测，LSW1-CR1,LSW2-CR2，类型icmp，5s间隔周期探测时间，</p></li><li><p>配置出向静态路由，backup路由优先级90，看示意图，LSW1-CR1，LSW2-CR2 的默认路由track nqa，配置默认路由备份路由指向 LSW1 LSW2</p></li><li><p>配置入向静态路由，看示意图</p></li><li><p>FW1配置安全策略，看示意图</p></li><li><p>FW1配置NAT映射，策略包含80端口，放行icmp</p></li><li><p>LSW1和LSW2之间的备份路由在出口全部宕机的情况下的环路处理</p></li><li><p>BGP network （web服务器公网映射网段路由）</p></li></ul><hr><ul><li><p>LSW1</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>interface</span> <span class=n>GigabitEthernet0</span><span class=o>/</span><span class=mi>0</span><span class=o>/</span><span class=mi>4</span>
</span></span><span class=line><span class=cl> <span class=n>undo</span> <span class=n>eth</span><span class=o>-</span><span class=n>trunk</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>interface</span> <span class=n>GigabitEthernet0</span><span class=o>/</span><span class=mi>0</span><span class=o>/</span><span class=mi>5</span>
</span></span><span class=line><span class=cl> <span class=n>undo</span> <span class=n>eth</span><span class=o>-</span><span class=n>trunk</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>interface</span> <span class=n>Eth</span><span class=o>-</span><span class=n>Trunk12</span>
</span></span><span class=line><span class=cl> <span class=n>mode</span> <span class=n>lacp</span><span class=o>-</span><span class=k>static</span>
</span></span><span class=line><span class=cl> <span class=nb>load</span><span class=o>-</span><span class=n>balance</span> <span class=n>src</span><span class=o>-</span><span class=n>mac</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>interface</span> <span class=n>GigabitEthernet0</span><span class=o>/</span><span class=mi>0</span><span class=o>/</span><span class=mi>4</span>
</span></span><span class=line><span class=cl> <span class=n>eth</span><span class=o>-</span><span class=n>trunk</span> <span class=mi>12</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>interface</span> <span class=n>GigabitEthernet0</span><span class=o>/</span><span class=mi>0</span><span class=o>/</span><span class=mi>5</span>
</span></span><span class=line><span class=cl> <span class=n>eth</span><span class=o>-</span><span class=n>trunk</span> <span class=mi>12</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>ip</span> <span class=n>vpn</span><span class=o>-</span><span class=n>instance</span> <span class=n>intvpn</span>
</span></span><span class=line><span class=cl> <span class=n>ipv4</span><span class=o>-</span><span class=n>family</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>interface</span> <span class=n>Vlanif200</span>
</span></span><span class=line><span class=cl> <span class=n>description</span> <span class=n>VPN</span><span class=o>-</span><span class=n>intvpn</span>
</span></span><span class=line><span class=cl> <span class=n>ip</span> <span class=n>binding</span> <span class=n>vpn</span><span class=o>-</span><span class=n>instance</span> <span class=n>intvpn</span>
</span></span><span class=line><span class=cl> <span class=n>ip</span> <span class=n>address</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>200.8</span> <span class=mf>255.255</span><span class=o>.</span><span class=mf>255.0</span> 
</span></span><span class=line><span class=cl> <span class=n>vrrp</span> <span class=n>vrid</span> <span class=mi>2</span> <span class=n>virtual</span><span class=o>-</span><span class=n>ip</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>200.1</span>
</span></span><span class=line><span class=cl> <span class=n>vrrp</span> <span class=n>vrid</span> <span class=mi>2</span> <span class=n>preempt</span><span class=o>-</span><span class=n>mode</span> <span class=n>timer</span> <span class=n>delay</span> <span class=mi>20</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>interface</span> <span class=n>Vlanif30</span>
</span></span><span class=line><span class=cl> <span class=n>description</span> <span class=n>VPN</span><span class=o>-</span><span class=n>intvpn</span>
</span></span><span class=line><span class=cl> <span class=n>ip</span> <span class=n>binding</span> <span class=n>vpn</span><span class=o>-</span><span class=n>instance</span> <span class=n>intvpn</span>
</span></span><span class=line><span class=cl> <span class=n>ip</span> <span class=n>address</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>3.1</span> <span class=mf>255.255</span><span class=o>.</span><span class=mf>255.252</span> 
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>nqa</span> <span class=n>test</span><span class=o>-</span><span class=n>instance</span> <span class=n>toCR</span> <span class=n>toCR</span> 
</span></span><span class=line><span class=cl> <span class=n>test</span><span class=o>-</span><span class=n>type</span> <span class=n>icmp</span>
</span></span><span class=line><span class=cl> <span class=n>destination</span><span class=o>-</span><span class=n>address</span> <span class=n>ipv4</span> <span class=mf>10.5</span><span class=o>.</span><span class=mf>8.2</span>
</span></span><span class=line><span class=cl> <span class=n>frequency</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl> <span class=n>interval</span> <span class=n>seconds</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl> <span class=n>timeout</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl> <span class=n>probe</span><span class=o>-</span><span class=n>count</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl> <span class=n>start</span> <span class=n>now</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>ip</span> <span class=n>route</span><span class=o>-</span><span class=k>static</span> <span class=mf>0.0</span><span class=o>.</span><span class=mf>0.0</span> <span class=mf>0.0</span><span class=o>.</span><span class=mf>0.0</span> <span class=mf>10.5</span><span class=o>.</span><span class=mf>8.2</span> <span class=n>track</span> <span class=n>nqa</span> <span class=n>toCR</span> <span class=n>toCR</span>
</span></span><span class=line><span class=cl><span class=n>ip</span> <span class=n>route</span><span class=o>-</span><span class=k>static</span> <span class=mf>0.0</span><span class=o>.</span><span class=mf>0.0</span> <span class=mf>0.0</span><span class=o>.</span><span class=mf>0.0</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>9.2</span> <span class=n>preference</span> <span class=mi>90</span>
</span></span><span class=line><span class=cl><span class=n>ip</span> <span class=n>route</span><span class=o>-</span><span class=k>static</span> <span class=mf>100.1</span><span class=o>.</span><span class=mf>200.0</span> <span class=mf>255.255</span><span class=o>.</span><span class=mf>255.0</span> <span class=mf>100.1</span><span class=o>.</span><span class=mf>4.2</span>
</span></span><span class=line><span class=cl><span class=n>ip</span> <span class=n>route</span><span class=o>-</span><span class=k>static</span> <span class=n>vpn</span><span class=o>-</span><span class=n>instance</span> <span class=n>intvpn</span> <span class=mf>0.0</span><span class=o>.</span><span class=mf>0.0</span> <span class=mf>0.0</span><span class=o>.</span><span class=mf>0.0</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>3.2</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>bgp</span> <span class=mi>62022</span>
</span></span><span class=line><span class=cl> <span class=c1>#</span>
</span></span><span class=line><span class=cl> <span class=n>ipv4</span><span class=o>-</span><span class=n>family</span> <span class=n>unicast</span>
</span></span><span class=line><span class=cl>  <span class=n>network</span> <span class=mf>100.1</span><span class=o>.</span><span class=mf>200.0</span> <span class=mi>24</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># 阻止LSW1-LSW2备份路由形成的环路</span>
</span></span><span class=line><span class=cl><span class=n>nqa</span> <span class=n>test</span><span class=o>-</span><span class=n>instance</span> <span class=n>PREVENT_LOOP</span> <span class=n>PREVENT_LOOP</span> 
</span></span><span class=line><span class=cl> <span class=n>test</span><span class=o>-</span><span class=n>type</span> <span class=n>icmp</span>
</span></span><span class=line><span class=cl> <span class=n>destination</span><span class=o>-</span><span class=n>address</span> <span class=n>ipv4</span> <span class=mf>10.6</span><span class=o>.</span><span class=mf>9.1</span>
</span></span><span class=line><span class=cl> <span class=n>frequency</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl> <span class=n>interval</span> <span class=n>seconds</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl> <span class=n>timeout</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl> <span class=n>probe</span><span class=o>-</span><span class=n>count</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl> <span class=n>start</span> <span class=n>now</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>ip</span> <span class=n>route</span><span class=o>-</span><span class=k>static</span> <span class=mf>10.6</span><span class=o>.</span><span class=mf>9.1</span> <span class=mf>255.255</span><span class=o>.</span><span class=mf>255.255</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>9.2</span>
</span></span><span class=line><span class=cl><span class=n>ip</span> <span class=n>route</span><span class=o>-</span><span class=k>static</span> <span class=mf>0.0</span><span class=o>.</span><span class=mf>0.0</span> <span class=mf>0.0</span><span class=o>.</span><span class=mf>0.0</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>9.2</span> <span class=n>preference</span> <span class=mi>90</span> <span class=n>track</span> <span class=n>nqa</span> <span class=n>PREVENT_LOOP</span> <span class=n>PREVENT_LOOP</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span></code></pre></div></li><li><p>LSW2</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>interface</span> <span class=n>GigabitEthernet0</span><span class=o>/</span><span class=mi>0</span><span class=o>/</span><span class=mi>4</span>
</span></span><span class=line><span class=cl> <span class=n>undo</span> <span class=n>eth</span><span class=o>-</span><span class=n>trunk</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>interface</span> <span class=n>GigabitEthernet0</span><span class=o>/</span><span class=mi>0</span><span class=o>/</span><span class=mi>5</span>
</span></span><span class=line><span class=cl> <span class=n>undo</span> <span class=n>eth</span><span class=o>-</span><span class=n>trunk</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>interface</span> <span class=n>Eth</span><span class=o>-</span><span class=n>Trunk12</span>
</span></span><span class=line><span class=cl> <span class=n>port</span> <span class=n>link</span><span class=o>-</span><span class=n>type</span> <span class=n>trunk</span>
</span></span><span class=line><span class=cl> <span class=n>port</span> <span class=n>trunk</span> <span class=n>allow</span><span class=o>-</span><span class=k>pass</span> <span class=n>vlan</span> <span class=mi>90</span> <span class=mi>100</span> <span class=mi>200</span>
</span></span><span class=line><span class=cl> <span class=n>mode</span> <span class=n>lacp</span><span class=o>-</span><span class=k>static</span>
</span></span><span class=line><span class=cl> <span class=nb>load</span><span class=o>-</span><span class=n>balance</span> <span class=n>src</span><span class=o>-</span><span class=n>mac</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>interface</span> <span class=n>GigabitEthernet0</span><span class=o>/</span><span class=mi>0</span><span class=o>/</span><span class=mi>4</span>
</span></span><span class=line><span class=cl> <span class=n>eth</span><span class=o>-</span><span class=n>trunk</span> <span class=mi>12</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>interface</span> <span class=n>GigabitEthernet0</span><span class=o>/</span><span class=mi>0</span><span class=o>/</span><span class=mi>5</span>
</span></span><span class=line><span class=cl> <span class=n>eth</span><span class=o>-</span><span class=n>trunk</span> <span class=mi>12</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>ip</span> <span class=n>vpn</span><span class=o>-</span><span class=n>instance</span> <span class=n>intvpn</span>
</span></span><span class=line><span class=cl> <span class=n>ipv4</span><span class=o>-</span><span class=n>family</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>interface</span> <span class=n>Vlanif200</span>
</span></span><span class=line><span class=cl> <span class=n>description</span> <span class=n>VPN</span><span class=o>-</span><span class=n>intvpn</span>
</span></span><span class=line><span class=cl> <span class=n>ip</span> <span class=n>binding</span> <span class=n>vpn</span><span class=o>-</span><span class=n>instance</span> <span class=n>intvpn</span>
</span></span><span class=line><span class=cl> <span class=n>ip</span> <span class=n>address</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>200.9</span> <span class=mf>255.255</span><span class=o>.</span><span class=mf>255.0</span> 
</span></span><span class=line><span class=cl> <span class=n>vrrp</span> <span class=n>vrid</span> <span class=mi>2</span> <span class=n>virtual</span><span class=o>-</span><span class=n>ip</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>200.1</span>
</span></span><span class=line><span class=cl> <span class=n>vrrp</span> <span class=n>vrid</span> <span class=mi>2</span> <span class=n>priority</span> <span class=mi>120</span>
</span></span><span class=line><span class=cl> <span class=n>vrrp</span> <span class=n>vrid</span> <span class=mi>2</span> <span class=n>preempt</span><span class=o>-</span><span class=n>mode</span> <span class=n>timer</span> <span class=n>delay</span> <span class=mi>20</span>
</span></span><span class=line><span class=cl> <span class=n>vrrp</span> <span class=n>vrid</span> <span class=mi>2</span> <span class=n>track</span> <span class=n>interface</span> <span class=n>GigabitEthernet0</span><span class=o>/</span><span class=mi>0</span><span class=o>/</span><span class=mi>2</span> <span class=n>reduced</span> <span class=mi>21</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>interface</span> <span class=n>Vlanif30</span>
</span></span><span class=line><span class=cl> <span class=n>description</span> <span class=n>VPN</span><span class=o>-</span><span class=n>intvpn</span>
</span></span><span class=line><span class=cl> <span class=n>ip</span> <span class=n>binding</span> <span class=n>vpn</span><span class=o>-</span><span class=n>instance</span> <span class=n>intvpn</span>
</span></span><span class=line><span class=cl> <span class=n>ip</span> <span class=n>address</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>30.1</span> <span class=mf>255.255</span><span class=o>.</span><span class=mf>255.252</span> 
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>nqa</span> <span class=n>test</span><span class=o>-</span><span class=n>instance</span> <span class=n>toCR</span> <span class=n>toCR</span> 
</span></span><span class=line><span class=cl> <span class=n>test</span><span class=o>-</span><span class=n>type</span> <span class=n>icmp</span>
</span></span><span class=line><span class=cl> <span class=n>destination</span><span class=o>-</span><span class=n>address</span> <span class=n>ipv4</span> <span class=mf>10.6</span><span class=o>.</span><span class=mf>9.2</span>
</span></span><span class=line><span class=cl> <span class=n>frequency</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl> <span class=n>interval</span> <span class=n>seconds</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl> <span class=n>timeout</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl> <span class=n>probe</span><span class=o>-</span><span class=n>count</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl> <span class=n>start</span> <span class=n>now</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>ip</span> <span class=n>route</span><span class=o>-</span><span class=k>static</span> <span class=mf>0.0</span><span class=o>.</span><span class=mf>0.0</span> <span class=mf>0.0</span><span class=o>.</span><span class=mf>0.0</span> <span class=mf>10.6</span><span class=o>.</span><span class=mf>9.2</span> <span class=n>track</span> <span class=n>nqa</span> <span class=n>toCR</span> <span class=n>toCR</span>
</span></span><span class=line><span class=cl><span class=n>ip</span> <span class=n>route</span><span class=o>-</span><span class=k>static</span> <span class=mf>0.0</span><span class=o>.</span><span class=mf>0.0</span> <span class=mf>0.0</span><span class=o>.</span><span class=mf>0.0</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>9.1</span> <span class=n>preference</span> <span class=mi>90</span>
</span></span><span class=line><span class=cl><span class=n>ip</span> <span class=n>route</span><span class=o>-</span><span class=k>static</span> <span class=mf>100.1</span><span class=o>.</span><span class=mf>200.0</span> <span class=mf>255.255</span><span class=o>.</span><span class=mf>255.0</span> <span class=mf>100.1</span><span class=o>.</span><span class=mf>40.2</span>
</span></span><span class=line><span class=cl><span class=n>ip</span> <span class=n>route</span><span class=o>-</span><span class=k>static</span> <span class=n>vpn</span><span class=o>-</span><span class=n>instance</span> <span class=n>intvpn</span> <span class=mf>0.0</span><span class=o>.</span><span class=mf>0.0</span> <span class=mf>0.0</span><span class=o>.</span><span class=mf>0.0</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>30.2</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>bgp</span> <span class=mi>62022</span>
</span></span><span class=line><span class=cl> <span class=c1>#</span>
</span></span><span class=line><span class=cl> <span class=n>ipv4</span><span class=o>-</span><span class=n>family</span> <span class=n>unicast</span>
</span></span><span class=line><span class=cl>  <span class=n>network</span> <span class=mf>100.1</span><span class=o>.</span><span class=mf>200.0</span> <span class=mi>24</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># 阻止LSW1-LSW2备份路由形成的环路</span>
</span></span><span class=line><span class=cl><span class=n>nqa</span> <span class=n>test</span><span class=o>-</span><span class=n>instance</span> <span class=n>PREVENT_LOOP</span> <span class=n>PREVENT_LOOP</span> 
</span></span><span class=line><span class=cl> <span class=n>test</span><span class=o>-</span><span class=n>type</span> <span class=n>icmp</span>
</span></span><span class=line><span class=cl> <span class=n>destination</span><span class=o>-</span><span class=n>address</span> <span class=n>ipv4</span> <span class=mf>10.5</span><span class=o>.</span><span class=mf>8.1</span>
</span></span><span class=line><span class=cl> <span class=n>frequency</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl> <span class=n>interval</span> <span class=n>seconds</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl> <span class=n>timeout</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl> <span class=n>probe</span><span class=o>-</span><span class=n>count</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl> <span class=n>start</span> <span class=n>now</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>ip</span> <span class=n>route</span><span class=o>-</span><span class=k>static</span> <span class=mf>10.5</span><span class=o>.</span><span class=mf>8.1</span> <span class=mf>255.255</span><span class=o>.</span><span class=mf>255.255</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>9.1</span>
</span></span><span class=line><span class=cl><span class=n>ip</span> <span class=n>route</span><span class=o>-</span><span class=k>static</span> <span class=mf>0.0</span><span class=o>.</span><span class=mf>0.0</span> <span class=mf>0.0</span><span class=o>.</span><span class=mf>0.0</span> <span class=mf>192.168</span><span class=o>.</span><span class=mf>9.1</span> <span class=n>preference</span> <span class=mi>90</span> <span class=n>track</span> <span class=n>nqa</span> <span class=n>PREVENT_LOOP</span> <span class=n>PREVENT_LOOP</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span></code></pre></div></li><li><p>FW1</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ip route-static 0.0.0.0 0.0.0.0 100.1.40.1
</span></span><span class=line><span class=cl>ip route-static 0.0.0.0 0.0.0.0 100.1.4.1 preference 90
</span></span><span class=line><span class=cl>ip route-static 192.168.200.0 255.255.255.0 192.168.30.1
</span></span><span class=line><span class=cl>ip route-static 192.168.200.0 255.255.255.0 192.168.3.1 preference 90
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>firewall zone untrust
</span></span><span class=line><span class=cl> add interface GigabitEthernet1/0/1.40
</span></span><span class=line><span class=cl> add interface GigabitEthernet1/0/2.40
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>firewall zone dmz
</span></span><span class=line><span class=cl> add interface GigabitEthernet1/0/1.30
</span></span><span class=line><span class=cl> add interface GigabitEthernet1/0/2.30
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>security-policy
</span></span><span class=line><span class=cl> rule name untrust2dmz
</span></span><span class=line><span class=cl>  source-zone untrust
</span></span><span class=line><span class=cl>  destination-zone dmz
</span></span><span class=line><span class=cl>  destination-address 192.168.200.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  action permit
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl> nat server web_server protocol tcp global 100.1.200.254 www inside 192.168.200.254 www
</span></span><span class=line><span class=cl> nat server icmp_server protocol icmp global 100.1.200.254 inside 192.168.200.254
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>AR4</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>bgp 64812
</span></span><span class=line><span class=cl> #
</span></span><span class=line><span class=cl> ipv4-family unicast
</span></span><span class=line><span class=cl>  network 200.1.200.0 24
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>PC4 ping测试和Http Client 测试</p><p><div class=post-img-view><a data-fancybox=gallery href=https://s2.loli.net/2024/07/19/qFvnT38SRItHifa.png><img src=https://s2.loli.net/2024/07/19/qFvnT38SRItHifa.png loading=lazy alt=image-004420171></a></div></p></li></ul><h4 id=432-connecting-the-simulated-ipv6-servers-to-the-network>4.3.2 Connecting the Simulated IPv6 Servers to the Network</h4><ul><li>LSW1和LSW2创建loopback1，配置IPv6地址</li><li>配置ospfv3，进程号200，vlanif90 建立邻居，改网络类型不选DR</li><li>BGP 仅 import 两loopback1 IPv6地址，挂上route-map ，prefix配置</li><li>配置路由聚合，112掩码</li></ul><hr><ul><li><p>LSW1</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ospfv3 200
</span></span><span class=line><span class=cl> router-id 1.1.1.8
</span></span><span class=line><span class=cl>interface LoopBack1
</span></span><span class=line><span class=cl> ipv6 enable 
</span></span><span class=line><span class=cl> ipv6 address 2001:100:1:200::8/128 
</span></span><span class=line><span class=cl> ospfv3 200 area 0.0.0.0
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface Vlanif90
</span></span><span class=line><span class=cl> ospfv3 200 area 0.0.0.0
</span></span><span class=line><span class=cl> ospfv3 network-type p2p
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ip ipv6-prefix V6_SERVER permit 2001:100:1:200::8 128
</span></span><span class=line><span class=cl>ip ipv6-prefix V6_SERVER permit 2001:100:1:200::9 128
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>route-policy V6_SERVER permit node 10 
</span></span><span class=line><span class=cl> if-match ipv6 address prefix-list V6_SERVER 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>bgp 62022
</span></span><span class=line><span class=cl> ipv6-family unicast
</span></span><span class=line><span class=cl>  aggregate 2001:100:1:200:: 112 detail-suppressed 
</span></span><span class=line><span class=cl>  import-route ospfv3 200 route-policy V6_SERVER
</span></span></code></pre></div></li><li><p>LSW2</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ospfv3 200
</span></span><span class=line><span class=cl> router-id 1.1.1.9
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface LoopBack1
</span></span><span class=line><span class=cl> ipv6 enable 
</span></span><span class=line><span class=cl> ipv6 address 2001:100:1:200::9/128 
</span></span><span class=line><span class=cl> ospfv3 200 area 0.0.0.0
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface Vlanif90
</span></span><span class=line><span class=cl> ospfv3 200 area 0.0.0.0
</span></span><span class=line><span class=cl> ospfv3 network-type p2p
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ip ipv6-prefix V6_SERVER permit 2001:100:1:200::8 128
</span></span><span class=line><span class=cl>ip ipv6-prefix V6_SERVER permit 2001:100:1:200::9 128
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>route-policy V6_SERVER permit node 10 
</span></span><span class=line><span class=cl> if-match ipv6 address prefix-list V6_SERVER 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>bgp 62022
</span></span><span class=line><span class=cl> ipv6-family unicast
</span></span><span class=line><span class=cl>  aggregate 2001:100:1:200:: 112 detail-suppressed 
</span></span><span class=line><span class=cl>  import-route ospfv3 200 route-policy V6_SERVER
</span></span></code></pre></div></li><li><p>AR4</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>bgp 64812
</span></span><span class=line><span class=cl> ipv6-family unicast
</span></span><span class=line><span class=cl>  network 2001:200:1:200:: 64 
</span></span></code></pre></div></li><li><p>PC4 配置IPv6地址-2001:200:1:200::254/64； IPv6网关-2001:200:1:200::1</p><p><div class=post-img-view><a data-fancybox=gallery href=https://s2.loli.net/2024/07/19/RxG8AWwrXqpVNtT.png><img src=https://s2.loli.net/2024/07/19/RxG8AWwrXqpVNtT.png loading=lazy alt=image-140018166></a></div></p></li><li><p>PC4 ping测试</p><p><div class=post-img-view><a data-fancybox=gallery href=https://s2.loli.net/2024/07/19/HqWUsa9yk1YZtfu.png><img src=https://s2.loli.net/2024/07/19/HqWUsa9yk1YZtfu.png loading=lazy alt=image-013227537></a></div></p><p><div class=post-img-view><a data-fancybox=gallery href=https://s2.loli.net/2024/07/19/kib3dspezqgWt1c.png><img src=https://s2.loli.net/2024/07/19/kib3dspezqgWt1c.png loading=lazy alt=image-013202951></a></div></p></li></ul><h4 id=433-configuring-security-protection-on-the-firewall>4.3.3 Configuring Security Protection on the Firewall</h4><ul><li>拉黑200.1.200.200地址</li></ul><hr><ul><li><p>FW1</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[FW1]firewall blacklist enable 
</span></span><span class=line><span class=cl>[FW1]firewall blacklist item source-ip 200.1.200.200
</span></span></code></pre></div></li></ul><h3 id=44-task-4-enterprise-hq-network-deployment>4.4 Task 4: Enterprise HQ Network Deployment</h3><h4 id=441-configuring-a-layer-2-network>4.4.1 Configuring a Layer 2 Network</h4><ul><li>端口安全，动态安全地址，mac 抖动，最大mac地址2，aging time 1200m</li><li>端口学习mac地址的优先级</li></ul><hr><ul><li><p>LSW3</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/2
</span></span><span class=line><span class=cl> mac-learning priority 3
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/4
</span></span><span class=line><span class=cl> port-security enable
</span></span><span class=line><span class=cl> port-security protect-action shutdown
</span></span><span class=line><span class=cl> port-security max-mac-num 2
</span></span><span class=line><span class=cl> port-security mac-address sticky
</span></span><span class=line><span class=cl> port-security aging-time 1200
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>LSW4</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/2
</span></span><span class=line><span class=cl> mac-learning priority 3
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/3
</span></span><span class=line><span class=cl> port-security enable
</span></span><span class=line><span class=cl> port-security protect-action shutdown
</span></span><span class=line><span class=cl> port-security max-mac-num 2
</span></span><span class=line><span class=cl> port-security mac-address sticky
</span></span><span class=line><span class=cl> port-security aging-time 1200
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li></ul><h4 id=442-configuring-basic-services-on-the-firewall>4.4.2 Configuring Basic Services on the Firewall</h4><ul><li>配置安全策略，HQ 172.16.100.0/24和Branch172.17.100.0/24上互联网（NAT need）</li><li>配置安全策略，HQ 172.16.101.0/24 访问OA 192.168.100.0/24（FW1上做了映射公网）</li><li>配置ip-link ,FW2-AR1, FW2-AR2，搭配后续的出向默认路由使用</li><li>出向静态路由</li><li>入向静态路由，AR1和AR2 （200.1.100.0/24）指向 FW2；FW2配置特定主备路由指向LSW3 LSW4</li><li>配置NAT，接入互联网，最终ping通WEB服务器和Video服务器需要这个，转换地址池200.1.100.2 - 200.1.100.10</li></ul><hr><ul><li><p>FW2</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>firewall zone trust
</span></span><span class=line><span class=cl> add interface GigabitEthernet1/0/3.30
</span></span><span class=line><span class=cl> add interface GigabitEthernet1/0/4.40
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>firewall zone untrust
</span></span><span class=line><span class=cl> add interface GigabitEthernet1/0/3.60
</span></span><span class=line><span class=cl> add interface GigabitEthernet1/0/4.70
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ip-link check enable                      
</span></span><span class=line><span class=cl>ip-link name toar1
</span></span><span class=line><span class=cl> destination 200.1.6.1 interface GigabitEthernet1/0/3.60 mode arp
</span></span><span class=line><span class=cl>ip-link name toar2
</span></span><span class=line><span class=cl> destination 200.1.7.1 interface GigabitEthernet1/0/4.70 mode arp
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>security-policy
</span></span><span class=line><span class=cl> rule name trust2untrust01
</span></span><span class=line><span class=cl>  source-zone trust
</span></span><span class=line><span class=cl>  destination-zone untrust
</span></span><span class=line><span class=cl>  source-address 172.16.100.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  source-address 172.17.100.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  action permit
</span></span><span class=line><span class=cl> rule name trust2untrust02
</span></span><span class=line><span class=cl>  source-zone trust
</span></span><span class=line><span class=cl>  destination-zone untrust
</span></span><span class=line><span class=cl>  source-address 172.16.101.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  destination-address 192.168.100.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  action permit
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ip route-static 0.0.0.0 0.0.0.0 200.1.6.1 track ip-link toar1
</span></span><span class=line><span class=cl>ip route-static 0.0.0.0 0.0.0.0 200.1.7.1 track ip-link toar2
</span></span><span class=line><span class=cl>ip route-static 172.16.100.0 255.255.255.0 172.16.3.1
</span></span><span class=line><span class=cl>ip route-static 172.16.100.0 255.255.255.0 172.16.4.1 preference 90
</span></span><span class=line><span class=cl>ip route-static 172.16.101.0 255.255.255.0 172.16.4.1
</span></span><span class=line><span class=cl>ip route-static 172.16.101.0 255.255.255.0 172.16.3.1 preference 90
</span></span><span class=line><span class=cl>ip route-static 172.17.100.0 255.255.255.0 172.16.3.1
</span></span><span class=line><span class=cl>ip route-static 172.17.100.0 255.255.255.0 172.16.4.1
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>nat address-group addressgroup1 0
</span></span><span class=line><span class=cl> mode pat
</span></span><span class=line><span class=cl> section 0 200.1.100.2 200.1.100.10
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>nat-policy
</span></span><span class=line><span class=cl> rule name policy_nat1
</span></span><span class=line><span class=cl>  source-zone trust
</span></span><span class=line><span class=cl>  destination-zone untrust
</span></span><span class=line><span class=cl>  source-address 172.16.100.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  source-address 172.17.100.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  destination-address 100.1.0.0 mask 255.255.0.0
</span></span><span class=line><span class=cl>  action source-nat address-group addressgroup1
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>LSW3</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ip route-static 0.0.0.0 0.0.0.0 172.16.3.2
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>LSW4</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ip route-static 0.0.0.0 0.0.0.0 172.16.4.2
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>AR1</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ip route-static 200.1.100.0 255.255.255.0 200.1.6.2
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>bgp 64812
</span></span><span class=line><span class=cl> #
</span></span><span class=line><span class=cl> ipv4-family unicast
</span></span><span class=line><span class=cl>  import-route static
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>AR2</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ip route-static 200.1.100.0 255.255.255.0 200.1.7.2
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>bgp 64812
</span></span><span class=line><span class=cl> #
</span></span><span class=line><span class=cl> ipv4-family unicast
</span></span><span class=line><span class=cl>  import-route static
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>验证</p><p><div class=post-img-view><a data-fancybox=gallery href=https://s2.loli.net/2024/07/19/7F9dWlTxU3eag6q.png><img src=https://s2.loli.net/2024/07/19/7F9dWlTxU3eag6q.png loading=lazy alt=image-124106425></a></div></p><p><div class=post-img-view><a data-fancybox=gallery href=https://s2.loli.net/2024/07/19/1J4VLSmGzk7ZYsq.png><img src=https://s2.loli.net/2024/07/19/1J4VLSmGzk7ZYsq.png loading=lazy alt=image-124147896></a></div></p></li></ul><h4 id=443-configuring-url-filtering-on-the-firewall>4.4.3 Configuring URL Filtering on the Firewall</h4><ul><li><p>url-filter profile的配置，去网页点点看</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>profile type url-filter name url_profile_deny
</span></span><span class=line><span class=cl> add blacklist url www.example1.com
</span></span><span class=line><span class=cl> add blacklist url www.example2.com
</span></span><span class=line><span class=cl> category pre-defined control-level medium
</span></span><span class=line><span class=cl> https-filter enable
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li></ul><h4 id=444-configuring-the-ips-function-on-the-firewall>4.4.4 Configuring the IPS Function on the Firewall</h4><ul><li><p>ips profile的配置，去网页点点看</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>profile type ips name Profile_ips_pc
</span></span><span class=line><span class=cl> collect-attack-evidence enable # 依赖硬盘，ensp不起作用
</span></span><span class=line><span class=cl> signature-set name filter_web
</span></span><span class=line><span class=cl>  target client
</span></span><span class=line><span class=cl>  severity high
</span></span><span class=line><span class=cl>  protocol HTTP
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>security-policy
</span></span><span class=line><span class=cl> rule name trust2untrust01
</span></span><span class=line><span class=cl>  profile ips Profile_ips_pc
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li></ul><h4 id=445-configuring-traffic-management-on-the-firewall>4.4.5 Configuring Traffic Management on the Firewall</h4><ul><li><p>配置流量管理，去网页点点看</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl> time-range work_time
</span></span><span class=line><span class=cl>  period-range 09:00:00 to 18:00:00 working-day  
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>traffic-policy
</span></span><span class=line><span class=cl> profile profile_p2p
</span></span><span class=line><span class=cl>  bandwidth maximum-bandwidth whole both 50000
</span></span><span class=line><span class=cl>  bandwidth connection-limit whole both 2000 
</span></span><span class=line><span class=cl> profile profile_email
</span></span><span class=line><span class=cl>  bandwidth guaranteed-bandwidth whole both 100000
</span></span><span class=line><span class=cl>  bandwidth priority 7
</span></span><span class=line><span class=cl> rule name policy_p2p
</span></span><span class=line><span class=cl>  source-zone trust
</span></span><span class=line><span class=cl>  destination-zone untrust
</span></span><span class=line><span class=cl>  source-address address-set 172.16.100.0&amp;172.17.100.0
</span></span><span class=line><span class=cl>  application app BT
</span></span><span class=line><span class=cl>  application app 	YouKu
</span></span><span class=line><span class=cl>  action qos profile profile_p2p
</span></span><span class=line><span class=cl> rule name policy_email
</span></span><span class=line><span class=cl>  source-zone trust
</span></span><span class=line><span class=cl>  destination-zone untrust
</span></span><span class=line><span class=cl>  source-address 172.16.100.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  source-address 172.17.100.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  application app LotusNotes
</span></span><span class=line><span class=cl>  application app OWA
</span></span><span class=line><span class=cl>  application category Business_Systems sub-category Email
</span></span><span class=line><span class=cl>  action qos profile profile_email
</span></span><span class=line><span class=cl># 
</span></span></code></pre></div></li></ul><h3 id=45-task-5-enterprise-branch-network-deployment>4.5 Task 5: Enterprise Branch Network Deployment</h3><h4 id=451-configuring-dhcp>4.5.1 Configuring DHCP</h4><ul><li>LSW5配置DHCP，此DHCP Server后续的无线sta获取地址也需要用到</li><li>DHCP参数，vlanif100接口，dns 8.8.8.8，lease 2d</li><li>LSW6，配置DHCP snooping，上联dhcp server接口trusted</li><li>可能的bug（PC3和STA1获取不到IP地址，在LSW5去掉DHCP配置再重新刷入配置解决）</li></ul><hr><ul><li><p>LSW5</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>dhcp enable
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface Vlanif100
</span></span><span class=line><span class=cl> dhcp select interface
</span></span><span class=line><span class=cl> dhcp server lease day 2
</span></span><span class=line><span class=cl> dhcp server dns-list 8.8.8.8 
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>LSW6</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>dhcp enable
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>dhcp snooping enable
</span></span><span class=line><span class=cl>arp dhcp-snooping-detect enable
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface Ethernet0/0/1
</span></span><span class=line><span class=cl> dhcp snooping check dhcp-rate enable
</span></span><span class=line><span class=cl> dhcp snooping check dhcp-rate 80
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/1
</span></span><span class=line><span class=cl> port trunk pvid vlan 200
</span></span><span class=line><span class=cl> dhcp snooping check dhcp-rate enable
</span></span><span class=line><span class=cl> dhcp snooping check dhcp-rate 80
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/2
</span></span><span class=line><span class=cl> dhcp snooping enable
</span></span><span class=line><span class=cl> dhcp snooping trusted
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li></ul><h4 id=452-configuring-a-wlan>4.5.2 Configuring a WLAN</h4><ul><li>配置旁挂二层直接转发+ vrrp热备冗余+hsb状态同步</li><li>黑名单拉黑sta2接入</li><li>动态拉黑攻击者mac</li><li>流量模板限速</li><li>ensp要是支持配置同步功能就厉害了</li></ul><hr><ul><li><p>AC1</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>dhcp enable
</span></span><span class=line><span class=cl># 下面这行说dhcp信息可以从文件恢复，很重要么这点信息？
</span></span><span class=line><span class=cl># dhcp server database enable 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface Vlanif200
</span></span><span class=line><span class=cl> ip address 172.17.200.2 255.255.255.0
</span></span><span class=line><span class=cl> vrrp vrid 1 virtual-ip 172.17.200.1
</span></span><span class=line><span class=cl> admin-vrrp vrid 1 
</span></span><span class=line><span class=cl> vrrp vrid 1 priority 200
</span></span><span class=line><span class=cl> dhcp select interface
</span></span><span class=line><span class=cl> dhcp server excluded-ip-address 172.17.200.1 172.17.200.3 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>capwap source ip-address 172.17.200.1
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>wlan
</span></span><span class=line><span class=cl># 流量模板
</span></span><span class=line><span class=cl> traffic-profile name wlan-traffic
</span></span><span class=line><span class=cl>  rate-limit client up 5000
</span></span><span class=line><span class=cl>  rate-limit vap up 100000
</span></span><span class=line><span class=cl>  rate-limit client down 10000
</span></span><span class=line><span class=cl>  rate-limit vap down 500000
</span></span><span class=line><span class=cl># 安全模板
</span></span><span class=line><span class=cl> security-profile name wlan-security
</span></span><span class=line><span class=cl>  security wpa-wpa2 psk pass-phrase Huawei@123 aes
</span></span><span class=line><span class=cl># 黑名单拉黑sta2
</span></span><span class=line><span class=cl> sta-blacklist-profile name sta-blacklist
</span></span><span class=line><span class=cl>  sta-mac 5489-988a-0449
</span></span><span class=line><span class=cl># 空白的白名单
</span></span><span class=line><span class=cl> sta-whitelist-profile name sta-whitelist
</span></span><span class=line><span class=cl># SSID模板
</span></span><span class=line><span class=cl> ssid-profile name wlan-ssid
</span></span><span class=line><span class=cl>  ssid ICT2022
</span></span><span class=line><span class=cl># VAP模板
</span></span><span class=line><span class=cl> vap-profile name wlan-vap
</span></span><span class=line><span class=cl>  service-vlan vlan-id 100
</span></span><span class=line><span class=cl>  sta-access-mode whitelist sta-whitelist
</span></span><span class=line><span class=cl>  ssid-profile wlan-ssid
</span></span><span class=line><span class=cl>  security-profile wlan-security
</span></span><span class=line><span class=cl>  traffic-profile wlan-traffic
</span></span><span class=line><span class=cl># WIDS模板
</span></span><span class=line><span class=cl> wids-profile name wlan-wids
</span></span><span class=line><span class=cl>  brute-force-detect interval 80
</span></span><span class=line><span class=cl>  brute-force-detect threshold 5
</span></span><span class=line><span class=cl>  brute-force-detect quiet-time 800
</span></span><span class=line><span class=cl>  dynamic-blacklist enable
</span></span><span class=line><span class=cl># AP系统模板
</span></span><span class=line><span class=cl> ap-system-profile name wlan-system
</span></span><span class=line><span class=cl>  dynamic-blacklist aging-time 300
</span></span><span class=line><span class=cl>  sta-access-mode blacklist sta-blacklist
</span></span><span class=line><span class=cl># AP组
</span></span><span class=line><span class=cl> ap-group name ap-group
</span></span><span class=line><span class=cl>  ap-system-profile wlan-system
</span></span><span class=line><span class=cl>  wids-profile wlan-wids
</span></span><span class=line><span class=cl>  radio 0
</span></span><span class=line><span class=cl>   vap-profile wlan-vap wlan 1
</span></span><span class=line><span class=cl> ap-id 0 type-id 61 ap-mac 00e0-fcf8-2fb0 ap-sn 2102354483106349735D
</span></span><span class=line><span class=cl>  ap-name AP1
</span></span><span class=line><span class=cl>  ap-group ap-group
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>hsb-service 0
</span></span><span class=line><span class=cl> service-ip-port local-ip 172.17.200.2 peer-ip 172.17.200.3 local-data-port 10241 peer-data-port 10241
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>hsb-group 0
</span></span><span class=line><span class=cl> track vrrp vrid 1 interface Vlanif200
</span></span><span class=line><span class=cl> bind-service 0
</span></span><span class=line><span class=cl> hsb enable # 配置完成其他配置再启用查看状态
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>hsb-service-type access-user hsb-group 0
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>hsb-service-type dhcp hsb-group 0
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>hsb-service-type ap hsb-group 0
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>AC2 ，修改参数即可，wlan配置与AC 1 一致，粘贴注意有时需要输入 Y 确认</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>dhcp enable
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface Vlanif200
</span></span><span class=line><span class=cl> ip address 172.17.200.3 255.255.255.0
</span></span><span class=line><span class=cl> vrrp vrid 1 virtual-ip 172.17.200.1
</span></span><span class=line><span class=cl> admin-vrrp vrid 1 
</span></span><span class=line><span class=cl> dhcp select interface
</span></span><span class=line><span class=cl> dhcp server excluded-ip-address 172.17.200.1 172.17.200.3 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>capwap source ip-address 172.17.200.1
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>wlan
</span></span><span class=line><span class=cl># 流量模板
</span></span><span class=line><span class=cl> traffic-profile name wlan-traffic
</span></span><span class=line><span class=cl>  rate-limit client up 5000
</span></span><span class=line><span class=cl>  rate-limit vap up 100000
</span></span><span class=line><span class=cl>  rate-limit client down 10000
</span></span><span class=line><span class=cl>  rate-limit vap down 500000
</span></span><span class=line><span class=cl># 安全模板
</span></span><span class=line><span class=cl> security-profile name wlan-security
</span></span><span class=line><span class=cl>  security wpa-wpa2 psk pass-phrase Huawei@123 aes
</span></span><span class=line><span class=cl># 黑名单拉黑sta2
</span></span><span class=line><span class=cl> sta-blacklist-profile name sta-blacklist
</span></span><span class=line><span class=cl>  sta-mac 5489-988a-0449
</span></span><span class=line><span class=cl># 空白的白名单
</span></span><span class=line><span class=cl> sta-whitelist-profile name sta-whitelist
</span></span><span class=line><span class=cl># SSID模板
</span></span><span class=line><span class=cl> ssid-profile name wlan-ssid
</span></span><span class=line><span class=cl>  ssid ICT2022
</span></span><span class=line><span class=cl># VAP模板
</span></span><span class=line><span class=cl> vap-profile name wlan-vap
</span></span><span class=line><span class=cl>  service-vlan vlan-id 100
</span></span><span class=line><span class=cl>  sta-access-mode whitelist sta-whitelist
</span></span><span class=line><span class=cl>  ssid-profile wlan-ssid
</span></span><span class=line><span class=cl>  security-profile wlan-security
</span></span><span class=line><span class=cl>  traffic-profile wlan-traffic
</span></span><span class=line><span class=cl># WIDS模板
</span></span><span class=line><span class=cl> wids-profile name wlan-wids
</span></span><span class=line><span class=cl>  brute-force-detect interval 80
</span></span><span class=line><span class=cl>  brute-force-detect threshold 5
</span></span><span class=line><span class=cl>  brute-force-detect quiet-time 800
</span></span><span class=line><span class=cl>  dynamic-blacklist enable
</span></span><span class=line><span class=cl># AP系统模板
</span></span><span class=line><span class=cl> ap-system-profile name wlan-system
</span></span><span class=line><span class=cl>  dynamic-blacklist aging-time 300
</span></span><span class=line><span class=cl>  sta-access-mode blacklist sta-blacklist
</span></span><span class=line><span class=cl># AP组
</span></span><span class=line><span class=cl> ap-group name ap-group
</span></span><span class=line><span class=cl>  ap-system-profile wlan-system
</span></span><span class=line><span class=cl>  wids-profile wlan-wids
</span></span><span class=line><span class=cl>  radio 0
</span></span><span class=line><span class=cl>   vap-profile wlan-vap wlan 1
</span></span><span class=line><span class=cl> ap-id 0 type-id 61 ap-mac 00e0-fcf8-2fb0 ap-sn 2102354483106349735D
</span></span><span class=line><span class=cl>  ap-name AP1
</span></span><span class=line><span class=cl>  ap-group ap-group
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>hsb-service 0
</span></span><span class=line><span class=cl> service-ip-port local-ip 172.17.200.3 peer-ip 172.17.200.2 local-data-port 10241 peer-data-port 10241
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>hsb-group 0
</span></span><span class=line><span class=cl> track vrrp vrid 1 interface Vlanif200
</span></span><span class=line><span class=cl> bind-service 0
</span></span><span class=line><span class=cl> hsb enable
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>hsb-service-type access-user hsb-group 0
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>hsb-service-type dhcp hsb-group 0
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>hsb-service-type ap hsb-group 0
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>校验</p><ul><li><p>dis vrrp</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[AC1]dis vrrp  
</span></span><span class=line><span class=cl>  Vlanif200 | Virtual Router 1
</span></span><span class=line><span class=cl>    State : Master
</span></span><span class=line><span class=cl>    Virtual IP : 172.17.200.1
</span></span><span class=line><span class=cl>    Master IP : 172.17.200.2
</span></span><span class=line><span class=cl>    PriorityRun : 222
</span></span><span class=line><span class=cl>    PriorityConfig : 222
</span></span><span class=line><span class=cl>    MasterPriority : 222
</span></span><span class=line><span class=cl>    Preempt : YES   Delay Time : 0 s
</span></span><span class=line><span class=cl>    TimerRun : 1 s
</span></span><span class=line><span class=cl>    TimerConfig : 1 s
</span></span><span class=line><span class=cl>    Auth type : NONE
</span></span><span class=line><span class=cl>    Virtual MAC : 0000-5e00-0101
</span></span><span class=line><span class=cl>    Check TTL : YES
</span></span><span class=line><span class=cl>    Config type : admin-vrrp
</span></span><span class=line><span class=cl>    Backup-forward : disabled
</span></span><span class=line><span class=cl>    Create time : 2024-07-16 21:14:14 UTC-05:13
</span></span><span class=line><span class=cl>    Last change time : 2024-07-16 21:14:27 UTC-05:13
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[AC1]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[AC2]dis vrrp
</span></span><span class=line><span class=cl>  Vlanif200 | Virtual Router 1
</span></span><span class=line><span class=cl>    State : Backup
</span></span><span class=line><span class=cl>    Virtual IP : 172.17.200.1
</span></span><span class=line><span class=cl>    Master IP : 172.17.200.2
</span></span><span class=line><span class=cl>    PriorityRun : 111
</span></span><span class=line><span class=cl>    PriorityConfig : 111
</span></span><span class=line><span class=cl>    MasterPriority : 222
</span></span><span class=line><span class=cl>    Preempt : YES   Delay Time : 0 s
</span></span><span class=line><span class=cl>    TimerRun : 1 s
</span></span><span class=line><span class=cl>    TimerConfig : 1 s
</span></span><span class=line><span class=cl>    Auth type : NONE
</span></span><span class=line><span class=cl>    Virtual MAC : 0000-5e00-0101
</span></span><span class=line><span class=cl>    Check TTL : YES
</span></span><span class=line><span class=cl>    Config type : admin-vrrp
</span></span><span class=line><span class=cl>    Backup-forward : disabled
</span></span><span class=line><span class=cl>    Create time : 2024-07-16 20:19:15 UTC-05:13
</span></span><span class=line><span class=cl>    Last change time : 2024-07-16 21:14:58 UTC-05:13
</span></span></code></pre></div></li><li><p>dis hsb-group 0</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[AC1]dis hsb-group 0
</span></span><span class=line><span class=cl>Hot Standby Group Information:
</span></span><span class=line><span class=cl>----------------------------------------------------------
</span></span><span class=line><span class=cl>  HSB-group ID                : 0
</span></span><span class=line><span class=cl>  Vrrp Group ID               : 1
</span></span><span class=line><span class=cl>  Vrrp Interface              : Vlanif200
</span></span><span class=line><span class=cl>  Service Index               : 0
</span></span><span class=line><span class=cl>  Group Vrrp Status           : Master
</span></span><span class=line><span class=cl>  Group Status                : Active
</span></span><span class=line><span class=cl>  Group Backup Process        : Realtime
</span></span><span class=line><span class=cl>  Peer Group Device Name      : AC6005
</span></span><span class=line><span class=cl>  Peer Group Software Version : V200R007C10SPC300B220
</span></span><span class=line><span class=cl>  Group Backup Modules        : Access-user
</span></span><span class=line><span class=cl>                                DHCP
</span></span><span class=line><span class=cl>                                AP
</span></span><span class=line><span class=cl>----------------------------------------------------------
</span></span><span class=line><span class=cl>[AC1]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[AC2]dis hsb-group 0  
</span></span><span class=line><span class=cl>Hot Standby Group Information:
</span></span><span class=line><span class=cl>----------------------------------------------------------
</span></span><span class=line><span class=cl>  HSB-group ID                : 0
</span></span><span class=line><span class=cl>  Vrrp Group ID               : 1
</span></span><span class=line><span class=cl>  Vrrp Interface              : Vlanif200
</span></span><span class=line><span class=cl>  Service Index               : 0
</span></span><span class=line><span class=cl>  Group Vrrp Status           : Backup
</span></span><span class=line><span class=cl>  Group Status                : Inactive
</span></span><span class=line><span class=cl>  Group Backup Process        : Realtime
</span></span><span class=line><span class=cl>  Peer Group Device Name      : AC6005
</span></span><span class=line><span class=cl>  Peer Group Software Version : V200R007C10SPC300B220
</span></span><span class=line><span class=cl>  Group Backup Modules        : Access-user
</span></span><span class=line><span class=cl>                                DHCP
</span></span><span class=line><span class=cl>                                AP
</span></span><span class=line><span class=cl>----------------------------------------------------------
</span></span><span class=line><span class=cl>[AC2]
</span></span></code></pre></div></li><li><p>dis hsb-service 0</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[AC1]dis hsb-service 0
</span></span><span class=line><span class=cl>Hot Standby Service Information:
</span></span><span class=line><span class=cl>----------------------------------------------------------
</span></span><span class=line><span class=cl>  Local IP Address       : 172.17.200.2
</span></span><span class=line><span class=cl>  Peer IP Address        : 172.17.200.3
</span></span><span class=line><span class=cl>  Source Port            : 10241
</span></span><span class=line><span class=cl>  Destination Port       : 10241
</span></span><span class=line><span class=cl>  Keep Alive Times       : 5
</span></span><span class=line><span class=cl>  Keep Alive Interval    : 3
</span></span><span class=line><span class=cl>  Service State          : Connected
</span></span><span class=line><span class=cl>  Service Batch Modules  :
</span></span><span class=line><span class=cl>----------------------------------------------------------
</span></span><span class=line><span class=cl>[AC1]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[AC2]dis hsb-service 0
</span></span><span class=line><span class=cl>Hot Standby Service Information:
</span></span><span class=line><span class=cl>----------------------------------------------------------
</span></span><span class=line><span class=cl>  Local IP Address       : 172.17.200.3
</span></span><span class=line><span class=cl>  Peer IP Address        : 172.17.200.2
</span></span><span class=line><span class=cl>  Source Port            : 10241
</span></span><span class=line><span class=cl>  Destination Port       : 10241
</span></span><span class=line><span class=cl>  Keep Alive Times       : 5
</span></span><span class=line><span class=cl>  Keep Alive Interval    : 3
</span></span><span class=line><span class=cl>  Service State          : Connected
</span></span><span class=line><span class=cl>  Service Batch Modules  :
</span></span><span class=line><span class=cl>----------------------------------------------------------
</span></span><span class=line><span class=cl>[AC2]
</span></span></code></pre></div></li><li><p>dis ap all</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[AC1]dis ap all
</span></span><span class=line><span class=cl>Info: This operation may take a few seconds. Please wait for a moment.done.
</span></span><span class=line><span class=cl>Total AP information:
</span></span><span class=line><span class=cl>nor  : normal          [1]
</span></span><span class=line><span class=cl>---------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>ID   MAC            Name Group    IP             Type            State STA Uptime
</span></span><span class=line><span class=cl>---------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>0    00e0-fcf8-2fb0 AP1  ap-group 172.17.200.132 AP4050DN-E      nor   1   22M:17S
</span></span><span class=line><span class=cl>---------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>Total: 1
</span></span><span class=line><span class=cl>[AC1]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[AC2]dis ap all
</span></span><span class=line><span class=cl>Info: This operation may take a few seconds. Please wait for a moment.done.
</span></span><span class=line><span class=cl>Total AP information:
</span></span><span class=line><span class=cl>stdby: standby         [1]
</span></span><span class=line><span class=cl>--------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>ID   MAC            Name Group    IP             Type            State STA Uptime
</span></span><span class=line><span class=cl>--------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>0    00e0-fcf8-2fb0 AP1  ap-group 172.17.200.132 AP4050DN-E      stdby 0   -
</span></span><span class=line><span class=cl>--------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>Total: 1
</span></span><span class=line><span class=cl>[AC2]
</span></span></code></pre></div></li><li><p>dis station all</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[AC1]dis station all
</span></span><span class=line><span class=cl>Rf/WLAN: Radio ID/WLAN ID                                                     
</span></span><span class=line><span class=cl>Rx/Tx: link receive rate/link transmit rate(Mbps)                             
</span></span><span class=line><span class=cl>-----------------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>STA MAC          AP ID Ap name  Rf/WLAN  Band  Type  Rx/Tx      RSSI  VLAN  IP address     SSID                   
</span></span><span class=line><span class=cl>-----------------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>5489-9811-592c   0     AP1      0/1      2.4G  -     -/-        -     100   172.17.100.254 ICT2022                
</span></span><span class=line><span class=cl>-----------------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>Total: 1 2.4G: 1 5G: 0
</span></span><span class=line><span class=cl>[AC1]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[AC2]dis station all
</span></span><span class=line><span class=cl>Rf/WLAN: Radio ID/WLAN ID                                                     
</span></span><span class=line><span class=cl>Rx/Tx: link receive rate/link transmit rate(Mbps)                             
</span></span><span class=line><span class=cl>--------------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>STA MAC          AP ID Ap name  Rf/WLAN  Band  Type  Rx/Tx      RSSI  VLAN  IP address  SSID                   
</span></span><span class=line><span class=cl>--------------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>--------------------------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>Total: 0 2.4G: 0 5G: 0
</span></span><span class=line><span class=cl>[AC2]
</span></span></code></pre></div></li><li><p>dis station online-fail-record all</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[AC1]dis station online-fail-record all
</span></span><span class=line><span class=cl>Rf/WLAN: Radio ID/WLAN ID
</span></span><span class=line><span class=cl>------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>STA MAC         AP ID Ap name  Rf/WLAN    Last record time
</span></span><span class=line><span class=cl>                Reason
</span></span><span class=line><span class=cl>------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>5489-988a-0449  0     AP1      0/1        2024-07-19/10:35:02
</span></span><span class=line><span class=cl>                The STA is in the global blacklist.
</span></span><span class=line><span class=cl>------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>Total stations: 1 Total records: 1
</span></span><span class=line><span class=cl>[AC1]
</span></span></code></pre></div></li></ul></li></ul><h3 id=46-task-6-service-deployment-for-communication-between-the-enterprise-hq-and-branch>4.6 Task 6: Service Deployment for Communication Between the Enterprise HQ and Branch</h3><h4 id=461-configuring-an-mplsvpn>4.6.1 Configuring an MPLSVPN</h4><ul><li>配置ldp，loopback0接口地址为lsr-id，</li><li>AR1/AR2/AR3/AR4，配置vrf entvpn，需要配置RD，RT</li><li>AR1/AR2/LSW3/LSW4配置ospf，进程号100，area0，LSW3/LSW4下发默认路由，面向PC的vlanif接口配置passive被动接口</li><li>LSW5/AR3/AR4/配置EBGP，AS62012，branch使用network起源宣告网段</li><li>vpnv4的反射器，AR1/AR2重分布默认路由进BGP vpn地址族</li><li>配置AS-PATH添加，route-map，对收到的路由进行选路干预</li><li>LSW5收到的默认路由负载均衡，最大优选路径设置2</li><li>当HQ两条出口链路中断，LSW3/LSW4的去往branch 172.17.100.0/24的不走FW2的默认路由 ，track默认路由检测互联AR1/AR2的链路</li><li>AR路由器的故障快速切换，在VPN路由收敛前切换</li></ul><hr><ul><li><p>AR1</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>mpls lsr-id 1.1.1.1
</span></span><span class=line><span class=cl>mpls
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>mpls ldp
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/0
</span></span><span class=line><span class=cl> mpls
</span></span><span class=line><span class=cl> mpls ldp
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/1
</span></span><span class=line><span class=cl> mpls
</span></span><span class=line><span class=cl> mpls ldp
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ip vpn-instance entvpn
</span></span><span class=line><span class=cl> ipv4-family
</span></span><span class=line><span class=cl>  route-distinguisher 64812:1
</span></span><span class=line><span class=cl>  vpn frr route-policy VPN-FRR
</span></span><span class=line><span class=cl>  vpn-target 64812:345 both
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/2.10
</span></span><span class=line><span class=cl> ip binding vpn-instance entvpn
</span></span><span class=line><span class=cl> ip address 172.16.1.1 255.255.255.252 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ospf 100 router-id 1.1.1.1 vpn-instance entvpn
</span></span><span class=line><span class=cl> import-route bgp
</span></span><span class=line><span class=cl> area 0.0.0.0 
</span></span><span class=line><span class=cl>  network 172.16.1.1 0.0.0.0 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>bgp 64812
</span></span><span class=line><span class=cl> #
</span></span><span class=line><span class=cl> ipv4-family vpn-instance entvpn 
</span></span><span class=line><span class=cl>  default-route imported
</span></span><span class=line><span class=cl>  import-route ospf 100
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>route-policy VPN-FRR permit node 10 
</span></span><span class=line><span class=cl> apply backup-nexthop auto
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>AR2</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>mpls lsr-id 1.1.1.2
</span></span><span class=line><span class=cl>mpls
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>mpls ldp
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/0
</span></span><span class=line><span class=cl> mpls
</span></span><span class=line><span class=cl> mpls ldp
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/1
</span></span><span class=line><span class=cl> mpls
</span></span><span class=line><span class=cl> mpls ldp
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ip vpn-instance entvpn
</span></span><span class=line><span class=cl> ipv4-family
</span></span><span class=line><span class=cl>  route-distinguisher 64812:1
</span></span><span class=line><span class=cl>  vpn frr route-policy VPN-FRR
</span></span><span class=line><span class=cl>  vpn-target 64812:345 both
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/2.20
</span></span><span class=line><span class=cl> ip binding vpn-instance entvpn
</span></span><span class=line><span class=cl> ip address 172.16.2.1 255.255.255.252 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ospf 100 router-id 1.1.1.2 vpn-instance entvpn
</span></span><span class=line><span class=cl> import-route bgp
</span></span><span class=line><span class=cl> area 0.0.0.0 
</span></span><span class=line><span class=cl>  network 172.16.2.1 0.0.0.0 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>bgp 64812
</span></span><span class=line><span class=cl> #
</span></span><span class=line><span class=cl> ipv4-family vpn-instance entvpn 
</span></span><span class=line><span class=cl>  default-route imported
</span></span><span class=line><span class=cl>  import-route ospf 100
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>route-policy VPN-FRR permit node 10 
</span></span><span class=line><span class=cl> apply backup-nexthop auto
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>AR3</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>mpls lsr-id 1.1.1.3
</span></span><span class=line><span class=cl>mpls
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>mpls ldp
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/0
</span></span><span class=line><span class=cl> mpls
</span></span><span class=line><span class=cl> mpls ldp
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/2
</span></span><span class=line><span class=cl> pim sm
</span></span><span class=line><span class=cl> mpls
</span></span><span class=line><span class=cl> mpls ldp
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ip vpn-instance entvpn
</span></span><span class=line><span class=cl> ipv4-family
</span></span><span class=line><span class=cl>  route-distinguisher 64812:1
</span></span><span class=line><span class=cl>  vpn frr route-policy VPN-FRR
</span></span><span class=line><span class=cl>  vpn-target 64812:345 both
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/1.10
</span></span><span class=line><span class=cl> ip binding vpn-instance entvpn
</span></span><span class=line><span class=cl> ip address 172.17.1.1 255.255.255.252 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>bgp 64812
</span></span><span class=line><span class=cl> #
</span></span><span class=line><span class=cl> ipv4-family vpn-instance entvpn 
</span></span><span class=line><span class=cl>  peer 172.17.1.2 as-number 62012 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>route-policy VPN-FRR permit node 10 
</span></span><span class=line><span class=cl> apply backup-nexthop auto
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>AR4</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>mpls lsr-id 1.1.1.4
</span></span><span class=line><span class=cl>mpls
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>mpls ldp
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/0
</span></span><span class=line><span class=cl> mpls
</span></span><span class=line><span class=cl> mpls ldp
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/2
</span></span><span class=line><span class=cl> pim sm
</span></span><span class=line><span class=cl> mpls
</span></span><span class=line><span class=cl> mpls ldp
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ip vpn-instance entvpn
</span></span><span class=line><span class=cl> ipv4-family
</span></span><span class=line><span class=cl>  route-distinguisher 64812:1
</span></span><span class=line><span class=cl>  vpn frr route-policy VPN-FRR
</span></span><span class=line><span class=cl>  vpn-target 64812:345 both
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet3/0/0.20
</span></span><span class=line><span class=cl> ip binding vpn-instance entvpn
</span></span><span class=line><span class=cl> ip address 172.17.2.1 255.255.255.252 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>bgp 64812
</span></span><span class=line><span class=cl> #
</span></span><span class=line><span class=cl> ipv4-family vpn-instance entvpn 
</span></span><span class=line><span class=cl>  peer 172.17.2.2 as-number 62012 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>route-policy VPN-FRR permit node 10 
</span></span><span class=line><span class=cl> apply backup-nexthop auto
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>CR1</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>mpls lsr-id 1.1.1.5
</span></span><span class=line><span class=cl>mpls
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>mpls ldp
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/0
</span></span><span class=line><span class=cl> mpls
</span></span><span class=line><span class=cl> mpls ldp
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/1
</span></span><span class=line><span class=cl> mpls
</span></span><span class=line><span class=cl> mpls ldp
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/2
</span></span><span class=line><span class=cl> mpls
</span></span><span class=line><span class=cl> mpls ldp
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>CR2</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>mpls lsr-id 1.1.1.6
</span></span><span class=line><span class=cl>mpls
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>mpls ldp
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/0
</span></span><span class=line><span class=cl> mpls
</span></span><span class=line><span class=cl> mpls ldp
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/1
</span></span><span class=line><span class=cl> mpls
</span></span><span class=line><span class=cl> mpls ldp
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/2
</span></span><span class=line><span class=cl> mpls
</span></span><span class=line><span class=cl> mpls ldp
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>LSW3</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ospf 100 
</span></span><span class=line><span class=cl> default-route-advertise
</span></span><span class=line><span class=cl> silent-interface Vlanif100
</span></span><span class=line><span class=cl> area 0.0.0.0 
</span></span><span class=line><span class=cl>  network 172.16.1.2 0.0.0.0 
</span></span><span class=line><span class=cl>  network 172.16.5.1 0.0.0.0 
</span></span><span class=line><span class=cl>  network 172.16.100.1 0.0.0.0 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>nqa test-instance toAR1 toAR1
</span></span><span class=line><span class=cl> test-type icmp
</span></span><span class=line><span class=cl> destination-address ipv4 172.16.1.1
</span></span><span class=line><span class=cl> frequency 5
</span></span><span class=line><span class=cl> interval seconds 1
</span></span><span class=line><span class=cl> timeout 1
</span></span><span class=line><span class=cl> probe-count 2
</span></span><span class=line><span class=cl> start now
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ip route-static 0.0.0.0 0.0.0.0 172.16.3.2 track nqa toAR1 toAR1
</span></span></code></pre></div></li><li><p>LSW4</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ospf 100 
</span></span><span class=line><span class=cl> default-route-advertise
</span></span><span class=line><span class=cl> silent-interface Vlanif101
</span></span><span class=line><span class=cl> area 0.0.0.0 
</span></span><span class=line><span class=cl>  network 172.16.2.2 0.0.0.0 
</span></span><span class=line><span class=cl>  network 172.16.5.2 0.0.0.0 
</span></span><span class=line><span class=cl>  network 172.16.101.1 0.0.0.0 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>nqa test-instance toAR2 toAR2
</span></span><span class=line><span class=cl> test-type icmp
</span></span><span class=line><span class=cl> destination-address ipv4 172.16.2.1
</span></span><span class=line><span class=cl> frequency 5
</span></span><span class=line><span class=cl> interval seconds 1
</span></span><span class=line><span class=cl> timeout 1
</span></span><span class=line><span class=cl> probe-count 2
</span></span><span class=line><span class=cl> start now
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ip route-static 0.0.0.0 0.0.0.0 172.16.4.2 track nqa toAR2 toAR2
</span></span></code></pre></div></li><li><p>LSW5</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>bgp</span> <span class=mi>62012</span>
</span></span><span class=line><span class=cl> <span class=n>peer</span> <span class=mf>172.17</span><span class=o>.</span><span class=mf>1.1</span> <span class=n>as</span><span class=o>-</span><span class=n>number</span> <span class=mi>64812</span> 
</span></span><span class=line><span class=cl> <span class=n>peer</span> <span class=mf>172.17</span><span class=o>.</span><span class=mf>2.1</span> <span class=n>as</span><span class=o>-</span><span class=n>number</span> <span class=mi>64812</span> 
</span></span><span class=line><span class=cl> <span class=c1>#</span>
</span></span><span class=line><span class=cl> <span class=n>ipv4</span><span class=o>-</span><span class=n>family</span> <span class=n>unicast</span>
</span></span><span class=line><span class=cl>  <span class=n>network</span> <span class=mf>172.17</span><span class=o>.</span><span class=mf>100.0</span> <span class=mf>255.255</span><span class=o>.</span><span class=mf>255.0</span> 
</span></span><span class=line><span class=cl>  <span class=n>maximum</span> <span class=nb>load</span><span class=o>-</span><span class=n>balancing</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>  <span class=n>peer</span> <span class=mf>172.17</span><span class=o>.</span><span class=mf>1.1</span> <span class=n>route</span><span class=o>-</span><span class=n>policy</span> <span class=n>AS_PATH_ODD</span> <span class=n>import</span>
</span></span><span class=line><span class=cl>  <span class=n>peer</span> <span class=mf>172.17</span><span class=o>.</span><span class=mf>2.1</span> <span class=n>route</span><span class=o>-</span><span class=n>policy</span> <span class=n>AS_PATH_EVEN</span> <span class=n>import</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>route</span><span class=o>-</span><span class=n>policy</span> <span class=n>AS_PATH_EVEN</span> <span class=n>permit</span> <span class=n>node</span> <span class=mi>10</span> 
</span></span><span class=line><span class=cl> <span class=k>if</span><span class=o>-</span><span class=n>match</span> <span class=n>acl</span> <span class=mi>2010</span> 
</span></span><span class=line><span class=cl> <span class=n>apply</span> <span class=n>as</span><span class=o>-</span><span class=n>path</span> <span class=mi>100</span> <span class=n>additive</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>route</span><span class=o>-</span><span class=n>policy</span> <span class=n>AS_PATH_EVEN</span> <span class=n>permit</span> <span class=n>node</span> <span class=mi>20</span> 
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>route</span><span class=o>-</span><span class=n>policy</span> <span class=n>AS_PATH_ODD</span> <span class=n>permit</span> <span class=n>node</span> <span class=mi>10</span> 
</span></span><span class=line><span class=cl> <span class=k>if</span><span class=o>-</span><span class=n>match</span> <span class=n>acl</span> <span class=mi>2020</span> 
</span></span><span class=line><span class=cl> <span class=n>apply</span> <span class=n>as</span><span class=o>-</span><span class=n>path</span> <span class=mi>100</span> <span class=n>additive</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>route</span><span class=o>-</span><span class=n>policy</span> <span class=n>AS_PATH_ODD</span> <span class=n>permit</span> <span class=n>node</span> <span class=mi>20</span> 
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>acl</span> <span class=n>number</span> <span class=mi>2010</span>  
</span></span><span class=line><span class=cl> <span class=n>rule</span> <span class=mi>5</span> <span class=n>permit</span> <span class=n>source</span> <span class=mf>172.16</span><span class=o>.</span><span class=mf>0.0</span> <span class=mf>0.0</span><span class=o>.</span><span class=mf>254.255</span> 
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=n>acl</span> <span class=n>number</span> <span class=mi>2020</span>  
</span></span><span class=line><span class=cl> <span class=n>rule</span> <span class=mi>5</span> <span class=n>permit</span> <span class=n>source</span> <span class=mf>172.16</span><span class=o>.</span><span class=mf>1.0</span> <span class=mf>0.0</span><span class=o>.</span><span class=mf>254.255</span> 
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span></code></pre></div></li><li><p>验证</p><ul><li><p>PC3 172.17.100.0/24 去往HQ的流量路径</p><p><div class=post-img-view><a data-fancybox=gallery href=https://s2.loli.net/2024/07/19/c5FrskDQpWo9xHa.png><img src=https://s2.loli.net/2024/07/19/c5FrskDQpWo9xHa.png loading=lazy alt=image-124208233></a></div></p></li><li><p>PC3 172.17.100.0/24 访问internet</p><p><div class=post-img-view><a data-fancybox=gallery href=https://s2.loli.net/2024/07/19/5pzSk7K6GmJawCO.png><img src=https://s2.loli.net/2024/07/19/5pzSk7K6GmJawCO.png loading=lazy alt=image-124336943></a></div></p></li><li><p>AR3查看FRR</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>[</span><span class=n>AR3</span><span class=p>]</span><span class=n>dis</span> <span class=n>ip</span> <span class=n>rou</span> <span class=n>vpn</span><span class=o>-</span><span class=n>instance</span> <span class=n>entvpn</span> <span class=mf>172.16</span><span class=o>.</span><span class=mf>100.0</span> <span class=n>v</span>
</span></span><span class=line><span class=cl><span class=n>Route</span> <span class=n>Flags</span><span class=p>:</span> <span class=n>R</span> <span class=o>-</span> <span class=n>relay</span><span class=p>,</span> <span class=n>D</span> <span class=o>-</span> <span class=n>download</span> <span class=n>to</span> <span class=n>fib</span>
</span></span><span class=line><span class=cl><span class=o>------------------------------------------------------------------------------</span>
</span></span><span class=line><span class=cl><span class=n>Routing</span> <span class=n>Table</span> <span class=p>:</span> <span class=n>entvpn</span>
</span></span><span class=line><span class=cl><span class=n>Summary</span> <span class=n>Count</span> <span class=p>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Destination</span><span class=p>:</span> <span class=mf>172.16</span><span class=o>.</span><span class=mf>100.0</span><span class=o>/</span><span class=mi>24</span>
</span></span><span class=line><span class=cl>     <span class=n>Protocol</span><span class=p>:</span> <span class=n>IBGP</span>             <span class=n>Process</span> <span class=n>ID</span><span class=p>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>   <span class=n>Preference</span><span class=p>:</span> <span class=mi>255</span>                    <span class=n>Cost</span><span class=p>:</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>      <span class=n>NextHop</span><span class=p>:</span> <span class=mf>1.1</span><span class=o>.</span><span class=mf>1.1</span>           <span class=n>Neighbour</span><span class=p>:</span> <span class=mf>1.1</span><span class=o>.</span><span class=mf>1.5</span>
</span></span><span class=line><span class=cl>        <span class=n>State</span><span class=p>:</span> <span class=n>Active</span> <span class=n>Adv</span> <span class=n>Relied</span>       <span class=n>Age</span><span class=p>:</span> <span class=mi>00</span><span class=n>h01m41s</span>
</span></span><span class=line><span class=cl>          <span class=n>Tag</span><span class=p>:</span> <span class=mi>0</span>                  <span class=n>Priority</span><span class=p>:</span> <span class=n>low</span>
</span></span><span class=line><span class=cl>        <span class=ne>Label</span><span class=p>:</span> <span class=mi>1054</span>                <span class=n>QoSInfo</span><span class=p>:</span> <span class=mh>0x0</span>
</span></span><span class=line><span class=cl>   <span class=n>IndirectID</span><span class=p>:</span> <span class=mh>0x10</span>             
</span></span><span class=line><span class=cl> <span class=n>RelayNextHop</span><span class=p>:</span> <span class=mf>10.3</span><span class=o>.</span><span class=mf>5.1</span>          <span class=n>Interface</span><span class=p>:</span> <span class=n>GigabitEthernet0</span><span class=o>/</span><span class=mi>0</span><span class=o>/</span><span class=mi>2</span>
</span></span><span class=line><span class=cl>     <span class=n>TunnelID</span><span class=p>:</span> <span class=mh>0x1</span>                   <span class=n>Flags</span><span class=p>:</span> <span class=n>RD</span>
</span></span><span class=line><span class=cl>    <span class=n>BkNextHop</span><span class=p>:</span> <span class=mf>1.1</span><span class=o>.</span><span class=mf>1.2</span>         <span class=n>BkInterface</span><span class=p>:</span> <span class=n>GigabitEthernet0</span><span class=o>/</span><span class=mi>0</span><span class=o>/</span><span class=mi>2</span>
</span></span><span class=line><span class=cl>      <span class=n>BkLabel</span><span class=p>:</span> <span class=mi>1053</span>            <span class=n>SecTunnelID</span><span class=p>:</span> <span class=mh>0x0</span>              
</span></span><span class=line><span class=cl> <span class=n>BkPETunnelID</span><span class=p>:</span> <span class=mh>0x3</span>         <span class=n>BkPESecTunnelID</span><span class=p>:</span> <span class=mh>0x0</span>              
</span></span><span class=line><span class=cl> <span class=n>BkIndirectID</span><span class=p>:</span> <span class=mh>0x14</span>      
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>AR3</span><span class=p>]</span>
</span></span></code></pre></div></li></ul></li></ul><h3 id=47-task-7-service-deployment-for-communication-between-the-enterprise-and-data-center-servers>4.7 Task 7: Service Deployment for Communication Between the Enterprise and Data Center Servers</h3><h4 id=471-configuring-a-virtual-system-on-the-firewall>4.7.1 Configuring a Virtual System on the Firewall</h4><ul><li><p>FW1配置vsys，服务OA server，鼠标点点也挺快</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>vsys enable                               
</span></span><span class=line><span class=cl>resource-class ent_resource
</span></span><span class=line><span class=cl> resource-item-limit session reserved-number 1000 maximum 5000
</span></span><span class=line><span class=cl> resource-item-limit bandwidth 8 outbound
</span></span><span class=line><span class=cl> resource-item-limit policy reserved-number 200
</span></span><span class=line><span class=cl> resource-item-limit user reserved-number 100
</span></span><span class=line><span class=cl> resource-item-limit l2tp-tunnel reserved-number 10
</span></span><span class=line><span class=cl> resource-item-limit ipsec-tunnel reserved-number 10 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl># 绑定vpn-instance，重新配置IP地址
</span></span><span class=line><span class=cl>vsys name entvsys
</span></span><span class=line><span class=cl> assign interface LoopBack0
</span></span><span class=line><span class=cl> assign interface GigabitEthernet1/0/1.50
</span></span><span class=line><span class=cl> assign interface GigabitEthernet1/0/1.60
</span></span><span class=line><span class=cl> assign interface GigabitEthernet1/0/2.50
</span></span><span class=line><span class=cl> assign interface GigabitEthernet1/0/2.60
</span></span><span class=line><span class=cl> assign resource-class ent_resource
</span></span><span class=line><span class=cl>#                                         
</span></span><span class=line><span class=cl>firewall zone trust
</span></span><span class=line><span class=cl> add interface GigabitEthernet1/0/1.50
</span></span><span class=line><span class=cl> add interface GigabitEthernet1/0/2.50
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>firewall zone untrust
</span></span><span class=line><span class=cl> add interface GigabitEthernet1/0/1.60
</span></span><span class=line><span class=cl> add interface GigabitEthernet1/0/2.60
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li></ul><h4 id=472-connecting-the-oa-server-to-the-network>4.7.2 Connecting the OA Server to the Network</h4><ul><li>LSW1/LSW2配置vrf entvpn，vlanif100 划入entvpn</li><li>vrrp配置，virtual-ip 192.168.100.1/24，LSW1 master，优先级120，抢占延迟20s</li><li>LSW1 track G0/0/1 接口，中断后优先级减21，LSW2抢占为master</li><li>配置出向路由，交换机默认路由指向FW1；FW1的vsys entvsys，配置出向的主备份路由</li><li>配置入向路由，交换机配置指向100.1.1.10/32 的静态路由指向FW1；FW1配置去往OA192.168.100.0/24的主备路由</li></ul><hr><ul><li><p>LSW1</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ip vpn-instance entvpn
</span></span><span class=line><span class=cl> ipv4-family
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface Vlanif100
</span></span><span class=line><span class=cl> description VPN-entvpn
</span></span><span class=line><span class=cl> ip binding vpn-instance entvpn
</span></span><span class=line><span class=cl> ip address 192.168.100.8 255.255.255.0 
</span></span><span class=line><span class=cl> vrrp vrid 1 virtual-ip 192.168.100.1
</span></span><span class=line><span class=cl> vrrp vrid 1 priority 120
</span></span><span class=line><span class=cl> vrrp vrid 1 preempt-mode timer delay 20
</span></span><span class=line><span class=cl> vrrp vrid 1 track interface GigabitEthernet0/0/1 reduced 21
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface Vlanif50
</span></span><span class=line><span class=cl> description VPN-entvpn
</span></span><span class=line><span class=cl> ip binding vpn-instance entvpn
</span></span><span class=line><span class=cl> ip address 192.168.5.1 255.255.255.252 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ip route-static 100.1.1.10 255.255.255.255 100.1.6.2
</span></span><span class=line><span class=cl>ip route-static vpn-instance entvpn 0.0.0.0 0.0.0.0 192.168.5.2
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>LSW2</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ip vpn-instance entvpn
</span></span><span class=line><span class=cl> ipv4-family
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface Vlanif100
</span></span><span class=line><span class=cl> description VPN-entvpn
</span></span><span class=line><span class=cl> ip binding vpn-instance entvpn
</span></span><span class=line><span class=cl> ip address 192.168.100.9 255.255.255.0 
</span></span><span class=line><span class=cl> vrrp vrid 1 virtual-ip 192.168.100.1
</span></span><span class=line><span class=cl> vrrp vrid 1 preempt-mode timer delay 20
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface Vlanif50
</span></span><span class=line><span class=cl> description VPN-entvpn
</span></span><span class=line><span class=cl> ip binding vpn-instance entvpn
</span></span><span class=line><span class=cl> ip address 192.168.50.1 255.255.255.252 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ip route-static 100.1.1.10 255.255.255.255 100.1.60.2
</span></span><span class=line><span class=cl>ip route-static vpn-instance entvpn 0.0.0.0 0.0.0.0 192.168.50.2
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>FW1</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>switch vsys entvsys 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ip route-static 0.0.0.0 0.0.0.0 100.1.6.1
</span></span><span class=line><span class=cl>ip route-static 0.0.0.0 0.0.0.0 100.1.60.1 preference 90
</span></span><span class=line><span class=cl>ip route-static 192.168.100.0 255.255.255.0 192.168.5.1
</span></span><span class=line><span class=cl>ip route-static 192.168.100.0 255.255.255.0 192.168.50.1 preference 90
</span></span></code></pre></div></li></ul><h4 id=473-configuring-ipsec-tunnels>4.7.3 Configuring IPsec Tunnels</h4><ul><li>配置172.16.100.0/24和172.17.100.0/24 走ipsec访问OA 192.168.100.0/24</li><li>使用IKE 协商模式</li><li>自动触发建立隧道</li><li>看图表设置参数</li></ul><hr><ul><li><p>AR1</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>bgp 64812
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl> ipv4-family unicast
</span></span><span class=line><span class=cl>  network 200.1.6.0 255.255.255.252 
</span></span></code></pre></div></li><li><p>AR2</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>bgp 64812
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl> ipv4-family unicast
</span></span><span class=line><span class=cl>  network 200.1.7.0 255.255.255.252 
</span></span></code></pre></div></li><li><p>LSW1</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl> #
</span></span><span class=line><span class=cl> bgp 62022
</span></span><span class=line><span class=cl> #
</span></span><span class=line><span class=cl> ipv4-family unicast
</span></span><span class=line><span class=cl>  network 100.1.6.0 255.255.255.252
</span></span></code></pre></div></li><li><p>LSW2</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl> #
</span></span><span class=line><span class=cl> bgp 62022
</span></span><span class=line><span class=cl> #
</span></span><span class=line><span class=cl> ipv4-family unicast
</span></span><span class=line><span class=cl>  network 100.1.60.0 255.255.255.252
</span></span></code></pre></div></li><li><p>FW1</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>acl number 3000
</span></span><span class=line><span class=cl> rule 5 permit ip source 192.168.100.0 0.0.0.255 destination 172.16.100.0 0.0.0.255 
</span></span><span class=line><span class=cl> rule 10 permit ip source 192.168.100.0 0.0.0.255 destination 172.17.100.0 0.0.0.255 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ipsec proposal ipsec_proposal
</span></span><span class=line><span class=cl> esp authentication-algorithm sha2-256 
</span></span><span class=line><span class=cl> esp encryption-algorithm aes-256 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ike proposal 10
</span></span><span class=line><span class=cl> encryption-algorithm aes-256 
</span></span><span class=line><span class=cl> dh group14 
</span></span><span class=line><span class=cl> authentication-algorithm sha2-256 
</span></span><span class=line><span class=cl> authentication-method pre-share
</span></span><span class=line><span class=cl> integrity-algorithm hmac-sha2-256 
</span></span><span class=line><span class=cl> prf hmac-sha2-256 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ike peer fw0201
</span></span><span class=line><span class=cl> pre-shared-key Huawei@123
</span></span><span class=line><span class=cl> ike-proposal 10
</span></span><span class=line><span class=cl> remote-id-type any
</span></span><span class=line><span class=cl> remote-address 200.1.6.2 
</span></span><span class=line><span class=cl>ike peer fw0202
</span></span><span class=line><span class=cl> pre-shared-key Huawei@123
</span></span><span class=line><span class=cl> ike-proposal 10
</span></span><span class=line><span class=cl> remote-id-type any
</span></span><span class=line><span class=cl> remote-address 200.1.7.2 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ipsec policy ipsec01 10 isakmp
</span></span><span class=line><span class=cl> security acl 3000
</span></span><span class=line><span class=cl> ike-peer fw0201
</span></span><span class=line><span class=cl> proposal ipsec_proposal
</span></span><span class=line><span class=cl>ipsec policy ipsec02 10 isakmp
</span></span><span class=line><span class=cl> security acl 3000
</span></span><span class=line><span class=cl> ike-peer fw0202
</span></span><span class=line><span class=cl> proposal ipsec_proposal
</span></span><span class=line><span class=cl> # undo policy enable # 策略禁用命令
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet1/0/1.60
</span></span><span class=line><span class=cl> ipsec policy ipsec01
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet1/0/2.60
</span></span><span class=line><span class=cl> ipsec policy ipsec02
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>security-policy
</span></span><span class=line><span class=cl> rule name ipsec_in_sp
</span></span><span class=line><span class=cl>  source-zone untrust
</span></span><span class=line><span class=cl>  destination-zone local
</span></span><span class=line><span class=cl>  source-address 200.1.6.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  source-address 200.1.7.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  action permit
</span></span><span class=line><span class=cl> rule name ipsec_out_sp
</span></span><span class=line><span class=cl>  source-zone local
</span></span><span class=line><span class=cl>  destination-zone untrust
</span></span><span class=line><span class=cl>  destination-address 200.1.6.2 mask 255.255.255.255
</span></span><span class=line><span class=cl>  destination-address 200.1.7.2 mask 255.255.255.255
</span></span><span class=line><span class=cl>  action permit
</span></span><span class=line><span class=cl> rule name trust2untrust
</span></span><span class=line><span class=cl>  source-zone trust
</span></span><span class=line><span class=cl>  destination-zone untrust
</span></span><span class=line><span class=cl>  source-address 192.168.100.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  destination-address 172.16.100.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  destination-address 172.17.100.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  action permit
</span></span><span class=line><span class=cl> rule name untrust2trust
</span></span><span class=line><span class=cl>  source-zone untrust
</span></span><span class=line><span class=cl>  destination-zone trust
</span></span><span class=line><span class=cl>  source-address 172.16.100.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  source-address 172.17.100.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  destination-address 192.168.100.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  action permit
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>FW2</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>acl number 3000
</span></span><span class=line><span class=cl> rule 5 permit ip source 172.16.100.0 0.0.0.255 destination 192.168.100.0 0.0.0.255 
</span></span><span class=line><span class=cl> rule 10 permit ip source 172.17.100.0 0.0.0.255 destination 192.168.100.0 0.0.0.255 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ipsec proposal ipsec_proposal # 使用默认值，不用敲以下2行命令
</span></span><span class=line><span class=cl> esp authentication-algorithm sha2-256 
</span></span><span class=line><span class=cl> esp encryption-algorithm aes-256 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ike proposal 10 # 使用默认值，不用敲以下6行命令
</span></span><span class=line><span class=cl> encryption-algorithm aes-256 
</span></span><span class=line><span class=cl> dh group14 
</span></span><span class=line><span class=cl> authentication-algorithm sha2-256 
</span></span><span class=line><span class=cl> authentication-method pre-share
</span></span><span class=line><span class=cl> integrity-algorithm hmac-sha2-256 
</span></span><span class=line><span class=cl> prf hmac-sha2-256 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ike peer fw0101
</span></span><span class=line><span class=cl> pre-shared-key Huawei@123
</span></span><span class=line><span class=cl> ike-proposal 10
</span></span><span class=line><span class=cl> remote-id-type any
</span></span><span class=line><span class=cl> remote-address 100.1.6.2 
</span></span><span class=line><span class=cl>ike peer fw0102
</span></span><span class=line><span class=cl> pre-shared-key Huawei@123
</span></span><span class=line><span class=cl> ike-proposal 10
</span></span><span class=line><span class=cl> remote-id-type any
</span></span><span class=line><span class=cl> remote-address 100.1.60.2 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>ipsec policy ipsec01 10 isakmp
</span></span><span class=line><span class=cl> security acl 3000
</span></span><span class=line><span class=cl> ike-peer fw0101
</span></span><span class=line><span class=cl> proposal ipsec_proposal
</span></span><span class=line><span class=cl>ipsec policy ipsec02 10 isakmp
</span></span><span class=line><span class=cl> security acl 3000
</span></span><span class=line><span class=cl> ike-peer fw0102
</span></span><span class=line><span class=cl> proposal ipsec_proposal
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet1/0/3.60
</span></span><span class=line><span class=cl> ipsec policy ipsec01
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet1/0/4.70
</span></span><span class=line><span class=cl> ipsec policy ipsec02
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>security-policy
</span></span><span class=line><span class=cl> rule name trust2untrust01
</span></span><span class=line><span class=cl>  source-zone trust
</span></span><span class=line><span class=cl>  destination-zone untrust
</span></span><span class=line><span class=cl>  source-address 172.16.100.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  source-address 172.17.100.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  profile ips Profile_ips_pc
</span></span><span class=line><span class=cl>  action permit
</span></span><span class=line><span class=cl> rule name trust2untrust02
</span></span><span class=line><span class=cl>  source-zone trust
</span></span><span class=line><span class=cl>  destination-zone untrust
</span></span><span class=line><span class=cl>  source-address 172.16.101.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  destination-address 192.168.100.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  action permit
</span></span><span class=line><span class=cl> rule name ipsec_out_sp
</span></span><span class=line><span class=cl>  source-zone local
</span></span><span class=line><span class=cl>  destination-zone untrust
</span></span><span class=line><span class=cl>  destination-address 100.1.6.2 mask 255.255.255.255
</span></span><span class=line><span class=cl>  destination-address 100.1.60.2 mask 255.255.255.255
</span></span><span class=line><span class=cl>  action permit
</span></span><span class=line><span class=cl> rule name ipsec_in_sp
</span></span><span class=line><span class=cl>  source-zone untrust
</span></span><span class=line><span class=cl>  destination-zone local
</span></span><span class=line><span class=cl>  source-address 100.1.6.2 mask 255.255.255.255
</span></span><span class=line><span class=cl>  source-address 100.1.60.2 mask 255.255.255.255
</span></span><span class=line><span class=cl>  action permit
</span></span><span class=line><span class=cl> rule name untrust2trust
</span></span><span class=line><span class=cl>  source-zone untrust
</span></span><span class=line><span class=cl>  destination-zone trust
</span></span><span class=line><span class=cl>  source-address 192.168.100.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  destination-address 172.16.100.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  destination-address 172.17.100.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  action permit
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>校验</p><ul><li><p>dis ipsec sa</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[FW1-entvsys]dis ipsec sa
</span></span><span class=line><span class=cl>2024-07-17 09:00:34.530 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ipsec sa information:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>===============================
</span></span><span class=line><span class=cl>Interface: GigabitEthernet1/0/1.60
</span></span><span class=line><span class=cl>===============================
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  -----------------------------
</span></span><span class=line><span class=cl>  IPSec policy name: &#34;ipsec01&#34;
</span></span><span class=line><span class=cl>  Sequence number  : 10
</span></span><span class=line><span class=cl>  Acl group        : 3000
</span></span><span class=line><span class=cl>  Acl rule         : 5
</span></span><span class=line><span class=cl>  Mode             : ISAKMP
</span></span><span class=line><span class=cl>  -----------------------------
</span></span><span class=line><span class=cl>    Connection ID     : 7
</span></span><span class=line><span class=cl>    Encapsulation mode: Tunnel
</span></span><span class=line><span class=cl>    Holding time      : 0d 1h 12m 55s
</span></span><span class=line><span class=cl>    Tunnel local      : 100.1.6.2:500
</span></span><span class=line><span class=cl>    Tunnel remote     : 200.1.6.2:500
</span></span><span class=line><span class=cl>    Flow source       : 192.168.100.0/255.255.255.0 0/0-65535
</span></span><span class=line><span class=cl>    Flow destination  : 172.16.100.0/255.255.255.0 0/0-65535
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    [Outbound ESP SAs] 
</span></span><span class=line><span class=cl>      SPI: 199477355 (0xbe3c86b)
</span></span><span class=line><span class=cl>      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
</span></span><span class=line><span class=cl>      SA remaining key duration (kilobytes/sec): 10485721/2324
</span></span><span class=line><span class=cl>      Max sent sequence-number: 665       
</span></span><span class=line><span class=cl>      UDP encapsulation used for NAT traversal: N
</span></span><span class=line><span class=cl>      SA encrypted packets (number/bytes): 664/39936
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    [Inbound ESP SAs] 
</span></span><span class=line><span class=cl>      SPI: 187864131 (0xb329443)
</span></span><span class=line><span class=cl>      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
</span></span><span class=line><span class=cl>      SA remaining key duration (kilobytes/sec): 10485760/2324
</span></span><span class=line><span class=cl>      Max received sequence-number: 1
</span></span><span class=line><span class=cl>      UDP encapsulation used for NAT traversal: N
</span></span><span class=line><span class=cl>      SA decrypted packets (number/bytes): 0/0
</span></span><span class=line><span class=cl>      Anti-replay : Enable
</span></span><span class=line><span class=cl>      Anti-replay window size: 1024
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  -----------------------------
</span></span><span class=line><span class=cl>  IPSec policy name: &#34;ipsec01&#34;
</span></span><span class=line><span class=cl>  Sequence number  : 10
</span></span><span class=line><span class=cl>  Acl group        : 3000
</span></span><span class=line><span class=cl>  Acl rule         : 10
</span></span><span class=line><span class=cl>  Mode             : ISAKMP
</span></span><span class=line><span class=cl>  -----------------------------
</span></span><span class=line><span class=cl>    Connection ID     : 6
</span></span><span class=line><span class=cl>    Encapsulation mode: Tunnel
</span></span><span class=line><span class=cl>    Holding time      : 0d 0h 39m 25s
</span></span><span class=line><span class=cl>    Tunnel local      : 100.1.6.2:500     
</span></span><span class=line><span class=cl>    Tunnel remote     : 200.1.6.2:500
</span></span><span class=line><span class=cl>    Flow source       : 192.168.100.0/255.255.255.0 0/0-65535
</span></span><span class=line><span class=cl>    Flow destination  : 172.17.100.0/255.255.255.0 0/0-65535
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    [Outbound ESP SAs] 
</span></span><span class=line><span class=cl>      SPI: 192541812 (0xb79f474)
</span></span><span class=line><span class=cl>      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
</span></span><span class=line><span class=cl>      SA remaining key duration (kilobytes/sec): 10485722/1237
</span></span><span class=line><span class=cl>      Max sent sequence-number: 666
</span></span><span class=line><span class=cl>      UDP encapsulation used for NAT traversal: N
</span></span><span class=line><span class=cl>      SA encrypted packets (number/bytes): 665/39900
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    [Inbound ESP SAs] 
</span></span><span class=line><span class=cl>      SPI: 186945386 (0xb248f6a)
</span></span><span class=line><span class=cl>      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
</span></span><span class=line><span class=cl>      SA remaining key duration (kilobytes/sec): 10485754/1237
</span></span><span class=line><span class=cl>      Max received sequence-number: 64
</span></span><span class=line><span class=cl>      UDP encapsulation used for NAT traversal: N
</span></span><span class=line><span class=cl>      SA decrypted packets (number/bytes): 106/6360
</span></span><span class=line><span class=cl>      Anti-replay : Enable
</span></span><span class=line><span class=cl>      Anti-replay window size: 1024
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>===============================
</span></span><span class=line><span class=cl>Interface: GigabitEthernet1/0/2.60        
</span></span><span class=line><span class=cl>===============================
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  -----------------------------
</span></span><span class=line><span class=cl>  IPSec policy name: &#34;ipsec02&#34;
</span></span><span class=line><span class=cl>  Sequence number  : 10
</span></span><span class=line><span class=cl>  Acl group        : 3000
</span></span><span class=line><span class=cl>  Acl rule         : 5
</span></span><span class=line><span class=cl>  Mode             : ISAKMP
</span></span><span class=line><span class=cl>  -----------------------------
</span></span><span class=line><span class=cl>    Connection ID     : 8
</span></span><span class=line><span class=cl>    Encapsulation mode: Tunnel
</span></span><span class=line><span class=cl>    Holding time      : 0d 0h 53m 39s
</span></span><span class=line><span class=cl>    Tunnel local      : 100.1.60.2:500
</span></span><span class=line><span class=cl>    Tunnel remote     : 200.1.7.2:500
</span></span><span class=line><span class=cl>    Flow source       : 192.168.100.0/255.255.255.0 0/0-65535
</span></span><span class=line><span class=cl>    Flow destination  : 172.16.100.0/255.255.255.0 0/0-65535
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    [Outbound ESP SAs] 
</span></span><span class=line><span class=cl>      SPI: 195126685 (0xba1659d)
</span></span><span class=line><span class=cl>      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
</span></span><span class=line><span class=cl>      SA remaining key duration (kilobytes/sec): 10485760/3407
</span></span><span class=line><span class=cl>      Max sent sequence-number: 1
</span></span><span class=line><span class=cl>      UDP encapsulation used for NAT traversal: N
</span></span><span class=line><span class=cl>      SA encrypted packets (number/bytes): 0/0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    [Inbound ESP SAs] 
</span></span><span class=line><span class=cl>      SPI: 195412318 (0xba5c15e)
</span></span><span class=line><span class=cl>      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
</span></span><span class=line><span class=cl>      SA remaining key duration (kilobytes/sec): 10485753/3407
</span></span><span class=line><span class=cl>      Max received sequence-number: 128
</span></span><span class=line><span class=cl>      UDP encapsulation used for NAT traversal: N
</span></span><span class=line><span class=cl>      SA decrypted packets (number/bytes): 133/7980
</span></span><span class=line><span class=cl>      Anti-replay : Enable
</span></span><span class=line><span class=cl>      Anti-replay window size: 1024
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  -----------------------------
</span></span><span class=line><span class=cl>  IPSec policy name: &#34;ipsec02&#34;
</span></span><span class=line><span class=cl>  Sequence number  : 10
</span></span><span class=line><span class=cl>  Acl group        : 3000
</span></span><span class=line><span class=cl>  Acl rule         : 10
</span></span><span class=line><span class=cl>  Mode             : ISAKMP
</span></span><span class=line><span class=cl>  -----------------------------
</span></span><span class=line><span class=cl>    Connection ID     : 5
</span></span><span class=line><span class=cl>    Encapsulation mode: Tunnel
</span></span><span class=line><span class=cl>    Holding time      : 0d 0h 42m 10s
</span></span><span class=line><span class=cl>    Tunnel local      : 100.1.60.2:500
</span></span><span class=line><span class=cl>    Tunnel remote     : 200.1.7.2:500
</span></span><span class=line><span class=cl>    Flow source       : 192.168.100.0/255.255.255.0 0/0-65535
</span></span><span class=line><span class=cl>    Flow destination  : 172.17.100.0/255.255.255.0 0/0-65535
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    [Outbound ESP SAs] 
</span></span><span class=line><span class=cl>      SPI: 184686406 (0xb021746)
</span></span><span class=line><span class=cl>      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
</span></span><span class=line><span class=cl>      SA remaining key duration (kilobytes/sec): 10485760/1071
</span></span><span class=line><span class=cl>      Max sent sequence-number: 1
</span></span><span class=line><span class=cl>      UDP encapsulation used for NAT traversal: N
</span></span><span class=line><span class=cl>      SA encrypted packets (number/bytes): 0/0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    [Inbound ESP SAs] 
</span></span><span class=line><span class=cl>      SPI: 187927920 (0xb338d70)
</span></span><span class=line><span class=cl>      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
</span></span><span class=line><span class=cl>      SA remaining key duration (kilobytes/sec): 10485699/1071
</span></span><span class=line><span class=cl>      Max received sequence-number: 1216
</span></span><span class=line><span class=cl>      UDP encapsulation used for NAT traversal: N
</span></span><span class=line><span class=cl>      SA decrypted packets (number/bytes): 1044/63024
</span></span><span class=line><span class=cl>      Anti-replay : Enable
</span></span><span class=line><span class=cl>      Anti-replay window size: 1024
</span></span><span class=line><span class=cl>[FW1-entvsys] 
</span></span></code></pre></div></li><li><p>dis ipsec sa</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[FW2]dis ipsec sa
</span></span><span class=line><span class=cl>2024-07-17 09:01:41.270 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ipsec sa information:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>===============================
</span></span><span class=line><span class=cl>Interface: GigabitEthernet1/0/3.60
</span></span><span class=line><span class=cl>===============================
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  -----------------------------
</span></span><span class=line><span class=cl>  IPSec policy name: &#34;ipsec01&#34;
</span></span><span class=line><span class=cl>  Sequence number  : 10
</span></span><span class=line><span class=cl>  Acl group        : 3000
</span></span><span class=line><span class=cl>  Acl rule         : 5
</span></span><span class=line><span class=cl>  Mode             : ISAKMP
</span></span><span class=line><span class=cl>  -----------------------------
</span></span><span class=line><span class=cl>    Connection ID     : 47
</span></span><span class=line><span class=cl>    Encapsulation mode: Tunnel
</span></span><span class=line><span class=cl>    Holding time      : 0d 1h 14m 2s
</span></span><span class=line><span class=cl>    Tunnel local      : 200.1.6.2:500
</span></span><span class=line><span class=cl>    Tunnel remote     : 100.1.6.2:500
</span></span><span class=line><span class=cl>    Flow source       : 172.16.100.0/255.255.255.0 0/0-65535
</span></span><span class=line><span class=cl>    Flow destination  : 192.168.100.0/255.255.255.0 0/0-65535
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    [Outbound ESP SAs] 
</span></span><span class=line><span class=cl>      SPI: 187864131 (0xb329443)
</span></span><span class=line><span class=cl>      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
</span></span><span class=line><span class=cl>      SA remaining key duration (kilobytes/sec): 10485760/2257
</span></span><span class=line><span class=cl>      Max sent sequence-number: 1         
</span></span><span class=line><span class=cl>      UDP encapsulation used for NAT traversal: N
</span></span><span class=line><span class=cl>      SA encrypted packets (number/bytes): 0/0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    [Inbound ESP SAs] 
</span></span><span class=line><span class=cl>      SPI: 199477355 (0xbe3c86b)
</span></span><span class=line><span class=cl>      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
</span></span><span class=line><span class=cl>      SA remaining key duration (kilobytes/sec): 10485719/2257
</span></span><span class=line><span class=cl>      Max received sequence-number: 704
</span></span><span class=line><span class=cl>      UDP encapsulation used for NAT traversal: N
</span></span><span class=line><span class=cl>      SA decrypted packets (number/bytes): 708/42576
</span></span><span class=line><span class=cl>      Anti-replay : Enable
</span></span><span class=line><span class=cl>      Anti-replay window size: 1024
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  -----------------------------
</span></span><span class=line><span class=cl>  IPSec policy name: &#34;ipsec01&#34;
</span></span><span class=line><span class=cl>  Sequence number  : 10
</span></span><span class=line><span class=cl>  Acl group        : 3000
</span></span><span class=line><span class=cl>  Acl rule         : 10
</span></span><span class=line><span class=cl>  Mode             : ISAKMP
</span></span><span class=line><span class=cl>  -----------------------------
</span></span><span class=line><span class=cl>    Connection ID     : 45
</span></span><span class=line><span class=cl>    Encapsulation mode: Tunnel
</span></span><span class=line><span class=cl>    Holding time      : 0d 0h 40m 31s
</span></span><span class=line><span class=cl>    Tunnel local      : 200.1.6.2:500     
</span></span><span class=line><span class=cl>    Tunnel remote     : 100.1.6.2:500
</span></span><span class=line><span class=cl>    Flow source       : 172.17.100.0/255.255.255.0 0/0-65535
</span></span><span class=line><span class=cl>    Flow destination  : 192.168.100.0/255.255.255.0 0/0-65535
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    [Outbound ESP SAs] 
</span></span><span class=line><span class=cl>      SPI: 186945386 (0xb248f6a)
</span></span><span class=line><span class=cl>      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
</span></span><span class=line><span class=cl>      SA remaining key duration (kilobytes/sec): 10485754/1170
</span></span><span class=line><span class=cl>      Max sent sequence-number: 107
</span></span><span class=line><span class=cl>      UDP encapsulation used for NAT traversal: N
</span></span><span class=line><span class=cl>      SA encrypted packets (number/bytes): 106/6360
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    [Inbound ESP SAs] 
</span></span><span class=line><span class=cl>      SPI: 192541812 (0xb79f474)
</span></span><span class=line><span class=cl>      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
</span></span><span class=line><span class=cl>      SA remaining key duration (kilobytes/sec): 10485719/1170
</span></span><span class=line><span class=cl>      Max received sequence-number: 704
</span></span><span class=line><span class=cl>      UDP encapsulation used for NAT traversal: N
</span></span><span class=line><span class=cl>      SA decrypted packets (number/bytes): 707/42420
</span></span><span class=line><span class=cl>      Anti-replay : Enable
</span></span><span class=line><span class=cl>      Anti-replay window size: 1024
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>===============================
</span></span><span class=line><span class=cl>Interface: GigabitEthernet1/0/4.70        
</span></span><span class=line><span class=cl>===============================
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  -----------------------------
</span></span><span class=line><span class=cl>  IPSec policy name: &#34;ipsec02&#34;
</span></span><span class=line><span class=cl>  Sequence number  : 10
</span></span><span class=line><span class=cl>  Acl group        : 3000
</span></span><span class=line><span class=cl>  Acl rule         : 5
</span></span><span class=line><span class=cl>  Mode             : ISAKMP
</span></span><span class=line><span class=cl>  -----------------------------
</span></span><span class=line><span class=cl>    Connection ID     : 48
</span></span><span class=line><span class=cl>    Encapsulation mode: Tunnel
</span></span><span class=line><span class=cl>    Holding time      : 0d 0h 54m 40s
</span></span><span class=line><span class=cl>    Tunnel local      : 200.1.7.2:500
</span></span><span class=line><span class=cl>    Tunnel remote     : 100.1.60.2:500
</span></span><span class=line><span class=cl>    Flow source       : 172.16.100.0/255.255.255.0 0/0-65535
</span></span><span class=line><span class=cl>    Flow destination  : 192.168.100.0/255.255.255.0 0/0-65535
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    [Outbound ESP SAs] 
</span></span><span class=line><span class=cl>      SPI: 195412318 (0xba5c15e)
</span></span><span class=line><span class=cl>      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
</span></span><span class=line><span class=cl>      SA remaining key duration (kilobytes/sec): 10485750/3347
</span></span><span class=line><span class=cl>      Max sent sequence-number: 178
</span></span><span class=line><span class=cl>      UDP encapsulation used for NAT traversal: N
</span></span><span class=line><span class=cl>      SA encrypted packets (number/bytes): 177/10620
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    [Inbound ESP SAs] 
</span></span><span class=line><span class=cl>      SPI: 195126685 (0xba1659d)
</span></span><span class=line><span class=cl>      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
</span></span><span class=line><span class=cl>      SA remaining key duration (kilobytes/sec): 10485760/3347
</span></span><span class=line><span class=cl>      Max received sequence-number: 1
</span></span><span class=line><span class=cl>      UDP encapsulation used for NAT traversal: N
</span></span><span class=line><span class=cl>      SA decrypted packets (number/bytes): 0/0
</span></span><span class=line><span class=cl>      Anti-replay : Enable
</span></span><span class=line><span class=cl>      Anti-replay window size: 1024
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  -----------------------------
</span></span><span class=line><span class=cl>  IPSec policy name: &#34;ipsec02&#34;
</span></span><span class=line><span class=cl>  Sequence number  : 10
</span></span><span class=line><span class=cl>  Acl group        : 3000
</span></span><span class=line><span class=cl>  Acl rule         : 10
</span></span><span class=line><span class=cl>  Mode             : ISAKMP
</span></span><span class=line><span class=cl>  -----------------------------
</span></span><span class=line><span class=cl>    Connection ID     : 44
</span></span><span class=line><span class=cl>    Encapsulation mode: Tunnel
</span></span><span class=line><span class=cl>    Holding time      : 0d 0h 43m 11s
</span></span><span class=line><span class=cl>    Tunnel local      : 200.1.7.2:500
</span></span><span class=line><span class=cl>    Tunnel remote     : 100.1.60.2:500
</span></span><span class=line><span class=cl>    Flow source       : 172.17.100.0/255.255.255.0 0/0-65535
</span></span><span class=line><span class=cl>    Flow destination  : 192.168.100.0/255.255.255.0 0/0-65535
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    [Outbound ESP SAs] 
</span></span><span class=line><span class=cl>      SPI: 187927920 (0xb338d70)
</span></span><span class=line><span class=cl>      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
</span></span><span class=line><span class=cl>      SA remaining key duration (kilobytes/sec): 10485683/1011
</span></span><span class=line><span class=cl>      Max sent sequence-number: 1317
</span></span><span class=line><span class=cl>      UDP encapsulation used for NAT traversal: N
</span></span><span class=line><span class=cl>      SA encrypted packets (number/bytes): 1316/79344
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    [Inbound ESP SAs] 
</span></span><span class=line><span class=cl>      SPI: 184686406 (0xb021746)
</span></span><span class=line><span class=cl>      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
</span></span><span class=line><span class=cl>      SA remaining key duration (kilobytes/sec): 10485760/1011
</span></span><span class=line><span class=cl>      Max received sequence-number: 1
</span></span><span class=line><span class=cl>      UDP encapsulation used for NAT traversal: N
</span></span><span class=line><span class=cl>      SA decrypted packets (number/bytes): 0/0
</span></span><span class=line><span class=cl>      Anti-replay : Enable
</span></span><span class=line><span class=cl>      Anti-replay window size: 1024
</span></span><span class=line><span class=cl>[FW2]
</span></span></code></pre></div></li><li><p>PC1 ping OA</p><p><div class=post-img-view><a data-fancybox=gallery href=https://s2.loli.net/2024/07/19/KslP3dvnjWorawu.png><img src=https://s2.loli.net/2024/07/19/KslP3dvnjWorawu.png loading=lazy alt=image-170314062></a></div></p></li><li><p>PC3 ping OA</p><p><div class=post-img-view><a data-fancybox=gallery href=https://s2.loli.net/2024/07/19/pGxZKakoYJ7ldiC.png><img src=https://s2.loli.net/2024/07/19/pGxZKakoYJ7ldiC.png loading=lazy alt=image-170423691></a></div></p></li></ul></li></ul><h4 id=474-configuring-an-l2tp-over-ipsec-tunnel>4.7.4 Configuring an L2TP over IPsec Tunnel</h4><ul><li>配置l2tp over ipsec</li></ul><hr><ul><li><p>FW1</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 切换虚拟系统，以下配置都在entvsys下配置
</span></span><span class=line><span class=cl>switch vsys entvsys 
</span></span><span class=line><span class=cl># 创建user001，每次启动都需要操作一次，产品手册中指示存于数据库中，而模拟器没硬盘没这货
</span></span><span class=line><span class=cl>user-manage user user0001
</span></span><span class=line><span class=cl>password Huawei@123
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface Virtual-Template0
</span></span><span class=line><span class=cl> ppp authentication-mode chap
</span></span><span class=line><span class=cl> remote address 30.30.30.2
</span></span><span class=line><span class=cl> ip address 30.30.30.1 255.255.255.252
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>firewall zone dmz
</span></span><span class=line><span class=cl> add interface Virtual-Template0
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>l2tp enable
</span></span><span class=line><span class=cl>l2tp-group 1
</span></span><span class=line><span class=cl> tunnel password cipher Huawei@123
</span></span><span class=line><span class=cl> tunnel name lns
</span></span><span class=line><span class=cl> allow l2tp virtual-template 0 remote lac
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>acl number 3000
</span></span><span class=line><span class=cl> rule 15 permit udp source-port eq 1701
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>security-policy
</span></span><span class=line><span class=cl> rule name trust2dmz
</span></span><span class=line><span class=cl>  source-zone trust
</span></span><span class=line><span class=cl>  destination-zone dmz
</span></span><span class=line><span class=cl>  source-address 192.168.100.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  destination-address 30.30.30.0 mask 255.255.255.252
</span></span><span class=line><span class=cl>  action permit
</span></span><span class=line><span class=cl> rule name dmz2trust
</span></span><span class=line><span class=cl>  source-zone dmz
</span></span><span class=line><span class=cl>  destination-zone trust
</span></span><span class=line><span class=cl>  source-address 30.30.30.0 mask 255.255.255.252
</span></span><span class=line><span class=cl>  destination-address 192.168.100.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  action permit
</span></span><span class=line><span class=cl> rule name untrust2local
</span></span><span class=line><span class=cl>  source-zone untrust
</span></span><span class=line><span class=cl>  destination-zone local
</span></span><span class=line><span class=cl>  source-address 200.1.1.11 mask 255.255.255.255
</span></span><span class=line><span class=cl>  destination-address 100.1.1.10 mask 255.255.255.255
</span></span><span class=line><span class=cl>  action permit
</span></span><span class=line><span class=cl> rule name any
</span></span><span class=line><span class=cl>  action permit
</span></span><span class=line><span class=cl># 
</span></span></code></pre></div></li><li><p>FW2</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl> l2tp enable
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>l2tp-group 1
</span></span><span class=line><span class=cl> tunnel password cipher Huawei@123
</span></span><span class=line><span class=cl> tunnel name lac
</span></span><span class=line><span class=cl> tunnel source LoopBack0
</span></span><span class=line><span class=cl> start l2tp ip 100.1.1.10 fullusername user001
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface Virtual-Template0
</span></span><span class=line><span class=cl> ppp authentication-mode chap
</span></span><span class=line><span class=cl> ppp chap user user001
</span></span><span class=line><span class=cl> ppp chap password cipher Huawei@123
</span></span><span class=line><span class=cl> ip address ppp-negotiate
</span></span><span class=line><span class=cl> call-lns local-user user001
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>policy-based-route
</span></span><span class=line><span class=cl> rule name l2tp 1
</span></span><span class=line><span class=cl>  source-zone trust
</span></span><span class=line><span class=cl>  source-address 172.16.101.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  destination-address 192.168.100.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  action pbr egress-interface Virtual-Template0
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>nat-policy
</span></span><span class=line><span class=cl> rule name l2tp
</span></span><span class=line><span class=cl>  source-zone trust
</span></span><span class=line><span class=cl>  egress-interface Virtual-Template0
</span></span><span class=line><span class=cl>  source-address 172.16.101.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  destination-address 192.168.100.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  action source-nat easy-ip
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>acl number 3000
</span></span><span class=line><span class=cl> rule 15 permit udp destination-port eq 1701
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>security-policy
</span></span><span class=line><span class=cl> rule name trust2dmz
</span></span><span class=line><span class=cl>  source-zone trust
</span></span><span class=line><span class=cl>  destination-zone dmz
</span></span><span class=line><span class=cl>  source-address 172.16.101.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  destination-address 192.168.100.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  action permit
</span></span><span class=line><span class=cl> rule name dmz2trust
</span></span><span class=line><span class=cl>  source-zone dmz
</span></span><span class=line><span class=cl>  destination-zone trust
</span></span><span class=line><span class=cl>  source-address 30.30.30.2 mask 255.255.255.255
</span></span><span class=line><span class=cl>  destination-address 172.16.101.0 mask 255.255.255.0
</span></span><span class=line><span class=cl>  action permit
</span></span><span class=line><span class=cl> rule name local2untrust
</span></span><span class=line><span class=cl>  source-zone local
</span></span><span class=line><span class=cl>  destination-zone untrust                
</span></span><span class=line><span class=cl>  source-address 200.1.1.11 mask 255.255.255.255
</span></span><span class=line><span class=cl>  destination-address 100.1.1.10 mask 255.255.255.255
</span></span><span class=line><span class=cl>  action permit
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>验证</p><ul><li><p>PC1 PC2 PC3 ping OA 192.168.100.254</p><p><div class=post-img-view><a data-fancybox=gallery href=https://s2.loli.net/2024/07/19/HyokRSbtgxev79u.png><img src=https://s2.loli.net/2024/07/19/HyokRSbtgxev79u.png loading=lazy alt=image-042024690></a></div></p></li><li><p>FW2查看l2tp隧道</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[FW2]dis l2tp tunnel  
</span></span><span class=line><span class=cl>2024-07-18 20:01:48.860 
</span></span><span class=line><span class=cl>L2TP::Total Tunnel: 1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> LocalTID RemoteTID RemoteAddress    Port   Sessions RemoteName  VpnInstance
</span></span><span class=line><span class=cl> ------------------------------------------------------------------------------
</span></span><span class=line><span class=cl> 1        1         100.1.1.10       1701   1        lns                     
</span></span><span class=line><span class=cl> ------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>  Total 1, 1 printed
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[FW2]dis l2tp session 
</span></span><span class=line><span class=cl>2024-07-18 20:01:51.360 
</span></span><span class=line><span class=cl>L2TP::Total Session: 1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  LocalSID  RemoteSID  LocalTID   RemoteTID  UserID  UserName    VpnInstance
</span></span><span class=line><span class=cl> ------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>  69        41         1          1                  user001                   
</span></span><span class=line><span class=cl> ------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>  Total 1, 1 printed
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[FW2]
</span></span></code></pre></div></li><li><p>FW2查看加密计数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[FW2]dis ipsec statistics 
</span></span><span class=line><span class=cl>2024-07-18 20:21:08.960 
</span></span><span class=line><span class=cl> IPSec statistics information:
</span></span><span class=line><span class=cl> Number of IPSec tunnels: 5
</span></span><span class=line><span class=cl> Number of standby IPSec tunnels: 0
</span></span><span class=line><span class=cl> the security packet statistics:
</span></span><span class=line><span class=cl>   input/output security packets: 5082/5457 
</span></span><span class=line><span class=cl>   input/output security bytes: 335843/362318 
</span></span><span class=line><span class=cl>   input/output dropped security packets: 4/7  
</span></span><span class=line><span class=cl>   the encrypt packet statistics: 
</span></span><span class=line><span class=cl>     send chip: 5457, recv chip: 5457, send err: 2
</span></span><span class=line><span class=cl>     local cpu: 5457, other cpu: 0, recv other cpu: 0
</span></span><span class=line><span class=cl>     intact packet: 5457, first slice: 0, after slice: 0
</span></span><span class=line><span class=cl>   the decrypt packet statistics:
</span></span><span class=line><span class=cl>     send chip: 5082, recv chip: 5082, send err: 0
</span></span><span class=line><span class=cl>     local cpu: 5082, other cpu: 0, recv other cpu: 0
</span></span><span class=line><span class=cl>     reass  first slice: 0, after slice: 0
</span></span><span class=line><span class=cl>   dropped security packet detail:
</span></span><span class=line><span class=cl>     can not find SA: 0, wrong SA: 0
</span></span><span class=line><span class=cl>     authentication: 0, replay: 0 
</span></span><span class=line><span class=cl>     front recheck: 0, after recheck: 4
</span></span><span class=line><span class=cl>     change cpu enc: 0, dec change cpu: 0 
</span></span><span class=line><span class=cl>     fib search: 0, output l3: 2
</span></span><span class=line><span class=cl>     flow err: 5, slice err: 0, byte limit: 0
</span></span><span class=line><span class=cl>     slave drop: 0
</span></span><span class=line><span class=cl>   negotiate about packet statistics:
</span></span><span class=line><span class=cl>     IKE fwd packet ok: 46, err: 0        
</span></span><span class=line><span class=cl>     IKE ctrl packet inbound ok: 46, outbound ok: 68
</span></span><span class=line><span class=cl>     SoftExpr: 0, HardExpr: 0, DPDOper: 0
</span></span><span class=line><span class=cl>     trigger ok: 29, switch sa: 12, sync sa: 0  
</span></span><span class=line><span class=cl>     recv IKE nat keepalive: 0, IKE input: 0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[FW2] 
</span></span></code></pre></div></li><li><p>FW查看ipsec状态</p><p><div class=post-img-view><a data-fancybox=gallery href=https://s2.loli.net/2024/07/19/PqFutpOGhkfn9ig.png><img src=https://s2.loli.net/2024/07/19/PqFutpOGhkfn9ig.png loading=lazy alt=image-042144749></a></div></p></li></ul></li></ul><h3 id=48-task-8-multicast-service-deployment-on-the-man>4.8 Task 8: Multicast Service Deployment on the MAN</h3><h4 id=481-configuring-the-multicast-service>4.8.1 Configuring the Multicast Service</h4><ul><li>配置MAN网络的组播网络，AR4 igmpv2，</li><li>CR1/CR2的loopback0接口选举bsr，配置优先级确保CR1成为bsr</li><li>配置anycast RP，创建loopback10 0100.100.100./32，loopback10地址为c-rp</li><li>配置msdp组播源发现协议</li><li>AR4的g0/0/01.100，限制组播地址</li><li>igmp加速离组</li></ul><hr><ul><li><p>AR1</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl> multicast routing-enable
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/0
</span></span><span class=line><span class=cl> pim sm
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/1	
</span></span><span class=line><span class=cl> pim sm
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>AR2</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl> multicast routing-enable
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/0
</span></span><span class=line><span class=cl> pim sm
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/1	
</span></span><span class=line><span class=cl> pim sm
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>AR3</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl> multicast routing-enable
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/0
</span></span><span class=line><span class=cl> pim sm
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/2	
</span></span><span class=line><span class=cl> pim sm
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>AR4</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl> multicast routing-enable
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/0
</span></span><span class=line><span class=cl> pim sm
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/2	
</span></span><span class=line><span class=cl> pim sm
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>acl number 2000  
</span></span><span class=line><span class=cl> rule 5 permit source 224.1.1.0 0.0.0.255 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/1.100
</span></span><span class=line><span class=cl> pim sm
</span></span><span class=line><span class=cl> igmp enable
</span></span><span class=line><span class=cl> igmp group-policy 2000 2
</span></span><span class=line><span class=cl> igmp prompt-leave group-policy 2000
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>CR1</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl> multicast routing-enable
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/0
</span></span><span class=line><span class=cl> pim sm
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/1
</span></span><span class=line><span class=cl> pim sm
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/2	
</span></span><span class=line><span class=cl> pim sm
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface Ethernet1/0/1
</span></span><span class=line><span class=cl> pim sm
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface LoopBack0
</span></span><span class=line><span class=cl> pim sm
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface LoopBack10
</span></span><span class=line><span class=cl> ip address 100.100.100.100 255.255.255.255 
</span></span><span class=line><span class=cl> pim sm
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>bgp 64812
</span></span><span class=line><span class=cl> #
</span></span><span class=line><span class=cl> ipv4-family unicast
</span></span><span class=line><span class=cl>  network 100.100.100.100 255.255.255.255 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>pim
</span></span><span class=line><span class=cl> c-bsr hash-length 0
</span></span><span class=line><span class=cl> c-bsr priority 255
</span></span><span class=line><span class=cl> c-bsr LoopBack0
</span></span><span class=line><span class=cl> c-rp LoopBack10
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>msdp
</span></span><span class=line><span class=cl> originating-rp LoopBack0
</span></span><span class=line><span class=cl> peer 1.1.1.6 connect-interface LoopBack0
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>CR2</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>#
</span></span><span class=line><span class=cl> multicast routing-enable
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/0
</span></span><span class=line><span class=cl> pim sm
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/1
</span></span><span class=line><span class=cl> pim sm
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface GigabitEthernet0/0/2	
</span></span><span class=line><span class=cl> pim sm
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface LoopBack0
</span></span><span class=line><span class=cl> pim sm
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>interface LoopBack10
</span></span><span class=line><span class=cl> ip address 100.100.100.100 255.255.255.255 
</span></span><span class=line><span class=cl> pim sm
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>bgp 64812
</span></span><span class=line><span class=cl> #
</span></span><span class=line><span class=cl> ipv4-family unicast
</span></span><span class=line><span class=cl>  network 100.100.100.100 255.255.255.255 
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>pim
</span></span><span class=line><span class=cl> c-bsr hash-length 0
</span></span><span class=line><span class=cl> c-bsr LoopBack0
</span></span><span class=line><span class=cl> c-rp LoopBack10
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl>msdp
</span></span><span class=line><span class=cl> originating-rp LoopBack0
</span></span><span class=line><span class=cl> peer 1.1.1.5 connect-interface LoopBack0
</span></span><span class=line><span class=cl>#
</span></span></code></pre></div></li><li><p>验证</p><ul><li><p>dis pim rp-info</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[AR4]dis pim bsr-info
</span></span><span class=line><span class=cl> VPN-Instance: public net
</span></span><span class=line><span class=cl> Elected AdminScoped BSR Count: 0
</span></span><span class=line><span class=cl> Elected BSR Address: 1.1.1.5
</span></span><span class=line><span class=cl>     Priority: 255
</span></span><span class=line><span class=cl>     Hash mask length: 0
</span></span><span class=line><span class=cl>     State: Accept Preferred
</span></span><span class=line><span class=cl>     Scope: Not scoped
</span></span><span class=line><span class=cl>     Uptime: 00:00:50
</span></span><span class=line><span class=cl>     Expires: 00:01:20
</span></span><span class=line><span class=cl>     C-RP Count: 1
</span></span><span class=line><span class=cl>[AR4]
</span></span><span class=line><span class=cl>[AR4]dis pim rp-info 
</span></span><span class=line><span class=cl> VPN-Instance: public net
</span></span><span class=line><span class=cl> PIM-SM BSR RP Number:1
</span></span><span class=line><span class=cl> Group/MaskLen: 224.0.0.0/4
</span></span><span class=line><span class=cl>     RP: 100.100.100.100
</span></span><span class=line><span class=cl>     Priority: 0
</span></span><span class=line><span class=cl>     Uptime: 00:00:56
</span></span><span class=line><span class=cl>     Expires: 00:01:34
</span></span><span class=line><span class=cl>[AR4]
</span></span></code></pre></div></li><li><p>dis pim routing-table</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[CR1]dis pim routing-table 
</span></span><span class=line><span class=cl> VPN-Instance: public net
</span></span><span class=line><span class=cl> Total 0 (*, G) entry; 1 (S, G) entry
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> (100.1.100.2, 224.1.1.1)
</span></span><span class=line><span class=cl>     RP: 100.100.100.100 (local)
</span></span><span class=line><span class=cl>     Protocol: pim-sm, Flag: SPT 2MSDP LOC ACT 
</span></span><span class=line><span class=cl>     UpTime: 00:03:16
</span></span><span class=line><span class=cl>     Upstream interface: Ethernet1/0/1
</span></span><span class=line><span class=cl>         Upstream neighbor: NULL
</span></span><span class=line><span class=cl>         RPF prime neighbor: NULL
</span></span><span class=line><span class=cl>     Downstream interface(s) information:
</span></span><span class=line><span class=cl>     Total number of downstreams: 1
</span></span><span class=line><span class=cl>         1: GigabitEthernet0/0/0
</span></span><span class=line><span class=cl>             Protocol: pim-sm, UpTime: 00:03:16, Expires: 00:03:14
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[CR1]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[CR2]dis pim routing-table 
</span></span><span class=line><span class=cl> VPN-Instance: public net
</span></span><span class=line><span class=cl> Total 1 (*, G) entry; 1 (S, G) entry
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> (*, 224.1.1.1)
</span></span><span class=line><span class=cl>     RP: 100.100.100.100 (local)
</span></span><span class=line><span class=cl>     Protocol: pim-sm, Flag: WC 
</span></span><span class=line><span class=cl>     UpTime: 00:17:28
</span></span><span class=line><span class=cl>     Upstream interface: Register
</span></span><span class=line><span class=cl>         Upstream neighbor: NULL
</span></span><span class=line><span class=cl>         RPF prime neighbor: NULL
</span></span><span class=line><span class=cl>     Downstream interface(s) information:
</span></span><span class=line><span class=cl>     Total number of downstreams: 1
</span></span><span class=line><span class=cl>         1: GigabitEthernet0/0/2
</span></span><span class=line><span class=cl>             Protocol: pim-sm, UpTime: 00:17:28, Expires: 00:03:02
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> (100.1.100.2, 224.1.1.1)
</span></span><span class=line><span class=cl>     RP: 100.100.100.100 (local)
</span></span><span class=line><span class=cl>     Protocol: pim-sm, Flag: SPT MSDP ACT 
</span></span><span class=line><span class=cl>     UpTime: 00:03:41
</span></span><span class=line><span class=cl>     Upstream interface: GigabitEthernet0/0/0
</span></span><span class=line><span class=cl>         Upstream neighbor: 10.5.6.1
</span></span><span class=line><span class=cl>         RPF prime neighbor: 10.5.6.1
</span></span><span class=line><span class=cl>     Downstream interface(s) information:
</span></span><span class=line><span class=cl>     Total number of downstreams: 1
</span></span><span class=line><span class=cl>         1: GigabitEthernet0/0/2
</span></span><span class=line><span class=cl>             Protocol: pim-sm, UpTime: 00:03:41, Expires: 00:02:49
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[CR2]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[AR4]dis pim routing-table 
</span></span><span class=line><span class=cl> VPN-Instance: public net
</span></span><span class=line><span class=cl> Total 1 (*, G) entry; 1 (S, G) entry
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> (*, 224.1.1.1)
</span></span><span class=line><span class=cl>     RP: 100.100.100.100
</span></span><span class=line><span class=cl>     Protocol: pim-sm, Flag: WC 
</span></span><span class=line><span class=cl>     UpTime: 00:17:42
</span></span><span class=line><span class=cl>     Upstream interface: GigabitEthernet0/0/2
</span></span><span class=line><span class=cl>         Upstream neighbor: 10.4.6.1
</span></span><span class=line><span class=cl>         RPF prime neighbor: 10.4.6.1
</span></span><span class=line><span class=cl>     Downstream interface(s) information:
</span></span><span class=line><span class=cl>     Total number of downstreams: 1
</span></span><span class=line><span class=cl>         1: GigabitEthernet0/0/1.100
</span></span><span class=line><span class=cl>             Protocol: igmp, UpTime: 00:17:42, Expires: -
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> (100.1.100.2, 224.1.1.1)
</span></span><span class=line><span class=cl>     RP: 100.100.100.100
</span></span><span class=line><span class=cl>     Protocol: pim-sm, Flag: SPT ACT 
</span></span><span class=line><span class=cl>     UpTime: 00:03:55
</span></span><span class=line><span class=cl>     Upstream interface: GigabitEthernet0/0/2
</span></span><span class=line><span class=cl>         Upstream neighbor: 10.4.6.1
</span></span><span class=line><span class=cl>         RPF prime neighbor: 10.4.6.1
</span></span><span class=line><span class=cl>     Downstream interface(s) information:
</span></span><span class=line><span class=cl>     Total number of downstreams: 1
</span></span><span class=line><span class=cl>         1: GigabitEthernet0/0/1.100
</span></span><span class=line><span class=cl>             Protocol: pim-sm, UpTime: 00:03:55, Expires: -
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[AR4]
</span></span></code></pre></div></li><li><p>电脑安装vlc，ensp选择vlc安装路径，启动组播源服务器和PC4接收视频</p><p><div class=post-img-view><a data-fancybox=gallery href=https://s2.loli.net/2024/07/19/cS86XbI1GBgy4dH.png><img src=https://s2.loli.net/2024/07/19/cS86XbI1GBgy4dH.png loading=lazy alt=image-152518086></a></div></p></li></ul></li></ul><h2 id=最后>最后</h2><ul><li>个人觉得整个拓扑的配置项还是挺多的，涉及的协议、框架、模型也挺多，有一定挑战</li><li>现场8个小时给我整，我是整不出来，在没有做充足准备的前提下</li><li>毕竟是实验，没有整防火墙双机热备</li><li>毕竟是实验，RR还能跑数据和接入EBGP对等体</li><li>毕竟是实验，AC与AC之间没有物理连线做状态监测</li><li>毕竟是实验，单线路多逻辑互联</li><li>……</li><li>可能有更好的实现需求的配置答案（山外有山）</li><li>文件存阿里云盘了，这是链接：[<a class=link href=https://www.alipan.com/s/sKaEyJg38HD target=_blank rel=noopener>分享的文件
<span style=white-space:nowrap><svg width=".7em" height=".7em" viewBox="0 0 21 21"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z" fill="currentcolor"/><path d="M19 19H5V5h7l-2-2H5c-1.103.0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103.0 2-.897 2-2v-5l-2-2v7z" fill="currentcolor"/></span>
</a>]</li><li>欢迎“<del>来电</del>”来函探讨。</li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/ict/>ICT</a>
<a href=/tags/ensp%E5%AE%9E%E9%AA%8C/>Ensp实验</a>
<a href=/tags/%E8%A7%A3%E9%A2%98/>解题</a>
<a href=/tags/%E5%8D%8E%E4%B8%BA/>华为</a>
<a href=/tags/vsys/>Vsys</a>
<a href=/tags/%E7%9C%9F%E7%9A%84%E5%8D%A1/>真的卡</a></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/posts/8f2ea734/><div class=article-details><h2 class=article-title>2022-2023华为ICT大赛（全国）实验题研究</h2></div></a></article><article><a href=/posts/c09d2b9c/><div class=article-details><h2 class=article-title>信锐NMC对接华为AC实现授权ACL下发</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2020 -
2024 <a href=https://github.com/kiraster target=_blank rel=noopener>@kiraster</a></section><section class=powerby><a href=https://github.com/kiraster target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a> <a href=https://space.bilibili.com/11565094 target=_blank title=Bilibili rel=me><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" width="24" height="24" stroke-width="2"><path d="M3 10a4 4 0 014-4h10a4 4 0 014 4v6a4 4 0 01-4 4H7a4 4 0 01-4-4v-6z"/><path d="M8 3l2 3"/><path d="M16 3l-2 3"/><path d="M9 13v-2"/><path d="M15 11v2"/></svg></a> <a href=mailto:kir_aster@foxmail.com target=_blank title=Email rel=me><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" width="24" height="24" stroke-width="2"><path d="M3 7a2 2 0 012-2h14a2 2 0 012 2v10a2 2 0 01-2 2H5a2 2 0 01-2-2V7z"/><path d="M3 7l9 6 9-6"/></svg></a><br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><script src=https://cdn.jsdelivr.net/gh/zhixuan2333/gh-blog@v0.1.0/js/nprogress.min.js integrity=sha384-bHDlAEUFxsRI7JfULv3DTpL2IXbbgn4JHQJibgo5iiXSK6Iu8muwqHANhun74Cqg crossorigin=anonymous></script><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/zhixuan2333/gh-blog@v0.1.0/css/nprogress.css integrity=sha384-KJyhr2syt5+4M9Pz5dipCvTrtvOmLk/olWVdfhAp858UCa64Ia5GFpTN7+G4BWpE crossorigin=anonymous><script>NProgress.start(),document.addEventListener("readystatechange",()=>{document.readyState==="interactive"&&NProgress.inc(.8),document.readyState==="complete"&&NProgress.done()})</script><script>document.addEventListener("DOMContentLoaded",function(){jQuery(function(e){e("[data-fancybox]").fancybox()})})</script></body></html>
<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
<meta charset="utf-8">
<title>CentOS-8.0.1905 安装配置图形化桌面环境和TigerVNC(在线安装) - Kir&#39;s Blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">


<meta name="description" content="Kir的博客，网络设备配置，网络拓扑实验，华为华三路由交换无线安全HCIP,CISCO,NETWORK">


<meta name="keywords" content="Kir的博客，网络设备配置，网络拓扑实验，华为华三路由交换无线安全HCIP,CISCO,NETWORK">


    <meta name="description" content="CentOS 8.0.1905 服务器上初始安装没有安装图形化桌面环境，现在需要对该服务器安装图形桌面化环境和安装TigerVNC，并在本地（windows平台）使用VNC客户端进行远程桌面连接">
<meta property="og:type" content="article">
<meta property="og:title" content="CentOS-8.0.1905 安装配置图形化桌面环境和TigerVNC(在线安装)">
<meta property="og:url" content="https://kiraster.github.io/posts/a451a5f2.html">
<meta property="og:site_name" content="Kir&#39;s Blog">
<meta property="og:description" content="CentOS 8.0.1905 服务器上初始安装没有安装图形化桌面环境，现在需要对该服务器安装图形桌面化环境和安装TigerVNC，并在本地（windows平台）使用VNC客户端进行远程桌面连接">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s2.loli.net/2023/05/20/TmgzICPbDUkwQMF.jpg">
<meta property="og:image" content="https://s2.loli.net/2023/05/20/JobT3SVD6OiMhkK.jpg">
<meta property="og:image" content="https://s2.loli.net/2023/05/20/pHfTQuhFBtClPvz.jpg">
<meta property="og:image" content="https://s2.loli.net/2023/05/20/UlDIh8WmETvdA2V.jpg">
<meta property="og:image" content="https://s2.loli.net/2023/05/20/eokPTcQ9DN1mqfx.jpg">
<meta property="og:image" content="https://s2.loli.net/2023/05/20/7ki35TpPR9ursC1.jpg">
<meta property="og:image" content="https://s2.loli.net/2023/05/20/mldZUyFNcri17YG.jpg">
<meta property="og:image" content="https://s2.loli.net/2023/05/20/6MGFkfhVWr2AKgR.jpg">
<meta property="article:published_time" content="2023-05-19T16:55:54.000Z">
<meta property="article:modified_time" content="2023-05-20T22:13:02.086Z">
<meta property="article:author" content="Kir Aster">
<meta property="article:tag" content="CentOS 8">
<meta property="article:tag" content="VNC">
<meta property="article:tag" content="TigerVNC">
<meta property="article:tag" content="5901">
<meta property="article:tag" content="SELinux">
<meta property="article:tag" content="CentOS-Vault">
<meta property="article:tag" content="图形化桌面环境">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2023/05/20/TmgzICPbDUkwQMF.jpg">



<link rel="icon" href="https://s2.loli.net/2022/11/07/nR4jdLTGEq6kZ2S.png">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<!--引入思源黑体 rel-->
<link rel="preconnect" href="https://fonts.proxy.ustclug.org">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.proxy.ustclug.org/css2?family=Noto+Sans+SC&display=swap" rel="stylesheet">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">

<link rel="stylesheet" href="/css/style.css">

<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>

    
    
    
    
    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-209914470-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-209914470-1');
</script>


    

<meta name="generator" content="Hexo 6.3.0"></head>
<body>

<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                    
                    Kir&#39;s
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/archives">Archives</a>
            
            <a class="navbar-item "
               href="/gallery">Gallery</a>
            
            <a class="navbar-item "
               href="/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="Search" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            <div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc">
                <a class="navbar-item" title="Table of Contents">
                    <i class="fa fa-list"></i>
                </a>
                <div class="navbar-dropdown is-right">
                    
                    
                    
                    
                    <a class="navbar-item" href="#使用华为云CentOS-Vault">1&nbsp;&nbsp;<b>使用华为云CentOS-Vault</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#备份-x2F-etc-x2F-yum-repos-d-目录下的文件">1.1&nbsp;&nbsp;备份/etc/yum.repos.d 目录下的文件</a>
                    
                    
                    
                    <a class="navbar-item" href="#配置华为云CentOS-Vault-yum源">1.2&nbsp;&nbsp;配置华为云CentOS-Vault yum源</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#安装配置图形桌面环境">2&nbsp;&nbsp;<b>安装配置图形桌面环境</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#关闭SELINUX，后面配置完成再启用">2.1&nbsp;&nbsp;关闭SELINUX，后面配置完成再启用</a>
                    
                    
                    
                    <a class="navbar-item" href="#安装图形化桌面环境">2.2&nbsp;&nbsp;安装图形化桌面环境</a>
                    
                    
                    
                    <a class="navbar-item" href="#设置图形界面为默认运行级别">2.3&nbsp;&nbsp;设置图形界面为默认运行级别</a>
                    
                    
                    
                    <a class="navbar-item" href="#启动图形界面">2.4&nbsp;&nbsp;启动图形界面</a>
                    
                    
                    
                    <a class="navbar-item" href="#重启">2.5&nbsp;&nbsp;重启</a>
                    
                    
                    
                    <a class="navbar-item" href="#向导设置">2.6&nbsp;&nbsp;向导设置</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#安装-VNC-Server-服务">3&nbsp;&nbsp;<b>安装 VNC Server 服务</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#安装-TigerVNC">3.1&nbsp;&nbsp;安装 TigerVNC</a>
                    
                    
                    
                    <a class="navbar-item" href="#创建-vnc-用户并设置密码（前面已创建可跳过）">3.2&nbsp;&nbsp;创建 vnc 用户并设置密码（前面已创建可跳过）</a>
                    
                    
                    
                    <a class="navbar-item" href="#拷贝-vncserver-service-文件">3.3&nbsp;&nbsp;拷贝 vncserver@.service 文件</a>
                    
                    
                    
                    <a class="navbar-item" href="#在-x2F-etc-x2F-tigervnc-x2F-vncserver-users-中为端口1配置用户-vncuser（即：1-x3D-vncuser）">3.4&nbsp;&nbsp;在 /etc/tigervnc/vncserver.users 中为端口1配置用户 vncuser（即：1=vncuser）</a>
                    
                    
                    
                    <a class="navbar-item" href="#从-root-切换到-vncuser，配置文件中定义的用户的连接密码">3.5&nbsp;&nbsp;从 root 切换到 vncuser，配置文件中定义的用户的连接密码</a>
                    
                    
                    
                    <a class="navbar-item" href="#查看-5901-端口-VNC-server-的监听状态">3.6&nbsp;&nbsp;查看 5901 端口 VNC server 的监听状态</a>
                    
                    
                    
                    <a class="navbar-item" href="#配置防火墙，开放-5901-端口：">3.7&nbsp;&nbsp;配置防火墙，开放 5901 端口：</a>
                    
                    
                    
                    <a class="navbar-item" href="#启动服务">3.8&nbsp;&nbsp;启动服务</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#本地使用-VNC-客户端进行远程桌面连接">4&nbsp;&nbsp;<b>本地使用 VNC 客户端进行远程桌面连接</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#打开软件，输入-服务器地址-端口号-，点击-Connect">4.1&nbsp;&nbsp;打开软件，输入 服务器地址:端口号 ，点击 Connect</a>
                    
                    
                    
                    <a class="navbar-item" href="#输入连接密码，点击-Log-On">4.2&nbsp;&nbsp;输入连接密码，点击 Log On</a>
                    
                    
                    
                    <a class="navbar-item" href="#登陆界面">4.3&nbsp;&nbsp;登陆界面</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#踩坑">5&nbsp;&nbsp;<b>踩坑</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#运行-yum-update-之后，repo-文件的变化">5.1&nbsp;&nbsp;运行 yum update 之后，repo 文件的变化</a>
                    
                    
                    
                    <a class="navbar-item" href="#运行-vncserver-等旧格式命令的提示">5.2&nbsp;&nbsp;运行 vncserver 等旧格式命令的提示</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#最后">6&nbsp;&nbsp;<b>最后</b></a>
                    
                </div>
            </div>
            
            
        </div>
    </div>
</nav>

<section class="section">
    <div class="container">
    <article class="article content gallery" itemscope itemprop="blogPost">
    
      <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
          
              CentOS-8.0.1905 安装配置图形化桌面环境和TigerVNC(在线安装)
          
      </h1>
    
    
      <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
          <span class="column is-narrow">
              
                  <i class="far fa-clock"></i>
                  <span>&nbspMay 20th 23&nbsp</span>
              
          </span>
          
          <span class="column is-narrow article-category">
              <i class="far fa-folder"></i>
              <a class="article-category-link" href="/categories/Linux/">Linux</a>
          </span>
          
          
          <span class="column is-narrow">
              
              
              13 minutes read (About 1987 words)
          </span>
          
      </div>
    
    <!-- add timeliness tips date:20230510 -->
    
      
      
    
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        
        <html><head></head><body><p><code>CentOS 8.0.1905</code> 服务器上初始安装没有安装图形化桌面环境，现在需要对该服务器安装图形桌面化环境和安装<code>TigerVNC</code>，并在本地（windows平台）使用<code>VNC</code>客户端进行远程桌面连接<span id="more"></span></p>
<p><strong>环境说明</strong></p>
<ul>
<li>Microsoft Windows 10 Pro 21H2</li>
<li>VMware® Workstation 15.0.0 </li>
<li>OS: CentOS Linux 8 </li>
<li>IMG: CentOS-8-x86_64-1905-dvd1.iso</li>
<li>Xvnc TigerVNC 1.11.0 - built Jul 21 2021 11:25:16</li>
</ul>
<h2 id="使用华为云CentOS-Vault"><a href="#使用华为云CentOS-Vault" class="headerlink" title="使用华为云CentOS-Vault"></a>使用华为云CentOS-Vault</h2><p><strong>现在 CentOS 8（非 Stream 版本）已被官方移除出该仓库。需要使用<code>centos-vault</code>镜像</strong></p>
<p>先浏览官网链接，查看使用说明</p>
<p>官网链接： <a target="_blank" rel="noopener" href="https://mirrors.huaweicloud.com/home">https://mirrors.huaweicloud.com/home</a></p>
<p><img src="https://s2.loli.net/2023/05/20/TmgzICPbDUkwQMF.jpg" alt="ScreenCaputure230518002717"></p>
<h3 id="备份-x2F-etc-x2F-yum-repos-d-目录下的文件"><a href="#备份-x2F-etc-x2F-yum-repos-d-目录下的文件" class="headerlink" title="备份/etc/yum.repos.d 目录下的文件"></a>备份/etc/yum.repos.d 目录下的文件</h3><figure class="highlight shell hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos-106 yum.repos.d]# cp -a /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak</span><br></pre></td></tr></tbody></table></figure>

<p>或</p>
<figure class="highlight shell hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="hljs-language-bash">创建备份目录</span></span><br><span class="line">[root@centos-106 yum.repos.d]# mkdir repo_back</span><br><span class="line"><span class="meta prompt_"># </span><span class="hljs-language-bash">移动 *.repo 到 back_repo 目录</span></span><br><span class="line">[root@centos-106 yum.repos.d]# mv *.repo back_repo/</span><br></pre></td></tr></tbody></table></figure>

<h3 id="配置华为云CentOS-Vault-yum源"><a href="#配置华为云CentOS-Vault-yum源" class="headerlink" title="配置华为云CentOS-Vault yum源"></a>配置华为云CentOS-Vault yum源</h3><figure class="highlight shell hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@centos-106 yum.repos.d]# wget -O /etc/yum.repos.d/CentOS-Base.repo https://repo.huaweicloud.com/repository/conf/CentOS-8-reg.repo</span><br><span class="line">--2023-05-17 12:12:00--  https://repo.huaweicloud.com/repository/conf/CentOS-8-reg.repo</span><br><span class="line">Resolving repo.huaweicloud.com (repo.huaweicloud.com)... 58.59.128.100, 58.59.128.102, 58.59.128.99</span><br><span class="line">Connecting to repo.huaweicloud.com (repo.huaweicloud.com)|58.59.128.100|:443... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 2218 (2.2K) [application/octet-stream]</span><br><span class="line">Saving to: ‘/etc/yum.repos.d/CentOS-Base.repo’</span><br><span class="line"></span><br><span class="line">/etc/yum.repos.d/CentOS-Base.repo   100%[================================================================&gt;]   2.17K  --.-KB/s    in 0s      </span><br><span class="line"></span><br><span class="line">2023-05-17 12:12:01 (33.0 MB/s) - ‘/etc/yum.repos.d/CentOS-Base.repo’ saved [2218/2218]</span><br></pre></td></tr></tbody></table></figure>

<p>执行<strong>yum clean all</strong>清除原有yum缓存。</p>
<p>执行<strong>yum makecache</strong>（刷新缓存）或者<strong>yum repolist all</strong>（查看所有配置可以使用的文件，会自动刷新缓存）</p>
<figure class="highlight shell hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@centos-106 yum.repos.d]# yum clean all</span><br><span class="line">7 files removed</span><br><span class="line">[root@centos-106 yum.repos.d]# yum makecache</span><br><span class="line">CentOS-8 - AppStream - repo.huaweicloud.com                                                                  3.9 MB/s | 8.4 MB     00:02    </span><br><span class="line">CentOS-8 - Base - repo.huaweicloud.com                                                                       2.7 MB/s | 4.6 MB     00:01    </span><br><span class="line">CentOS-8 - PowerTools - repo.huaweicloud.com                                                                 1.6 MB/s | 2.3 MB     00:01    </span><br><span class="line">CentOS-8 - Extras - repo.huaweicloud.com                                                                     4.9 kB/s |  10 kB     00:02    </span><br><span class="line">Metadata cache created.</span><br></pre></td></tr></tbody></table></figure>

<h2 id="安装配置图形桌面环境"><a href="#安装配置图形桌面环境" class="headerlink" title="安装配置图形桌面环境"></a>安装配置图形桌面环境</h2><h3 id="关闭SELINUX，后面配置完成再启用"><a href="#关闭SELINUX，后面配置完成再启用" class="headerlink" title="关闭SELINUX，后面配置完成再启用"></a>关闭SELINUX，后面配置完成再启用</h3><figure class="highlight shell hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@centos-106 selinux]# nano /etc/selinux/config</span><br><span class="line">将SELINUX设置为disabled</span><br><span class="line">……</span><br><span class="line">SELINUX=disabled</span><br><span class="line">……</span><br><span class="line">reboot重启</span><br></pre></td></tr></tbody></table></figure>

<p>查看防火墙状态</p>
<figure class="highlight shell hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos-106 ~]# sestatus</span><br><span class="line">SELinux status:                 disabled</span><br></pre></td></tr></tbody></table></figure>

<h3 id="安装图形化桌面环境"><a href="#安装图形化桌面环境" class="headerlink" title="安装图形化桌面环境"></a>安装图形化桌面环境</h3><figure class="highlight shell hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@centos-106 yum.repos.d]# dnf groupinstall "Server with GUI" -y</span><br><span class="line">……</span><br><span class="line">……</span><br><span class="line">……                                                    </span><br><span class="line">Complete!</span><br><span class="line">[root@centos-106 yum.repos.d]# </span><br></pre></td></tr></tbody></table></figure>

<h3 id="设置图形界面为默认运行级别"><a href="#设置图形界面为默认运行级别" class="headerlink" title="设置图形界面为默认运行级别"></a>设置图形界面为默认运行级别</h3><figure class="highlight shell hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl set-default graphical.target</span><br></pre></td></tr></tbody></table></figure>

<h3 id="启动图形界面"><a href="#启动图形界面" class="headerlink" title="启动图形界面"></a>启动图形界面</h3><figure class="highlight shell hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start graphical.target</span><br></pre></td></tr></tbody></table></figure>

<h3 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h3><figure class="highlight shell hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></tbody></table></figure>

<h3 id="向导设置"><a href="#向导设置" class="headerlink" title="向导设置"></a>向导设置</h3><p>重启后会看到图形化界面的一个向导，前面的基本点<code>next</code>(定位服务可关)，最后几步有个新建用户的步骤，建立一个用户给下一步骤中的 VNC Server服务 使用（不一定非使用vncuser这个名称）</p>
<p><img src="https://s2.loli.net/2023/05/20/JobT3SVD6OiMhkK.jpg" alt="ScreenCaputure230519172613"></p>
<p><img src="https://s2.loli.net/2023/05/20/pHfTQuhFBtClPvz.jpg" alt="ScreenCaputure230519172631"></p>
<p><img src="https://s2.loli.net/2023/05/20/UlDIh8WmETvdA2V.jpg" alt="ScreenCaputure230519172807"></p>
<h2 id="安装-VNC-Server-服务"><a href="#安装-VNC-Server-服务" class="headerlink" title="安装 VNC Server 服务"></a><strong>安装 VNC Server 服务</strong></h2><h3 id="安装-TigerVNC"><a href="#安装-TigerVNC" class="headerlink" title="安装 TigerVNC"></a>安装 <strong>TigerVNC</strong></h3><p>以 <code>root</code> 用户身份运行以下命令，基本都使用<code>root</code>用户权限操作（提示权限不足要在命令前加 sudo 很烦），需要切换<code>vncuser</code>用户会说明</p>
<figure class="highlight shell hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@centos-106 ~]#  dnf install tigervnc-server -y</span><br><span class="line">……</span><br><span class="line">……</span><br><span class="line">Installed:</span><br><span class="line">  tigervnc-selinux-1.11.0-9.el8.noarch                       tigervnc-server-1.11.0-9.el8.x86_64                      </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">[root@centos-106 ~]#</span><br></pre></td></tr></tbody></table></figure>

<h3 id="创建-vnc-用户并设置密码（前面已创建可跳过）"><a href="#创建-vnc-用户并设置密码（前面已创建可跳过）" class="headerlink" title="创建 vnc 用户并设置密码（前面已创建可跳过）"></a>创建 vnc 用户并设置密码（前面已创建可跳过）</h3><p>如不想使用在上一步骤建立的用户，可在这一步骤中新建用户</p>
<figure class="highlight shell hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@centos-106 ~]# useradd vnc_user</span><br><span class="line">[root@centos-106 ~]# passwd vnc_user</span><br><span class="line">Changing password for user uservnc.</span><br><span class="line">New password: </span><br><span class="line">Retype new password: </span><br><span class="line">passwd: all authentication tokens updated successfully.</span><br><span class="line">[root@centos-106 ~]#</span><br></pre></td></tr></tbody></table></figure>

<h3 id="拷贝-vncserver-service-文件"><a href="#拷贝-vncserver-service-文件" class="headerlink" title="拷贝 vncserver@.service 文件"></a>拷贝 vncserver@.service 文件</h3><p>创建<code>/etc/systemd/system/vncserver@.service</code> 配置文件。要创建这个文件，从<code>/usr/lib/systemd/system/vncserver@.service</code> 复制						</p>
<figure class="highlight shell hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centos-106 ~]# ~]# cp /usr/lib/systemd/system/vncserver@.service /etc/systemd/system/vncserver@.service</span><br></pre></td></tr></tbody></table></figure>

<p>不需要在文件名中包含显示号，因为 <code>systemd 会自动根据需要</code> 在内存中创建适当的命名实例，将服务文件中的 <code>'%i'</code> 替换为显示号。对于单个用户，无需重命名该文件。</p>
<blockquote>
<p>VNC 桌面的默认大小为 1024x768。 							</p>
<p>可以使用 <code>~/.vnc/config</code> 文件进一步配置用户的 VNC 会话。 							</p>
<p>例如，要更改 VNC 窗口大小，请添加以下行： 							</p>
<p>geometry= <width> x <height> </height></width></p>
</blockquote>
<h3 id="在-x2F-etc-x2F-tigervnc-x2F-vncserver-users-中为端口1配置用户-vncuser（即：1-x3D-vncuser）"><a href="#在-x2F-etc-x2F-tigervnc-x2F-vncserver-users-中为端口1配置用户-vncuser（即：1-x3D-vncuser）" class="headerlink" title="在 /etc/tigervnc/vncserver.users 中为端口1配置用户 vncuser（即：1=vncuser）"></a>在 /etc/tigervnc/vncserver.users 中为端口1配置用户 vncuser（即：1=vncuser）</h3><figure class="highlight shell hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos-106 system]# nano /etc/tigervnc/vncserver.users </span><br><span class="line"></span><br><span class="line">添加：</span><br><span class="line">:1=vncuser</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h3 id="从-root-切换到-vncuser，配置文件中定义的用户的连接密码"><a href="#从-root-切换到-vncuser，配置文件中定义的用户的连接密码" class="headerlink" title="从 root 切换到 vncuser，配置文件中定义的用户的连接密码"></a>从 root 切换到 vncuser，配置文件中定义的用户的连接密码</h3><p>这一步骤中需要设置一个连接密码(最长八个字符，多出的字符会被切掉）；在<code>view-only password (y/n)? </code> 选 <code>n</code>；选<code>y</code>只能查看不能输入</p>
<figure class="highlight shell hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@centos-106 ~]# su - vncuser </span><br><span class="line">[vncuser@centos-106 ~]$ vncpasswd </span><br><span class="line">Password:</span><br><span class="line">Verify:</span><br><span class="line">Would you like to enter a view-only password (y/n)? n</span><br><span class="line">A view-only password is not used</span><br><span class="line">[vncuser@centos-106 ~]$ exit</span><br></pre></td></tr></tbody></table></figure>

<h3 id="查看-5901-端口-VNC-server-的监听状态"><a href="#查看-5901-端口-VNC-server-的监听状态" class="headerlink" title="查看 5901 端口 VNC server 的监听状态"></a>查看 5901 端口 VNC server 的监听状态</h3><p><strong>lsof -i :5901</strong> 或 <strong>netstat -tulpn | grep 5901</strong></p>
<figure class="highlight shell hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[vncuser@centos-106 ~]$ lsof -i :5901</span><br><span class="line">COMMAND  PID    USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">Xvnc    2385 vncuser    6u  IPv4  46911      0t0  TCP *:5901 (LISTEN)</span><br><span class="line">Xvnc    2385 vncuser    7u  IPv6  46912      0t0  TCP *:5901 (LISTEN)</span><br><span class="line">[vncuser@centos-106 ~]$ netstat -tulpn | grep 5901</span><br><span class="line">(Not all processes could be identified, non-owned process info</span><br><span class="line"> will not be shown, you would have to be root to see it all.)</span><br><span class="line">tcp        0      0 0.0.0.0:5901            0.0.0.0:*               LISTEN      2385/Xvnc           </span><br><span class="line">tcp6       0      0 :::5901                 :::*                    LISTEN      2385/Xvnc           </span><br></pre></td></tr></tbody></table></figure>

<h3 id="配置防火墙，开放-5901-端口："><a href="#配置防火墙，开放-5901-端口：" class="headerlink" title="配置防火墙，开放 5901 端口："></a>配置防火墙，开放 5901 端口：</h3><figure class="highlight shell hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos-106 ~]# firewall-cmd --permanent --zone=public --add-port=5901/tcp</span><br><span class="line">success</span><br><span class="line">[root@centos-106 ~]# firewall-cmd --reload</span><br><span class="line">success</span><br><span class="line">[root@centos-106 ~]# </span><br></pre></td></tr></tbody></table></figure>

<h3 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h3><figure class="highlight shell hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="hljs-language-bash">重新加载systemd守护程序配置</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line"><span class="meta prompt_"># </span><span class="hljs-language-bash">将VNC服务器服务vncserver@:1.service设置为开机自启动</span></span><br><span class="line">systemctl enable vncserver@:1.service</span><br><span class="line"><span class="meta prompt_"># </span><span class="hljs-language-bash">将VNC服务器服务vncserver@:1.service启动</span></span><br><span class="line">systemctl start vncserver@:1.service</span><br><span class="line"><span class="meta prompt_">#</span><span class="hljs-language-bash"></span></span><br><span class="line"><span class="hljs-language-bash"><span class="hljs-comment"># 在终端上输出有关VNC服务器服务vncserver@:1.service的当前状态信息</span></span></span><br><span class="line">systemctl status vncserver@:1.service</span><br><span class="line"><span class="meta prompt_">#</span></span><br></pre></td></tr></tbody></table></figure>

<h2 id="本地使用-VNC-客户端进行远程桌面连接"><a href="#本地使用-VNC-客户端进行远程桌面连接" class="headerlink" title="本地使用 VNC 客户端进行远程桌面连接"></a>本地使用 VNC 客户端进行远程桌面连接</h2><p><code>VNC</code>客户端的选择有很多，例如以下用到的<code>UltraVNC Viewer</code>；还有<code>VNC Viewer</code>、<code>MobaXterm</code>，任君选择</p>
<h3 id="打开软件，输入-服务器地址-端口号-，点击-Connect"><a href="#打开软件，输入-服务器地址-端口号-，点击-Connect" class="headerlink" title="打开软件，输入 服务器地址:端口号 ，点击 Connect"></a>打开软件，输入 服务器地址:端口号 ，点击 Connect</h3><p><img src="https://s2.loli.net/2023/05/20/eokPTcQ9DN1mqfx.jpg" alt="ScreenCaputure230519175406"></p>
<h3 id="输入连接密码，点击-Log-On"><a href="#输入连接密码，点击-Log-On" class="headerlink" title="输入连接密码，点击 Log On"></a>输入连接密码，点击 Log On</h3><p><img src="https://s2.loli.net/2023/05/20/7ki35TpPR9ursC1.jpg" alt="ScreenCaputure230519174918"></p>
<h3 id="登陆界面"><a href="#登陆界面" class="headerlink" title="登陆界面"></a>登陆界面</h3><p><img src="https://s2.loli.net/2023/05/20/mldZUyFNcri17YG.jpg" alt="ScreenCaputure230520005726"></p>
<p><img src="https://s2.loli.net/2023/05/20/6MGFkfhVWr2AKgR.jpg" alt="ScreenCaputure230520005831"></p>
<h2 id="踩坑"><a href="#踩坑" class="headerlink" title="踩坑"></a>踩坑</h2><h3 id="运行-yum-update-之后，repo-文件的变化"><a href="#运行-yum-update-之后，repo-文件的变化" class="headerlink" title="运行 yum update 之后，repo 文件的变化"></a>运行 yum update 之后，repo 文件的变化</h3><p>在配置华为云CentOS-Vault yum源之后，运行<code>yum update</code>，好家伙把<code>/etc/yum.repos.d/</code>目录下<code>*.repo</code>文件给干掉了，又得重复一次<code>配置华为云CentOS-Vault yum源</code>的步骤</p>
<figure class="highlight shell hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos-106 yum.repos.d]# ll</span><br><span class="line">total 12</span><br><span class="line">-rw-r--r--. 1 root root 2218 May 18 13:03 CentOS-Base.repo</span><br><span class="line">drwxr-xr-x. 2 root root 4096 May 18 12:41 repo_back</span><br><span class="line">drwxr-xr-x. 2 root root 4096 May 18 13:03 repo_back2</span><br></pre></td></tr></tbody></table></figure>

<h3 id="运行-vncserver-等旧格式命令的提示"><a href="#运行-vncserver-等旧格式命令的提示" class="headerlink" title="运行 vncserver 等旧格式命令的提示"></a>运行 vncserver 等旧格式命令的提示</h3><p>在运行<code>vncserver</code>开头的命令后，会有一行提示如下</p>
<figure class="highlight shell hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WARNING: vncserver has been replaced by a systemd unit and is about to be removed in future releases.</span><br><span class="line">Please read /usr/share/doc/tigervnc/HOWTO.md for more information.</span><br></pre></td></tr></tbody></table></figure>

<p>在处理这个步骤耗费了本人非常多的时间，例如启动报错，启动不报错能连接但是黑屏各种问题。最后在CentOS论坛看到一篇帖子，看到提示去找 Red Hat 官网手册才处理好这个问题；顺便说一句搜索引擎各种关于安装VNC Server 的中文资料没一个能用（没标明环境和版本，索骥失败），最终还是去看官网手册；看来少吃别人嚼过的东西</p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><ul>
<li>参考资料:</li>
</ul>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- vncserver failed by ShinShin on 2020/11/17 : </span><br><span class="line">https://forums.centos.org/viewtopic.php?f=54&amp;t=76387</span><br><span class="line">- Red Hat Enterprise Linux 7 Deployment, configuration, and administration of RHEL 7 Chapter 13. TigerVNC:</span><br><span class="line">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/ch-tigervnc</span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>发现即使指定要求只下载<code>Server with GUI</code>，但安装时查看到软件包列表还是发现很多包一并安装了，这可能对已有运行服务产生影响，慎重使用，起码懂得回退的操作</li>
<li>现在服务器操作系统一般都上虚拟化了，操作这些安装升级的时候要记得做个快照，备份之类的</li>
<li>如有需要玩这个的话，强烈建议先在虚拟机多轮测试再去实际操作，多建立快照</li>
<li>配置完成后别忘了开防火墙策略SELINUX=enforcing，重开SELINUX真耗时间</li>
<li>业余选手，勿喷</li>
<li>欢迎“<del>来电</del>”来函探讨</li>
</ul>
</body></html>
    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/CentOS-8/">#CentOS 8</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/VNC/">#VNC</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/TigerVNC/">#TigerVNC</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/5901/">#5901</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/SELinux/">#SELinux</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/CentOS-Vault/">#CentOS-Vault</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/%E5%9B%BE%E5%BD%A2%E5%8C%96%E6%A1%8C%E9%9D%A2%E7%8E%AF%E5%A2%83/">#图形化桌面环境</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/posts/f652ccc4.html">CentOS-8.0.1905 安装配置图形化桌面环境和TigerVNC(离线安装)</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/posts/9481f4f2.html">添加hexo文章时效性提示</a>
            
        </span>
    </div>
    
</article>
<!-- 
DO NOT APPLY SHAREBOX

<div class="sharebox">
    
<div class="notification is-danger">
    You need to set <code>install_url</code> to use ShareThis. Please set it in <code>_config.yml</code>.
</div>

</div>

DO NOT APPLY COMMENTS

<div class="comments">
    <h3 class="title is-4">Comments</h3>
    
<div id="disqus_thread">
    
    <div class="notification is-danger">
        You forgot to set the <code>shortname</code> for Disqus. Please set it in <code>_config.yml</code>.
    </div>
    
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</div>

-->
    </div>
</section>
<footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2023 Kir Aster&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            
        </div>
    </div>
</footer>
<div id="totop" class="ctotop">
<a title="返回顶部"><img src="/images/scrollup.png"/></a>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("en-AU");
</script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
</script>

    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof($.fn.justifiedGallery) === 'function') {
                $('.justified-gallery > p > .gallery-item').unwrap();
                $('.justified-gallery').justifiedGallery();
            }
        });
    })(jQuery);
</script>

    
    
    
    

    



<script src="/js/script.js"></script>


<script src="/js/totop.js"></script>


<div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>

<script src="/js/insight.js"></script>


</body>
</html>
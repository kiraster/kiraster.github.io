<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
<meta charset="utf-8">
<title>配置跨域的Option C MPLS VPN（Cisco） - Kir&#39;s Blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">


<meta name="description" content="Kir的博客，网络设备配置，网络拓扑实验，华为华三路由交换无线安全HCIP,CISCO,NETWORK">


<meta name="keywords" content="Kir的博客，网络设备配置，网络拓扑实验，华为华三路由交换无线安全HCIP,CISCO,NETWORK">


    <meta name="description" content="Introduction This document describes how to configure and verify the Inter-AS  Layer 3 Multiprotocol Label Switching (MPLS) VPN, option C feature.  A sample network scenario and its  configuration and">
<meta property="og:type" content="article">
<meta property="og:title" content="配置跨域的Option C MPLS VPN（Cisco）">
<meta property="og:url" content="https://kiraster.github.io/posts/c0ba4ae2.html">
<meta property="og:site_name" content="Kir&#39;s Blog">
<meta property="og:description" content="Introduction This document describes how to configure and verify the Inter-AS  Layer 3 Multiprotocol Label Switching (MPLS) VPN, option C feature.  A sample network scenario and its  configuration and">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s2.loli.net/2023/03/07/oZLaRtUIcxgjFqe.jpg">
<meta property="og:image" content="https://s2.loli.net/2023/03/07/S4HEnAgOUe6QYpj.jpg">
<meta property="article:published_time" content="2023-03-07T09:05:34.000Z">
<meta property="article:modified_time" content="2023-05-22T09:14:36.308Z">
<meta property="article:author" content="Kir Aster">
<meta property="article:tag" content="Network Emulator">
<meta property="article:tag" content="PNETLab">
<meta property="article:tag" content="Cisco">
<meta property="article:tag" content="MPLS VPN">
<meta property="article:tag" content="Option C">
<meta property="article:tag" content="跨域">
<meta property="article:tag" content="nter-AS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2023/03/07/oZLaRtUIcxgjFqe.jpg">



<link rel="icon" href="https://s2.loli.net/2022/11/07/nR4jdLTGEq6kZ2S.png">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<!--引入思源黑体 rel-->
<link rel="preconnect" href="https://fonts.proxy.ustclug.org">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.proxy.ustclug.org/css2?family=Noto+Sans+SC&display=swap" rel="stylesheet">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">

<link rel="stylesheet" href="/css/style.css">

<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>

    
    
    
    
    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-209914470-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-209914470-1');
</script>


    
    
<!-- Clarity tracking code for https://kiraster.github.io/ -->
<script>
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i+"?ref=bwt";
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "heff72hdac");
</script>

    

<meta name="generator" content="Hexo 6.3.0"></head>
<body>

<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                    
                    Kir&#39;s
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/archives">Archives</a>
            
            <a class="navbar-item "
               href="/gallery">Gallery</a>
            
            <a class="navbar-item "
               href="/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="Search" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            <div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc">
                <a class="navbar-item" title="Table of Contents">
                    <i class="fa fa-list"></i>
                </a>
                <div class="navbar-dropdown is-right">
                    
                    
                    
                    
                    <a class="navbar-item" href="#环境">1&nbsp;&nbsp;<b>环境</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#配置">2&nbsp;&nbsp;<b>配置</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#网络拓扑">2.1&nbsp;&nbsp;网络拓扑</a>
                    
                    
                    
                    <a class="navbar-item" href="#拓扑规划">2.2&nbsp;&nbsp;拓扑规划</a>
                    
                    
                    
                    <a class="navbar-item" href="#配置思路">2.3&nbsp;&nbsp;配置思路</a>
                    
                    
                    
                    <a class="navbar-item" href="#配置步骤">2.4&nbsp;&nbsp;配置步骤</a>
                    
                    
                    
                    <a class="navbar-item" href="#配置-IP-地址-（略）">2.4.1&nbsp;&nbsp;配置 IP 地址 （略）</a>
                    
                    
                    
                    <a class="navbar-item" href="#配置-ISP-底层-IGP-（以-ISP-1-为例，ISP2-同理）">2.4.2&nbsp;&nbsp;配置 ISP 底层 IGP （以 ISP 1 为例，ISP2 同理）</a>
                    
                    
                    
                    <a class="navbar-item" href="#配置-ISP-启用-MPLS-LDP-（以-ISP-1-为例，ISP2-同理）">2.4.3&nbsp;&nbsp;配置 ISP 启用 MPLS LDP （以 ISP 1 为例，ISP2 同理）</a>
                    
                    
                    
                    <a class="navbar-item" href="#配置-PE-的-VRF，配置与-CE-互联的接口划分到-VRF">2.4.4&nbsp;&nbsp;配置 PE 的 VRF，配置与 CE 互联的接口划分到 VRF</a>
                    
                    
                    
                    <a class="navbar-item" href="#配置-ISP-的-BGP-邻居">2.4.5&nbsp;&nbsp;配置 ISP 的 BGP 邻居</a>
                    
                    
                    
                    <a class="navbar-item" href="#配置-CE-和-PE-间的路由协议">2.4.6&nbsp;&nbsp;配置 CE 和 PE 间的路由协议</a>
                    
                    
                    
                    <a class="navbar-item" href="#配置-PE-上-双向重分布">2.4.7&nbsp;&nbsp;配置 PE 上 双向重分布</a>
                    
                    
                    
                    <a class="navbar-item" href="#优化ISP-内部-OSPF-下一跳">2.4.8&nbsp;&nbsp;优化ISP 内部 OSPF 下一跳</a>
                    
                    
                    
                    <a class="navbar-item" href="#测试">2.5&nbsp;&nbsp;测试</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#一个视频">3&nbsp;&nbsp;<b>一个视频</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#最后">4&nbsp;&nbsp;<b>最后</b></a>
                    
                </div>
            </div>
            
            
        </div>
    </div>
</nav>

<section class="section">
    <div class="container">
    <article class="article content gallery" itemscope itemprop="blogPost">
    
      <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
          
              配置跨域的Option C MPLS VPN（Cisco）
          
      </h1>
    
    
      <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
          <span class="column is-narrow">
              
                  <i class="far fa-clock"></i>
                  <span>&nbspMar 7th 23&nbsp</span>
              
          </span>
          
          <span class="column is-narrow article-category">
              <i class="far fa-folder"></i>
              <a class="article-category-link" href="/categories/PNETLab/">PNETLab</a>
          </span>
          
          
          <span class="column is-narrow">
              
              
              21 minutes read (About 3212 words)
          </span>
          
      </div>
    
    <!-- add timeliness tips date:20230510 -->
    
      
      
    
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        
        <html><head></head><body><p><strong>Introduction</strong></p>
<p>This document describes how to configure and verify the Inter-AS  Layer 3 Multiprotocol Label Switching (MPLS) VPN, option C feature.  A sample network scenario and its  configuration and outputs are shown for a better understanding. <span id="more"></span></p>
<p>本文描述的是根据思科网站一篇配置文档（<a target="_blank" rel="noopener" href="https://www.cisco.com/c/en/us/support/docs/multiprotocol-label-switching-mpls/mpls/200523-Configuration-and-Verification-of-Layer.html#%EF%BC%89">https://www.cisco.com/c/en/us/support/docs/multiprotocol-label-switching-mpls/mpls/200523-Configuration-and-Verification-of-Layer.html#）</a> 修改搭建的一个实验。</p>
<hr>
<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul>
<li>模拟器：PNET 4.2.10 </li>
<li>Cisco IOL： l3-ADVENTERPRISEK9-M-15.4-2T.bin</li>
</ul>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="网络拓扑"><a href="#网络拓扑" class="headerlink" title="网络拓扑"></a>网络拓扑</h3><p><strong>网站原图</strong></p>
<p><img src="https://s2.loli.net/2023/03/07/oZLaRtUIcxgjFqe.jpg" alt="200523-Configuration-and-Verification-of-Layer-00"></p>
<p><strong>搭建的拓扑</strong></p>
<p><img src="https://s2.loli.net/2023/03/07/S4HEnAgOUe6QYpj.jpg" alt="ScreenCaputure230304012642"></p>
<h3 id="拓扑规划"><a href="#拓扑规划" class="headerlink" title="拓扑规划"></a>拓扑规划</h3><ol>
<li>每台路由配置环回接口 0 ，例如 R1 格式为： 1.1.1.1/32</li>
<li>互联接口为：设备编号1 + 设备编号2  + .1.1 + 设备编号1，例如 R1 e0/0 接口IP地址：12.1.1.1/24</li>
<li>R7、R8、R9、R10 为 CE，R11 和 R12 为 反射器</li>
<li>ISP1，ISP2 底层 IGP 运行 OSPF 协议</li>
<li>A1，A2  的 CE 与 PE 运行 OSPF 协议</li>
<li>B1，B2  的 CE 与 PE 运行 BGP 协议</li>
</ol>
<h3 id="配置思路"><a href="#配置思路" class="headerlink" title="配置思路"></a>配置思路</h3><ol>
<li>配置 ISP 底层 OSPF IGP ，验证：show ip os nei  / show ip route ospf</li>
<li>配置 ISP 启用 MPLS LDP，验证：show mpls interface / show mpls ldp discovery</li>
<li>配置 PE VRF，配置与 CE 互联接口划分到 VRF，验证：show ip vrf int / show ip route vrf <strong>X</strong></li>
<li>配置 ISP 的 BGP 邻居，验证：show ip b summ / show ip b vpnv4 all summ</li>
<li>配置 RR1 和 RR2 的 MP-eBGP，验证：show ip b vpnv4 all summ</li>
<li>配置 CE 和 PE 间的路由协议，验证：show ip route vrf <strong>X</strong> / show ip os nei / show ip b summ</li>
<li>配置 PE 上 双向重分布</li>
</ol>
<h3 id="配置步骤"><a href="#配置步骤" class="headerlink" title="配置步骤"></a>配置步骤</h3><ol>
<li><h4 id="配置-IP-地址-（略）"><a href="#配置-IP-地址-（略）" class="headerlink" title="配置 IP 地址 （略）"></a>配置 IP 地址 （略）</h4></li>
<li><h4 id="配置-ISP-底层-IGP-（以-ISP-1-为例，ISP2-同理）"><a href="#配置-ISP-底层-IGP-（以-ISP-1-为例，ISP2-同理）" class="headerlink" title="配置 ISP 底层 IGP （以 ISP 1 为例，ISP2 同理）"></a>配置 ISP 底层 IGP （以 ISP 1 为例，ISP2 同理）</h4><figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">!--- R1 commands.</span><br><span class="line"></span><br><span class="line">int ran e 0/0,e0/3,lo0</span><br><span class="line"> ip os 100 a 0</span><br><span class="line"> </span><br><span class="line">!--- R2 commands.</span><br><span class="line"></span><br><span class="line">int ran e0/0-1,e0/3,lo0</span><br><span class="line"> ip os 100 a 0</span><br><span class="line"> </span><br><span class="line">!--- R3 commands.</span><br><span class="line"></span><br><span class="line">int ran e 0/1,e0/3,lo0</span><br><span class="line"> ip os 100 a 0</span><br><span class="line"> </span><br><span class="line">!--- R11 commands.</span><br><span class="line"></span><br><span class="line">int ran e 0/1-3,lo0</span><br><span class="line"> ip os 100 a 0</span><br></pre></td></tr></tbody></table></figure>

<p><strong>验证：</strong>查看 OSPF 邻居，查看 OSPF 路由，以 R2 为例</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">!--- R2 output.</span><br><span class="line"></span><br><span class="line">R2#sh ip os nei</span><br><span class="line"></span><br><span class="line">Neighbor ID     Pri   State           Dead Time   Address         Interface</span><br><span class="line">11.11.11.11       1   FULL/BDR        00:00:39    112.1.1.11      Ethernet0/3</span><br><span class="line">3.3.3.3           1   FULL/DR         00:00:30    23.1.1.3        Ethernet0/1</span><br><span class="line">1.1.1.1           1   FULL/BDR        00:00:39    12.1.1.1        Ethernet0/0</span><br><span class="line"></span><br><span class="line">R2#sh ip route ospf | b Gate</span><br><span class="line">Gateway of last resort is not set</span><br><span class="line"></span><br><span class="line">      1.0.0.0/32 is subnetted, 1 subnets</span><br><span class="line">O        1.1.1.1 [110/11] via 12.1.1.1, 02:06:04, Ethernet0/0</span><br><span class="line">      3.0.0.0/32 is subnetted, 1 subnets</span><br><span class="line">O        3.3.3.3 [110/11] via 23.1.1.3, 02:05:54, Ethernet0/1</span><br><span class="line">      11.0.0.0/32 is subnetted, 1 subnets</span><br><span class="line">O        11.11.11.11 [110/11] via 112.1.1.11, 02:05:54, Ethernet0/3</span><br><span class="line">      111.0.0.0/24 is subnetted, 1 subnets</span><br><span class="line">O        111.1.1.0 [110/20] via 12.1.1.1, 02:06:04, Ethernet0/0</span><br><span class="line">      113.0.0.0/24 is subnetted, 1 subnets</span><br><span class="line">O        113.1.1.0 [110/20] via 23.1.1.3, 02:05:54, Ethernet0/1</span><br><span class="line">R2#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><h4 id="配置-ISP-启用-MPLS-LDP-（以-ISP-1-为例，ISP2-同理）"><a href="#配置-ISP-启用-MPLS-LDP-（以-ISP-1-为例，ISP2-同理）" class="headerlink" title="配置 ISP 启用 MPLS LDP （以 ISP 1 为例，ISP2 同理）"></a>配置 ISP 启用 MPLS LDP （以 ISP 1 为例，ISP2 同理）</h4><figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">!--- R1 commands.</span><br><span class="line"></span><br><span class="line">int ran e 0/0,e0/3    </span><br><span class="line"> mpls ip</span><br><span class="line"> </span><br><span class="line">!--- R2 commands.</span><br><span class="line"></span><br><span class="line">int ran e0/0-1,e0/3    </span><br><span class="line"> mpls ip</span><br><span class="line"></span><br><span class="line">!--- R3 commands.</span><br><span class="line"></span><br><span class="line">int ran e 0/1,e0/3    </span><br><span class="line"> mpls ip</span><br><span class="line"></span><br><span class="line">!--- R11 commands.</span><br><span class="line"></span><br><span class="line">int ran e 0/1-3</span><br><span class="line"> mpls ip</span><br></pre></td></tr></tbody></table></figure>

<p><strong>验证：</strong> 查看 LDP 接口和 ldp 会话，以 R2 为例</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">!--- R2 output.</span><br><span class="line"></span><br><span class="line">R2#sh mpls interfaces </span><br><span class="line">Interface              IP            Tunnel   BGP Static Operational</span><br><span class="line">Ethernet0/0            Yes (ldp)     No       No  No     Yes        </span><br><span class="line">Ethernet0/1            Yes (ldp)     No       No  No     Yes        </span><br><span class="line">Ethernet0/3            Yes (ldp)     No       No  No     Yes        </span><br><span class="line">R2#sh mpls ldp dis</span><br><span class="line">R2#sh mpls ldp discovery </span><br><span class="line"> Local LDP Identifier:</span><br><span class="line">    2.2.2.2:0</span><br><span class="line">    Discovery Sources:</span><br><span class="line">    Interfaces:</span><br><span class="line">        Ethernet0/0 (ldp): xmit/recv</span><br><span class="line">            LDP Id: 1.1.1.1:0</span><br><span class="line">        Ethernet0/1 (ldp): xmit/recv</span><br><span class="line">            LDP Id: 3.3.3.3:0</span><br><span class="line">        Ethernet0/3 (ldp): xmit/recv</span><br><span class="line">            LDP Id: 11.11.11.11:0</span><br><span class="line">R2#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><h4 id="配置-PE-的-VRF，配置与-CE-互联的接口划分到-VRF"><a href="#配置-PE-的-VRF，配置与-CE-互联的接口划分到-VRF" class="headerlink" title="配置 PE 的 VRF，配置与 CE 互联的接口划分到 VRF"></a>配置 PE 的 VRF，配置与 CE 互联的接口划分到 VRF</h4><figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">!--- R1 commands.</span><br><span class="line"></span><br><span class="line">ip vrf a</span><br><span class="line"> rd 7:100</span><br><span class="line"> route-target export 7:7</span><br><span class="line"> route-target import 9:9</span><br><span class="line">ip vrf b</span><br><span class="line"> rd 8:100</span><br><span class="line"> route-target export 8:8</span><br><span class="line"> route-target import 10:10</span><br><span class="line"> </span><br><span class="line">!</span><br><span class="line">interface Ethernet0/1</span><br><span class="line"> ip vrf forwarding a</span><br><span class="line"> ip address 17.1.1.1 255.255.255.0</span><br><span class="line"></span><br><span class="line">interface Ethernet0/2</span><br><span class="line"> ip vrf forwarding b</span><br><span class="line"> ip address 18.1.1.1 255.255.255.0</span><br><span class="line"></span><br><span class="line">!--- R6 commands.</span><br><span class="line"></span><br><span class="line">ip vrf a</span><br><span class="line"> rd 9:200</span><br><span class="line"> route-target export 9:9</span><br><span class="line"> route-target import 7:7</span><br><span class="line">ip vrf b</span><br><span class="line"> rd 10:200</span><br><span class="line"> route-target export 10:10</span><br><span class="line"> route-target import 8:8</span><br><span class="line"> </span><br><span class="line">interface Ethernet0/1</span><br><span class="line"> ip vrf forwarding a</span><br><span class="line"> ip address 69.1.1.6 255.255.255.0</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/2</span><br><span class="line"> ip vrf forwarding b</span><br><span class="line"> ip address 106.1.1.6 255.255.255.0</span><br></pre></td></tr></tbody></table></figure>

<p><strong>验证：</strong>查看 VRF 路由表，以 R1 为例</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">!--- R1 output.</span><br><span class="line"></span><br><span class="line">R1#sh ip route vrf a | b Gate</span><br><span class="line">Gateway of last resort is not set</span><br><span class="line"></span><br><span class="line">      17.0.0.0/8 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        17.1.1.0/24 is directly connected, Ethernet0/1</span><br><span class="line">L        17.1.1.1/32 is directly connected, Ethernet0/1</span><br><span class="line">R1#</span><br><span class="line">R1#sh ip route vrf b | b Gate</span><br><span class="line">Gateway of last resort is not set</span><br><span class="line"></span><br><span class="line">      18.0.0.0/8 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        18.1.1.0/24 is directly connected, Ethernet0/2</span><br><span class="line">L        18.1.1.1/32 is directly connected, Ethernet0/2</span><br><span class="line">R1#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><h4 id="配置-ISP-的-BGP-邻居"><a href="#配置-ISP-的-BGP-邻居" class="headerlink" title="配置 ISP 的 BGP 邻居"></a>配置 ISP 的 BGP 邻居</h4><p><strong>R3 与 R4 配置 IPv4 BGP 邻居，R3 宣告 1.1.1.1 和 11.11.11.11，R4 宣告 6.6.6.6 和 12.12.12.12</strong></p>
<p><strong>将 BGP 路由重分布进底层 OSPF 协议，为了学习到对端 RR 和 PE 路由，建立 MP-BGP 需要</strong></p>
<p>由于底层 OSPF 协议的运行，R3 与 R4 已经学习到这些路由，在建立 eBGP 邻居后能传递到对端</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">!--- R3 commands.</span><br><span class="line"></span><br><span class="line">router bgp 100</span><br><span class="line"> bgp log-neighbor-changes</span><br><span class="line"> network 1.1.1.1 mask 255.255.255.255</span><br><span class="line"> network 11.11.11.11 mask 255.255.255.255</span><br><span class="line"> neighbor 34.1.1.4 remote-as 200</span><br><span class="line"> neighbor 34.1.1.4 send-label</span><br><span class="line"> </span><br><span class="line">router ospf 100</span><br><span class="line"> redistribute bgp 100 subnets</span><br><span class="line"> </span><br><span class="line">!--- R4 commands.</span><br><span class="line"></span><br><span class="line">router bgp 200</span><br><span class="line"> bgp log-neighbor-changes</span><br><span class="line"> network 6.6.6.6 mask 255.255.255.255</span><br><span class="line"> network 12.12.12.12 mask 255.255.255.255</span><br><span class="line"> neighbor 34.1.1.3 remote-as 100</span><br><span class="line"> neighbor 34.1.1.3 send-label</span><br><span class="line"> </span><br><span class="line">router ospf 200</span><br><span class="line"> redistribute bgp 200 subnets</span><br></pre></td></tr></tbody></table></figure>

<p><strong>验证：</strong></p>
<p>R3 与 R4 的 eBGP 邻居</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">R3#sh ip b summary </span><br><span class="line">BGP router identifier 3.3.3.3, local AS number 100</span><br><span class="line">BGP table version is 75, main routing table version 75</span><br><span class="line">4 network entries using 560 bytes of memory</span><br><span class="line">4 path entries using 320 bytes of memory</span><br><span class="line">4/4 BGP path/bestpath attribute entries using 576 bytes of memory</span><br><span class="line">1 BGP AS-PATH entries using 24 bytes of memory</span><br><span class="line">0 BGP route-map cache entries using 0 bytes of memory</span><br><span class="line">0 BGP filter-list cache entries using 0 bytes of memory</span><br><span class="line">BGP using 1480 total bytes of memory</span><br><span class="line">BGP activity 4/0 prefixes, 36/32 paths, scan interval 60 secs</span><br><span class="line"></span><br><span class="line">Neighbor        V           AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd</span><br><span class="line">34.1.1.4        4          200      90      90       75    0    0 01:16:45        0</span><br></pre></td></tr></tbody></table></figure>

<p>R1 的 1.1.1.1 去往 R6 的 6.6.6.6 路由可达，标签路径连续</p>
<p>R11 的 11.11.11.11 去往 R12 的 12.12.12.12 路由可达，标签路径连续</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">R1#ping  6.6.6.6 source 1.1.1.1        </span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending 5, 100-byte ICMP Echos to 6.6.6.6, timeout is 2 seconds:</span><br><span class="line">Packet sent with a source address of 1.1.1.1 </span><br><span class="line">!!!!!</span><br><span class="line">Success rate is 100 percent (5/5), round-trip min/avg/max = 6/6/8 ms</span><br><span class="line">R1#traceroute 6.6.6.6 source 1.1.1.1</span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Tracing the route to 6.6.6.6</span><br><span class="line">VRF info: (vrf in name/id, vrf out name/id)</span><br><span class="line">  1 12.1.1.2 [MPLS: Label 24 Exp 0] 5 msec 6 msec 6 msec</span><br><span class="line">  2 23.1.1.3 [MPLS: Label 26 Exp 0] 6 msec 5 msec 6 msec</span><br><span class="line">  3 34.1.1.4 [MPLS: Label 27 Exp 0] 7 msec 7 msec 5 msec</span><br><span class="line">  4 45.1.1.5 [MPLS: Label 22 Exp 0] 4 msec 5 msec 6 msec</span><br><span class="line">  5 56.1.1.6 6 msec *  7 msec</span><br><span class="line">R1#</span><br><span class="line">----------------------------------------------------------</span><br><span class="line">R11#ping 12.12.12.12 source 11.11.11.11</span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending 5, 100-byte ICMP Echos to 12.12.12.12, timeout is 2 seconds:</span><br><span class="line">Packet sent with a source address of 11.11.11.11 </span><br><span class="line">!!!!!</span><br><span class="line">Success rate is 100 percent (5/5), round-trip min/avg/max = 3/3/4 ms</span><br><span class="line">R11#trace 12.12.12.12 source 11.11.11.11</span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Tracing the route to 12.12.12.12</span><br><span class="line">VRF info: (vrf in name/id, vrf out name/id)</span><br><span class="line">  1 113.1.1.3 [MPLS: Label 27 Exp 0] 4 msec 4 msec 4 msec</span><br><span class="line">  2 34.1.1.4 [MPLS: Label 25 Exp 0] 3 msec 2 msec 2 msec</span><br><span class="line">  3 124.1.1.12 4 msec *  4 msec</span><br><span class="line">R11#</span><br></pre></td></tr></tbody></table></figure>

<p><strong>关于send-label 命令：</strong></p>
<p>tell the router to send the lables of bgp prefix to its peer，为 BGP 路由传递标签，使用此命令后，对应接口自动配置 mpls bgp forwarding ，但是 no 掉后接口的这行配置并不会自动去掉</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*Mar  4 05:54:10.850: %BGP_LMM-6-AUTOGEN1: The mpls bgp forwarding command has been configured on interface: Ethernet0/0</span><br></pre></td></tr></tbody></table></figure>

<p>未配置 <strong>send-label</strong> 命令前，R3 去往 6.6.6.6 的标签 是空标签，R3 的动作是弹出所有标签，标签中断。</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">R3#sh mpls forwarding-table 6.6.6.6</span><br><span class="line">Local      Outgoing   Prefix           Bytes Label   Outgoing   Next Hop    </span><br><span class="line">Label      Label      or Tunnel Id     Switched      interface              </span><br><span class="line">26         No Label   6.6.6.6/32       0             Et0/0      34.1.1.4    </span><br><span class="line">R3#sh ip b la                      </span><br><span class="line">R3#sh ip b labels </span><br><span class="line">   Network          Next Hop      In label/Out label</span><br><span class="line">   1.1.1.1/32       23.1.1.2        nolabel/nolabel</span><br><span class="line">   6.6.6.6/32       34.1.1.4        nolabel/nolabel</span><br><span class="line">   11.11.11.11/32   113.1.1.11      nolabel/nolabel</span><br><span class="line">   12.12.12.12/32   34.1.1.4        nolabel/nolabel</span><br><span class="line"></span><br><span class="line">R3#sh ip b 6.6.6.6        </span><br><span class="line">BGP routing table entry for 6.6.6.6/32, version 66</span><br><span class="line">Paths: (1 available, best #1, table default)</span><br><span class="line">  Not advertised to any peer</span><br><span class="line">  Refresh Epoch 1</span><br><span class="line">  200</span><br><span class="line">    34.1.1.4 from 34.1.1.4 (4.4.4.4)</span><br><span class="line">      Origin IGP, metric 21, localpref 100, valid, external, best</span><br><span class="line">      rx pathid: 0, tx pathid: 0x0</span><br><span class="line">R3#</span><br></pre></td></tr></tbody></table></figure>

<p>配置 <strong>send-label</strong> 命令后，分配 27 标签</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">R3#sh mpls forwarding-table 6.6.6.6</span><br><span class="line">Local      Outgoing   Prefix           Bytes Label   Outgoing   Next Hop    </span><br><span class="line">Label      Label      or Tunnel Id     Switched      interface              </span><br><span class="line">26         27         6.6.6.6/32       0             Et0/0      34.1.1.4    </span><br><span class="line">R3#sh ip b labels                  </span><br><span class="line">   Network          Next Hop      In label/Out label</span><br><span class="line">   1.1.1.1/32       23.1.1.2        21/nolabel</span><br><span class="line">   6.6.6.6/32       34.1.1.4        nolabel/27</span><br><span class="line">   11.11.11.11/32   113.1.1.11      25/nolabel</span><br><span class="line">   12.12.12.12/32   34.1.1.4        nolabel/25</span><br><span class="line"></span><br><span class="line">R3#sh ip b 6.6.6.6                 </span><br><span class="line">BGP routing table entry for 6.6.6.6/32, version 56</span><br><span class="line">Paths: (1 available, best #1, table default)</span><br><span class="line">  Not advertised to any peer</span><br><span class="line">  Refresh Epoch 1</span><br><span class="line">  200</span><br><span class="line">    34.1.1.4 from 34.1.1.4 (4.4.4.4)</span><br><span class="line">      Origin IGP, metric 21, localpref 100, valid, external, best</span><br><span class="line">      mpls labels in/out nolabel/27</span><br><span class="line">      rx pathid: 0, tx pathid: 0x0</span><br><span class="line"></span><br><span class="line"># 在 R4 上查看到关于去往6.6.6.6 的 入向标签 27</span><br><span class="line">R4#sh ip bgp labels </span><br><span class="line">   Network          Next Hop      In label/Out label</span><br><span class="line">   1.1.1.1/32       34.1.1.3        nolabel/21</span><br><span class="line">   6.6.6.6/32       45.1.1.5        27/nolabel</span><br><span class="line">   11.11.11.11/32   34.1.1.3        nolabel/25</span><br><span class="line">   12.12.12.12/32   124.1.1.12      25/nolabel</span><br><span class="line"></span><br><span class="line">R4#</span><br></pre></td></tr></tbody></table></figure>

<p><strong>R1 与 R11 配置 BGP VPNV4 邻居</strong></p>
<p>注意：R3 与 R11 不建立 BGP 邻居</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">!--- R1 commands.</span><br><span class="line"></span><br><span class="line">router bgp 100</span><br><span class="line"> no bgp default ipv4-unicast</span><br><span class="line"> neighbor 11.11.11.11 remote-as 100</span><br><span class="line"> neighbor 11.11.11.11 update-source Loopback0</span><br><span class="line"></span><br><span class="line"> address-family vpnv4</span><br><span class="line">  neighbor 11.11.11.11 activate</span><br><span class="line">  </span><br><span class="line">!--- R11 commands.</span><br><span class="line"> </span><br><span class="line">router bgp 100</span><br><span class="line"> bgp log-neighbor-changes</span><br><span class="line"> no bgp default ipv4-unicast</span><br><span class="line"> neighbor 1.1.1.1 remote-as 100</span><br><span class="line"> neighbor 1.1.1.1 update-source Loopback0</span><br><span class="line"></span><br><span class="line"> address-family vpnv4</span><br><span class="line">  neighbor 1.1.1.1 activate</span><br><span class="line">  neighbor 1.1.1.1 route-reflector-client</span><br></pre></td></tr></tbody></table></figure>

<p><strong>R6 与 R12 配置 BGP VPNV4 邻居</strong></p>
<p>注意：R4 与 R12 不建立 BGP 邻居</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">!--- R6 commands.</span><br><span class="line"></span><br><span class="line">router bgp 200</span><br><span class="line"> no bgp default ipv4-unicast</span><br><span class="line"> neighbor 12.12.12.12 remote-as 200</span><br><span class="line"> neighbor 12.12.12.12 update-source Loopback0</span><br><span class="line"></span><br><span class="line"> address-family vpnv4</span><br><span class="line">  neighbor 12.12.12.12 activate</span><br><span class="line">  </span><br><span class="line">!--- R12 commands.</span><br><span class="line"></span><br><span class="line">router bgp 200</span><br><span class="line"> no bgp default ipv4-unicast</span><br><span class="line"> neighbor 6.6.6.6 remote-as 200</span><br><span class="line"> neighbor 6.6.6.6 update-source Loopback0</span><br><span class="line"></span><br><span class="line"> address-family vpnv4</span><br><span class="line">  neighbor 6.6.6.6 activate</span><br><span class="line">  neighbor 6.6.6.6 route-reflector-client</span><br></pre></td></tr></tbody></table></figure>

<p><strong>验证：</strong>VPNV4 邻居</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh ip b vpnv4 all summary </span><br></pre></td></tr></tbody></table></figure>

<p><strong>R11 与 R12 建立 MP-eBGP 邻居</strong></p>
<p>设置 eBGP 多跳。不是物理直连的 eBGP 邻居</p>
<p>设置下一跳不改变。R11 与 R12 建立 MP-eBGP 邻居，传递路由时默认下一跳改变成自身，这样 ISP 两侧的流量互通都流经反射器不合理，设置下一跳不改变后，R1 上去往 ISP2 CE 的路由下一跳看到的是 R6 的 6.6.6.6 ，最后再在两个 ISP 内部控制底层 IGP 的路径，使得流量不经过反射器。</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">!--- R11 commands.</span><br><span class="line"></span><br><span class="line">router bgp 100</span><br><span class="line"> neighbor 12.12.12.12 remote-as 200</span><br><span class="line"> neighbor 12.12.12.12 ebgp-multihop 255</span><br><span class="line"> neighbor 12.12.12.12 update-source Loopback0</span><br><span class="line"></span><br><span class="line"> address-family vpnv4</span><br><span class="line">  neighbor 12.12.12.12 activate</span><br><span class="line">  neighbor 12.12.12.12 next-hop-unchanged</span><br><span class="line"></span><br><span class="line">!--- R12 commands.</span><br><span class="line"></span><br><span class="line">router bgp 200</span><br><span class="line"> neighbor 11.11.11.11 remote-as 100</span><br><span class="line"> neighbor 11.11.11.11 ebgp-multihop 255</span><br><span class="line"> neighbor 11.11.11.11 update-source Loopback0</span><br><span class="line"></span><br><span class="line"> address-family vpnv4</span><br><span class="line">  neighbor 11.11.11.11 activate</span><br><span class="line">  neighbor 11.11.11.11 next-hop-unchanged</span><br></pre></td></tr></tbody></table></figure>

<p>验证：查看 R11 上的 BGP  邻居</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">R11#sh ip b vpnv4 all summary </span><br><span class="line">BGP router identifier 11.11.11.11, local AS number 100</span><br><span class="line">BGP table version is 67, main routing table version 67</span><br><span class="line">6 network entries using 912 bytes of memory</span><br><span class="line">6 path entries using 480 bytes of memory</span><br><span class="line">5/5 BGP path/bestpath attribute entries using 760 bytes of memory</span><br><span class="line">3 BGP AS-PATH entries using 72 bytes of memory</span><br><span class="line">4 BGP extended community entries using 128 bytes of memory</span><br><span class="line">0 BGP route-map cache entries using 0 bytes of memory</span><br><span class="line">0 BGP filter-list cache entries using 0 bytes of memory</span><br><span class="line">BGP using 2352 total bytes of memory</span><br><span class="line">BGP activity 6/0 prefixes, 6/0 paths, scan interval 60 secs</span><br><span class="line"></span><br><span class="line">Neighbor        V           AS MsgRcvd MsgSent   TblVer  InQ OutQ Up/Down  State/PfxRcd</span><br><span class="line">1.1.1.1         4          100     127     151       67    0    0 01:50:57        3</span><br><span class="line">12.12.12.12     4          200     190     185       67    0    0 01:50:16        3</span><br><span class="line">R11#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><h4 id="配置-CE-和-PE-间的路由协议"><a href="#配置-CE-和-PE-间的路由协议" class="headerlink" title="配置 CE 和 PE 间的路由协议"></a>配置 CE 和 PE 间的路由协议</h4><p>以 R7，R8，R1 为例， R9，R10，R6 同理</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">!--- R7 commands.</span><br><span class="line"></span><br><span class="line">int ran e 0/0,lo0</span><br><span class="line"> ip os 7 a 0</span><br><span class="line"></span><br><span class="line">!--- R8 commands.</span><br><span class="line"></span><br><span class="line">router bgp 300</span><br><span class="line"> network 8.8.8.8 mask 255.255.255.255</span><br><span class="line"> neighbor 18.1.1.1 remote-as 100</span><br><span class="line"> </span><br><span class="line">!--- R1 commands.</span><br><span class="line"></span><br><span class="line">router ospf 1 vrf a</span><br><span class="line"> router-id 1.1.1.17</span><br><span class="line"> network 17.1.1.1 0.0.0.0 area 0</span><br><span class="line"> </span><br><span class="line">router bgp 100</span><br><span class="line"> address-family ipv4 vrf b</span><br><span class="line">  neighbor 18.1.1.8 remote-as 300</span><br></pre></td></tr></tbody></table></figure>

<p><strong>验证：</strong></p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">show ip os nei</span><br><span class="line">show ip route ospf</span><br><span class="line">show ip route vrf a</span><br><span class="line">show ip route vrf b</span><br><span class="line"></span><br><span class="line">sh ip b summary </span><br></pre></td></tr></tbody></table></figure>


</li>
<li><h4 id="配置-PE-上-双向重分布"><a href="#配置-PE-上-双向重分布" class="headerlink" title="配置 PE 上 双向重分布"></a>配置 PE 上 双向重分布</h4><p>以 R1 为例，只需在 VRF a </p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">!--- R1 commands.</span><br><span class="line"># 只需在 vrf a 和 BGP ipv4 vrf a 视图下配置重分布</span><br><span class="line"># R8 - R1 之间运行的是 BGP ，在 BGP ipv4 vrf b 视图下建立邻居即可</span><br><span class="line"></span><br><span class="line">router ospf 1 vrf a</span><br><span class="line"> redistribute bgp 100 subnets</span><br><span class="line"> </span><br><span class="line">router bgp 100</span><br><span class="line"> address-family ipv4 vrf a</span><br><span class="line">  redistribute ospf 1</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><h4 id="优化ISP-内部-OSPF-下一跳"><a href="#优化ISP-内部-OSPF-下一跳" class="headerlink" title="优化ISP 内部 OSPF 下一跳"></a>优化ISP 内部 OSPF 下一跳</h4><p>查看 R1 路由表发现，去往 9.9.9.9 下一跳是 6.6.6.6</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">R1#sh ip b vpnv4 vrf a </span><br><span class="line">BGP table version is 166, local router ID is 1.1.1.1</span><br><span class="line">Status codes: s suppressed, d damped, h history, * valid, &gt; best, i - internal, </span><br><span class="line">              r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter, </span><br><span class="line">              x best-external, a additional-path, c RIB-compressed, </span><br><span class="line">Origin codes: i - IGP, e - EGP, ? - incomplete</span><br><span class="line">RPKI validation codes: V valid, I invalid, N Not found</span><br><span class="line"></span><br><span class="line">     Network          Next Hop            Metric LocPrf Weight Path</span><br><span class="line">Route Distinguisher: 7:100 (default for vrf a)</span><br><span class="line"> *&gt;  7.7.7.7/32       17.1.1.7                11         32768 ?</span><br><span class="line"> *&gt;i 9.9.9.9/32       6.6.6.6                  0    100      0 200 ?</span><br><span class="line"> *&gt;  17.1.1.0/24      0.0.0.0                  0         32768 ?</span><br><span class="line"> *&gt;i 69.1.1.0/24      6.6.6.6                  0    100      0 200 ?</span><br><span class="line">R1#</span><br><span class="line">R1#sh ip route vrf a  | b Gate</span><br><span class="line">Gateway of last resort is not set</span><br><span class="line"></span><br><span class="line">      7.0.0.0/32 is subnetted, 1 subnets</span><br><span class="line">O        7.7.7.7 [110/11] via 17.1.1.7, 04:21:39, Ethernet0/1</span><br><span class="line">      9.0.0.0/32 is subnetted, 1 subnets</span><br><span class="line">B        9.9.9.9 [200/0] via 6.6.6.6, 03:10:42</span><br><span class="line">      17.0.0.0/8 is variably subnetted, 2 subnets, 2 masks</span><br><span class="line">C        17.1.1.0/24 is directly connected, Ethernet0/1</span><br><span class="line">L        17.1.1.1/32 is directly connected, Ethernet0/1</span><br><span class="line">      69.0.0.0/24 is subnetted, 1 subnets</span><br><span class="line">B        69.1.1.0 [200/0] via 6.6.6.6, 03:10:42</span><br><span class="line">R1#</span><br></pre></td></tr></tbody></table></figure>

<p>再查找，去往 6.6.6.6 前缀有两条路径，管理和开销都一致，负载均衡？</p>
<p>这条路由是 R3 BGP 重分布进底层 IGP OSPF 而学习到的，有两条路径，管理距离110，metric 1 ，这时候需要比较forwarding metric，很不巧的是forwarding metric 也是一样，这样去往 6.6.6.6 就真负载均衡。forwarding metric  是本地到 ASBR 的 开销，修改 R11 e0/1-3 的开销。同理也需要修改 R12 的接口开销。</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">O E2     12.12.12.12/32 [110/1] via 111.1.1.11, 01:37:27, Ethernet0/3</span><br><span class="line">                        [110/1] via 12.1.1.2, 03:15:27, Ethernet0/0</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">R1#sh ip route | b Gate</span><br><span class="line">Gateway of last resort is not set</span><br><span class="line"></span><br><span class="line">      1.0.0.0/32 is subnetted, 1 subnets</span><br><span class="line">C        1.1.1.1 is directly connected, Loopback0</span><br><span class="line">      2.0.0.0/32 is subnetted, 1 subnets</span><br><span class="line">O        2.2.2.2 [110/11] via 12.1.1.2, 04:26:59, Ethernet0/0</span><br><span class="line">      3.0.0.0/32 is subnetted, 1 subnets</span><br><span class="line">O        3.3.3.3 [110/21] via 111.1.1.11, 01:37:27, Ethernet0/3</span><br><span class="line">                 [110/21] via 12.1.1.2, 04:26:49, Ethernet0/0</span><br><span class="line">      6.0.0.0/32 is subnetted, 1 subnets</span><br><span class="line">O E2     6.6.6.6 [110/1] via 111.1.1.11, 01:37:27, Ethernet0/3</span><br><span class="line">                 [110/1] via 12.1.1.2, 03:15:27, Ethernet0/0</span><br><span class="line">……</span><br><span class="line"></span><br><span class="line">R1#</span><br><span class="line">R1#sh ip route 6.6.6.6</span><br><span class="line">Routing entry for 6.6.6.6/32</span><br><span class="line">  Known via "ospf 100", distance 110, metric 1</span><br><span class="line">  Tag 200, type extern 2, forward metric 20</span><br><span class="line">  Last update from 12.1.1.2 on Ethernet0/0, 00:00:51 ago</span><br><span class="line">  Routing Descriptor Blocks:</span><br><span class="line">  * 111.1.1.11, from 3.3.3.3, 00:31:15 ago, via Ethernet0/3</span><br><span class="line">      Route metric is 1, traffic share count is 1</span><br><span class="line">      Route tag 200</span><br><span class="line">    12.1.1.2, from 3.3.3.3, 00:00:51 ago, via Ethernet0/0</span><br><span class="line">      Route metric is 1, traffic share count is 1</span><br><span class="line">      Route tag 200</span><br><span class="line">R1#</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 修改 R11 R12 的接口开销</span><br><span class="line"></span><br><span class="line">R11(config)#int ran e 0/1-/3  </span><br><span class="line">R11(config-if-range)#ip ospf cost 1000</span><br><span class="line"></span><br><span class="line">R12(config-if)#int ran e 0/1-0/3</span><br><span class="line">R12(config-if-range)#ip ospf cost 1000</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># 修改 R11 R12 的接口开销后</span><br><span class="line">R1#sh ip route 6.6.6.6</span><br><span class="line">Routing entry for 6.6.6.6/32</span><br><span class="line">  Known via "ospf 100", distance 110, metric 1</span><br><span class="line">  Tag 200, type extern 2, forward metric 20</span><br><span class="line">  Last update from 12.1.1.2 on Ethernet0/0, 00:08:51 ago</span><br><span class="line">  Routing Descriptor Blocks:</span><br><span class="line">  * 12.1.1.2, from 3.3.3.3, 00:08:51 ago, via Ethernet0/0</span><br><span class="line">      Route metric is 1, traffic share count is 1</span><br><span class="line">      Route tag 200</span><br><span class="line">R1#</span><br><span class="line">R6#sh ip rou 1.1.1.1 </span><br><span class="line">Routing entry for 1.1.1.1/32</span><br><span class="line">  Known via "ospf 200", distance 110, metric 1</span><br><span class="line">  Tag 100, type extern 2, forward metric 20</span><br><span class="line">  Last update from 56.1.1.5 on Ethernet0/0, 00:02:30 ago</span><br><span class="line">  Routing Descriptor Blocks:</span><br><span class="line">  * 56.1.1.5, from 4.4.4.4, 00:39:02 ago, via Ethernet0/0</span><br><span class="line">      Route metric is 1, traffic share count is 1</span><br><span class="line">      Route tag 100</span><br><span class="line">R6#</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p><strong>R7 和 R9 之间的 ping 操作</strong></p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">R7#ping 9.9.9.9 source 7.7.7.7</span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending 5, 100-byte ICMP Echos to 9.9.9.9, timeout is 2 seconds:</span><br><span class="line">Packet sent with a source address of 7.7.7.7 </span><br><span class="line">!!!!!</span><br><span class="line">Success rate is 100 percent (5/5), round-trip min/avg/max = 8/8/11 ms</span><br><span class="line">R7#</span><br><span class="line">R9#ping 7.7.7.7 source 9.9.9.9</span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending 5, 100-byte ICMP Echos to 7.7.7.7, timeout is 2 seconds:</span><br><span class="line">Packet sent with a source address of 9.9.9.9 </span><br><span class="line">!!!!!</span><br><span class="line">Success rate is 100 percent (5/5), round-trip min/avg/max = 8/8/10 ms</span><br><span class="line">R9#</span><br></pre></td></tr></tbody></table></figure>

<p><strong>R8 和 R10 之间的 ping 操作</strong></p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">R8#ping 10.10.10.10 source 8.8.8.8</span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending 5, 100-byte ICMP Echos to 10.10.10.10, timeout is 2 seconds:</span><br><span class="line">Packet sent with a source address of 8.8.8.8 </span><br><span class="line">!!!!!</span><br><span class="line">Success rate is 100 percent (5/5), round-trip min/avg/max = 8/9/13 ms</span><br><span class="line">R8#</span><br><span class="line">R10#ping 8.8.8.8 source 10.10.10.10</span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Sending 5, 100-byte ICMP Echos to 8.8.8.8, timeout is 2 seconds:</span><br><span class="line">Packet sent with a source address of 10.10.10.10 </span><br><span class="line">!!!!!</span><br><span class="line">Success rate is 100 percent (5/5), round-trip min/avg/max = 8/9/10 ms</span><br><span class="line">R10#</span><br></pre></td></tr></tbody></table></figure>

<p><strong>R7 和 R9 之间的 Traceroute 操作</strong></p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">R7#traceroute 9.9.9.9 source 7.7.7.7</span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Tracing the route to 9.9.9.9</span><br><span class="line">VRF info: (vrf in name/id, vrf out name/id)</span><br><span class="line">  1 17.1.1.1 1 msec 1 msec 2 msec</span><br><span class="line">  2 12.1.1.2 [MPLS: Labels 24/26 Exp 0] 8 msec 8 msec 8 msec</span><br><span class="line">  3 23.1.1.3 [MPLS: Labels 26/26 Exp 0] 8 msec 12 msec 7 msec</span><br><span class="line">  4 34.1.1.4 [MPLS: Labels 27/26 Exp 0] 8 msec 9 msec 8 msec</span><br><span class="line">  5 45.1.1.5 [MPLS: Labels 22/26 Exp 0] 9 msec 8 msec 8 msec</span><br><span class="line">  6 69.1.1.6 [MPLS: Label 26 Exp 0] 9 msec 7 msec 9 msec</span><br><span class="line">  7 69.1.1.9 9 msec *  9 msec</span><br><span class="line">R7#</span><br><span class="line">R9#traceroute 7.7.7.7 source 9.9.9.9</span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Tracing the route to 7.7.7.7</span><br><span class="line">VRF info: (vrf in name/id, vrf out name/id)</span><br><span class="line">  1 69.1.1.6 2 msec 39 msec 2 msec</span><br><span class="line">  2 56.1.1.5 [MPLS: Labels 25/26 Exp 0] 10 msec 9 msec 9 msec</span><br><span class="line">  3 45.1.1.4 [MPLS: Labels 23/26 Exp 0] 12 msec 9 msec 9 msec</span><br><span class="line">  4 34.1.1.3 [MPLS: Labels 21/26 Exp 0] 10 msec 8 msec 10 msec</span><br><span class="line">  5 23.1.1.2 [MPLS: Labels 19/26 Exp 0] 9 msec 10 msec 11 msec</span><br><span class="line">  6 17.1.1.1 [MPLS: Label 26 Exp 0] 7 msec 18 msec 9 msec</span><br><span class="line">  7 17.1.1.7 8 msec *  8 msec</span><br><span class="line">R9#</span><br></pre></td></tr></tbody></table></figure>

<p><strong>R8 和 R10 之间的 Traceroute 操作</strong></p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">R8#traceroute 10.10.10.10 source 8.8.8.8</span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Tracing the route to 10.10.10.10</span><br><span class="line">VRF info: (vrf in name/id, vrf out name/id)</span><br><span class="line">  1 18.1.1.1 2 msec 1 msec 1 msec</span><br><span class="line">  2 12.1.1.2 [MPLS: Labels 24/28 Exp 0] 8 msec 9 msec 9 msec</span><br><span class="line">  3 23.1.1.3 [MPLS: Labels 26/28 Exp 0] 9 msec 9 msec 9 msec</span><br><span class="line">  4 34.1.1.4 [MPLS: Labels 27/28 Exp 0] 10 msec 8 msec 10 msec</span><br><span class="line">  5 45.1.1.5 [MPLS: Labels 22/28 Exp 0] 7 msec 9 msec 8 msec</span><br><span class="line">  6 106.1.1.6 [MPLS: Label 28 Exp 0] 8 msec 7 msec 9 msec</span><br><span class="line">  7 106.1.1.10 8 msec *  10 msec</span><br><span class="line">R8#</span><br><span class="line">R10#traceroute 8.8.8.8 source 10.10.10.10</span><br><span class="line">Type escape sequence to abort.</span><br><span class="line">Tracing the route to 8.8.8.8</span><br><span class="line">VRF info: (vrf in name/id, vrf out name/id)</span><br><span class="line">  1 106.1.1.6 1 msec 2 msec 1 msec</span><br><span class="line">  2 56.1.1.5 [MPLS: Labels 25/28 Exp 0] 8 msec 8 msec 11 msec</span><br><span class="line">  3 45.1.1.4 [MPLS: Labels 23/28 Exp 0] 8 msec 28 msec 8 msec</span><br><span class="line">  4 34.1.1.3 [MPLS: Labels 21/28 Exp 0] 8 msec 11 msec 8 msec</span><br><span class="line">  5 23.1.1.2 [MPLS: Labels 19/28 Exp 0] 9 msec 8 msec 10 msec</span><br><span class="line">  6 18.1.1.1 [MPLS: Label 28 Exp 0] 16 msec 6 msec 7 msec</span><br><span class="line">  7 18.1.1.8 9 msec *  10 msec</span><br><span class="line">R10#</span><br></pre></td></tr></tbody></table></figure>

<h2 id="一个视频"><a href="#一个视频" class="headerlink" title="一个视频"></a>一个视频</h2><style>.bbplayer{width: 100%; max-width: 850px; margin: auto}</style><div class="bbplayer"><iframe class="bbplayer" id="mmedia-yMsGWsCEzzycaDCH" src="https://player.bilibili.com/player.html?bvid=BV1Lv4y1a7tG&amp;page=1&amp;high_quality=1&amp;danmaku=true" allowfullscreen="allowfullscreen" scrolling="no" border="0" frameborder="0" framespacing="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts allow-popups"></iframe></div><script> document.getElementById("mmedia-yMsGWsCEzzycaDCH").style.height=document.getElementById("mmedia-yMsGWsCEzzycaDCH").scrollWidth*0.76+"px";
    window.onresize = function(){
      document.getElementById("mmedia-yMsGWsCEzzycaDCH").style.height=document.getElementById("mmedia-yMsGWsCEzzycaDCH").scrollWidth*0.76+"px";
    }; </script>

<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><ul>
<li>文中可能有些配置未提及或内容术语表述的不规范，请见谅。</li>
<li>配置存阿里云盘了，这是链接：[<a target="_blank" rel="noopener" href="https://www.aliyundrive.com/s/HueqNEaKSAx">分享的文件</a>]</li>
<li>欢迎“<del>来电</del>”来函探讨。</li>
</ul>
</body></html>
    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/Network-Emulator/">#Network Emulator</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/PNETLab/">#PNETLab</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/Cisco/">#Cisco</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/MPLS-VPN/">#MPLS VPN</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/Option-C/">#Option C</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/%E8%B7%A8%E5%9F%9F/">#跨域</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/nter-AS/">#nter-AS</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/posts/d70f2b4c.html">基于Django编写的SNMP轮询Demo</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/posts/ed7bc2e7.html">Ubuntu Server 22.04 安装 Gitlab-ce</a>
            
        </span>
    </div>
    
</article>
<!-- 
DO NOT APPLY SHAREBOX

<div class="sharebox">
    
<div class="notification is-danger">
    You need to set <code>install_url</code> to use ShareThis. Please set it in <code>_config.yml</code>.
</div>

</div>

DO NOT APPLY COMMENTS

<div class="comments">
    <h3 class="title is-4">Comments</h3>
    
<div id="disqus_thread">
    
    <div class="notification is-danger">
        You forgot to set the <code>shortname</code> for Disqus. Please set it in <code>_config.yml</code>.
    </div>
    
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</div>

-->
    </div>
</section>
<footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2023 Kir Aster&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow has-text-blue" title="About" href="/about">
                    
                    About
                    
                </a>
                
                    
                <a class="column is-narrow has-text-blue" title="Privacy" href="/privacy-statement">
                    
                    Privacy
                    
                </a>
                
                    
                <a class="column is-narrow has-text-blue" title="GitHub" target="_blank" rel="noopener" href="https://github.com/kiraster">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
        </div>
    </div>
</footer>
<div id="totop" class="ctotop">
<a title="返回顶部"><img src="/images/scrollup.png"/></a>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("en-AU");
</script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
</script>

    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof($.fn.justifiedGallery) === 'function') {
                $('.justified-gallery > p > .gallery-item').unwrap();
                $('.justified-gallery').justifiedGallery();
            }
        });
    })(jQuery);
</script>

    
    
    
    

    
    
    



<script src="/js/script.js"></script>


<script src="/js/totop.js"></script>


<div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>

<script src="/js/insight.js"></script>


</body>
</html>
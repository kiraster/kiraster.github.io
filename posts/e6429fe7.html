<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
<meta charset="utf-8">
<title>2021-2022华为ICT大赛（全球）实验题研究 - Kir&#39;s Blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">


<meta name="description" content="Kir的博客，网络设备配置，网络拓扑实验，华为华三路由交换无线安全HCIP,CISCO,NETWORK">


<meta name="keywords" content="Kir的博客，网络设备配置，网络拓扑实验，华为华三路由交换无线安全HCIP,CISCO,NETWORK">


    <meta name="description" content="在公众号【易联无界】看到文章 [华为2021-2022全球总决赛实验题] 研究研究，搓一搓">
<meta property="og:type" content="article">
<meta property="og:title" content="2021-2022华为ICT大赛（全球）实验题研究">
<meta property="og:url" content="https://kiraster.github.io/posts/e6429fe7.html">
<meta property="og:site_name" content="Kir&#39;s Blog">
<meta property="og:description" content="在公众号【易联无界】看到文章 [华为2021-2022全球总决赛实验题] 研究研究，搓一搓">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s2.loli.net/2024/07/19/oPik8cpRV5KH2Fw.jpg">
<meta property="og:image" content="https://s2.loli.net/2024/07/19/qFvnT38SRItHifa.png">
<meta property="og:image" content="https://s2.loli.net/2024/07/19/RxG8AWwrXqpVNtT.png">
<meta property="og:image" content="https://s2.loli.net/2024/07/19/HqWUsa9yk1YZtfu.png">
<meta property="og:image" content="https://s2.loli.net/2024/07/19/kib3dspezqgWt1c.png">
<meta property="og:image" content="https://s2.loli.net/2024/07/19/7F9dWlTxU3eag6q.png">
<meta property="og:image" content="https://s2.loli.net/2024/07/19/1J4VLSmGzk7ZYsq.png">
<meta property="og:image" content="https://s2.loli.net/2024/07/19/c5FrskDQpWo9xHa.png">
<meta property="og:image" content="https://s2.loli.net/2024/07/19/5pzSk7K6GmJawCO.png">
<meta property="og:image" content="https://s2.loli.net/2024/07/19/KslP3dvnjWorawu.png">
<meta property="og:image" content="https://s2.loli.net/2024/07/19/pGxZKakoYJ7ldiC.png">
<meta property="og:image" content="https://s2.loli.net/2024/07/19/HyokRSbtgxev79u.png">
<meta property="og:image" content="https://s2.loli.net/2024/07/19/PqFutpOGhkfn9ig.png">
<meta property="og:image" content="https://s2.loli.net/2024/07/19/cS86XbI1GBgy4dH.png">
<meta property="article:published_time" content="2024-07-19T07:54:31.000Z">
<meta property="article:modified_time" content="2024-07-24T08:20:13.576Z">
<meta property="article:author" content="Kir Aster">
<meta property="article:tag" content="ICT">
<meta property="article:tag" content="ensp实验">
<meta property="article:tag" content="解题">
<meta property="article:tag" content="华为">
<meta property="article:tag" content="真的卡">
<meta property="article:tag" content="vsys">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2024/07/19/oPik8cpRV5KH2Fw.jpg">



<link rel="icon" href="https://s2.loli.net/2022/11/07/nR4jdLTGEq6kZ2S.png">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<!--引入思源黑体 rel-->
<link rel="preconnect" href="https://fonts.proxy.ustclug.org">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.proxy.ustclug.org/css2?family=Noto+Sans+SC&display=swap" rel="stylesheet">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">

<link rel="stylesheet" href="/css/style.css">

<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>

    
    
    
    
    
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-209914470-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-209914470-1');
</script>


    
    
<!-- Clarity tracking code for https://kiraster.github.io/ -->
<script>
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i+"?ref=bwt";
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "heff72hdac");
</script>

    

<meta name="generator" content="Hexo 6.3.0"></head>
<body>

<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                    
                    Kir&#39;s
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/archives">Archives</a>
            
            <a class="navbar-item "
               href="/gallery">Gallery</a>
            
            <a class="navbar-item "
               href="/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="Search" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            <div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc">
                <a class="navbar-item" title="Table of Contents">
                    <i class="fa fa-list"></i>
                </a>
                <div class="navbar-dropdown is-right">
                    
                    
                    
                    
                    <a class="navbar-item" href="#说明">1&nbsp;&nbsp;<b>说明</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#实验拓扑">2&nbsp;&nbsp;<b>实验拓扑</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#需求分析和配置">3&nbsp;&nbsp;<b>需求分析和配置</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#4-1-Task-1-Basic-Data-Configuration">3.1&nbsp;&nbsp;4.1 Task 1: Basic Data Configuration</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-1-1-Configuring-VLANs">3.1.1&nbsp;&nbsp;4.1.1 Configuring VLANs</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-1-2-Configuring-IP-Addresses">3.1.2&nbsp;&nbsp;4.1.2 Configuring IP Addresses</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-2-Task-2-Route-Deployment-on-the-MAN">3.2&nbsp;&nbsp;4.2 Task 2: Route Deployment on the MAN</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-2-1-Configuring-IGP">3.2.1&nbsp;&nbsp;4.2.1 Configuring IGP</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-2-2-Configuring-BGP">3.2.2&nbsp;&nbsp;4.2.2 Configuring BGP</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-3-Task-3-Data-Center-Internet-Service-Deployment">3.3&nbsp;&nbsp;4.3 Task 3: Data Center Internet Service Deployment</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-3-1-Connecting-the-Web-Server-to-the-Network">3.3.1&nbsp;&nbsp;4.3.1 Connecting the Web Server to the Network</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-3-2-Connecting-the-Simulated-IPv6-Servers-to-the-Network">3.3.2&nbsp;&nbsp;4.3.2 Connecting the Simulated IPv6 Servers to the Network</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-3-3-Configuring-Security-Protection-on-the-Firewall">3.3.3&nbsp;&nbsp;4.3.3 Configuring Security Protection on the Firewall</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-4-Task-4-Enterprise-HQ-Network-Deployment">3.4&nbsp;&nbsp;4.4 Task 4: Enterprise HQ Network Deployment</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-4-1-Configuring-a-Layer-2-Network">3.4.1&nbsp;&nbsp;4.4.1 Configuring a Layer 2 Network</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-4-2-Configuring-Basic-Services-on-the-Firewall">3.4.2&nbsp;&nbsp;4.4.2 Configuring Basic Services on the Firewall</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-4-3-Configuring-URL-Filtering-on-the-Firewall">3.4.3&nbsp;&nbsp;4.4.3 Configuring URL Filtering on the Firewall</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-4-4-Configuring-the-IPS-Function-on-the-Firewall">3.4.4&nbsp;&nbsp;4.4.4 Configuring the IPS Function on the Firewall</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-4-5-Configuring-Traffic-Management-on-the-Firewall">3.4.5&nbsp;&nbsp;4.4.5 Configuring Traffic Management on the Firewall</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-5-Task-5-Enterprise-Branch-Network-Deployment">3.5&nbsp;&nbsp;4.5 Task 5: Enterprise Branch Network Deployment</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-5-1-Configuring-DHCP">3.5.1&nbsp;&nbsp;4.5.1 Configuring DHCP</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-5-2-Configuring-a-WLAN">3.5.2&nbsp;&nbsp;4.5.2 Configuring a WLAN</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-6-Task-6-Service-Deployment-for-Communication-Between-the-Enterprise-HQ-and-Branch">3.6&nbsp;&nbsp;4.6 Task 6: Service Deployment for Communication Between the Enterprise HQ and Branch</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-6-1-Configuring-an-MPLSVPN">3.6.1&nbsp;&nbsp;4.6.1 Configuring an MPLSVPN</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-7-Task-7-Service-Deployment-for-Communication-Between-the-Enterprise-and-Data-Center-Servers">3.7&nbsp;&nbsp;4.7 Task 7: Service Deployment for Communication Between the Enterprise and Data Center Servers</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-7-1-Configuring-a-Virtual-System-on-the-Firewall">3.7.1&nbsp;&nbsp;4.7.1 Configuring a Virtual System on the Firewall</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-7-2-Connecting-the-OA-Server-to-the-Network">3.7.2&nbsp;&nbsp;4.7.2 Connecting the OA Server to the Network</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-7-3-Configuring-IPsec-Tunnels">3.7.3&nbsp;&nbsp;4.7.3 Configuring IPsec Tunnels</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-7-4-Configuring-an-L2TP-over-IPsec-Tunnel">3.7.4&nbsp;&nbsp;4.7.4 Configuring an L2TP over IPsec Tunnel</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-8-Task-8-Multicast-Service-Deployment-on-the-MAN">3.8&nbsp;&nbsp;4.8 Task 8: Multicast Service Deployment on the MAN</a>
                    
                    
                    
                    <a class="navbar-item" href="#4-8-1-Configuring-the-Multicast-Service">3.8.1&nbsp;&nbsp;4.8.1 Configuring the Multicast Service</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#最后">4&nbsp;&nbsp;<b>最后</b></a>
                    
                </div>
            </div>
            
            
        </div>
    </div>
</nav>

<section class="section">
    <div class="container">
    <article class="article content gallery" itemscope itemprop="blogPost">
    
      <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
          
              2021-2022华为ICT大赛（全球）实验题研究
          
      </h1>
    
    
      <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
          <span class="column is-narrow">
              
                  <i class="far fa-clock"></i>
                  <span>&nbspJul 19th 24&nbsp</span>
              
          </span>
          
          <span class="column is-narrow article-category">
              <i class="far fa-folder"></i>
              <a class="article-category-link" href="/categories/Huawei/">Huawei</a>
          </span>
          
          
          <span class="column is-narrow">
              
              
              an hour read (About 8921 words)
          </span>
          
      </div>
    
    <!-- add timeliness tips date:20230510 -->
    
      
      
    
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        
        <html><head></head><body><p>在公众号【易联无界】看到文章 [<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/uMLXHcPn-ke4HpI7IddU-g">华为2021-2022全球总决赛实验题</a>]</p>
<p>研究研究，搓一搓<span id="more"></span></p>
<p>文章很长，建议电脑端网页查看</p>
<p>文章末尾，附上ensp拓扑文件和配置导出文件</p>
<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ul>
<li>ensp版本：1.3.00.100 V100R003C00SPC100</li>
<li>电脑：Win10 ltsc （CPU：不配拥有名称，RAM=16GB）</li>
<li>FW桥接网卡只是直观查看会话和状态</li>
<li>我电脑跑这图是真的卡</li>
<li>遇到FW启动错误代码40，建议先启动两台FW，再启动其他设备</li>
<li>AR路由器我整不出G0/0/3接口，使用G3/0/0代替</li>
<li>Video server 地址修改为100.1.100.2</li>
<li>PC4手动配置IPv6地址 2001:200:1:200::254/64</li>
</ul>
<h2 id="实验拓扑"><a href="#实验拓扑" class="headerlink" title="实验拓扑"></a>实验拓扑</h2><p><img src="https://s2.loli.net/2024/07/19/oPik8cpRV5KH2Fw.jpg" alt="ENSP拓扑图"></p>
<h2 id="需求分析和配置"><a href="#需求分析和配置" class="headerlink" title="需求分析和配置"></a>需求分析和配置</h2><h3 id="4-1-Task-1-Basic-Data-Configuration"><a href="#4-1-Task-1-Basic-Data-Configuration" class="headerlink" title="4.1 Task 1: Basic Data Configuration"></a>4.1 Task 1: Basic Data Configuration</h3><h4 id="4-1-1-Configuring-VLANs"><a href="#4-1-1-Configuring-VLANs" class="headerlink" title="4.1.1 Configuring VLANs"></a>4.1.1 Configuring VLANs</h4><ul>
<li>按照给出的表格数据配置对应设备的vlan、Trunk、Access</li>
<li>路由器接口注意配置子接口dot1q termination vid xx ，arp broadcast enable</li>
<li>防火墙接口注意配置 vlan-type dot1q xx</li>
</ul>
<h4 id="4-1-2-Configuring-IP-Addresses"><a href="#4-1-2-Configuring-IP-Addresses" class="headerlink" title="4.1.2 Configuring IP Addresses"></a>4.1.2 Configuring IP Addresses</h4><ul>
<li>按照给出的表格数据配置对应设备的IP地址、IPv6地址</li>
<li>对于vrf接口和防火墙vsys接口，可先配置description描述</li>
<li>配置必要的接口描述（后续配置静态路由时快速查看和检查）</li>
</ul>
<h3 id="4-2-Task-2-Route-Deployment-on-the-MAN"><a href="#4-2-Task-2-Route-Deployment-on-the-MAN" class="headerlink" title="4.2 Task 2: Route Deployment on the MAN"></a>4.2 Task 2: Route Deployment on the MAN</h3><h4 id="4-2-1-Configuring-IGP"><a href="#4-2-1-Configuring-IGP" class="headerlink" title="4.2.1 Configuring IGP"></a>4.2.1 Configuring IGP</h4><ul>
<li>配置IS-IS，进程号100，区域ID 86.0010，level-2路由器，系统ID的换算，直连不选举DIS</li>
<li>配置接口cost，（设置cost-style wide）</li>
<li>IS-IS收敛参数，spf计算参数，lsp 快速泛洪</li>
<li>IS-IS hello md5认证</li>
<li>IPv6 IS-IS，IPv6的IS-IS cost</li>
</ul>
<hr>
<ul>
<li><p>AR1/AR2/AR3/AR4/CR1/CR2</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"># 区域ID + 系统ID换算</span><br><span class="line">AR1:</span><br><span class="line">network-entity 86.0010.0010.0100.1001.00</span><br><span class="line">AR2:</span><br><span class="line">network-entity 86.0010.0010.0100.1002.00</span><br><span class="line">AR3:</span><br><span class="line">network-entity 86.0010.0010.0100.1003.00</span><br><span class="line">AR4:</span><br><span class="line">network-entity 86.0010.0010.0100.1004.00</span><br><span class="line">CR1:</span><br><span class="line">network-entity 86.0010.0010.0100.1005.00</span><br><span class="line">CR2:</span><br><span class="line">network-entity 86.0010.0010.0100.1006.00</span><br><span class="line">#</span><br><span class="line"># AR1</span><br><span class="line">bfd</span><br><span class="line">#</span><br><span class="line">isis 100</span><br><span class="line"> # level-2路由器</span><br><span class="line"> is-level level-2</span><br><span class="line"> # 设置IS-IS设备接收和发送路由的开销类型，默认narro的值范围为1-63，wide的值范围1-16777215</span><br><span class="line"> cost-style wide</span><br><span class="line"> # IS-IS收敛参数</span><br><span class="line"> timer lsp-generation 1 50 100 level-2</span><br><span class="line"> # lsp 快速泛洪</span><br><span class="line"> flash-flood level-2</span><br><span class="line"> # bfd</span><br><span class="line"> bfd all-interfaces enable</span><br><span class="line"> network-entity 86.0010.0010.0100.1001.00</span><br><span class="line"> # spf计算参数</span><br><span class="line"> timer spf 1 20 100</span><br><span class="line"> # IPv6拓扑类型</span><br><span class="line"> ipv6 enable topology ipv6</span><br><span class="line"> #</span><br><span class="line"># loopback 0 接口运行isis</span><br><span class="line">interface LoopBack0</span><br><span class="line"> isis enable 100</span><br><span class="line"> isis ipv6 enable 100</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>AR1</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> isis enable 100</span><br><span class="line"> isis ipv6 enable 100</span><br><span class="line"> isis circuit-type p2p</span><br><span class="line"> isis authentication-mode md5 Huawei@123</span><br><span class="line"> isis ipv6 cost 200 level-2</span><br><span class="line"> isis cost 200 level-2</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> isis enable 100</span><br><span class="line"> isis ipv6 enable 100</span><br><span class="line"> isis circuit-type p2p</span><br><span class="line"> isis authentication-mode md5 Huawei@123</span><br><span class="line"> isis ipv6 cost 100 level-2</span><br><span class="line"> isis cost 100 level-2</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>AR2</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0 </span><br><span class="line"> isis enable 100</span><br><span class="line"> isis ipv6 enable 100</span><br><span class="line"> isis circuit-type p2p</span><br><span class="line"> isis authentication-mode md5 Huawei@123</span><br><span class="line"> isis ipv6 cost 200 level-2</span><br><span class="line"> isis cost 200 level-2</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> isis enable 100</span><br><span class="line"> isis ipv6 enable 100</span><br><span class="line"> isis circuit-type p2p</span><br><span class="line"> isis authentication-mode md5 Huawei@123</span><br><span class="line"> isis ipv6 cost 100 level-2</span><br><span class="line"> isis cost 100 level-2</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>AR3</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> isis enable 100</span><br><span class="line"> isis ipv6 enable 100</span><br><span class="line"> isis circuit-type p2p</span><br><span class="line"> isis authentication-mode md5 Huawei@123</span><br><span class="line"> isis ipv6 cost 200 level-2</span><br><span class="line"> isis cost 200 level-2</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2 </span><br><span class="line"> isis enable 100</span><br><span class="line"> isis ipv6 enable 100</span><br><span class="line"> isis circuit-type p2p</span><br><span class="line"> isis authentication-mode md5 Huawei@123</span><br><span class="line"> isis ipv6 cost 100 level-2</span><br><span class="line"> isis cost 100 level-2</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>AR4</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> isis enable 100</span><br><span class="line"> isis ipv6 enable 100</span><br><span class="line"> isis circuit-type p2p</span><br><span class="line"> isis authentication-mode md5 Huawei@123</span><br><span class="line"> isis ipv6 cost 200 level-2</span><br><span class="line"> isis cost 200 level-2</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line"> isis enable 100</span><br><span class="line"> isis ipv6 enable 100</span><br><span class="line"> isis circuit-type p2p</span><br><span class="line"> isis authentication-mode md5 Huawei@123</span><br><span class="line"> isis ipv6 cost 100 level-2</span><br><span class="line"> isis cost 100 level-2</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>CR1</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> isis enable 100</span><br><span class="line"> isis ipv6 enable 100</span><br><span class="line">  isis circuit-type p2p</span><br><span class="line"> isis authentication-mode md5 Huawei@123</span><br><span class="line"> isis ipv6 cost 300 level-2</span><br><span class="line"> isis cost 300 level-2 </span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> isis enable 100</span><br><span class="line"> isis ipv6 enable 100</span><br><span class="line"> isis circuit-type p2p</span><br><span class="line"> isis authentication-mode md5 Huawei@123</span><br><span class="line"> isis ipv6 cost 100 level-2</span><br><span class="line"> isis cost 100 level-2</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line"> isis enable 100</span><br><span class="line"> isis ipv6 enable 100</span><br><span class="line"> isis circuit-type p2p</span><br><span class="line"> isis authentication-mode md5 Huawei@123</span><br><span class="line"> isis ipv6 cost 100 level-2</span><br><span class="line"> isis cost 100 level-2</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>CR2</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> isis enable 100</span><br><span class="line"> isis ipv6 enable 100</span><br><span class="line"> isis circuit-type p2p</span><br><span class="line"> isis authentication-mode md5 Huawei@123</span><br><span class="line"> isis ipv6 cost 300 level-2</span><br><span class="line"> isis cost 300 level-2</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> isis enable 100</span><br><span class="line"> isis ipv6 enable 100</span><br><span class="line"> isis circuit-type p2p</span><br><span class="line"> isis authentication-mode md5 Huawei@123</span><br><span class="line"> isis ipv6 cost 100 level-2</span><br><span class="line"> isis cost 100 level-2</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line"> isis enable 100</span><br><span class="line"> isis ipv6 enable 100</span><br><span class="line"> isis circuit-type p2p</span><br><span class="line"> isis authentication-mode md5 Huawei@123</span><br><span class="line"> isis ipv6 cost 100 level-2</span><br><span class="line"> isis cost 100 level-2</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>验证</p>
<ul>
<li><p>dis ip routing-table protocol isis  （配置完成6台路由器，查看路由表学到其他5台路由器的loopback0地址）</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;AR1&gt;dis ip routing-table protocol isis | i 1.1.1.</span><br><span class="line">Route Flags: R - relay, D - download to fib</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">Public routing table : ISIS</span><br><span class="line">         Destinations : 10       Routes : 11       </span><br><span class="line"></span><br><span class="line">ISIS routing table status : &lt;Active&gt;</span><br><span class="line">         Destinations : 10       Routes : 11</span><br><span class="line"></span><br><span class="line">Destination/Mask    Proto   Pre  Cost      Flags NextHop         Interface</span><br><span class="line"></span><br><span class="line">1.1.1.2/32  ISIS-L2 15   200         D   10.1.2.2        GigabitEthernet0/0/0</span><br><span class="line">1.1.1.3/32  ISIS-L2 15   200         D   10.1.5.1        GigabitEthernet0/0/1</span><br><span class="line">1.1.1.4/32  ISIS-L2 15   400         D   10.1.5.1        GigabitEthernet0/0/1</span><br><span class="line">1.1.1.5/32  ISIS-L2 15   100         D   10.1.5.1        GigabitEthernet0/0/1</span><br><span class="line">1.1.1.6/32  ISIS-L2 15   300         D   10.1.2.2        GigabitEthernet0/0/0</span><br><span class="line"></span><br><span class="line">ISIS routing table status : &lt;Inactive&gt;</span><br><span class="line">         Destinations : 0        Routes : 0</span><br><span class="line"></span><br><span class="line">&lt;AR1&gt;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>dis ipv routing-table protocol isis  （IPv6）</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;CR2&gt;dis ipv routing-table protocol isis | i 2022::</span><br><span class="line">Public Routing Table : ISIS</span><br><span class="line">Summary Count : 11</span><br><span class="line"></span><br><span class="line">ISIS Routing Table's Status : &lt; Active &gt;</span><br><span class="line">Summary Count : 11 </span><br><span class="line"></span><br><span class="line"> Destination  : 2022::1                         PrefixLength : 128</span><br><span class="line"> Destination  : 2022::2                         PrefixLength : 128</span><br><span class="line"> Destination  : 2022::3                         PrefixLength : 128</span><br><span class="line"> Destination  : 2022::4                         PrefixLength : 128</span><br><span class="line"> Destination  : 2022::5                         PrefixLength : 128</span><br><span class="line">ISIS Routing Table's Status : &lt; Inactive &gt;</span><br><span class="line">Summary Count : 0</span><br><span class="line"></span><br><span class="line">&lt;CR2&gt;</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
</li>
</ul>
<h4 id="4-2-2-Configuring-BGP"><a href="#4-2-2-Configuring-BGP" class="headerlink" title="4.2.2 Configuring BGP"></a>4.2.2 Configuring BGP</h4><ul>
<li>配置MAN IBGP，AS64812，CR1和CR2为RR反射器（v4,vpnv4,v6），使用对等体组命令，使用loopback0作为源</li>
<li>配置与DataCenter的EBGP，AS62022，使用loopback0（EBGP多跳）（v4,v6），LSW1和LSW2配置指向CR1,CR2的默认路由（后边有配置静态路由的需求）</li>
<li>配置CR1,CR2 的v4 EBGP邻居md5认证</li>
<li>配置CR1,CR2路由阻尼dampening</li>
<li>配置CR1和CR2条件通告默认路由到AR1-AR4</li>
<li>配置AR1,和AR3优选下一跳CR1，AR2和AR4优选下一跳CR2</li>
<li>配置BGP network组播源服务器网段</li>
</ul>
<hr>
<ul>
<li><p>CR1</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">bgp 64812</span><br><span class="line"> router-id 1.1.1.5</span><br><span class="line"> group ibgpv4 internal</span><br><span class="line"> peer ibgpv4 connect-interface LoopBack0</span><br><span class="line"> group ibgpv6 internal</span><br><span class="line"> peer ibgpv6 connect-interface LoopBack0</span><br><span class="line"> peer 1.1.1.1 group ibgpv4 </span><br><span class="line"> peer 1.1.1.2 group ibgpv4 </span><br><span class="line"> peer 1.1.1.3 group ibgpv4 </span><br><span class="line"> peer 1.1.1.4 group ibgpv4 </span><br><span class="line"> peer 1.1.1.6 group ibgpv4 </span><br><span class="line"> peer 2022::1 group ibgpv6 </span><br><span class="line"> peer 2022::2 group ibgpv6 </span><br><span class="line"> peer 2022::3 group ibgpv6 </span><br><span class="line"> peer 2022::4 group ibgpv6 </span><br><span class="line"> peer 2022::6 group ibgpv6 </span><br><span class="line"> peer 1.1.1.8 as-number 62022 </span><br><span class="line"> peer 1.1.1.8 ebgp-max-hop 2 </span><br><span class="line"> peer 1.1.1.8 connect-interface LoopBack0</span><br><span class="line"> peer 1.1.1.8 password cipher Huawei@123</span><br><span class="line"> peer 2022::8 as-number 62022 </span><br><span class="line"> peer 2022::8 ebgp-max-hop 2 </span><br><span class="line"> peer 2022::8 connect-interface LoopBack0</span><br><span class="line">#</span><br><span class="line"> ipv4-family unicast</span><br><span class="line">  reflector cluster-id 56.56.56.56</span><br><span class="line">  dampening 10 2000 3000 10000</span><br><span class="line">  network 100.1.100.0 255.255.255.252 </span><br><span class="line">  peer ibgpv4 reflect-client</span><br><span class="line">  peer ibgpv4 next-hop-local</span><br><span class="line">  peer ibgpv4 default-route-advertise conditional-route-match-all 100.1.200.0 255.255.255.0</span><br><span class="line">  undo peer 1.1.1.6 default-route-advertise</span><br><span class="line">  peer 1.1.1.8 enable</span><br><span class="line">#</span><br><span class="line"> ipv6-family unicast</span><br><span class="line">  reflector cluster-id 56.56.56.56</span><br><span class="line">  dampening 10 2000 3000 10000</span><br><span class="line">  peer 2022::8 enable</span><br><span class="line">  peer ibgpv6 enable</span><br><span class="line">  peer ibgpv6 reflect-client</span><br><span class="line">  peer ibgpv6 next-hop-local</span><br><span class="line">  peer 2022::1 group ibgpv6 </span><br><span class="line">  peer 2022::2 group ibgpv6 </span><br><span class="line">  peer 2022::3 group ibgpv6 </span><br><span class="line">  peer 2022::4 group ibgpv6 </span><br><span class="line">  peer 2022::6 group ibgpv6 </span><br><span class="line">#</span><br><span class="line"> ipv4-family vpnv4</span><br><span class="line">  reflector cluster-id 56.56.56.56</span><br><span class="line">  undo policy vpn-target</span><br><span class="line">  peer ibgpv4 enable</span><br><span class="line">  peer ibgpv4 reflect-client</span><br><span class="line">  peer 1.1.1.1 group ibgpv4 </span><br><span class="line">  peer 1.1.1.2 group ibgpv4 </span><br><span class="line">  peer 1.1.1.3 group ibgpv4 </span><br><span class="line">  peer 1.1.1.4 group ibgpv4 </span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line">ip route-static 1.1.1.8 255.255.255.255 10.5.8.1</span><br><span class="line">#</span><br><span class="line">ipv6 route-static 2022::8 128 2001:5:8::1 </span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>CR2</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">bgp 64812</span><br><span class="line"> router-id 1.1.1.6</span><br><span class="line"> group ibgpv4 internal</span><br><span class="line"> peer ibgpv4 connect-interface LoopBack0</span><br><span class="line"> group ibgpv6 internal</span><br><span class="line"> peer ibgpv6 connect-interface LoopBack0</span><br><span class="line"> peer 1.1.1.1 group ibgpv4 </span><br><span class="line"> peer 1.1.1.2 group ibgpv4 </span><br><span class="line"> peer 1.1.1.3 group ibgpv4 </span><br><span class="line"> peer 1.1.1.4 group ibgpv4 </span><br><span class="line"> peer 1.1.1.5 group ibgpv4 </span><br><span class="line"> peer 2022::1 group ibgpv6 </span><br><span class="line"> peer 2022::2 group ibgpv6 </span><br><span class="line"> peer 2022::3 group ibgpv6 </span><br><span class="line"> peer 2022::4 group ibgpv6 </span><br><span class="line"> peer 2022::5 group ibgpv6 </span><br><span class="line"> peer 1.1.1.9 as-number 62022 </span><br><span class="line"> peer 1.1.1.9 ebgp-max-hop 2 </span><br><span class="line"> peer 1.1.1.9 connect-interface LoopBack0</span><br><span class="line"> peer 1.1.1.9 password cipher Huawei@123</span><br><span class="line"> peer 2022::9 as-number 62022 </span><br><span class="line"> peer 2022::9 ebgp-max-hop 2 </span><br><span class="line"> peer 2022::9 connect-interface LoopBack0</span><br><span class="line">#</span><br><span class="line"> ipv4-family unicast</span><br><span class="line">  reflector cluster-id 56.56.56.56</span><br><span class="line">  dampening 10 2000 3000 10000</span><br><span class="line">  network 100.1.100.0 255.255.255.252 </span><br><span class="line">  peer ibgpv4 reflect-client</span><br><span class="line">  peer ibgpv4 next-hop-local</span><br><span class="line">  peer ibgpv4 default-route-advertise conditional-route-match-all 100.1.200.0 255.255.255.0</span><br><span class="line">  undo peer 1.1.1.5 default-route-advertise</span><br><span class="line">  peer 1.1.1.9 enable</span><br><span class="line">#</span><br><span class="line"> ipv6-family unicast</span><br><span class="line">  reflector cluster-id 56.56.56.56</span><br><span class="line">  dampening 10 2000 3000 10000</span><br><span class="line">  peer 2022::9 enable</span><br><span class="line">  peer ibgpv6 enable</span><br><span class="line">  peer ibgpv6 reflect-client</span><br><span class="line">  peer ibgpv6 next-hop-local</span><br><span class="line">  peer 2022::1 group ibgpv6 </span><br><span class="line">  peer 2022::2 group ibgpv6 </span><br><span class="line">  peer 2022::3 group ibgpv6 </span><br><span class="line">  peer 2022::4 group ibgpv6 </span><br><span class="line">  peer 2022::5 group ibgpv6 </span><br><span class="line">#</span><br><span class="line"> ipv4-family vpnv4</span><br><span class="line">  reflector cluster-id 56.56.56.56</span><br><span class="line">  undo policy vpn-target</span><br><span class="line">  peer ibgpv4 enable</span><br><span class="line">  peer ibgpv4 reflect-client</span><br><span class="line">  peer 1.1.1.1 group ibgpv4 </span><br><span class="line">  peer 1.1.1.2 group ibgpv4 </span><br><span class="line">  peer 1.1.1.3 group ibgpv4 </span><br><span class="line">  peer 1.1.1.4 group ibgpv4 </span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line">ip route-static 1.1.1.9 255.255.255.255 10.6.9.1</span><br><span class="line">#</span><br><span class="line">ipv6 route-static 2022::9 128 2001:6:9::1 </span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>AR1/AR2/AR3/AR4/，注意修改各路由器的router-id</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># AR1</span><br><span class="line">bgp 64812</span><br><span class="line"> router-id 1.1.1.1</span><br><span class="line"> peer 1.1.1.5 as-number 64812 </span><br><span class="line"> peer 1.1.1.5 connect-interface LoopBack0</span><br><span class="line"> peer 1.1.1.6 as-number 64812 </span><br><span class="line"> peer 1.1.1.6 connect-interface LoopBack0</span><br><span class="line"> peer 2022::5 as-number 64812 </span><br><span class="line"> peer 2022::5 connect-interface LoopBack0</span><br><span class="line"> peer 2022::6 as-number 64812 </span><br><span class="line"> peer 2022::6 connect-interface LoopBack0</span><br><span class="line"> #</span><br><span class="line"> ipv4-family unicast</span><br><span class="line">  peer 1.1.1.5 next-hop-local </span><br><span class="line">  peer 1.1.1.6 next-hop-local </span><br><span class="line"> #</span><br><span class="line"> ipv6-family unicast</span><br><span class="line">  peer 2022::5 enable</span><br><span class="line">  peer 2022::5 next-hop-local </span><br><span class="line">  peer 2022::6 enable</span><br><span class="line">  peer 2022::6 next-hop-local </span><br><span class="line"> # </span><br><span class="line"> ipv4-family vpnv4</span><br><span class="line">  policy vpn-target</span><br><span class="line">  peer 1.1.1.5 enable</span><br><span class="line">  peer 1.1.1.6 enable</span><br><span class="line"> #</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>AR1/AR3</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">bgp 64812</span><br><span class="line"> #</span><br><span class="line"> ipv4-family unicast</span><br><span class="line">  peer 1.1.1.5 preferred-value 2000  </span><br><span class="line">  peer 1.1.1.6 preferred-value 1000 </span><br><span class="line"> #</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>AR2/AR4</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">bgp 64812</span><br><span class="line"> #</span><br><span class="line"> ipv4-family unicast</span><br><span class="line">  peer 1.1.1.5 preferred-value 1000 </span><br><span class="line">  peer 1.1.1.6 preferred-value 2000 </span><br><span class="line"> #</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>LSW1</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">ip route-static 0.0.0.0 0.0.0.0 10.5.8.2</span><br><span class="line">#</span><br><span class="line">ipv6 route-static :: 0 2001:5:8::2 </span><br><span class="line">#</span><br><span class="line">bgp 62022</span><br><span class="line"> router-id 1.1.1.8</span><br><span class="line"> peer 1.1.1.5 as-number 64812 </span><br><span class="line"> peer 1.1.1.5 ebgp-max-hop 2 </span><br><span class="line"> peer 1.1.1.5 connect-interface LoopBack0</span><br><span class="line"> peer 1.1.1.5 password cipher Huawei@123</span><br><span class="line"> peer 2022::5 as-number 64812 </span><br><span class="line"> peer 2022::5 ebgp-max-hop 2 </span><br><span class="line"> peer 2022::5 connect-interface LoopBack0</span><br><span class="line"> #</span><br><span class="line"> ipv4-family unicast</span><br><span class="line">  peer 1.1.1.5 enable</span><br><span class="line"> #</span><br><span class="line"> ipv6-family unicast</span><br><span class="line">  peer 2022::5 enable</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>LSW2</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">ip route-static 0.0.0.0 0.0.0.0 10.6.9.2</span><br><span class="line">#</span><br><span class="line">ipv6 route-static :: 0 2001:6:9::2 </span><br><span class="line">#</span><br><span class="line">bgp 62022</span><br><span class="line"> router-id 1.1.1.9</span><br><span class="line"> peer 1.1.1.6 as-number 64812 </span><br><span class="line"> peer 1.1.1.6 ebgp-max-hop 2 </span><br><span class="line"> peer 1.1.1.6 connect-interface LoopBack0</span><br><span class="line"> peer 1.1.1.6 password cipher Huawei@123</span><br><span class="line"> peer 2022::6 as-number 64812 </span><br><span class="line"> peer 2022::6 ebgp-max-hop 2 </span><br><span class="line"> peer 2022::6 connect-interface LoopBack0</span><br><span class="line"> #</span><br><span class="line"> ipv4-family unicast</span><br><span class="line">  peer 1.1.1.6 enable</span><br><span class="line"> #</span><br><span class="line"> ipv6-family unicast</span><br><span class="line">  peer 2022::6 enable</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>验证</p>
<ul>
<li><p>dis bgp peer （IPv4peer）</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;AR1&gt;dis bgp peer </span><br><span class="line"></span><br><span class="line"> BGP local router ID : 1.1.1.1</span><br><span class="line"> Local AS number : 64812</span><br><span class="line"> Total number of peers : 2                Peers in established state : 2</span><br><span class="line"></span><br><span class="line">  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State PrefRcv</span><br><span class="line"></span><br><span class="line">  1.1.1.5         4       64812       15       14     0 00:12:14 Established       1</span><br><span class="line">  1.1.1.6         4       64812       15       14     0 00:12:14 Established       1</span><br><span class="line">&lt;AR1&gt;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>dis bgp ipv6 peer （IPv6 peer）</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;AR2&gt;dis bgp ipv6 peer </span><br><span class="line"></span><br><span class="line"> BGP local router ID : 1.1.1.2</span><br><span class="line"> Local AS number : 64812</span><br><span class="line"> Total number of peers : 2                Peers in established state : 2</span><br><span class="line"></span><br><span class="line">  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State PrefRcv</span><br><span class="line"></span><br><span class="line">  2022::5         4       64812       12       12     0 00:10:23 Established       0</span><br><span class="line">  2022::6         4       64812       12       12     0 00:10:22 Established       0</span><br><span class="line">&lt;AR2&gt;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>dis bgp vpnv4 all peer （vpnv4 peer）</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;CR1&gt;dis bgp vpnv4 all peer </span><br><span class="line"></span><br><span class="line"> BGP local router ID : 1.1.1.5</span><br><span class="line"> Local AS number : 64812</span><br><span class="line"> Total number of peers : 4                Peers in established state : 4</span><br><span class="line"></span><br><span class="line">  Peer            V          AS  MsgRcvd  MsgSent  OutQ  Up/Down       State PrefRcv</span><br><span class="line"></span><br><span class="line">  1.1.1.1         4       64812       21       23     0 00:19:24 Established       0</span><br><span class="line">  1.1.1.2         4       64812       19       21     0 00:17:19 Established       0</span><br><span class="line">  1.1.1.3         4       64812       19       21     0 00:17:52 Established       0</span><br><span class="line">  1.1.1.4         4       64812       18       20     0 00:16:52 Established       0</span><br><span class="line">&lt;CR1&gt;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>dis bgp routing-table </p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;AR4&gt;dis bgp routing-table</span><br><span class="line"></span><br><span class="line"> BGP Local router ID is 1.1.1.4 </span><br><span class="line"> Status codes: * - valid, &gt; - best, d - damped,</span><br><span class="line">               h - history,  i - internal, s - suppressed, S - Stale</span><br><span class="line">               Origin : i - IGP, e - EGP, ? - incomplete</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> Total Number of Routes: 2</span><br><span class="line">      Network            NextHop        MED        LocPrf    PrefVal Path/Ogn</span><br><span class="line"></span><br><span class="line"> *&gt;i  100.1.100.0/30     1.1.1.5         0          100        2000   i</span><br><span class="line"> * i                     1.1.1.5         0          100        1000   i</span><br><span class="line">&lt;AR4&gt;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>dis bgp routing-table 100.1.100.0 </p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;AR4&gt;dis bgp routing-table 100.1.100.0</span><br><span class="line"></span><br><span class="line"> BGP local router ID : 1.1.1.4</span><br><span class="line"> Local AS number : 64812</span><br><span class="line"> Paths:   2 available, 1 best, 1 select</span><br><span class="line"> BGP routing table entry information of 100.1.100.0/30:</span><br><span class="line"> From: 1.1.1.6 (1.1.1.6)</span><br><span class="line"> Route Duration: 00h03m40s  </span><br><span class="line"> Relay IP Nexthop: 10.3.4.1</span><br><span class="line"> Relay IP Out-Interface: GigabitEthernet0/0/0</span><br><span class="line"> Original nexthop: 1.1.1.5</span><br><span class="line"> Qos information : 0x0</span><br><span class="line"> AS-path Nil, origin igp, MED 0, localpref 100, pref-val 2000, valid, internal, best, select, active, pre 255, IGP cost 300</span><br><span class="line"> Originator:  1.1.1.5</span><br><span class="line"> Cluster list: 56.56.56.56</span><br><span class="line"> Not advertised to any peer yet</span><br><span class="line"></span><br><span class="line"> BGP routing table entry information of 100.1.100.0/30:</span><br><span class="line"> From: 1.1.1.5 (1.1.1.5)</span><br><span class="line"> Route Duration: 00h03m40s  </span><br><span class="line"> Relay IP Nexthop: 10.3.4.1</span><br><span class="line"> Relay IP Out-Interface: GigabitEthernet0/0/0</span><br><span class="line"> Original nexthop: 1.1.1.5</span><br><span class="line"> Qos information : 0x0</span><br><span class="line"> AS-path Nil, origin igp, MED 0, localpref 100, pref-val 1000, valid, internal, pre 255, IGP cost 300, not preferred for PreVal</span><br><span class="line"> Not advertised to any peer yet</span><br><span class="line"></span><br><span class="line">&lt;AR4&gt;</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
</li>
</ul>
<h3 id="4-3-Task-3-Data-Center-Internet-Service-Deployment"><a href="#4-3-Task-3-Data-Center-Internet-Service-Deployment" class="headerlink" title="4.3 Task 3: Data Center Internet Service Deployment"></a>4.3 Task 3: Data Center Internet Service Deployment</h3><h4 id="4-3-1-Connecting-the-Web-Server-to-the-Network"><a href="#4-3-1-Connecting-the-Web-Server-to-the-Network" class="headerlink" title="4.3.1 Connecting the Web Server to the Network"></a>4.3.1 Connecting the Web Server to the Network</h4><ul>
<li><p>配置LSW1,LSW2的eth-trunk 12，静态lacp，src-mac 负载均衡</p>
</li>
<li><p>创建vrf intvpn，不传vpnv4用不到RD和RT</p>
</li>
<li><p>vlan200,下配置vrrp，vrid 2，virtual-ip 192.168.200.1/24，LSW2为master，优先级120，抢占延迟20s，track接口G0/0/2状态，失效优先级减21成为backup</p>
</li>
<li><p>配置nqa探测，LSW1-CR1,LSW2-CR2，类型icmp，5s间隔周期探测时间，</p>
</li>
<li><p>配置出向静态路由，backup路由优先级90，看示意图，LSW1-CR1，LSW2-CR2 的默认路由track nqa，配置默认路由备份路由指向 LSW1 LSW2</p>
</li>
<li><p>配置入向静态路由，看示意图</p>
</li>
<li><p>FW1配置安全策略，看示意图</p>
</li>
<li><p>FW1配置NAT映射，策略包含80端口，放行icmp</p>
</li>
<li><p>LSW1和LSW2之间的备份路由在出口全部宕机的情况下的环路处理</p>
</li>
<li><p>BGP network （web服务器公网映射网段路由）</p>
</li>
</ul>
<hr>
<ul>
<li><p>LSW1</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/4</span><br><span class="line"> undo eth-trunk</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/5</span><br><span class="line"> undo eth-trunk</span><br><span class="line">#</span><br><span class="line">interface Eth-Trunk12</span><br><span class="line"> mode lacp-static</span><br><span class="line"> load-balance src-mac</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/4</span><br><span class="line"> eth-trunk 12</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/5</span><br><span class="line"> eth-trunk 12</span><br><span class="line">#</span><br><span class="line">ip vpn-instance intvpn</span><br><span class="line"> ipv4-family</span><br><span class="line">#</span><br><span class="line">interface Vlanif200</span><br><span class="line"> description VPN-intvpn</span><br><span class="line"> ip binding vpn-instance intvpn</span><br><span class="line"> ip address 192.168.200.8 255.255.255.0 </span><br><span class="line"> vrrp vrid 2 virtual-ip 192.168.200.1</span><br><span class="line"> vrrp vrid 2 preempt-mode timer delay 20</span><br><span class="line">#</span><br><span class="line">interface Vlanif30</span><br><span class="line"> description VPN-intvpn</span><br><span class="line"> ip binding vpn-instance intvpn</span><br><span class="line"> ip address 192.168.3.1 255.255.255.252 </span><br><span class="line">#</span><br><span class="line">nqa test-instance toCR toCR </span><br><span class="line"> test-type icmp</span><br><span class="line"> destination-address ipv4 10.5.8.2</span><br><span class="line"> frequency 5</span><br><span class="line"> interval seconds 1</span><br><span class="line"> timeout 1</span><br><span class="line"> probe-count 2</span><br><span class="line"> start now</span><br><span class="line">#</span><br><span class="line">ip route-static 0.0.0.0 0.0.0.0 10.5.8.2 track nqa toCR toCR</span><br><span class="line">ip route-static 0.0.0.0 0.0.0.0 192.168.9.2 preference 90</span><br><span class="line">ip route-static 100.1.200.0 255.255.255.0 100.1.4.2</span><br><span class="line">ip route-static vpn-instance intvpn 0.0.0.0 0.0.0.0 192.168.3.2</span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line">bgp 62022</span><br><span class="line"> #</span><br><span class="line"> ipv4-family unicast</span><br><span class="line">  network 100.1.200.0 24</span><br><span class="line">#</span><br><span class="line"># 阻止LSW1-LSW2备份路由形成的环路</span><br><span class="line">nqa test-instance PREVENT_LOOP PREVENT_LOOP </span><br><span class="line"> test-type icmp</span><br><span class="line"> destination-address ipv4 10.6.9.1</span><br><span class="line"> frequency 5</span><br><span class="line"> interval seconds 1</span><br><span class="line"> timeout 1</span><br><span class="line"> probe-count 2</span><br><span class="line"> start now</span><br><span class="line">#</span><br><span class="line">ip route-static 10.6.9.1 255.255.255.255 192.168.9.2</span><br><span class="line">ip route-static 0.0.0.0 0.0.0.0 192.168.9.2 preference 90 track nqa PREVENT_LOOP PREVENT_LOOP</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>LSW2</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/4</span><br><span class="line"> undo eth-trunk</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/5</span><br><span class="line"> undo eth-trunk</span><br><span class="line">#</span><br><span class="line">interface Eth-Trunk12</span><br><span class="line"> port link-type trunk</span><br><span class="line"> port trunk allow-pass vlan 90 100 200</span><br><span class="line"> mode lacp-static</span><br><span class="line"> load-balance src-mac</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/4</span><br><span class="line"> eth-trunk 12</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/5</span><br><span class="line"> eth-trunk 12</span><br><span class="line">#</span><br><span class="line">ip vpn-instance intvpn</span><br><span class="line"> ipv4-family</span><br><span class="line">#</span><br><span class="line">interface Vlanif200</span><br><span class="line"> description VPN-intvpn</span><br><span class="line"> ip binding vpn-instance intvpn</span><br><span class="line"> ip address 192.168.200.9 255.255.255.0 </span><br><span class="line"> vrrp vrid 2 virtual-ip 192.168.200.1</span><br><span class="line"> vrrp vrid 2 priority 120</span><br><span class="line"> vrrp vrid 2 preempt-mode timer delay 20</span><br><span class="line"> vrrp vrid 2 track interface GigabitEthernet0/0/2 reduced 21</span><br><span class="line">#</span><br><span class="line">interface Vlanif30</span><br><span class="line"> description VPN-intvpn</span><br><span class="line"> ip binding vpn-instance intvpn</span><br><span class="line"> ip address 192.168.30.1 255.255.255.252 </span><br><span class="line">#</span><br><span class="line">nqa test-instance toCR toCR </span><br><span class="line"> test-type icmp</span><br><span class="line"> destination-address ipv4 10.6.9.2</span><br><span class="line"> frequency 5</span><br><span class="line"> interval seconds 1</span><br><span class="line"> timeout 1</span><br><span class="line"> probe-count 2</span><br><span class="line"> start now</span><br><span class="line">#</span><br><span class="line">ip route-static 0.0.0.0 0.0.0.0 10.6.9.2 track nqa toCR toCR</span><br><span class="line">ip route-static 0.0.0.0 0.0.0.0 192.168.9.1 preference 90</span><br><span class="line">ip route-static 100.1.200.0 255.255.255.0 100.1.40.2</span><br><span class="line">ip route-static vpn-instance intvpn 0.0.0.0 0.0.0.0 192.168.30.2</span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line">bgp 62022</span><br><span class="line"> #</span><br><span class="line"> ipv4-family unicast</span><br><span class="line">  network 100.1.200.0 24</span><br><span class="line">#</span><br><span class="line"># 阻止LSW1-LSW2备份路由形成的环路</span><br><span class="line">nqa test-instance PREVENT_LOOP PREVENT_LOOP </span><br><span class="line"> test-type icmp</span><br><span class="line"> destination-address ipv4 10.5.8.1</span><br><span class="line"> frequency 5</span><br><span class="line"> interval seconds 1</span><br><span class="line"> timeout 1</span><br><span class="line"> probe-count 2</span><br><span class="line"> start now</span><br><span class="line">#</span><br><span class="line">ip route-static 10.5.8.1 255.255.255.255 192.168.9.1</span><br><span class="line">ip route-static 0.0.0.0 0.0.0.0 192.168.9.1 preference 90 track nqa PREVENT_LOOP PREVENT_LOOP</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>FW1</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">ip route-static 0.0.0.0 0.0.0.0 100.1.40.1</span><br><span class="line">ip route-static 0.0.0.0 0.0.0.0 100.1.4.1 preference 90</span><br><span class="line">ip route-static 192.168.200.0 255.255.255.0 192.168.30.1</span><br><span class="line">ip route-static 192.168.200.0 255.255.255.0 192.168.3.1 preference 90</span><br><span class="line">#</span><br><span class="line">firewall zone untrust</span><br><span class="line"> add interface GigabitEthernet1/0/1.40</span><br><span class="line"> add interface GigabitEthernet1/0/2.40</span><br><span class="line">#</span><br><span class="line">firewall zone dmz</span><br><span class="line"> add interface GigabitEthernet1/0/1.30</span><br><span class="line"> add interface GigabitEthernet1/0/2.30</span><br><span class="line">#</span><br><span class="line">security-policy</span><br><span class="line"> rule name untrust2dmz</span><br><span class="line">  source-zone untrust</span><br><span class="line">  destination-zone dmz</span><br><span class="line">  destination-address 192.168.200.0 mask 255.255.255.0</span><br><span class="line">  action permit</span><br><span class="line">#</span><br><span class="line"> nat server web_server protocol tcp global 100.1.200.254 www inside 192.168.200.254 www</span><br><span class="line"> nat server icmp_server protocol icmp global 100.1.200.254 inside 192.168.200.254</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>AR4</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">bgp 64812</span><br><span class="line"> #</span><br><span class="line"> ipv4-family unicast</span><br><span class="line">  network 200.1.200.0 24</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>PC4 ping测试和Http Client 测试</p>
<p><img src="https://s2.loli.net/2024/07/19/qFvnT38SRItHifa.png" alt="image-004420171"></p>
</li>
</ul>
<h4 id="4-3-2-Connecting-the-Simulated-IPv6-Servers-to-the-Network"><a href="#4-3-2-Connecting-the-Simulated-IPv6-Servers-to-the-Network" class="headerlink" title="4.3.2 Connecting the Simulated IPv6 Servers to the Network"></a>4.3.2 Connecting the Simulated IPv6 Servers to the Network</h4><ul>
<li>LSW1和LSW2创建loopback1，配置IPv6地址</li>
<li>配置ospfv3，进程号200，vlanif90 建立邻居，改网络类型不选DR</li>
<li>BGP 仅 import  两loopback1 IPv6地址，挂上route-map ，prefix配置</li>
<li>配置路由聚合，112掩码</li>
</ul>
<hr>
<ul>
<li><p>LSW1</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">ospfv3 200</span><br><span class="line"> router-id 1.1.1.8</span><br><span class="line">interface LoopBack1</span><br><span class="line"> ipv6 enable </span><br><span class="line"> ipv6 address 2001:100:1:200::8/128 </span><br><span class="line"> ospfv3 200 area 0.0.0.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif90</span><br><span class="line"> ospfv3 200 area 0.0.0.0</span><br><span class="line"> ospfv3 network-type p2p</span><br><span class="line">#</span><br><span class="line">ip ipv6-prefix V6_SERVER permit 2001:100:1:200::8 128</span><br><span class="line">ip ipv6-prefix V6_SERVER permit 2001:100:1:200::9 128</span><br><span class="line">#</span><br><span class="line">route-policy V6_SERVER permit node 10 </span><br><span class="line"> if-match ipv6 address prefix-list V6_SERVER </span><br><span class="line">#</span><br><span class="line">bgp 62022</span><br><span class="line"> ipv6-family unicast</span><br><span class="line">  aggregate 2001:100:1:200:: 112 detail-suppressed </span><br><span class="line">  import-route ospfv3 200 route-policy V6_SERVER</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>LSW2</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">ospfv3 200</span><br><span class="line"> router-id 1.1.1.9</span><br><span class="line">#</span><br><span class="line">interface LoopBack1</span><br><span class="line"> ipv6 enable </span><br><span class="line"> ipv6 address 2001:100:1:200::9/128 </span><br><span class="line"> ospfv3 200 area 0.0.0.0</span><br><span class="line">#</span><br><span class="line">interface Vlanif90</span><br><span class="line"> ospfv3 200 area 0.0.0.0</span><br><span class="line"> ospfv3 network-type p2p</span><br><span class="line">#</span><br><span class="line">ip ipv6-prefix V6_SERVER permit 2001:100:1:200::8 128</span><br><span class="line">ip ipv6-prefix V6_SERVER permit 2001:100:1:200::9 128</span><br><span class="line">#</span><br><span class="line">route-policy V6_SERVER permit node 10 </span><br><span class="line"> if-match ipv6 address prefix-list V6_SERVER </span><br><span class="line">#</span><br><span class="line">bgp 62022</span><br><span class="line"> ipv6-family unicast</span><br><span class="line">  aggregate 2001:100:1:200:: 112 detail-suppressed </span><br><span class="line">  import-route ospfv3 200 route-policy V6_SERVER</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>AR4</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bgp 64812</span><br><span class="line"> ipv6-family unicast</span><br><span class="line">  network 2001:200:1:200:: 64 </span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>PC4 配置IPv6地址-2001:200:1:200::254/64； IPv6网关-2001:200:1:200::1</p>
<p><img src="https://s2.loli.net/2024/07/19/RxG8AWwrXqpVNtT.png" alt="image-140018166"></p>
</li>
<li><p>PC4 ping测试</p>
<p><img src="https://s2.loli.net/2024/07/19/HqWUsa9yk1YZtfu.png" alt="image-013227537"></p>
<p><img src="https://s2.loli.net/2024/07/19/kib3dspezqgWt1c.png" alt="image-013202951"></p>
</li>
</ul>
<h4 id="4-3-3-Configuring-Security-Protection-on-the-Firewall"><a href="#4-3-3-Configuring-Security-Protection-on-the-Firewall" class="headerlink" title="4.3.3 Configuring Security Protection on the Firewall"></a>4.3.3 Configuring Security Protection on the Firewall</h4><ul>
<li>拉黑200.1.200.200地址</li>
</ul>
<hr>
<ul>
<li><p>FW1</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[FW1]firewall blacklist enable </span><br><span class="line">[FW1]firewall blacklist item source-ip 200.1.200.200</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h3 id="4-4-Task-4-Enterprise-HQ-Network-Deployment"><a href="#4-4-Task-4-Enterprise-HQ-Network-Deployment" class="headerlink" title="4.4 Task 4: Enterprise HQ Network Deployment"></a>4.4 Task 4: Enterprise HQ Network Deployment</h3><h4 id="4-4-1-Configuring-a-Layer-2-Network"><a href="#4-4-1-Configuring-a-Layer-2-Network" class="headerlink" title="4.4.1 Configuring a Layer 2 Network"></a>4.4.1 Configuring a Layer 2 Network</h4><ul>
<li>端口安全，动态安全地址，mac 抖动，最大mac地址2，aging time 1200m</li>
<li>端口学习mac地址的优先级</li>
</ul>
<hr>
<ul>
<li><p>LSW3</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line"> mac-learning priority 3</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/4</span><br><span class="line"> port-security enable</span><br><span class="line"> port-security protect-action shutdown</span><br><span class="line"> port-security max-mac-num 2</span><br><span class="line"> port-security mac-address sticky</span><br><span class="line"> port-security aging-time 1200</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>LSW4</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line"> mac-learning priority 3</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/3</span><br><span class="line"> port-security enable</span><br><span class="line"> port-security protect-action shutdown</span><br><span class="line"> port-security max-mac-num 2</span><br><span class="line"> port-security mac-address sticky</span><br><span class="line"> port-security aging-time 1200</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h4 id="4-4-2-Configuring-Basic-Services-on-the-Firewall"><a href="#4-4-2-Configuring-Basic-Services-on-the-Firewall" class="headerlink" title="4.4.2 Configuring Basic Services on the Firewall"></a>4.4.2 Configuring Basic Services on the Firewall</h4><ul>
<li>配置安全策略，HQ 172.16.100.0/24和Branch172.17.100.0/24上互联网（NAT need）</li>
<li>配置安全策略，HQ 172.16.101.0/24 访问OA 192.168.100.0/24（FW1上做了映射公网）</li>
<li>配置ip-link ,FW2-AR1, FW2-AR2，搭配后续的出向默认路由使用</li>
<li>出向静态路由</li>
<li>入向静态路由，AR1和AR2 （200.1.100.0/24）指向 FW2；FW2配置特定主备路由指向LSW3 LSW4 </li>
<li>配置NAT，接入互联网，最终ping通WEB服务器和Video服务器需要这个，转换地址池200.1.100.2 - 200.1.100.10</li>
</ul>
<hr>
<ul>
<li><p>FW2</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">firewall zone trust</span><br><span class="line"> add interface GigabitEthernet1/0/3.30</span><br><span class="line"> add interface GigabitEthernet1/0/4.40</span><br><span class="line">#</span><br><span class="line">firewall zone untrust</span><br><span class="line"> add interface GigabitEthernet1/0/3.60</span><br><span class="line"> add interface GigabitEthernet1/0/4.70</span><br><span class="line">#</span><br><span class="line">ip-link check enable                      </span><br><span class="line">ip-link name toar1</span><br><span class="line"> destination 200.1.6.1 interface GigabitEthernet1/0/3.60 mode arp</span><br><span class="line">ip-link name toar2</span><br><span class="line"> destination 200.1.7.1 interface GigabitEthernet1/0/4.70 mode arp</span><br><span class="line">#</span><br><span class="line">security-policy</span><br><span class="line"> rule name trust2untrust01</span><br><span class="line">  source-zone trust</span><br><span class="line">  destination-zone untrust</span><br><span class="line">  source-address 172.16.100.0 mask 255.255.255.0</span><br><span class="line">  source-address 172.17.100.0 mask 255.255.255.0</span><br><span class="line">  action permit</span><br><span class="line"> rule name trust2untrust02</span><br><span class="line">  source-zone trust</span><br><span class="line">  destination-zone untrust</span><br><span class="line">  source-address 172.16.101.0 mask 255.255.255.0</span><br><span class="line">  destination-address 192.168.100.0 mask 255.255.255.0</span><br><span class="line">  action permit</span><br><span class="line">#</span><br><span class="line">ip route-static 0.0.0.0 0.0.0.0 200.1.6.1 track ip-link toar1</span><br><span class="line">ip route-static 0.0.0.0 0.0.0.0 200.1.7.1 track ip-link toar2</span><br><span class="line">ip route-static 172.16.100.0 255.255.255.0 172.16.3.1</span><br><span class="line">ip route-static 172.16.100.0 255.255.255.0 172.16.4.1 preference 90</span><br><span class="line">ip route-static 172.16.101.0 255.255.255.0 172.16.4.1</span><br><span class="line">ip route-static 172.16.101.0 255.255.255.0 172.16.3.1 preference 90</span><br><span class="line">ip route-static 172.17.100.0 255.255.255.0 172.16.3.1</span><br><span class="line">ip route-static 172.17.100.0 255.255.255.0 172.16.4.1</span><br><span class="line">#</span><br><span class="line">nat address-group addressgroup1 0</span><br><span class="line"> mode pat</span><br><span class="line"> section 0 200.1.100.2 200.1.100.10</span><br><span class="line">#</span><br><span class="line">nat-policy</span><br><span class="line"> rule name policy_nat1</span><br><span class="line">  source-zone trust</span><br><span class="line">  destination-zone untrust</span><br><span class="line">  source-address 172.16.100.0 mask 255.255.255.0</span><br><span class="line">  source-address 172.17.100.0 mask 255.255.255.0</span><br><span class="line">  destination-address 100.1.0.0 mask 255.255.0.0</span><br><span class="line">  action source-nat address-group addressgroup1</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>LSW3</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">ip route-static 0.0.0.0 0.0.0.0 172.16.3.2</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>LSW4</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">ip route-static 0.0.0.0 0.0.0.0 172.16.4.2</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>AR1</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">ip route-static 200.1.100.0 255.255.255.0 200.1.6.2</span><br><span class="line">#</span><br><span class="line">bgp 64812</span><br><span class="line"> #</span><br><span class="line"> ipv4-family unicast</span><br><span class="line">  import-route static</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>AR2</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">ip route-static 200.1.100.0 255.255.255.0 200.1.7.2</span><br><span class="line">#</span><br><span class="line">bgp 64812</span><br><span class="line"> #</span><br><span class="line"> ipv4-family unicast</span><br><span class="line">  import-route static</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>验证</p>
<p><img src="https://s2.loli.net/2024/07/19/7F9dWlTxU3eag6q.png" alt="image-124106425"></p>
<p><img src="https://s2.loli.net/2024/07/19/1J4VLSmGzk7ZYsq.png" alt="image-124147896"></p>
</li>
</ul>
<h4 id="4-4-3-Configuring-URL-Filtering-on-the-Firewall"><a href="#4-4-3-Configuring-URL-Filtering-on-the-Firewall" class="headerlink" title="4.4.3 Configuring URL Filtering on the Firewall"></a>4.4.3 Configuring URL Filtering on the Firewall</h4><ul>
<li><p>url-filter profile的配置，去网页点点看</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">profile type url-filter name url_profile_deny</span><br><span class="line"> add blacklist url www.example1.com</span><br><span class="line"> add blacklist url www.example2.com</span><br><span class="line"> category pre-defined control-level medium</span><br><span class="line"> https-filter enable</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h4 id="4-4-4-Configuring-the-IPS-Function-on-the-Firewall"><a href="#4-4-4-Configuring-the-IPS-Function-on-the-Firewall" class="headerlink" title="4.4.4 Configuring the IPS Function on the Firewall"></a>4.4.4 Configuring the IPS Function on the Firewall</h4><ul>
<li><p>ips profile的配置，去网页点点看</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">profile type ips name Profile_ips_pc</span><br><span class="line"> collect-attack-evidence enable # 依赖硬盘，ensp不起作用</span><br><span class="line"> signature-set name filter_web</span><br><span class="line">  target client</span><br><span class="line">  severity high</span><br><span class="line">  protocol HTTP</span><br><span class="line">#</span><br><span class="line">security-policy</span><br><span class="line"> rule name trust2untrust01</span><br><span class="line">  profile ips Profile_ips_pc</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h4 id="4-4-5-Configuring-Traffic-Management-on-the-Firewall"><a href="#4-4-5-Configuring-Traffic-Management-on-the-Firewall" class="headerlink" title="4.4.5 Configuring Traffic Management on the Firewall"></a>4.4.5 Configuring Traffic Management on the Firewall</h4><ul>
<li><p>配置流量管理，去网页点点看</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line"> time-range work_time</span><br><span class="line">  period-range 09:00:00 to 18:00:00 working-day  </span><br><span class="line">#</span><br><span class="line">traffic-policy</span><br><span class="line"> profile profile_p2p</span><br><span class="line">  bandwidth maximum-bandwidth whole both 50000</span><br><span class="line">  bandwidth connection-limit whole both 2000 </span><br><span class="line"> profile profile_email</span><br><span class="line">  bandwidth guaranteed-bandwidth whole both 100000</span><br><span class="line">  bandwidth priority 7</span><br><span class="line"> rule name policy_p2p</span><br><span class="line">  source-zone trust</span><br><span class="line">  destination-zone untrust</span><br><span class="line">  source-address address-set 172.16.100.0&amp;172.17.100.0</span><br><span class="line">  application app BT</span><br><span class="line">  application app 	YouKu</span><br><span class="line">  action qos profile profile_p2p</span><br><span class="line"> rule name policy_email</span><br><span class="line">  source-zone trust</span><br><span class="line">  destination-zone untrust</span><br><span class="line">  source-address 172.16.100.0 mask 255.255.255.0</span><br><span class="line">  source-address 172.17.100.0 mask 255.255.255.0</span><br><span class="line">  application app LotusNotes</span><br><span class="line">  application app OWA</span><br><span class="line">  application category Business_Systems sub-category Email</span><br><span class="line">  action qos profile profile_email</span><br><span class="line"># </span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h3 id="4-5-Task-5-Enterprise-Branch-Network-Deployment"><a href="#4-5-Task-5-Enterprise-Branch-Network-Deployment" class="headerlink" title="4.5 Task 5: Enterprise Branch Network Deployment"></a>4.5 Task 5: Enterprise Branch Network Deployment</h3><h4 id="4-5-1-Configuring-DHCP"><a href="#4-5-1-Configuring-DHCP" class="headerlink" title="4.5.1 Configuring DHCP"></a>4.5.1 Configuring DHCP</h4><ul>
<li>LSW5配置DHCP，此DHCP Server后续的无线sta获取地址也需要用到</li>
<li>DHCP参数，vlanif100接口，dns 8.8.8.8，lease 2d</li>
<li>LSW6，配置DHCP snooping，上联dhcp server接口trusted</li>
<li>可能的bug（PC3和STA1获取不到IP地址，在LSW5去掉DHCP配置再重新刷入配置解决）</li>
</ul>
<hr>
<ul>
<li><p>LSW5</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">dhcp enable</span><br><span class="line">#</span><br><span class="line">interface Vlanif100</span><br><span class="line"> dhcp select interface</span><br><span class="line"> dhcp server lease day 2</span><br><span class="line"> dhcp server dns-list 8.8.8.8 </span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>LSW6</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">dhcp enable</span><br><span class="line">#</span><br><span class="line">dhcp snooping enable</span><br><span class="line">arp dhcp-snooping-detect enable</span><br><span class="line">#</span><br><span class="line">interface Ethernet0/0/1</span><br><span class="line"> dhcp snooping check dhcp-rate enable</span><br><span class="line"> dhcp snooping check dhcp-rate 80</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> port trunk pvid vlan 200</span><br><span class="line"> dhcp snooping check dhcp-rate enable</span><br><span class="line"> dhcp snooping check dhcp-rate 80</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line"> dhcp snooping enable</span><br><span class="line"> dhcp snooping trusted</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h4 id="4-5-2-Configuring-a-WLAN"><a href="#4-5-2-Configuring-a-WLAN" class="headerlink" title="4.5.2 Configuring a WLAN"></a>4.5.2 Configuring a WLAN</h4><ul>
<li>配置旁挂二层直接转发+ vrrp热备冗余+hsb状态同步</li>
<li>黑名单拉黑sta2接入</li>
<li>动态拉黑攻击者mac</li>
<li>流量模板限速</li>
<li>ensp要是支持配置同步功能就厉害了</li>
</ul>
<hr>
<ul>
<li><p>AC1</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">dhcp enable</span><br><span class="line"># 下面这行说dhcp信息可以从文件恢复，很重要么这点信息？</span><br><span class="line"># dhcp server database enable </span><br><span class="line">#</span><br><span class="line">interface Vlanif200</span><br><span class="line"> ip address 172.17.200.2 255.255.255.0</span><br><span class="line"> vrrp vrid 1 virtual-ip 172.17.200.1</span><br><span class="line"> admin-vrrp vrid 1 </span><br><span class="line"> vrrp vrid 1 priority 200</span><br><span class="line"> dhcp select interface</span><br><span class="line"> dhcp server excluded-ip-address 172.17.200.1 172.17.200.3 </span><br><span class="line">#</span><br><span class="line">capwap source ip-address 172.17.200.1</span><br><span class="line">#</span><br><span class="line">wlan</span><br><span class="line"># 流量模板</span><br><span class="line"> traffic-profile name wlan-traffic</span><br><span class="line">  rate-limit client up 5000</span><br><span class="line">  rate-limit vap up 100000</span><br><span class="line">  rate-limit client down 10000</span><br><span class="line">  rate-limit vap down 500000</span><br><span class="line"># 安全模板</span><br><span class="line"> security-profile name wlan-security</span><br><span class="line">  security wpa-wpa2 psk pass-phrase Huawei@123 aes</span><br><span class="line"># 黑名单拉黑sta2</span><br><span class="line"> sta-blacklist-profile name sta-blacklist</span><br><span class="line">  sta-mac 5489-988a-0449</span><br><span class="line"># 空白的白名单</span><br><span class="line"> sta-whitelist-profile name sta-whitelist</span><br><span class="line"># SSID模板</span><br><span class="line"> ssid-profile name wlan-ssid</span><br><span class="line">  ssid ICT2022</span><br><span class="line"># VAP模板</span><br><span class="line"> vap-profile name wlan-vap</span><br><span class="line">  service-vlan vlan-id 100</span><br><span class="line">  sta-access-mode whitelist sta-whitelist</span><br><span class="line">  ssid-profile wlan-ssid</span><br><span class="line">  security-profile wlan-security</span><br><span class="line">  traffic-profile wlan-traffic</span><br><span class="line"># WIDS模板</span><br><span class="line"> wids-profile name wlan-wids</span><br><span class="line">  brute-force-detect interval 80</span><br><span class="line">  brute-force-detect threshold 5</span><br><span class="line">  brute-force-detect quiet-time 800</span><br><span class="line">  dynamic-blacklist enable</span><br><span class="line"># AP系统模板</span><br><span class="line"> ap-system-profile name wlan-system</span><br><span class="line">  dynamic-blacklist aging-time 300</span><br><span class="line">  sta-access-mode blacklist sta-blacklist</span><br><span class="line"># AP组</span><br><span class="line"> ap-group name ap-group</span><br><span class="line">  ap-system-profile wlan-system</span><br><span class="line">  wids-profile wlan-wids</span><br><span class="line">  radio 0</span><br><span class="line">   vap-profile wlan-vap wlan 1</span><br><span class="line"> ap-id 0 type-id 61 ap-mac 00e0-fcf8-2fb0 ap-sn 2102354483106349735D</span><br><span class="line">  ap-name AP1</span><br><span class="line">  ap-group ap-group</span><br><span class="line">#</span><br><span class="line">hsb-service 0</span><br><span class="line"> service-ip-port local-ip 172.17.200.2 peer-ip 172.17.200.3 local-data-port 10241 peer-data-port 10241</span><br><span class="line">#</span><br><span class="line">hsb-group 0</span><br><span class="line"> track vrrp vrid 1 interface Vlanif200</span><br><span class="line"> bind-service 0</span><br><span class="line"> hsb enable # 配置完成其他配置再启用查看状态</span><br><span class="line">#</span><br><span class="line">hsb-service-type access-user hsb-group 0</span><br><span class="line">#</span><br><span class="line">hsb-service-type dhcp hsb-group 0</span><br><span class="line">#</span><br><span class="line">hsb-service-type ap hsb-group 0</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>AC2 ，修改参数即可，wlan配置与AC 1 一致，粘贴注意有时需要输入 Y 确认</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">dhcp enable</span><br><span class="line">#</span><br><span class="line">interface Vlanif200</span><br><span class="line"> ip address 172.17.200.3 255.255.255.0</span><br><span class="line"> vrrp vrid 1 virtual-ip 172.17.200.1</span><br><span class="line"> admin-vrrp vrid 1 </span><br><span class="line"> dhcp select interface</span><br><span class="line"> dhcp server excluded-ip-address 172.17.200.1 172.17.200.3 </span><br><span class="line">#</span><br><span class="line">capwap source ip-address 172.17.200.1</span><br><span class="line">#</span><br><span class="line">wlan</span><br><span class="line"># 流量模板</span><br><span class="line"> traffic-profile name wlan-traffic</span><br><span class="line">  rate-limit client up 5000</span><br><span class="line">  rate-limit vap up 100000</span><br><span class="line">  rate-limit client down 10000</span><br><span class="line">  rate-limit vap down 500000</span><br><span class="line"># 安全模板</span><br><span class="line"> security-profile name wlan-security</span><br><span class="line">  security wpa-wpa2 psk pass-phrase Huawei@123 aes</span><br><span class="line"># 黑名单拉黑sta2</span><br><span class="line"> sta-blacklist-profile name sta-blacklist</span><br><span class="line">  sta-mac 5489-988a-0449</span><br><span class="line"># 空白的白名单</span><br><span class="line"> sta-whitelist-profile name sta-whitelist</span><br><span class="line"># SSID模板</span><br><span class="line"> ssid-profile name wlan-ssid</span><br><span class="line">  ssid ICT2022</span><br><span class="line"># VAP模板</span><br><span class="line"> vap-profile name wlan-vap</span><br><span class="line">  service-vlan vlan-id 100</span><br><span class="line">  sta-access-mode whitelist sta-whitelist</span><br><span class="line">  ssid-profile wlan-ssid</span><br><span class="line">  security-profile wlan-security</span><br><span class="line">  traffic-profile wlan-traffic</span><br><span class="line"># WIDS模板</span><br><span class="line"> wids-profile name wlan-wids</span><br><span class="line">  brute-force-detect interval 80</span><br><span class="line">  brute-force-detect threshold 5</span><br><span class="line">  brute-force-detect quiet-time 800</span><br><span class="line">  dynamic-blacklist enable</span><br><span class="line"># AP系统模板</span><br><span class="line"> ap-system-profile name wlan-system</span><br><span class="line">  dynamic-blacklist aging-time 300</span><br><span class="line">  sta-access-mode blacklist sta-blacklist</span><br><span class="line"># AP组</span><br><span class="line"> ap-group name ap-group</span><br><span class="line">  ap-system-profile wlan-system</span><br><span class="line">  wids-profile wlan-wids</span><br><span class="line">  radio 0</span><br><span class="line">   vap-profile wlan-vap wlan 1</span><br><span class="line"> ap-id 0 type-id 61 ap-mac 00e0-fcf8-2fb0 ap-sn 2102354483106349735D</span><br><span class="line">  ap-name AP1</span><br><span class="line">  ap-group ap-group</span><br><span class="line">#</span><br><span class="line">hsb-service 0</span><br><span class="line"> service-ip-port local-ip 172.17.200.3 peer-ip 172.17.200.2 local-data-port 10241 peer-data-port 10241</span><br><span class="line">#</span><br><span class="line">hsb-group 0</span><br><span class="line"> track vrrp vrid 1 interface Vlanif200</span><br><span class="line"> bind-service 0</span><br><span class="line"> hsb enable</span><br><span class="line">#</span><br><span class="line">hsb-service-type access-user hsb-group 0</span><br><span class="line">#</span><br><span class="line">hsb-service-type dhcp hsb-group 0</span><br><span class="line">#</span><br><span class="line">hsb-service-type ap hsb-group 0</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>校验</p>
<ul>
<li><p>dis vrrp</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[AC1]dis vrrp  </span><br><span class="line">  Vlanif200 | Virtual Router 1</span><br><span class="line">    State : Master</span><br><span class="line">    Virtual IP : 172.17.200.1</span><br><span class="line">    Master IP : 172.17.200.2</span><br><span class="line">    PriorityRun : 222</span><br><span class="line">    PriorityConfig : 222</span><br><span class="line">    MasterPriority : 222</span><br><span class="line">    Preempt : YES   Delay Time : 0 s</span><br><span class="line">    TimerRun : 1 s</span><br><span class="line">    TimerConfig : 1 s</span><br><span class="line">    Auth type : NONE</span><br><span class="line">    Virtual MAC : 0000-5e00-0101</span><br><span class="line">    Check TTL : YES</span><br><span class="line">    Config type : admin-vrrp</span><br><span class="line">    Backup-forward : disabled</span><br><span class="line">    Create time : 2024-07-16 21:14:14 UTC-05:13</span><br><span class="line">    Last change time : 2024-07-16 21:14:27 UTC-05:13</span><br><span class="line"></span><br><span class="line">[AC1]</span><br><span class="line"></span><br><span class="line">[AC2]dis vrrp</span><br><span class="line">  Vlanif200 | Virtual Router 1</span><br><span class="line">    State : Backup</span><br><span class="line">    Virtual IP : 172.17.200.1</span><br><span class="line">    Master IP : 172.17.200.2</span><br><span class="line">    PriorityRun : 111</span><br><span class="line">    PriorityConfig : 111</span><br><span class="line">    MasterPriority : 222</span><br><span class="line">    Preempt : YES   Delay Time : 0 s</span><br><span class="line">    TimerRun : 1 s</span><br><span class="line">    TimerConfig : 1 s</span><br><span class="line">    Auth type : NONE</span><br><span class="line">    Virtual MAC : 0000-5e00-0101</span><br><span class="line">    Check TTL : YES</span><br><span class="line">    Config type : admin-vrrp</span><br><span class="line">    Backup-forward : disabled</span><br><span class="line">    Create time : 2024-07-16 20:19:15 UTC-05:13</span><br><span class="line">    Last change time : 2024-07-16 21:14:58 UTC-05:13</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>dis hsb-group 0 </p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[AC1]dis hsb-group 0</span><br><span class="line">Hot Standby Group Information:</span><br><span class="line">----------------------------------------------------------</span><br><span class="line">  HSB-group ID                : 0</span><br><span class="line">  Vrrp Group ID               : 1</span><br><span class="line">  Vrrp Interface              : Vlanif200</span><br><span class="line">  Service Index               : 0</span><br><span class="line">  Group Vrrp Status           : Master</span><br><span class="line">  Group Status                : Active</span><br><span class="line">  Group Backup Process        : Realtime</span><br><span class="line">  Peer Group Device Name      : AC6005</span><br><span class="line">  Peer Group Software Version : V200R007C10SPC300B220</span><br><span class="line">  Group Backup Modules        : Access-user</span><br><span class="line">                                DHCP</span><br><span class="line">                                AP</span><br><span class="line">----------------------------------------------------------</span><br><span class="line">[AC1]</span><br><span class="line"></span><br><span class="line">[AC2]dis hsb-group 0  </span><br><span class="line">Hot Standby Group Information:</span><br><span class="line">----------------------------------------------------------</span><br><span class="line">  HSB-group ID                : 0</span><br><span class="line">  Vrrp Group ID               : 1</span><br><span class="line">  Vrrp Interface              : Vlanif200</span><br><span class="line">  Service Index               : 0</span><br><span class="line">  Group Vrrp Status           : Backup</span><br><span class="line">  Group Status                : Inactive</span><br><span class="line">  Group Backup Process        : Realtime</span><br><span class="line">  Peer Group Device Name      : AC6005</span><br><span class="line">  Peer Group Software Version : V200R007C10SPC300B220</span><br><span class="line">  Group Backup Modules        : Access-user</span><br><span class="line">                                DHCP</span><br><span class="line">                                AP</span><br><span class="line">----------------------------------------------------------</span><br><span class="line">[AC2]</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>dis hsb-service 0</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[AC1]dis hsb-service 0</span><br><span class="line">Hot Standby Service Information:</span><br><span class="line">----------------------------------------------------------</span><br><span class="line">  Local IP Address       : 172.17.200.2</span><br><span class="line">  Peer IP Address        : 172.17.200.3</span><br><span class="line">  Source Port            : 10241</span><br><span class="line">  Destination Port       : 10241</span><br><span class="line">  Keep Alive Times       : 5</span><br><span class="line">  Keep Alive Interval    : 3</span><br><span class="line">  Service State          : Connected</span><br><span class="line">  Service Batch Modules  :</span><br><span class="line">----------------------------------------------------------</span><br><span class="line">[AC1]</span><br><span class="line"></span><br><span class="line">[AC2]dis hsb-service 0</span><br><span class="line">Hot Standby Service Information:</span><br><span class="line">----------------------------------------------------------</span><br><span class="line">  Local IP Address       : 172.17.200.3</span><br><span class="line">  Peer IP Address        : 172.17.200.2</span><br><span class="line">  Source Port            : 10241</span><br><span class="line">  Destination Port       : 10241</span><br><span class="line">  Keep Alive Times       : 5</span><br><span class="line">  Keep Alive Interval    : 3</span><br><span class="line">  Service State          : Connected</span><br><span class="line">  Service Batch Modules  :</span><br><span class="line">----------------------------------------------------------</span><br><span class="line">[AC2]</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>dis ap all</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[AC1]dis ap all</span><br><span class="line">Info: This operation may take a few seconds. Please wait for a moment.done.</span><br><span class="line">Total AP information:</span><br><span class="line">nor  : normal          [1]</span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line">ID   MAC            Name Group    IP             Type            State STA Uptime</span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line">0    00e0-fcf8-2fb0 AP1  ap-group 172.17.200.132 AP4050DN-E      nor   1   22M:17S</span><br><span class="line">---------------------------------------------------------------------------------------------</span><br><span class="line">Total: 1</span><br><span class="line">[AC1]</span><br><span class="line"></span><br><span class="line">[AC2]dis ap all</span><br><span class="line">Info: This operation may take a few seconds. Please wait for a moment.done.</span><br><span class="line">Total AP information:</span><br><span class="line">stdby: standby         [1]</span><br><span class="line">--------------------------------------------------------------------------------------------</span><br><span class="line">ID   MAC            Name Group    IP             Type            State STA Uptime</span><br><span class="line">--------------------------------------------------------------------------------------------</span><br><span class="line">0    00e0-fcf8-2fb0 AP1  ap-group 172.17.200.132 AP4050DN-E      stdby 0   -</span><br><span class="line">--------------------------------------------------------------------------------------------</span><br><span class="line">Total: 1</span><br><span class="line">[AC2]</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>dis station all</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[AC1]dis station all</span><br><span class="line">Rf/WLAN: Radio ID/WLAN ID                                                     </span><br><span class="line">Rx/Tx: link receive rate/link transmit rate(Mbps)                             </span><br><span class="line">-----------------------------------------------------------------------------------------------------</span><br><span class="line">STA MAC          AP ID Ap name  Rf/WLAN  Band  Type  Rx/Tx      RSSI  VLAN  IP address     SSID                   </span><br><span class="line">-----------------------------------------------------------------------------------------------------</span><br><span class="line">5489-9811-592c   0     AP1      0/1      2.4G  -     -/-        -     100   172.17.100.254 ICT2022                </span><br><span class="line">-----------------------------------------------------------------------------------------------------</span><br><span class="line">Total: 1 2.4G: 1 5G: 0</span><br><span class="line">[AC1]</span><br><span class="line"></span><br><span class="line">[AC2]dis station all</span><br><span class="line">Rf/WLAN: Radio ID/WLAN ID                                                     </span><br><span class="line">Rx/Tx: link receive rate/link transmit rate(Mbps)                             </span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line">STA MAC          AP ID Ap name  Rf/WLAN  Band  Type  Rx/Tx      RSSI  VLAN  IP address  SSID                   </span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line">--------------------------------------------------------------------------------------------------</span><br><span class="line">Total: 0 2.4G: 0 5G: 0</span><br><span class="line">[AC2]</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>dis station online-fail-record all</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[AC1]dis station online-fail-record all</span><br><span class="line">Rf/WLAN: Radio ID/WLAN ID</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">STA MAC         AP ID Ap name  Rf/WLAN    Last record time</span><br><span class="line">                Reason</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">5489-988a-0449  0     AP1      0/1        2024-07-19/10:35:02</span><br><span class="line">                The STA is in the global blacklist.</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">Total stations: 1 Total records: 1</span><br><span class="line">[AC1]</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
</li>
</ul>
<h3 id="4-6-Task-6-Service-Deployment-for-Communication-Between-the-Enterprise-HQ-and-Branch"><a href="#4-6-Task-6-Service-Deployment-for-Communication-Between-the-Enterprise-HQ-and-Branch" class="headerlink" title="4.6 Task 6: Service Deployment for Communication Between the Enterprise HQ and Branch"></a>4.6 Task 6: Service Deployment for Communication Between the Enterprise HQ and Branch</h3><h4 id="4-6-1-Configuring-an-MPLSVPN"><a href="#4-6-1-Configuring-an-MPLSVPN" class="headerlink" title="4.6.1 Configuring an MPLSVPN"></a>4.6.1 Configuring an MPLSVPN</h4><ul>
<li>配置ldp，loopback0接口地址为lsr-id，</li>
<li>AR1/AR2/AR3/AR4，配置vrf entvpn，需要配置RD，RT</li>
<li>AR1/AR2/LSW3/LSW4配置ospf，进程号100，area0，LSW3/LSW4下发默认路由，面向PC的vlanif接口配置passive被动接口</li>
<li>LSW5/AR3/AR4/配置EBGP，AS62012，branch使用network起源宣告网段</li>
<li>vpnv4的反射器，AR1/AR2重分布默认路由进BGP vpn地址族</li>
<li>配置AS-PATH添加，route-map，对收到的路由进行选路干预</li>
<li>LSW5收到的默认路由负载均衡，最大优选路径设置2</li>
<li>当HQ两条出口链路中断，LSW3/LSW4的去往branch 172.17.100.0/24的不走FW2的默认路由 ，track默认路由检测互联AR1/AR2的链路</li>
<li>AR路由器的故障快速切换，在VPN路由收敛前切换</li>
</ul>
<hr>
<ul>
<li><p>AR1</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">mpls lsr-id 1.1.1.1</span><br><span class="line">mpls</span><br><span class="line">#</span><br><span class="line">mpls ldp</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> mpls</span><br><span class="line"> mpls ldp</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> mpls</span><br><span class="line"> mpls ldp</span><br><span class="line">#</span><br><span class="line">ip vpn-instance entvpn</span><br><span class="line"> ipv4-family</span><br><span class="line">  route-distinguisher 64812:1</span><br><span class="line">  vpn frr route-policy VPN-FRR</span><br><span class="line">  vpn-target 64812:345 both</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2.10</span><br><span class="line"> ip binding vpn-instance entvpn</span><br><span class="line"> ip address 172.16.1.1 255.255.255.252 </span><br><span class="line">#</span><br><span class="line">ospf 100 router-id 1.1.1.1 vpn-instance entvpn</span><br><span class="line"> import-route bgp</span><br><span class="line"> area 0.0.0.0 </span><br><span class="line">  network 172.16.1.1 0.0.0.0 </span><br><span class="line">#</span><br><span class="line">bgp 64812</span><br><span class="line"> #</span><br><span class="line"> ipv4-family vpn-instance entvpn </span><br><span class="line">  default-route imported</span><br><span class="line">  import-route ospf 100</span><br><span class="line">#</span><br><span class="line">route-policy VPN-FRR permit node 10 </span><br><span class="line"> apply backup-nexthop auto</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>AR2</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">mpls lsr-id 1.1.1.2</span><br><span class="line">mpls</span><br><span class="line">#</span><br><span class="line">mpls ldp</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> mpls</span><br><span class="line"> mpls ldp</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> mpls</span><br><span class="line"> mpls ldp</span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line">ip vpn-instance entvpn</span><br><span class="line"> ipv4-family</span><br><span class="line">  route-distinguisher 64812:1</span><br><span class="line">  vpn frr route-policy VPN-FRR</span><br><span class="line">  vpn-target 64812:345 both</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2.20</span><br><span class="line"> ip binding vpn-instance entvpn</span><br><span class="line"> ip address 172.16.2.1 255.255.255.252 </span><br><span class="line">#</span><br><span class="line">ospf 100 router-id 1.1.1.2 vpn-instance entvpn</span><br><span class="line"> import-route bgp</span><br><span class="line"> area 0.0.0.0 </span><br><span class="line">  network 172.16.2.1 0.0.0.0 </span><br><span class="line">#</span><br><span class="line">bgp 64812</span><br><span class="line"> #</span><br><span class="line"> ipv4-family vpn-instance entvpn </span><br><span class="line">  default-route imported</span><br><span class="line">  import-route ospf 100</span><br><span class="line">#</span><br><span class="line">route-policy VPN-FRR permit node 10 </span><br><span class="line"> apply backup-nexthop auto</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>AR3</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">mpls lsr-id 1.1.1.3</span><br><span class="line">mpls</span><br><span class="line">#</span><br><span class="line">mpls ldp</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> mpls</span><br><span class="line"> mpls ldp</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line"> pim sm</span><br><span class="line"> mpls</span><br><span class="line"> mpls ldp</span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line">ip vpn-instance entvpn</span><br><span class="line"> ipv4-family</span><br><span class="line">  route-distinguisher 64812:1</span><br><span class="line">  vpn frr route-policy VPN-FRR</span><br><span class="line">  vpn-target 64812:345 both</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1.10</span><br><span class="line"> ip binding vpn-instance entvpn</span><br><span class="line"> ip address 172.17.1.1 255.255.255.252 </span><br><span class="line">#</span><br><span class="line">bgp 64812</span><br><span class="line"> #</span><br><span class="line"> ipv4-family vpn-instance entvpn </span><br><span class="line">  peer 172.17.1.2 as-number 62012 </span><br><span class="line">#</span><br><span class="line">route-policy VPN-FRR permit node 10 </span><br><span class="line"> apply backup-nexthop auto</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>AR4</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">mpls lsr-id 1.1.1.4</span><br><span class="line">mpls</span><br><span class="line">#</span><br><span class="line">mpls ldp</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> mpls</span><br><span class="line"> mpls ldp</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line"> pim sm</span><br><span class="line"> mpls</span><br><span class="line"> mpls ldp</span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line">ip vpn-instance entvpn</span><br><span class="line"> ipv4-family</span><br><span class="line">  route-distinguisher 64812:1</span><br><span class="line">  vpn frr route-policy VPN-FRR</span><br><span class="line">  vpn-target 64812:345 both</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet3/0/0.20</span><br><span class="line"> ip binding vpn-instance entvpn</span><br><span class="line"> ip address 172.17.2.1 255.255.255.252 </span><br><span class="line">#</span><br><span class="line">bgp 64812</span><br><span class="line"> #</span><br><span class="line"> ipv4-family vpn-instance entvpn </span><br><span class="line">  peer 172.17.2.2 as-number 62012 </span><br><span class="line">#</span><br><span class="line">route-policy VPN-FRR permit node 10 </span><br><span class="line"> apply backup-nexthop auto</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>CR1</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">mpls lsr-id 1.1.1.5</span><br><span class="line">mpls</span><br><span class="line">#</span><br><span class="line">mpls ldp</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> mpls</span><br><span class="line"> mpls ldp</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> mpls</span><br><span class="line"> mpls ldp</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line"> mpls</span><br><span class="line"> mpls ldp</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>CR2</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">mpls lsr-id 1.1.1.6</span><br><span class="line">mpls</span><br><span class="line">#</span><br><span class="line">mpls ldp</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> mpls</span><br><span class="line"> mpls ldp</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> mpls</span><br><span class="line"> mpls ldp</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2</span><br><span class="line"> mpls</span><br><span class="line"> mpls ldp</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>LSW3</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">ospf 100 </span><br><span class="line"> default-route-advertise</span><br><span class="line"> silent-interface Vlanif100</span><br><span class="line"> area 0.0.0.0 </span><br><span class="line">  network 172.16.1.2 0.0.0.0 </span><br><span class="line">  network 172.16.5.1 0.0.0.0 </span><br><span class="line">  network 172.16.100.1 0.0.0.0 </span><br><span class="line">#</span><br><span class="line">nqa test-instance toAR1 toAR1</span><br><span class="line"> test-type icmp</span><br><span class="line"> destination-address ipv4 172.16.1.1</span><br><span class="line"> frequency 5</span><br><span class="line"> interval seconds 1</span><br><span class="line"> timeout 1</span><br><span class="line"> probe-count 2</span><br><span class="line"> start now</span><br><span class="line">#</span><br><span class="line">ip route-static 0.0.0.0 0.0.0.0 172.16.3.2 track nqa toAR1 toAR1</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>LSW4</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">ospf 100 </span><br><span class="line"> default-route-advertise</span><br><span class="line"> silent-interface Vlanif101</span><br><span class="line"> area 0.0.0.0 </span><br><span class="line">  network 172.16.2.2 0.0.0.0 </span><br><span class="line">  network 172.16.5.2 0.0.0.0 </span><br><span class="line">  network 172.16.101.1 0.0.0.0 </span><br><span class="line">#</span><br><span class="line">nqa test-instance toAR2 toAR2</span><br><span class="line"> test-type icmp</span><br><span class="line"> destination-address ipv4 172.16.2.1</span><br><span class="line"> frequency 5</span><br><span class="line"> interval seconds 1</span><br><span class="line"> timeout 1</span><br><span class="line"> probe-count 2</span><br><span class="line"> start now</span><br><span class="line">#</span><br><span class="line">ip route-static 0.0.0.0 0.0.0.0 172.16.4.2 track nqa toAR2 toAR2</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>LSW5</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">bgp 62012</span><br><span class="line"> peer 172.17.1.1 as-number 64812 </span><br><span class="line"> peer 172.17.2.1 as-number 64812 </span><br><span class="line"> #</span><br><span class="line"> ipv4-family unicast</span><br><span class="line">  network 172.17.100.0 255.255.255.0 </span><br><span class="line">  maximum load-balancing 2</span><br><span class="line">  peer 172.17.1.1 route-policy AS_PATH_ODD import</span><br><span class="line">  peer 172.17.2.1 route-policy AS_PATH_EVEN import</span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line">route-policy AS_PATH_EVEN permit node 10 </span><br><span class="line"> if-match acl 2010 </span><br><span class="line"> apply as-path 100 additive</span><br><span class="line">#</span><br><span class="line">route-policy AS_PATH_EVEN permit node 20 </span><br><span class="line">#</span><br><span class="line">route-policy AS_PATH_ODD permit node 10 </span><br><span class="line"> if-match acl 2020 </span><br><span class="line"> apply as-path 100 additive</span><br><span class="line">#</span><br><span class="line">route-policy AS_PATH_ODD permit node 20 </span><br><span class="line">#</span><br><span class="line">acl number 2010  </span><br><span class="line"> rule 5 permit source 172.16.0.0 0.0.254.255 </span><br><span class="line">#</span><br><span class="line">acl number 2020  </span><br><span class="line"> rule 5 permit source 172.16.1.0 0.0.254.255 </span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>验证</p>
<ul>
<li><p>PC3 172.17.100.0/24 去往HQ的流量路径</p>
<p><img src="https://s2.loli.net/2024/07/19/c5FrskDQpWo9xHa.png" alt="image-124208233"></p>
</li>
<li><p>PC3 172.17.100.0/24 访问internet</p>
<p><img src="https://s2.loli.net/2024/07/19/5pzSk7K6GmJawCO.png" alt="image-124336943"></p>
</li>
<li><p>AR3查看FRR</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[AR3]dis ip rou vpn-instance entvpn 172.16.100.0 v</span><br><span class="line">Route Flags: R - relay, D - download to fib</span><br><span class="line">------------------------------------------------------------------------------</span><br><span class="line">Routing Table : entvpn</span><br><span class="line">Summary Count : 1</span><br><span class="line"></span><br><span class="line">Destination: 172.16.100.0/24</span><br><span class="line">     Protocol: IBGP             Process ID: 0</span><br><span class="line">   Preference: 255                    Cost: 3</span><br><span class="line">      NextHop: 1.1.1.1           Neighbour: 1.1.1.5</span><br><span class="line">        State: Active Adv Relied       Age: 00h01m41s</span><br><span class="line">          Tag: 0                  Priority: low</span><br><span class="line">        Label: 1054                QoSInfo: 0x0</span><br><span class="line">   IndirectID: 0x10             </span><br><span class="line"> RelayNextHop: 10.3.5.1          Interface: GigabitEthernet0/0/2</span><br><span class="line">     TunnelID: 0x1                   Flags: RD</span><br><span class="line">    BkNextHop: 1.1.1.2         BkInterface: GigabitEthernet0/0/2</span><br><span class="line">      BkLabel: 1053            SecTunnelID: 0x0              </span><br><span class="line"> BkPETunnelID: 0x3         BkPESecTunnelID: 0x0              </span><br><span class="line"> BkIndirectID: 0x14      </span><br><span class="line">[AR3]</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
</li>
</ul>
<h3 id="4-7-Task-7-Service-Deployment-for-Communication-Between-the-Enterprise-and-Data-Center-Servers"><a href="#4-7-Task-7-Service-Deployment-for-Communication-Between-the-Enterprise-and-Data-Center-Servers" class="headerlink" title="4.7 Task 7: Service Deployment for Communication Between the Enterprise and Data Center Servers"></a>4.7 Task 7: Service Deployment for Communication Between the Enterprise and Data Center Servers</h3><h4 id="4-7-1-Configuring-a-Virtual-System-on-the-Firewall"><a href="#4-7-1-Configuring-a-Virtual-System-on-the-Firewall" class="headerlink" title="4.7.1 Configuring a Virtual System on the Firewall"></a>4.7.1 Configuring a Virtual System on the Firewall</h4><ul>
<li><p>FW1配置vsys，服务OA server，鼠标点点也挺快</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">vsys enable                               </span><br><span class="line">resource-class ent_resource</span><br><span class="line"> resource-item-limit session reserved-number 1000 maximum 5000</span><br><span class="line"> resource-item-limit bandwidth 8 outbound</span><br><span class="line"> resource-item-limit policy reserved-number 200</span><br><span class="line"> resource-item-limit user reserved-number 100</span><br><span class="line"> resource-item-limit l2tp-tunnel reserved-number 10</span><br><span class="line"> resource-item-limit ipsec-tunnel reserved-number 10 </span><br><span class="line">#</span><br><span class="line"># 绑定vpn-instance，重新配置IP地址</span><br><span class="line">vsys name entvsys</span><br><span class="line"> assign interface LoopBack0</span><br><span class="line"> assign interface GigabitEthernet1/0/1.50</span><br><span class="line"> assign interface GigabitEthernet1/0/1.60</span><br><span class="line"> assign interface GigabitEthernet1/0/2.50</span><br><span class="line"> assign interface GigabitEthernet1/0/2.60</span><br><span class="line"> assign resource-class ent_resource</span><br><span class="line">#                                         </span><br><span class="line">firewall zone trust</span><br><span class="line"> add interface GigabitEthernet1/0/1.50</span><br><span class="line"> add interface GigabitEthernet1/0/2.50</span><br><span class="line">#</span><br><span class="line">firewall zone untrust</span><br><span class="line"> add interface GigabitEthernet1/0/1.60</span><br><span class="line"> add interface GigabitEthernet1/0/2.60</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h4 id="4-7-2-Connecting-the-OA-Server-to-the-Network"><a href="#4-7-2-Connecting-the-OA-Server-to-the-Network" class="headerlink" title="4.7.2 Connecting the OA Server to the Network"></a>4.7.2 Connecting the OA Server to the Network</h4><ul>
<li>LSW1/LSW2配置vrf entvpn，vlanif100 划入entvpn</li>
<li>vrrp配置，virtual-ip 192.168.100.1/24，LSW1 master，优先级120，抢占延迟20s</li>
<li>LSW1 track G0/0/1 接口，中断后优先级减21，LSW2抢占为master</li>
<li>配置出向路由，交换机默认路由指向FW1；FW1的vsys entvsys，配置出向的主备份路由</li>
<li>配置入向路由，交换机配置指向100.1.1.10/32 的静态路由指向FW1；FW1配置去往OA192.168.100.0/24的主备路由</li>
</ul>
<hr>
<ul>
<li><p>LSW1</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">ip vpn-instance entvpn</span><br><span class="line"> ipv4-family</span><br><span class="line">#</span><br><span class="line">interface Vlanif100</span><br><span class="line"> description VPN-entvpn</span><br><span class="line"> ip binding vpn-instance entvpn</span><br><span class="line"> ip address 192.168.100.8 255.255.255.0 </span><br><span class="line"> vrrp vrid 1 virtual-ip 192.168.100.1</span><br><span class="line"> vrrp vrid 1 priority 120</span><br><span class="line"> vrrp vrid 1 preempt-mode timer delay 20</span><br><span class="line"> vrrp vrid 1 track interface GigabitEthernet0/0/1 reduced 21</span><br><span class="line">#</span><br><span class="line">interface Vlanif50</span><br><span class="line"> description VPN-entvpn</span><br><span class="line"> ip binding vpn-instance entvpn</span><br><span class="line"> ip address 192.168.5.1 255.255.255.252 </span><br><span class="line">#</span><br><span class="line">ip route-static 100.1.1.10 255.255.255.255 100.1.6.2</span><br><span class="line">ip route-static vpn-instance entvpn 0.0.0.0 0.0.0.0 192.168.5.2</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>LSW2</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">ip vpn-instance entvpn</span><br><span class="line"> ipv4-family</span><br><span class="line">#</span><br><span class="line">interface Vlanif100</span><br><span class="line"> description VPN-entvpn</span><br><span class="line"> ip binding vpn-instance entvpn</span><br><span class="line"> ip address 192.168.100.9 255.255.255.0 </span><br><span class="line"> vrrp vrid 1 virtual-ip 192.168.100.1</span><br><span class="line"> vrrp vrid 1 preempt-mode timer delay 20</span><br><span class="line">#</span><br><span class="line">interface Vlanif50</span><br><span class="line"> description VPN-entvpn</span><br><span class="line"> ip binding vpn-instance entvpn</span><br><span class="line"> ip address 192.168.50.1 255.255.255.252 </span><br><span class="line">#</span><br><span class="line">ip route-static 100.1.1.10 255.255.255.255 100.1.60.2</span><br><span class="line">ip route-static vpn-instance entvpn 0.0.0.0 0.0.0.0 192.168.50.2</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>FW1</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">switch vsys entvsys </span><br><span class="line">#</span><br><span class="line">ip route-static 0.0.0.0 0.0.0.0 100.1.6.1</span><br><span class="line">ip route-static 0.0.0.0 0.0.0.0 100.1.60.1 preference 90</span><br><span class="line">ip route-static 192.168.100.0 255.255.255.0 192.168.5.1</span><br><span class="line">ip route-static 192.168.100.0 255.255.255.0 192.168.50.1 preference 90</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h4 id="4-7-3-Configuring-IPsec-Tunnels"><a href="#4-7-3-Configuring-IPsec-Tunnels" class="headerlink" title="4.7.3 Configuring IPsec Tunnels"></a>4.7.3 Configuring IPsec Tunnels</h4><ul>
<li>配置172.16.100.0/24和172.17.100.0/24 走ipsec访问OA 192.168.100.0/24</li>
<li>使用IKE 协商模式</li>
<li>自动触发建立隧道</li>
<li>看图表设置参数</li>
</ul>
<hr>
<ul>
<li><p>AR1</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">bgp 64812</span><br><span class="line">#</span><br><span class="line"> ipv4-family unicast</span><br><span class="line">  network 200.1.6.0 255.255.255.252 </span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>AR2</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">bgp 64812</span><br><span class="line">#</span><br><span class="line"> ipv4-family unicast</span><br><span class="line">  network 200.1.7.0 255.255.255.252 </span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>LSW1</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">bgp 62022</span><br><span class="line">#</span><br><span class="line">ipv4-family unicast</span><br><span class="line"> network 100.1.6.0 255.255.255.252</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>LSW2</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">bgp 62022</span><br><span class="line">#</span><br><span class="line">ipv4-family unicast</span><br><span class="line"> network 100.1.60.0 255.255.255.252</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>FW1</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">acl number 3000</span><br><span class="line"> rule 5 permit ip source 192.168.100.0 0.0.0.255 destination 172.16.100.0 0.0.0.255 </span><br><span class="line"> rule 10 permit ip source 192.168.100.0 0.0.0.255 destination 172.17.100.0 0.0.0.255 </span><br><span class="line">#</span><br><span class="line">ipsec proposal ipsec_proposal</span><br><span class="line"> esp authentication-algorithm sha2-256 </span><br><span class="line"> esp encryption-algorithm aes-256 </span><br><span class="line">#</span><br><span class="line">ike proposal 10</span><br><span class="line"> encryption-algorithm aes-256 </span><br><span class="line"> dh group14 </span><br><span class="line"> authentication-algorithm sha2-256 </span><br><span class="line"> authentication-method pre-share</span><br><span class="line"> integrity-algorithm hmac-sha2-256 </span><br><span class="line"> prf hmac-sha2-256 </span><br><span class="line">#</span><br><span class="line">ike peer fw0201</span><br><span class="line"> pre-shared-key Huawei@123</span><br><span class="line"> ike-proposal 10</span><br><span class="line"> remote-id-type any</span><br><span class="line"> remote-address 200.1.6.2 </span><br><span class="line">ike peer fw0202</span><br><span class="line"> pre-shared-key Huawei@123</span><br><span class="line"> ike-proposal 10</span><br><span class="line"> remote-id-type any</span><br><span class="line"> remote-address 200.1.7.2 </span><br><span class="line">#</span><br><span class="line">ipsec policy ipsec01 10 isakmp</span><br><span class="line"> security acl 3000</span><br><span class="line"> ike-peer fw0201</span><br><span class="line"> proposal ipsec_proposal</span><br><span class="line">ipsec policy ipsec02 10 isakmp</span><br><span class="line"> security acl 3000</span><br><span class="line"> ike-peer fw0202</span><br><span class="line"> proposal ipsec_proposal</span><br><span class="line"> # undo policy enable # 策略禁用命令</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet1/0/1.60</span><br><span class="line"> ipsec policy ipsec01</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet1/0/2.60</span><br><span class="line"> ipsec policy ipsec02</span><br><span class="line">#</span><br><span class="line">security-policy</span><br><span class="line"> rule name ipsec_in_sp</span><br><span class="line">  source-zone untrust</span><br><span class="line">  destination-zone local</span><br><span class="line">  source-address 200.1.6.0 mask 255.255.255.0</span><br><span class="line">  source-address 200.1.7.0 mask 255.255.255.0</span><br><span class="line">  action permit</span><br><span class="line"> rule name ipsec_out_sp</span><br><span class="line">  source-zone local</span><br><span class="line">  destination-zone untrust</span><br><span class="line">  destination-address 200.1.6.2 mask 255.255.255.255</span><br><span class="line">  destination-address 200.1.7.2 mask 255.255.255.255</span><br><span class="line">  action permit</span><br><span class="line"> rule name trust2untrust</span><br><span class="line">  source-zone trust</span><br><span class="line">  destination-zone untrust</span><br><span class="line">  source-address 192.168.100.0 mask 255.255.255.0</span><br><span class="line">  destination-address 172.16.100.0 mask 255.255.255.0</span><br><span class="line">  destination-address 172.17.100.0 mask 255.255.255.0</span><br><span class="line">  action permit</span><br><span class="line"> rule name untrust2trust</span><br><span class="line">  source-zone untrust</span><br><span class="line">  destination-zone trust</span><br><span class="line">  source-address 172.16.100.0 mask 255.255.255.0</span><br><span class="line">  source-address 172.17.100.0 mask 255.255.255.0</span><br><span class="line">  destination-address 192.168.100.0 mask 255.255.255.0</span><br><span class="line">  action permit</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>FW2</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line">acl number 3000</span><br><span class="line"> rule 5 permit ip source 172.16.100.0 0.0.0.255 destination 192.168.100.0 0.0.0.255 </span><br><span class="line"> rule 10 permit ip source 172.17.100.0 0.0.0.255 destination 192.168.100.0 0.0.0.255 </span><br><span class="line">#</span><br><span class="line">ipsec proposal ipsec_proposal # 使用默认值，不用敲以下2行命令</span><br><span class="line"> esp authentication-algorithm sha2-256 </span><br><span class="line"> esp encryption-algorithm aes-256 </span><br><span class="line">#</span><br><span class="line">ike proposal 10 # 使用默认值，不用敲以下6行命令</span><br><span class="line"> encryption-algorithm aes-256 </span><br><span class="line"> dh group14 </span><br><span class="line"> authentication-algorithm sha2-256 </span><br><span class="line"> authentication-method pre-share</span><br><span class="line"> integrity-algorithm hmac-sha2-256 </span><br><span class="line"> prf hmac-sha2-256 </span><br><span class="line">#</span><br><span class="line">ike peer fw0101</span><br><span class="line"> pre-shared-key Huawei@123</span><br><span class="line"> ike-proposal 10</span><br><span class="line"> remote-id-type any</span><br><span class="line"> remote-address 100.1.6.2 </span><br><span class="line">ike peer fw0102</span><br><span class="line"> pre-shared-key Huawei@123</span><br><span class="line"> ike-proposal 10</span><br><span class="line"> remote-id-type any</span><br><span class="line"> remote-address 100.1.60.2 </span><br><span class="line">#</span><br><span class="line">ipsec policy ipsec01 10 isakmp</span><br><span class="line"> security acl 3000</span><br><span class="line"> ike-peer fw0101</span><br><span class="line"> proposal ipsec_proposal</span><br><span class="line">ipsec policy ipsec02 10 isakmp</span><br><span class="line"> security acl 3000</span><br><span class="line"> ike-peer fw0102</span><br><span class="line"> proposal ipsec_proposal</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet1/0/3.60</span><br><span class="line"> ipsec policy ipsec01</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet1/0/4.70</span><br><span class="line"> ipsec policy ipsec02</span><br><span class="line">#</span><br><span class="line">security-policy</span><br><span class="line"> rule name trust2untrust01</span><br><span class="line">  source-zone trust</span><br><span class="line">  destination-zone untrust</span><br><span class="line">  source-address 172.16.100.0 mask 255.255.255.0</span><br><span class="line">  source-address 172.17.100.0 mask 255.255.255.0</span><br><span class="line">  profile ips Profile_ips_pc</span><br><span class="line">  action permit</span><br><span class="line"> rule name trust2untrust02</span><br><span class="line">  source-zone trust</span><br><span class="line">  destination-zone untrust</span><br><span class="line">  source-address 172.16.101.0 mask 255.255.255.0</span><br><span class="line">  destination-address 192.168.100.0 mask 255.255.255.0</span><br><span class="line">  action permit</span><br><span class="line"> rule name ipsec_out_sp</span><br><span class="line">  source-zone local</span><br><span class="line">  destination-zone untrust</span><br><span class="line">  destination-address 100.1.6.2 mask 255.255.255.255</span><br><span class="line">  destination-address 100.1.60.2 mask 255.255.255.255</span><br><span class="line">  action permit</span><br><span class="line"> rule name ipsec_in_sp</span><br><span class="line">  source-zone untrust</span><br><span class="line">  destination-zone local</span><br><span class="line">  source-address 100.1.6.2 mask 255.255.255.255</span><br><span class="line">  source-address 100.1.60.2 mask 255.255.255.255</span><br><span class="line">  action permit</span><br><span class="line"> rule name untrust2trust</span><br><span class="line">  source-zone untrust</span><br><span class="line">  destination-zone trust</span><br><span class="line">  source-address 192.168.100.0 mask 255.255.255.0</span><br><span class="line">  destination-address 172.16.100.0 mask 255.255.255.0</span><br><span class="line">  destination-address 172.17.100.0 mask 255.255.255.0</span><br><span class="line">  action permit</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>校验</p>
<ul>
<li><p>dis ipsec sa</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line">[FW1-entvsys]dis ipsec sa</span><br><span class="line">2024-07-17 09:00:34.530 </span><br><span class="line"></span><br><span class="line">ipsec sa information:</span><br><span class="line"></span><br><span class="line">===============================</span><br><span class="line">Interface: GigabitEthernet1/0/1.60</span><br><span class="line">===============================</span><br><span class="line"></span><br><span class="line">  -----------------------------</span><br><span class="line">  IPSec policy name: "ipsec01"</span><br><span class="line">  Sequence number  : 10</span><br><span class="line">  Acl group        : 3000</span><br><span class="line">  Acl rule         : 5</span><br><span class="line">  Mode             : ISAKMP</span><br><span class="line">  -----------------------------</span><br><span class="line">    Connection ID     : 7</span><br><span class="line">    Encapsulation mode: Tunnel</span><br><span class="line">    Holding time      : 0d 1h 12m 55s</span><br><span class="line">    Tunnel local      : 100.1.6.2:500</span><br><span class="line">    Tunnel remote     : 200.1.6.2:500</span><br><span class="line">    Flow source       : 192.168.100.0/255.255.255.0 0/0-65535</span><br><span class="line">    Flow destination  : 172.16.100.0/255.255.255.0 0/0-65535</span><br><span class="line"></span><br><span class="line">    [Outbound ESP SAs] </span><br><span class="line">      SPI: 199477355 (0xbe3c86b)</span><br><span class="line">      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128</span><br><span class="line">      SA remaining key duration (kilobytes/sec): 10485721/2324</span><br><span class="line">      Max sent sequence-number: 665       </span><br><span class="line">      UDP encapsulation used for NAT traversal: N</span><br><span class="line">      SA encrypted packets (number/bytes): 664/39936</span><br><span class="line"></span><br><span class="line">    [Inbound ESP SAs] </span><br><span class="line">      SPI: 187864131 (0xb329443)</span><br><span class="line">      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128</span><br><span class="line">      SA remaining key duration (kilobytes/sec): 10485760/2324</span><br><span class="line">      Max received sequence-number: 1</span><br><span class="line">      UDP encapsulation used for NAT traversal: N</span><br><span class="line">      SA decrypted packets (number/bytes): 0/0</span><br><span class="line">      Anti-replay : Enable</span><br><span class="line">      Anti-replay window size: 1024</span><br><span class="line"></span><br><span class="line">  -----------------------------</span><br><span class="line">  IPSec policy name: "ipsec01"</span><br><span class="line">  Sequence number  : 10</span><br><span class="line">  Acl group        : 3000</span><br><span class="line">  Acl rule         : 10</span><br><span class="line">  Mode             : ISAKMP</span><br><span class="line">  -----------------------------</span><br><span class="line">    Connection ID     : 6</span><br><span class="line">    Encapsulation mode: Tunnel</span><br><span class="line">    Holding time      : 0d 0h 39m 25s</span><br><span class="line">    Tunnel local      : 100.1.6.2:500     </span><br><span class="line">    Tunnel remote     : 200.1.6.2:500</span><br><span class="line">    Flow source       : 192.168.100.0/255.255.255.0 0/0-65535</span><br><span class="line">    Flow destination  : 172.17.100.0/255.255.255.0 0/0-65535</span><br><span class="line"></span><br><span class="line">    [Outbound ESP SAs] </span><br><span class="line">      SPI: 192541812 (0xb79f474)</span><br><span class="line">      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128</span><br><span class="line">      SA remaining key duration (kilobytes/sec): 10485722/1237</span><br><span class="line">      Max sent sequence-number: 666</span><br><span class="line">      UDP encapsulation used for NAT traversal: N</span><br><span class="line">      SA encrypted packets (number/bytes): 665/39900</span><br><span class="line"></span><br><span class="line">    [Inbound ESP SAs] </span><br><span class="line">      SPI: 186945386 (0xb248f6a)</span><br><span class="line">      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128</span><br><span class="line">      SA remaining key duration (kilobytes/sec): 10485754/1237</span><br><span class="line">      Max received sequence-number: 64</span><br><span class="line">      UDP encapsulation used for NAT traversal: N</span><br><span class="line">      SA decrypted packets (number/bytes): 106/6360</span><br><span class="line">      Anti-replay : Enable</span><br><span class="line">      Anti-replay window size: 1024</span><br><span class="line"></span><br><span class="line">===============================</span><br><span class="line">Interface: GigabitEthernet1/0/2.60        </span><br><span class="line">===============================</span><br><span class="line"></span><br><span class="line">  -----------------------------</span><br><span class="line">  IPSec policy name: "ipsec02"</span><br><span class="line">  Sequence number  : 10</span><br><span class="line">  Acl group        : 3000</span><br><span class="line">  Acl rule         : 5</span><br><span class="line">  Mode             : ISAKMP</span><br><span class="line">  -----------------------------</span><br><span class="line">    Connection ID     : 8</span><br><span class="line">    Encapsulation mode: Tunnel</span><br><span class="line">    Holding time      : 0d 0h 53m 39s</span><br><span class="line">    Tunnel local      : 100.1.60.2:500</span><br><span class="line">    Tunnel remote     : 200.1.7.2:500</span><br><span class="line">    Flow source       : 192.168.100.0/255.255.255.0 0/0-65535</span><br><span class="line">    Flow destination  : 172.16.100.0/255.255.255.0 0/0-65535</span><br><span class="line"></span><br><span class="line">    [Outbound ESP SAs] </span><br><span class="line">      SPI: 195126685 (0xba1659d)</span><br><span class="line">      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128</span><br><span class="line">      SA remaining key duration (kilobytes/sec): 10485760/3407</span><br><span class="line">      Max sent sequence-number: 1</span><br><span class="line">      UDP encapsulation used for NAT traversal: N</span><br><span class="line">      SA encrypted packets (number/bytes): 0/0</span><br><span class="line"></span><br><span class="line">    [Inbound ESP SAs] </span><br><span class="line">      SPI: 195412318 (0xba5c15e)</span><br><span class="line">      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128</span><br><span class="line">      SA remaining key duration (kilobytes/sec): 10485753/3407</span><br><span class="line">      Max received sequence-number: 128</span><br><span class="line">      UDP encapsulation used for NAT traversal: N</span><br><span class="line">      SA decrypted packets (number/bytes): 133/7980</span><br><span class="line">      Anti-replay : Enable</span><br><span class="line">      Anti-replay window size: 1024</span><br><span class="line"></span><br><span class="line">  -----------------------------</span><br><span class="line">  IPSec policy name: "ipsec02"</span><br><span class="line">  Sequence number  : 10</span><br><span class="line">  Acl group        : 3000</span><br><span class="line">  Acl rule         : 10</span><br><span class="line">  Mode             : ISAKMP</span><br><span class="line">  -----------------------------</span><br><span class="line">    Connection ID     : 5</span><br><span class="line">    Encapsulation mode: Tunnel</span><br><span class="line">    Holding time      : 0d 0h 42m 10s</span><br><span class="line">    Tunnel local      : 100.1.60.2:500</span><br><span class="line">    Tunnel remote     : 200.1.7.2:500</span><br><span class="line">    Flow source       : 192.168.100.0/255.255.255.0 0/0-65535</span><br><span class="line">    Flow destination  : 172.17.100.0/255.255.255.0 0/0-65535</span><br><span class="line"></span><br><span class="line">    [Outbound ESP SAs] </span><br><span class="line">      SPI: 184686406 (0xb021746)</span><br><span class="line">      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128</span><br><span class="line">      SA remaining key duration (kilobytes/sec): 10485760/1071</span><br><span class="line">      Max sent sequence-number: 1</span><br><span class="line">      UDP encapsulation used for NAT traversal: N</span><br><span class="line">      SA encrypted packets (number/bytes): 0/0</span><br><span class="line"></span><br><span class="line">    [Inbound ESP SAs] </span><br><span class="line">      SPI: 187927920 (0xb338d70)</span><br><span class="line">      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128</span><br><span class="line">      SA remaining key duration (kilobytes/sec): 10485699/1071</span><br><span class="line">      Max received sequence-number: 1216</span><br><span class="line">      UDP encapsulation used for NAT traversal: N</span><br><span class="line">      SA decrypted packets (number/bytes): 1044/63024</span><br><span class="line">      Anti-replay : Enable</span><br><span class="line">      Anti-replay window size: 1024</span><br><span class="line">[FW1-entvsys] </span><br></pre></td></tr></tbody></table></figure>


</li>
<li><p>dis ipsec sa</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line">[FW2]dis ipsec sa</span><br><span class="line">2024-07-17 09:01:41.270 </span><br><span class="line"></span><br><span class="line">ipsec sa information:</span><br><span class="line"></span><br><span class="line">===============================</span><br><span class="line">Interface: GigabitEthernet1/0/3.60</span><br><span class="line">===============================</span><br><span class="line"></span><br><span class="line">  -----------------------------</span><br><span class="line">  IPSec policy name: "ipsec01"</span><br><span class="line">  Sequence number  : 10</span><br><span class="line">  Acl group        : 3000</span><br><span class="line">  Acl rule         : 5</span><br><span class="line">  Mode             : ISAKMP</span><br><span class="line">  -----------------------------</span><br><span class="line">    Connection ID     : 47</span><br><span class="line">    Encapsulation mode: Tunnel</span><br><span class="line">    Holding time      : 0d 1h 14m 2s</span><br><span class="line">    Tunnel local      : 200.1.6.2:500</span><br><span class="line">    Tunnel remote     : 100.1.6.2:500</span><br><span class="line">    Flow source       : 172.16.100.0/255.255.255.0 0/0-65535</span><br><span class="line">    Flow destination  : 192.168.100.0/255.255.255.0 0/0-65535</span><br><span class="line"></span><br><span class="line">    [Outbound ESP SAs] </span><br><span class="line">      SPI: 187864131 (0xb329443)</span><br><span class="line">      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128</span><br><span class="line">      SA remaining key duration (kilobytes/sec): 10485760/2257</span><br><span class="line">      Max sent sequence-number: 1         </span><br><span class="line">      UDP encapsulation used for NAT traversal: N</span><br><span class="line">      SA encrypted packets (number/bytes): 0/0</span><br><span class="line"></span><br><span class="line">    [Inbound ESP SAs] </span><br><span class="line">      SPI: 199477355 (0xbe3c86b)</span><br><span class="line">      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128</span><br><span class="line">      SA remaining key duration (kilobytes/sec): 10485719/2257</span><br><span class="line">      Max received sequence-number: 704</span><br><span class="line">      UDP encapsulation used for NAT traversal: N</span><br><span class="line">      SA decrypted packets (number/bytes): 708/42576</span><br><span class="line">      Anti-replay : Enable</span><br><span class="line">      Anti-replay window size: 1024</span><br><span class="line"></span><br><span class="line">  -----------------------------</span><br><span class="line">  IPSec policy name: "ipsec01"</span><br><span class="line">  Sequence number  : 10</span><br><span class="line">  Acl group        : 3000</span><br><span class="line">  Acl rule         : 10</span><br><span class="line">  Mode             : ISAKMP</span><br><span class="line">  -----------------------------</span><br><span class="line">    Connection ID     : 45</span><br><span class="line">    Encapsulation mode: Tunnel</span><br><span class="line">    Holding time      : 0d 0h 40m 31s</span><br><span class="line">    Tunnel local      : 200.1.6.2:500     </span><br><span class="line">    Tunnel remote     : 100.1.6.2:500</span><br><span class="line">    Flow source       : 172.17.100.0/255.255.255.0 0/0-65535</span><br><span class="line">    Flow destination  : 192.168.100.0/255.255.255.0 0/0-65535</span><br><span class="line"></span><br><span class="line">    [Outbound ESP SAs] </span><br><span class="line">      SPI: 186945386 (0xb248f6a)</span><br><span class="line">      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128</span><br><span class="line">      SA remaining key duration (kilobytes/sec): 10485754/1170</span><br><span class="line">      Max sent sequence-number: 107</span><br><span class="line">      UDP encapsulation used for NAT traversal: N</span><br><span class="line">      SA encrypted packets (number/bytes): 106/6360</span><br><span class="line"></span><br><span class="line">    [Inbound ESP SAs] </span><br><span class="line">      SPI: 192541812 (0xb79f474)</span><br><span class="line">      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128</span><br><span class="line">      SA remaining key duration (kilobytes/sec): 10485719/1170</span><br><span class="line">      Max received sequence-number: 704</span><br><span class="line">      UDP encapsulation used for NAT traversal: N</span><br><span class="line">      SA decrypted packets (number/bytes): 707/42420</span><br><span class="line">      Anti-replay : Enable</span><br><span class="line">      Anti-replay window size: 1024</span><br><span class="line"></span><br><span class="line">===============================</span><br><span class="line">Interface: GigabitEthernet1/0/4.70        </span><br><span class="line">===============================</span><br><span class="line"></span><br><span class="line">  -----------------------------</span><br><span class="line">  IPSec policy name: "ipsec02"</span><br><span class="line">  Sequence number  : 10</span><br><span class="line">  Acl group        : 3000</span><br><span class="line">  Acl rule         : 5</span><br><span class="line">  Mode             : ISAKMP</span><br><span class="line">  -----------------------------</span><br><span class="line">    Connection ID     : 48</span><br><span class="line">    Encapsulation mode: Tunnel</span><br><span class="line">    Holding time      : 0d 0h 54m 40s</span><br><span class="line">    Tunnel local      : 200.1.7.2:500</span><br><span class="line">    Tunnel remote     : 100.1.60.2:500</span><br><span class="line">    Flow source       : 172.16.100.0/255.255.255.0 0/0-65535</span><br><span class="line">    Flow destination  : 192.168.100.0/255.255.255.0 0/0-65535</span><br><span class="line"></span><br><span class="line">    [Outbound ESP SAs] </span><br><span class="line">      SPI: 195412318 (0xba5c15e)</span><br><span class="line">      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128</span><br><span class="line">      SA remaining key duration (kilobytes/sec): 10485750/3347</span><br><span class="line">      Max sent sequence-number: 178</span><br><span class="line">      UDP encapsulation used for NAT traversal: N</span><br><span class="line">      SA encrypted packets (number/bytes): 177/10620</span><br><span class="line"></span><br><span class="line">    [Inbound ESP SAs] </span><br><span class="line">      SPI: 195126685 (0xba1659d)</span><br><span class="line">      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128</span><br><span class="line">      SA remaining key duration (kilobytes/sec): 10485760/3347</span><br><span class="line">      Max received sequence-number: 1</span><br><span class="line">      UDP encapsulation used for NAT traversal: N</span><br><span class="line">      SA decrypted packets (number/bytes): 0/0</span><br><span class="line">      Anti-replay : Enable</span><br><span class="line">      Anti-replay window size: 1024</span><br><span class="line"></span><br><span class="line">  -----------------------------</span><br><span class="line">  IPSec policy name: "ipsec02"</span><br><span class="line">  Sequence number  : 10</span><br><span class="line">  Acl group        : 3000</span><br><span class="line">  Acl rule         : 10</span><br><span class="line">  Mode             : ISAKMP</span><br><span class="line">  -----------------------------</span><br><span class="line">    Connection ID     : 44</span><br><span class="line">    Encapsulation mode: Tunnel</span><br><span class="line">    Holding time      : 0d 0h 43m 11s</span><br><span class="line">    Tunnel local      : 200.1.7.2:500</span><br><span class="line">    Tunnel remote     : 100.1.60.2:500</span><br><span class="line">    Flow source       : 172.17.100.0/255.255.255.0 0/0-65535</span><br><span class="line">    Flow destination  : 192.168.100.0/255.255.255.0 0/0-65535</span><br><span class="line"></span><br><span class="line">    [Outbound ESP SAs] </span><br><span class="line">      SPI: 187927920 (0xb338d70)</span><br><span class="line">      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128</span><br><span class="line">      SA remaining key duration (kilobytes/sec): 10485683/1011</span><br><span class="line">      Max sent sequence-number: 1317</span><br><span class="line">      UDP encapsulation used for NAT traversal: N</span><br><span class="line">      SA encrypted packets (number/bytes): 1316/79344</span><br><span class="line"></span><br><span class="line">    [Inbound ESP SAs] </span><br><span class="line">      SPI: 184686406 (0xb021746)</span><br><span class="line">      Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128</span><br><span class="line">      SA remaining key duration (kilobytes/sec): 10485760/1011</span><br><span class="line">      Max received sequence-number: 1</span><br><span class="line">      UDP encapsulation used for NAT traversal: N</span><br><span class="line">      SA decrypted packets (number/bytes): 0/0</span><br><span class="line">      Anti-replay : Enable</span><br><span class="line">      Anti-replay window size: 1024</span><br><span class="line">[FW2]</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>PC1 ping OA</p>
<p><img src="https://s2.loli.net/2024/07/19/KslP3dvnjWorawu.png" alt="image-170314062"></p>
</li>
<li><p>PC3 ping OA</p>
<p><img src="https://s2.loli.net/2024/07/19/pGxZKakoYJ7ldiC.png" alt="image-170423691"></p>
</li>
</ul>
</li>
</ul>
<h4 id="4-7-4-Configuring-an-L2TP-over-IPsec-Tunnel"><a href="#4-7-4-Configuring-an-L2TP-over-IPsec-Tunnel" class="headerlink" title="4.7.4 Configuring an L2TP over IPsec Tunnel"></a>4.7.4 Configuring an L2TP over IPsec Tunnel</h4><ul>
<li>配置l2tp over ipsec</li>
</ul>
<hr>
<ul>
<li><p>FW1</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"># 切换虚拟系统，以下配置都在entvsys下配置</span><br><span class="line">switch vsys entvsys </span><br><span class="line"># 创建user001，每次启动都需要操作一次，产品手册中指示存于数据库中，而模拟器没硬盘没这货</span><br><span class="line">user-manage user user0001</span><br><span class="line">password Huawei@123</span><br><span class="line">#</span><br><span class="line">interface Virtual-Template0</span><br><span class="line"> ppp authentication-mode chap</span><br><span class="line"> remote address 30.30.30.2</span><br><span class="line"> ip address 30.30.30.1 255.255.255.252</span><br><span class="line">#</span><br><span class="line">firewall zone dmz</span><br><span class="line"> add interface Virtual-Template0</span><br><span class="line">#</span><br><span class="line">l2tp enable</span><br><span class="line">l2tp-group 1</span><br><span class="line"> tunnel password cipher Huawei@123</span><br><span class="line"> tunnel name lns</span><br><span class="line"> allow l2tp virtual-template 0 remote lac</span><br><span class="line">#</span><br><span class="line">acl number 3000</span><br><span class="line"> rule 15 permit udp source-port eq 1701</span><br><span class="line">#</span><br><span class="line">security-policy</span><br><span class="line"> rule name trust2dmz</span><br><span class="line">  source-zone trust</span><br><span class="line">  destination-zone dmz</span><br><span class="line">  source-address 192.168.100.0 mask 255.255.255.0</span><br><span class="line">  destination-address 30.30.30.0 mask 255.255.255.252</span><br><span class="line">  action permit</span><br><span class="line"> rule name dmz2trust</span><br><span class="line">  source-zone dmz</span><br><span class="line">  destination-zone trust</span><br><span class="line">  source-address 30.30.30.0 mask 255.255.255.252</span><br><span class="line">  destination-address 192.168.100.0 mask 255.255.255.0</span><br><span class="line">  action permit</span><br><span class="line"> rule name untrust2local</span><br><span class="line">  source-zone untrust</span><br><span class="line">  destination-zone local</span><br><span class="line">  source-address 200.1.1.11 mask 255.255.255.255</span><br><span class="line">  destination-address 100.1.1.10 mask 255.255.255.255</span><br><span class="line">  action permit</span><br><span class="line"> rule name any</span><br><span class="line">  action permit</span><br><span class="line"># </span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>FW2</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line"> l2tp enable</span><br><span class="line">#</span><br><span class="line">l2tp-group 1</span><br><span class="line"> tunnel password cipher Huawei@123</span><br><span class="line"> tunnel name lac</span><br><span class="line"> tunnel source LoopBack0</span><br><span class="line"> start l2tp ip 100.1.1.10 fullusername user001</span><br><span class="line">#</span><br><span class="line">interface Virtual-Template0</span><br><span class="line"> ppp authentication-mode chap</span><br><span class="line"> ppp chap user user001</span><br><span class="line"> ppp chap password cipher Huawei@123</span><br><span class="line"> ip address ppp-negotiate</span><br><span class="line"> call-lns local-user user001</span><br><span class="line">#</span><br><span class="line">policy-based-route</span><br><span class="line"> rule name l2tp 1</span><br><span class="line">  source-zone trust</span><br><span class="line">  source-address 172.16.101.0 mask 255.255.255.0</span><br><span class="line">  destination-address 192.168.100.0 mask 255.255.255.0</span><br><span class="line">  action pbr egress-interface Virtual-Template0</span><br><span class="line">#</span><br><span class="line">nat-policy</span><br><span class="line"> rule name l2tp</span><br><span class="line">  source-zone trust</span><br><span class="line">  egress-interface Virtual-Template0</span><br><span class="line">  source-address 172.16.101.0 mask 255.255.255.0</span><br><span class="line">  destination-address 192.168.100.0 mask 255.255.255.0</span><br><span class="line">  action source-nat easy-ip</span><br><span class="line">#</span><br><span class="line">acl number 3000</span><br><span class="line"> rule 15 permit udp destination-port eq 1701</span><br><span class="line">#</span><br><span class="line">security-policy</span><br><span class="line"> rule name trust2dmz</span><br><span class="line">  source-zone trust</span><br><span class="line">  destination-zone dmz</span><br><span class="line">  source-address 172.16.101.0 mask 255.255.255.0</span><br><span class="line">  destination-address 192.168.100.0 mask 255.255.255.0</span><br><span class="line">  action permit</span><br><span class="line"> rule name dmz2trust</span><br><span class="line">  source-zone dmz</span><br><span class="line">  destination-zone trust</span><br><span class="line">  source-address 30.30.30.2 mask 255.255.255.255</span><br><span class="line">  destination-address 172.16.101.0 mask 255.255.255.0</span><br><span class="line">  action permit</span><br><span class="line"> rule name local2untrust</span><br><span class="line">  source-zone local</span><br><span class="line">  destination-zone untrust                </span><br><span class="line">  source-address 200.1.1.11 mask 255.255.255.255</span><br><span class="line">  destination-address 100.1.1.10 mask 255.255.255.255</span><br><span class="line">  action permit</span><br><span class="line">#</span><br><span class="line"> </span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>验证</p>
<ul>
<li><p>PC1 PC2 PC3 ping OA 192.168.100.254</p>
<p><img src="https://s2.loli.net/2024/07/19/HyokRSbtgxev79u.png" alt="image-042024690"></p>
</li>
<li><p>FW2查看l2tp隧道</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[FW2]dis l2tp tunnel  </span><br><span class="line">2024-07-18 20:01:48.860 </span><br><span class="line">L2TP::Total Tunnel: 1</span><br><span class="line"></span><br><span class="line"> LocalTID RemoteTID RemoteAddress    Port   Sessions RemoteName  VpnInstance</span><br><span class="line"> ------------------------------------------------------------------------------</span><br><span class="line"> 1        1         100.1.1.10       1701   1        lns                     </span><br><span class="line"> ------------------------------------------------------------------------------</span><br><span class="line">  Total 1, 1 printed</span><br><span class="line"></span><br><span class="line">[FW2]dis l2tp session </span><br><span class="line">2024-07-18 20:01:51.360 </span><br><span class="line">L2TP::Total Session: 1</span><br><span class="line"></span><br><span class="line">  LocalSID  RemoteSID  LocalTID   RemoteTID  UserID  UserName    VpnInstance</span><br><span class="line"> ------------------------------------------------------------------------------</span><br><span class="line">  69        41         1          1                  user001                   </span><br><span class="line"> ------------------------------------------------------------------------------</span><br><span class="line">  Total 1, 1 printed</span><br><span class="line"></span><br><span class="line">[FW2]</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>FW2查看加密计数</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[FW2]dis ipsec statistics </span><br><span class="line">2024-07-18 20:21:08.960 </span><br><span class="line"> IPSec statistics information:</span><br><span class="line"> Number of IPSec tunnels: 5</span><br><span class="line"> Number of standby IPSec tunnels: 0</span><br><span class="line"> the security packet statistics:</span><br><span class="line">   input/output security packets: 5082/5457 </span><br><span class="line">   input/output security bytes: 335843/362318 </span><br><span class="line">   input/output dropped security packets: 4/7  </span><br><span class="line">   the encrypt packet statistics: </span><br><span class="line">     send chip: 5457, recv chip: 5457, send err: 2</span><br><span class="line">     local cpu: 5457, other cpu: 0, recv other cpu: 0</span><br><span class="line">     intact packet: 5457, first slice: 0, after slice: 0</span><br><span class="line">   the decrypt packet statistics:</span><br><span class="line">     send chip: 5082, recv chip: 5082, send err: 0</span><br><span class="line">     local cpu: 5082, other cpu: 0, recv other cpu: 0</span><br><span class="line">     reass  first slice: 0, after slice: 0</span><br><span class="line">   dropped security packet detail:</span><br><span class="line">     can not find SA: 0, wrong SA: 0</span><br><span class="line">     authentication: 0, replay: 0 </span><br><span class="line">     front recheck: 0, after recheck: 4</span><br><span class="line">     change cpu enc: 0, dec change cpu: 0 </span><br><span class="line">     fib search: 0, output l3: 2</span><br><span class="line">     flow err: 5, slice err: 0, byte limit: 0</span><br><span class="line">     slave drop: 0</span><br><span class="line">   negotiate about packet statistics:</span><br><span class="line">     IKE fwd packet ok: 46, err: 0        </span><br><span class="line">     IKE ctrl packet inbound ok: 46, outbound ok: 68</span><br><span class="line">     SoftExpr: 0, HardExpr: 0, DPDOper: 0</span><br><span class="line">     trigger ok: 29, switch sa: 12, sync sa: 0  </span><br><span class="line">     recv IKE nat keepalive: 0, IKE input: 0</span><br><span class="line"></span><br><span class="line">[FW2] </span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>FW查看ipsec状态</p>
<p><img src="https://s2.loli.net/2024/07/19/PqFutpOGhkfn9ig.png" alt="image-042144749"></p>
</li>
</ul>
</li>
</ul>
<h3 id="4-8-Task-8-Multicast-Service-Deployment-on-the-MAN"><a href="#4-8-Task-8-Multicast-Service-Deployment-on-the-MAN" class="headerlink" title="4.8 Task 8: Multicast Service Deployment on the MAN"></a>4.8 Task 8: Multicast Service Deployment on the MAN</h3><h4 id="4-8-1-Configuring-the-Multicast-Service"><a href="#4-8-1-Configuring-the-Multicast-Service" class="headerlink" title="4.8.1 Configuring the Multicast Service"></a>4.8.1 Configuring the Multicast Service</h4><ul>
<li>配置MAN网络的组播网络，AR4 igmpv2，</li>
<li>CR1/CR2的loopback0接口选举bsr，配置优先级确保CR1成为bsr</li>
<li>配置anycast RP，创建loopback10 0100.100.100./32，loopback10地址为c-rp</li>
<li>配置msdp组播源发现协议</li>
<li>AR4的g0/0/01.100，限制组播地址</li>
<li>igmp加速离组</li>
</ul>
<hr>
<ul>
<li><p>AR1</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line"> multicast routing-enable</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> pim sm</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1	</span><br><span class="line"> pim sm</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>AR2</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line"> multicast routing-enable</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> pim sm</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1	</span><br><span class="line"> pim sm</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>AR3</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line"> multicast routing-enable</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> pim sm</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2	</span><br><span class="line"> pim sm</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>AR4</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line"> multicast routing-enable</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> pim sm</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2	</span><br><span class="line"> pim sm</span><br><span class="line">#</span><br><span class="line">acl number 2000  </span><br><span class="line"> rule 5 permit source 224.1.1.0 0.0.0.255 </span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1.100</span><br><span class="line"> pim sm</span><br><span class="line"> igmp enable</span><br><span class="line"> igmp group-policy 2000 2</span><br><span class="line"> igmp prompt-leave group-policy 2000</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>CR1</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line"> multicast routing-enable</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> pim sm</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> pim sm</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2	</span><br><span class="line"> pim sm</span><br><span class="line">#</span><br><span class="line">interface Ethernet1/0/1</span><br><span class="line"> pim sm</span><br><span class="line">#</span><br><span class="line">interface LoopBack0</span><br><span class="line"> pim sm</span><br><span class="line">#</span><br><span class="line">interface LoopBack10</span><br><span class="line"> ip address 100.100.100.100 255.255.255.255 </span><br><span class="line"> pim sm</span><br><span class="line">#</span><br><span class="line">bgp 64812</span><br><span class="line"> #</span><br><span class="line"> ipv4-family unicast</span><br><span class="line">  network 100.100.100.100 255.255.255.255 </span><br><span class="line">#</span><br><span class="line">pim</span><br><span class="line"> c-bsr hash-length 0</span><br><span class="line"> c-bsr priority 255</span><br><span class="line"> c-bsr LoopBack0</span><br><span class="line"> c-rp LoopBack10</span><br><span class="line">#</span><br><span class="line">msdp</span><br><span class="line"> originating-rp LoopBack0</span><br><span class="line"> peer 1.1.1.6 connect-interface LoopBack0</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>CR2</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line"> multicast routing-enable</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/0</span><br><span class="line"> pim sm</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/1</span><br><span class="line"> pim sm</span><br><span class="line">#</span><br><span class="line">interface GigabitEthernet0/0/2	</span><br><span class="line"> pim sm</span><br><span class="line">#</span><br><span class="line">interface LoopBack0</span><br><span class="line"> pim sm</span><br><span class="line">#</span><br><span class="line">interface LoopBack10</span><br><span class="line"> ip address 100.100.100.100 255.255.255.255 </span><br><span class="line"> pim sm</span><br><span class="line">#</span><br><span class="line">bgp 64812</span><br><span class="line"> #</span><br><span class="line"> ipv4-family unicast</span><br><span class="line">  network 100.100.100.100 255.255.255.255 </span><br><span class="line">#</span><br><span class="line">pim</span><br><span class="line"> c-bsr hash-length 0</span><br><span class="line"> c-bsr LoopBack0</span><br><span class="line"> c-rp LoopBack10</span><br><span class="line">#</span><br><span class="line">msdp</span><br><span class="line"> originating-rp LoopBack0</span><br><span class="line"> peer 1.1.1.5 connect-interface LoopBack0</span><br><span class="line">#</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>验证</p>
<ul>
<li><p>dis pim rp-info</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[AR4]dis pim bsr-info</span><br><span class="line"> VPN-Instance: public net</span><br><span class="line"> Elected AdminScoped BSR Count: 0</span><br><span class="line"> Elected BSR Address: 1.1.1.5</span><br><span class="line">     Priority: 255</span><br><span class="line">     Hash mask length: 0</span><br><span class="line">     State: Accept Preferred</span><br><span class="line">     Scope: Not scoped</span><br><span class="line">     Uptime: 00:00:50</span><br><span class="line">     Expires: 00:01:20</span><br><span class="line">     C-RP Count: 1</span><br><span class="line">[AR4]</span><br><span class="line">[AR4]dis pim rp-info </span><br><span class="line"> VPN-Instance: public net</span><br><span class="line"> PIM-SM BSR RP Number:1</span><br><span class="line"> Group/MaskLen: 224.0.0.0/4</span><br><span class="line">     RP: 100.100.100.100</span><br><span class="line">     Priority: 0</span><br><span class="line">     Uptime: 00:00:56</span><br><span class="line">     Expires: 00:01:34</span><br><span class="line">[AR4]</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>dis pim routing-table</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">[CR1]dis pim routing-table </span><br><span class="line"> VPN-Instance: public net</span><br><span class="line"> Total 0 (*, G) entry; 1 (S, G) entry</span><br><span class="line"></span><br><span class="line"> (100.1.100.2, 224.1.1.1)</span><br><span class="line">     RP: 100.100.100.100 (local)</span><br><span class="line">     Protocol: pim-sm, Flag: SPT 2MSDP LOC ACT </span><br><span class="line">     UpTime: 00:03:16</span><br><span class="line">     Upstream interface: Ethernet1/0/1</span><br><span class="line">         Upstream neighbor: NULL</span><br><span class="line">         RPF prime neighbor: NULL</span><br><span class="line">     Downstream interface(s) information:</span><br><span class="line">     Total number of downstreams: 1</span><br><span class="line">         1: GigabitEthernet0/0/0</span><br><span class="line">             Protocol: pim-sm, UpTime: 00:03:16, Expires: 00:03:14</span><br><span class="line"></span><br><span class="line">[CR1]</span><br><span class="line"></span><br><span class="line">[CR2]dis pim routing-table </span><br><span class="line"> VPN-Instance: public net</span><br><span class="line"> Total 1 (*, G) entry; 1 (S, G) entry</span><br><span class="line"></span><br><span class="line"> (*, 224.1.1.1)</span><br><span class="line">     RP: 100.100.100.100 (local)</span><br><span class="line">     Protocol: pim-sm, Flag: WC </span><br><span class="line">     UpTime: 00:17:28</span><br><span class="line">     Upstream interface: Register</span><br><span class="line">         Upstream neighbor: NULL</span><br><span class="line">         RPF prime neighbor: NULL</span><br><span class="line">     Downstream interface(s) information:</span><br><span class="line">     Total number of downstreams: 1</span><br><span class="line">         1: GigabitEthernet0/0/2</span><br><span class="line">             Protocol: pim-sm, UpTime: 00:17:28, Expires: 00:03:02</span><br><span class="line"></span><br><span class="line"> (100.1.100.2, 224.1.1.1)</span><br><span class="line">     RP: 100.100.100.100 (local)</span><br><span class="line">     Protocol: pim-sm, Flag: SPT MSDP ACT </span><br><span class="line">     UpTime: 00:03:41</span><br><span class="line">     Upstream interface: GigabitEthernet0/0/0</span><br><span class="line">         Upstream neighbor: 10.5.6.1</span><br><span class="line">         RPF prime neighbor: 10.5.6.1</span><br><span class="line">     Downstream interface(s) information:</span><br><span class="line">     Total number of downstreams: 1</span><br><span class="line">         1: GigabitEthernet0/0/2</span><br><span class="line">             Protocol: pim-sm, UpTime: 00:03:41, Expires: 00:02:49</span><br><span class="line"></span><br><span class="line">[CR2]</span><br><span class="line"></span><br><span class="line">[AR4]dis pim routing-table </span><br><span class="line"> VPN-Instance: public net</span><br><span class="line"> Total 1 (*, G) entry; 1 (S, G) entry</span><br><span class="line"></span><br><span class="line"> (*, 224.1.1.1)</span><br><span class="line">     RP: 100.100.100.100</span><br><span class="line">     Protocol: pim-sm, Flag: WC </span><br><span class="line">     UpTime: 00:17:42</span><br><span class="line">     Upstream interface: GigabitEthernet0/0/2</span><br><span class="line">         Upstream neighbor: 10.4.6.1</span><br><span class="line">         RPF prime neighbor: 10.4.6.1</span><br><span class="line">     Downstream interface(s) information:</span><br><span class="line">     Total number of downstreams: 1</span><br><span class="line">         1: GigabitEthernet0/0/1.100</span><br><span class="line">             Protocol: igmp, UpTime: 00:17:42, Expires: -</span><br><span class="line"></span><br><span class="line"> (100.1.100.2, 224.1.1.1)</span><br><span class="line">     RP: 100.100.100.100</span><br><span class="line">     Protocol: pim-sm, Flag: SPT ACT </span><br><span class="line">     UpTime: 00:03:55</span><br><span class="line">     Upstream interface: GigabitEthernet0/0/2</span><br><span class="line">         Upstream neighbor: 10.4.6.1</span><br><span class="line">         RPF prime neighbor: 10.4.6.1</span><br><span class="line">     Downstream interface(s) information:</span><br><span class="line">     Total number of downstreams: 1</span><br><span class="line">         1: GigabitEthernet0/0/1.100</span><br><span class="line">             Protocol: pim-sm, UpTime: 00:03:55, Expires: -</span><br><span class="line"></span><br><span class="line">[AR4]</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>电脑安装vlc，ensp选择vlc安装路径，启动组播源服务器和PC4接收视频</p>
<p><img src="https://s2.loli.net/2024/07/19/cS86XbI1GBgy4dH.png" alt="image-152518086"></p>
</li>
</ul>
</li>
</ul>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><ul>
<li>个人觉得整个拓扑的配置项还是挺多的，涉及的协议、框架、模型也挺多，有一定挑战</li>
<li>现场8个小时给我整，我是整不出来，在没有做充足准备的前提下</li>
<li>毕竟是实验，没有整防火墙双机热备</li>
<li>毕竟是实验，RR还能跑数据和接入EBGP对等体</li>
<li>毕竟是实验，AC与AC之间没有物理连线做状态监测</li>
<li>毕竟是实验，单线路多逻辑互联</li>
<li>……</li>
<li>可能有更好的实现需求的配置答案（山外有山）</li>
<li>文件存阿里云盘了，这是链接：[<a target="_blank" rel="noopener" href="https://www.alipan.com/s/sKaEyJg38HD">分享的文件</a>]</li>
<li>欢迎“<del>来电</del>”来函探讨。</li>
</ul>
</body></html>
    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/ICT/">#ICT</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/ensp%E5%AE%9E%E9%AA%8C/">#ensp实验</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/%E8%A7%A3%E9%A2%98/">#解题</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/%E5%8D%8E%E4%B8%BA/">#华为</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/%E7%9C%9F%E7%9A%84%E5%8D%A1/">#真的卡</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/vsys/">#vsys</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/posts/8f2ea734.html">2022-2023华为ICT大赛（全国）实验题研究</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/posts/ccacf283.html">使用Selenium打开PNETLab拓扑并开启所有节点</a>
            
        </span>
    </div>
    
</article>
<!-- 
DO NOT APPLY SHAREBOX

<div class="sharebox">
    
<div class="notification is-danger">
    You need to set <code>install_url</code> to use ShareThis. Please set it in <code>_config.yml</code>.
</div>

</div>

DO NOT APPLY COMMENTS

<div class="comments">
    <h3 class="title is-4">Comments</h3>
    
<div id="disqus_thread">
    
    <div class="notification is-danger">
        You forgot to set the <code>shortname</code> for Disqus. Please set it in <code>_config.yml</code>.
    </div>
    
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</div>

-->
    </div>
</section>
<footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2024 Kir Aster&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow has-text-blue" title="About" href="/about">
                    
                    About
                    
                </a>
                
                    
                <a class="column is-narrow has-text-blue" title="Privacy" href="/privacy-statement">
                    
                    Privacy
                    
                </a>
                
                    
                <a class="column is-narrow has-text-blue" title="GitHub" target="_blank" rel="noopener" href="https://github.com/kiraster">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
        </div>
    </div>
</footer>
<div id="totop" class="ctotop">
<a title="返回顶部"><img src="/images/scrollup.png"/></a>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("en-AU");
</script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
</script>

    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof($.fn.justifiedGallery) === 'function') {
                $('.justified-gallery > p > .gallery-item').unwrap();
                $('.justified-gallery').justifiedGallery();
            }
        });
    })(jQuery);
</script>

    
    
    
    

    
    
    



<script src="/js/script.js"></script>


<script src="/js/totop.js"></script>


<div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>

<script src="/js/insight.js"></script>


</body>
</html>
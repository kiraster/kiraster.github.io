<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head>
<meta charset="utf-8">
<title>No.003 Simple Case - Kir&#39;s Blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">


<meta name="description" content="Kir的博客，网络设备配置，网络拓扑实验，华为华三路由交换无线安全HCIP,CISCO,NETWORK">


<meta name="keywords" content="Kir的博客，网络设备配置，网络拓扑实验，华为华三路由交换无线安全HCIP,CISCO,NETWORK">


    <meta name="description" content="红茶三杯的原文 ：【有点儿意思系列 04】哎哟喂停不下来了 ，根据问题延续中的表述， 实验拓扑增加了两台出口路由器，两台防火墙，一台服务器。本次拓扑实验依托上一个拓扑演变而来，大部分基础配置与上一个相同，如果您是初次看到本文，请参阅上文 【No.002 Simple Case】，本文不在赘述。 可能你看到拓扑中防火墙名称就懵了，我解释一下，由于我这是台古董级 AMD CPU 的电脑，跑不起 Cis">
<meta property="og:type" content="article">
<meta property="og:title" content="No.003 Simple Case">
<meta property="og:url" content="https://kiraster.github.io/posts/62d0e673.html">
<meta property="og:site_name" content="Kir&#39;s Blog">
<meta property="og:description" content="红茶三杯的原文 ：【有点儿意思系列 04】哎哟喂停不下来了 ，根据问题延续中的表述， 实验拓扑增加了两台出口路由器，两台防火墙，一台服务器。本次拓扑实验依托上一个拓扑演变而来，大部分基础配置与上一个相同，如果您是初次看到本文，请参阅上文 【No.002 Simple Case】，本文不在赘述。 可能你看到拓扑中防火墙名称就懵了，我解释一下，由于我这是台古董级 AMD CPU 的电脑，跑不起 Cis">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://i.loli.net/2021/11/11/VWlKy1fZaJ2eBEM.jpg">
<meta property="og:image" content="https://i.loli.net/2021/11/11/j46XPe2TpvLVhNk.gif">
<meta property="og:image" content="https://i.loli.net/2021/11/11/TktXihfwbMCjx9d.gif">
<meta property="og:image" content="https://i.loli.net/2021/11/11/ciU36EwAlCWsIzG.gif">
<meta property="og:image" content="https://i.loli.net/2021/11/11/FR9PMsbqgIQNjzV.jpg">
<meta property="og:image" content="https://i.loli.net/2021/11/11/SidCgVkOe76LKAo.jpg">
<meta property="og:image" content="https://i.loli.net/2021/11/11/tjePOHGadCIg1mN.jpg">
<meta property="article:published_time" content="2021-11-11T05:44:43.000Z">
<meta property="article:modified_time" content="2023-02-14T08:59:47.185Z">
<meta property="article:author" content="Kir Aster">
<meta property="article:tag" content="Network Emulator">
<meta property="article:tag" content="PNETLab">
<meta property="article:tag" content="Cisco">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/11/11/VWlKy1fZaJ2eBEM.jpg">



<link rel="icon" href="https://s2.loli.net/2022/11/07/nR4jdLTGEq6kZ2S.png">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<!--引入思源黑体 rel-->
<link rel="preconnect" href="https://fonts.proxy.ustclug.org">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.proxy.ustclug.org/css2?family=Noto+Sans+SC&display=swap" rel="stylesheet">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">

<link rel="stylesheet" href="/css/style.css">

<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>

    
    
    
    
    
    
    
    
    
    
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?3a4045a27e1262a56b8fe2f8b7b42ff1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-209914470-1"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-209914470-1');
</script>


    

<meta name="generator" content="Hexo 6.3.0"></head>
<body>

<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                    
                    Kir&#39;s
                    
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item "
               href="/archives">Archives</a>
            
            <a class="navbar-item "
               href="/gallery">Gallery</a>
            
            <a class="navbar-item "
               href="/about">About</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="Search" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            <div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc">
                <a class="navbar-item" title="Table of Contents">
                    <i class="fa fa-list"></i>
                </a>
                <div class="navbar-dropdown is-right">
                    
                    
                    
                    
                    <a class="navbar-item" href="#Part-1">1&nbsp;&nbsp;<b>Part 1</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#Step-1：修改-Core-SW1-和-Core-SW2-配置">1.1&nbsp;&nbsp;Step 1：修改 Core-SW1 和 Core-SW2 配置</a>
                    
                    
                    
                    <a class="navbar-item" href="#Step-2：修改-OBR-SW1-和-OBR-SW2-配置">1.2&nbsp;&nbsp;Step 2：修改 OBR-SW1 和 OBR-SW2 配置</a>
                    
                    
                    
                    <a class="navbar-item" href="#Step-3：配置-R1-和-R2">1.3&nbsp;&nbsp;Step 3：配置 R1 和 R2</a>
                    
                    
                    
                    <a class="navbar-item" href="#Step-4：Internet-配置，Faker-FW1、Faker-FW2-基础配置">1.4&nbsp;&nbsp;Step 4：Internet 配置，Faker_FW1、Faker_FW2 基础配置</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Part-2">2&nbsp;&nbsp;<b>Part 2</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#Step-1：配置-Faker-FW-与出口路由器建立-GRE-隧道">2.1&nbsp;&nbsp;Step 1：配置 Faker_FW 与出口路由器建立 GRE 隧道</a>
                    
                    
                    
                    <a class="navbar-item" href="#Step-2：配置-Core-SW-静态路由使上网流量下一跳设备为防火墙">2.2&nbsp;&nbsp;Step 2：配置 Core-SW 静态路由使上网流量下一跳设备为防火墙</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Part-3">3&nbsp;&nbsp;<b>Part 3</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Ending">4&nbsp;&nbsp;<b>Ending</b></a>
                    
                </div>
            </div>
            
            
        </div>
    </div>
</nav>

<section class="section">
    <div class="container">
    <article class="article content gallery" itemscope itemprop="blogPost">
    
      <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
          
              No.003 Simple Case
          
      </h1>
    
    
      <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
          <span class="column is-narrow">
              
                  <i class="far fa-clock"></i>
                  <span>&nbspNov 11th 21&nbsp</span>
              
          </span>
          
          <span class="column is-narrow article-category">
              <i class="far fa-folder"></i>
              <a class="article-category-link" href="/categories/PNETLab/">PNETLab</a>
          </span>
          
          
          <span class="column is-narrow">
              
              
              19 minutes read (About 2905 words)
          </span>
          
      </div>
    
    
    
      
      
        <div class="alert alert-warning">
          <i class="fa fa-exclamation-triangle"></i> 
          This is an article that was created 365 days ago, and the information may have evolved or changed.  
        </div>
        <br>
      
    
    
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <html><head></head><body><p>红茶三杯的原文 ：<a target="_blank" rel="noopener" href="http://blog.sina.com.cn/s/blog_5ec353710102vmkk.html">【有点儿意思系列 04】哎哟喂停不下来了</a> ，根据问题延续中的表述， 实验拓扑增加了两台出口路由器，两台防火墙，一台服务器。本次拓扑实验依托上一个拓扑演变而来，大部分基础配置与上一个相同，如果您是初次看到本文，请参阅上文 <strong>【<a href="https://kiraster.github.io/posts/2da7a7a9.html">No.002 Simple Case</a>】</strong>，本文不在赘述。</p>
<p>可能你看到拓扑中防火墙名称就懵了，我解释一下，由于我这是台古董级 AMD CPU 的电脑，跑不起 Cisco ASAv 的镜像（报错：Unsupport CPU type，无限重启），再加上内存有限，就不折腾了，考虑到文中只提到 NAT 的需求，我就用两台路由器换个图标和名称代替了。最终实现了原文中源地址转换及静态映射的需求，虽然牺牲了安全策略配置和 HA 配置。<span id="more"></span></p>
<p>极致极简，拓扑中的 Open_Server 同样是用路由器模拟的，实验中将实现 Open_Server 的 SSH 服务映射到公网地址提供访问。</p>
<p><img src="https://i.loli.net/2021/11/11/VWlKy1fZaJ2eBEM.jpg"></p>
<h2 id="Part-1"><a href="#Part-1" class="headerlink" title="Part 1"></a>Part 1</h2><h3 id="Step-1：修改-Core-SW1-和-Core-SW2-配置"><a href="#Step-1：修改-Core-SW1-和-Core-SW2-配置" class="headerlink" title="Step 1：修改 Core-SW1 和 Core-SW2 配置"></a>Step 1：修改 Core-SW1 和 Core-SW2 配置</h3><figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">! --- Core-SW1 配置，增加与 Faker_FW1 互联地址，OSPF 宣告互联地址</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/3</span><br><span class="line"> no switchport</span><br><span class="line"> ip vrf forwarding vpn_internet</span><br><span class="line"> ip address 192.168.100.5 255.255.255.252</span><br><span class="line">!</span><br><span class="line">router ospf 200 vrf vpn_internet</span><br><span class="line"> network 192.168.100.5 0.0.0.0 area 0</span><br><span class="line">!</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">! --- Core-SW2 配置，增加与 Faker_FW2 互联地址，OSPF 宣告互联地址</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/3</span><br><span class="line"> no switchport</span><br><span class="line"> ip vrf forwarding vpn_internet</span><br><span class="line"> ip address 192.168.100.1 255.255.255.252</span><br><span class="line">!</span><br><span class="line">router ospf 200 vrf vpn_internet</span><br><span class="line"> network 192.168.100.1 0.0.0.0 area 0</span><br><span class="line">!</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Step-2：修改-OBR-SW1-和-OBR-SW2-配置"><a href="#Step-2：修改-OBR-SW1-和-OBR-SW2-配置" class="headerlink" title="Step 2：修改 OBR-SW1 和 OBR-SW2 配置"></a>Step 2：修改 OBR-SW1 和 OBR-SW2 配置</h3><figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">! --- OBR-SW1 配置，配置与 R1 互联地址，OSPF 宣告互联地址,去除原先的 NAT 相关配置和去除 OSPF 注入默认路由</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/1</span><br><span class="line"> no switchport</span><br><span class="line"> ip vrf forwarding vpn_internet</span><br><span class="line"> ip address 20.20.20.1 255.255.255.252</span><br><span class="line"> ip ospf network point-to-point</span><br><span class="line">!</span><br><span class="line">router ospf 200 vrf vpn_internet</span><br><span class="line"> network 20.20.20.1 0.0.0.0 area 0</span><br><span class="line">!</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">! --- OBR-SW2 配置，配置与 R2 互联地址，OSPF 宣告互联地址,去除原先的 NAT 相关配置和去除 OSPF 注入默认路由</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/0</span><br><span class="line"> no switchport</span><br><span class="line"> ip vrf forwarding vpn_internet</span><br><span class="line"> ip address 20.20.20.10 255.255.255.252</span><br><span class="line"> ip ospf network point-to-point</span><br><span class="line">!</span><br><span class="line">router ospf 200 vrf vpn_internet</span><br><span class="line"> network 20.20.20.10 0.0.0.0 area 0</span><br><span class="line">!</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Step-3：配置-R1-和-R2"><a href="#Step-3：配置-R1-和-R2" class="headerlink" title="Step 3：配置 R1 和 R2"></a>Step 3：配置 R1 和 R2</h3><figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">! --- R1 配置，配置互联地址，OSPF 宣告互联地址</span><br><span class="line">! --- 配置中包含了 NAT 配置，当两台防火墙宕机后仍可保持内网与互联网通信</span><br><span class="line">!</span><br><span class="line">ip vrf vpn_internet</span><br><span class="line"> rd 20:20</span><br><span class="line"> route-target export 200:200</span><br><span class="line"> route-target import 200:200</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/0</span><br><span class="line"> ip vrf forwarding vpn_internet</span><br><span class="line"> ip address 200.1.1.1 255.255.255.248</span><br><span class="line"> ip nat outside</span><br><span class="line"> ip virtual-reassembly in</span><br><span class="line"> duplex auto</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/1</span><br><span class="line"> ip vrf forwarding vpn_internet</span><br><span class="line"> ip address 20.20.20.2 255.255.255.252</span><br><span class="line"> ip nat inside</span><br><span class="line"> ip virtual-reassembly in</span><br><span class="line"> ip ospf network point-to-point</span><br><span class="line"> duplex auto</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/2</span><br><span class="line"> ip vrf forwarding vpn_internet</span><br><span class="line"> ip address 20.20.20.5 255.255.255.252</span><br><span class="line"> ip nat inside</span><br><span class="line"> ip virtual-reassembly in</span><br><span class="line"> ip ospf network point-to-point</span><br><span class="line"> duplex auto</span><br><span class="line">!</span><br><span class="line">router ospf 200 vrf vpn_internet</span><br><span class="line"> router-id 111.111.111.111</span><br><span class="line"> network 20.20.20.2 0.0.0.0 area 0</span><br><span class="line"> network 20.20.20.5 0.0.0.0 area 0</span><br><span class="line"> network 200.1.1.1 0.0.0.0 area 0</span><br><span class="line"> default-information originate metric 11 metric-type 1</span><br><span class="line">!</span><br><span class="line">ip nat inside source list 10 interface Ethernet0/0 vrf vpn_internet overload</span><br><span class="line">!</span><br><span class="line">ip route vrf vpn_internet 0.0.0.0 0.0.0.0 200.1.1.6</span><br><span class="line">!</span><br><span class="line">access-list 10 permit 192.168.50.0 0.0.0.255</span><br><span class="line">!</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">! --- R2 配置，配置互联地址，OSPF 宣告互联地址</span><br><span class="line">! --- 配置中包含了 NAT 配置，当两台防火墙宕机后仍可保持内网与互联网通信</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/0</span><br><span class="line"> ip vrf forwarding vpn_internet</span><br><span class="line"> ip address 20.20.20.9 255.255.255.252</span><br><span class="line"> ip nat inside</span><br><span class="line"> ip virtual-reassembly in</span><br><span class="line"> ip ospf network point-to-point</span><br><span class="line"> duplex auto</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/1</span><br><span class="line"> ip vrf forwarding vpn_internet</span><br><span class="line"> ip address 200.1.1.2 255.255.255.248</span><br><span class="line"> ip nat outside</span><br><span class="line"> ip virtual-reassembly in</span><br><span class="line"> duplex auto</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/2</span><br><span class="line"> ip vrf forwarding vpn_internet</span><br><span class="line"> ip address 20.20.20.6 255.255.255.252</span><br><span class="line"> ip nat inside</span><br><span class="line"> ip virtual-reassembly in</span><br><span class="line"> ip ospf network point-to-point</span><br><span class="line"> duplex auto</span><br><span class="line">!</span><br><span class="line">router ospf 200 vrf vpn_internet</span><br><span class="line"> router-id 222.222.222.222</span><br><span class="line"> network 20.20.20.6 0.0.0.0 area 0</span><br><span class="line"> network 20.20.20.9 0.0.0.0 area 0</span><br><span class="line"> network 200.1.1.2 0.0.0.0 area 0</span><br><span class="line"> default-information originate metric 10 metric-type 1</span><br><span class="line">!</span><br><span class="line">ip nat inside source list 10 interface Ethernet0/1 vrf vpn_internet overload</span><br><span class="line">!</span><br><span class="line">ip route vrf vpn_internet 0.0.0.0 0.0.0.0 200.1.1.6</span><br><span class="line">!</span><br><span class="line">access-list 10 permit 192.168.50.0 0.0.0.255</span><br><span class="line">!</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Step-4：Internet-配置，Faker-FW1、Faker-FW2-基础配置"><a href="#Step-4：Internet-配置，Faker-FW1、Faker-FW2-基础配置" class="headerlink" title="Step 4：Internet 配置，Faker_FW1、Faker_FW2 基础配置"></a>Step 4：Internet 配置，Faker_FW1、Faker_FW2 基础配置</h3><figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">! --- Internet 配置</span><br><span class="line">!</span><br><span class="line">interface Loopback0</span><br><span class="line"> ip address 1.2.3.4 255.255.255.255</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/0</span><br><span class="line"> switchport access vlan 123</span><br><span class="line">!</span><br><span class="line">interface Vlan123</span><br><span class="line"> ip address 200.1.1.6 255.255.255.248</span><br><span class="line">!</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">! --- Faker_FW1 配置</span><br><span class="line">! --- 200.1.1.3 是 NAT 和 映射使用的公网地址</span><br><span class="line">!</span><br><span class="line">interface Loopback0</span><br><span class="line"> ip address 200.1.1.3 255.255.255.255</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/0</span><br><span class="line"> ip address 192.168.100.6 255.255.255.252</span><br><span class="line">!</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">! --- Faker_FW2 配置</span><br><span class="line">! --- 200.1.1.4 是 NAT 和 映射使用的公网地址</span><br><span class="line">!</span><br><span class="line">interface Loopback0</span><br><span class="line"> ip address 200.1.1.4 255.255.255.255</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/0</span><br><span class="line"> ip address 192.168.100.2 255.255.255.252</span><br><span class="line">!</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Part-2"><a href="#Part-2" class="headerlink" title="Part 2"></a>Part 2</h2><ol>
<li>配置完第一部分， Biz_B_PC 可以 ping 通 Internet 的 1.2.3.4，路径是： <strong>Core-SW2 -&gt; OBR-SW2 -&gt; R2</strong>，而从 Internet 开启 debug ip icmp 观察到：Internet 返回 reply  报文远端地址是 R2 的外网接口 IP 地址（200.1.1.2）。</li>
</ol>
<p><img src="https://i.loli.net/2021/11/11/j46XPe2TpvLVhNk.gif"></p>
<ol start="2">
<li><p>根据原文中的描述，“ <em>防火墙与核心交换机为仅有一条物理线路。另外，由于增加了防火墙，因此将原先部署在出口路由器（拓扑中没有画出来）上的NAT下沉到防火墙上，由防火墙来部署源地址转换及静态映射。防火墙出公网的下一跳是OBR-SW交换机，两者使用私有IP地址三层对接。</em>”</p>
<p>也就是 NAT 和映射的功能交给了防火墙设备，然后防火墙出公网的下一跳是出口设备，联想到防火墙与出口路由器之间创建一条隧道，内网去往公网的 inside source  IP 地址在防火墙上进行  NAT 后直接走隧道至出口路由器，再路由出去。我在两台防火墙上配置的环回接口地址就是转换用的。</p>
</li>
</ol>
<h3 id="Step-1：配置-Faker-FW-与出口路由器建立-GRE-隧道"><a href="#Step-1：配置-Faker-FW-与出口路由器建立-GRE-隧道" class="headerlink" title="Step 1：配置 Faker_FW 与出口路由器建立 GRE 隧道"></a>Step 1：配置 Faker_FW 与出口路由器建立 GRE 隧道</h3><figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">! --- Faker_FW2 配置</span><br><span class="line">! --- NAT 和 映射使用的公网地址</span><br><span class="line">interface Loopback0</span><br><span class="line"> ip address 200.1.1.4 255.255.255.255</span><br><span class="line">! --- 使用 e0/0 接口地址与 R2 的 e0/0 接口地址建立隧道，并配置 nat outside</span><br><span class="line">interface Tunnel0</span><br><span class="line"> ip address 1.1.1.2 255.255.255.252</span><br><span class="line"> ip nat outside</span><br><span class="line"> ip virtual-reassembly in</span><br><span class="line"> tunnel source 192.168.100.2</span><br><span class="line"> tunnel destination 20.20.20.9</span><br><span class="line">! --- 配置 nat inside</span><br><span class="line">interface Ethernet0/0</span><br><span class="line"> ip nat inside</span><br><span class="line">! --- 配置 NAT overload 和 静态映射（将内网 Open_Server 的 SSH 端口映射到公网的 2222 端口）</span><br><span class="line">ip nat pool nat-pat 200.1.1.4 200.1.1.4 prefix-length 29</span><br><span class="line">ip nat inside source list 10 pool nat-pat overload</span><br><span class="line">ip nat inside source static tcp 192.168.50.200 22 200.1.1.4 2222 extendable</span><br><span class="line">! --- 配置默认路由和必要的静态路由</span><br><span class="line">ip route 0.0.0.0 0.0.0.0 Tunnel0</span><br><span class="line">ip route 20.20.20.8 255.255.255.252 192.168.100.1</span><br><span class="line">ip route 192.168.50.0 255.255.255.0 192.168.100.1</span><br><span class="line">! --- 配置 inside source list</span><br><span class="line">access-list 10 permit 192.168.50.0 0.0.0.255</span><br><span class="line">!</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">! --- R2 配置</span><br><span class="line">! --- 使用 e0/0 接口地址与 Faker_FW2 的 e0/0 接口地址建立隧道</span><br><span class="line">interface Tunnel0</span><br><span class="line"> ip vrf forwarding vpn_internet</span><br><span class="line"> ip address 1.1.1.1 255.255.255.252</span><br><span class="line"> tunnel source 20.20.20.9</span><br><span class="line"> tunnel destination 192.168.100.2</span><br><span class="line"> tunnel vrf vpn_internet</span><br><span class="line">! --- 配置需要走隧道的 VRF 静态路由，内网地址回程路由 track 跟踪</span><br><span class="line">ip route vrf vpn_internet 192.168.50.0 255.255.255.0 Tunnel0 track 1</span><br><span class="line">ip route vrf vpn_internet 200.1.1.4 255.255.255.255 Tunnel0</span><br><span class="line">! --- 配置 SLA 监测隧道对端的连通性</span><br><span class="line">ip sla 1</span><br><span class="line"> icmp-echo 192.168.100.2 source-interface Ethernet0/0</span><br><span class="line"> vrf vpn_internet</span><br><span class="line">ip sla schedule 1 life forever start-time now</span><br><span class="line">!</span><br><span class="line">track 1 ip sla 1 reachability</span><br><span class="line">!         </span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">! --- Faker_FW1 配置</span><br><span class="line">! --- NAT 和 映射使用的公网地址</span><br><span class="line">interface Loopback0</span><br><span class="line"> ip address 200.1.1.3 255.255.255.255</span><br><span class="line">! --- 使用 e0/0 接口地址与 R1 的 e0/1 接口地址建立隧道，并配置 nat outside</span><br><span class="line">interface Tunnel0</span><br><span class="line"> ip address 2.2.2.1 255.255.255.252</span><br><span class="line"> ip nat outside</span><br><span class="line"> ip virtual-reassembly in</span><br><span class="line"> tunnel source 192.168.100.6</span><br><span class="line"> tunnel destination 20.20.20.2</span><br><span class="line">! --- 配置 nat inside</span><br><span class="line">interface Ethernet0/0</span><br><span class="line"> ip nat inside</span><br><span class="line">! --- 配置 NAT overload 和 静态映射</span><br><span class="line">ip nat pool nat-pat 200.1.1.3 200.1.1.3 prefix-length 29</span><br><span class="line">ip nat inside source list 10 pool nat-pat overload</span><br><span class="line">ip nat inside source static tcp 192.168.50.200 22 200.1.1.3 2222 extendable</span><br><span class="line">! --- 配置默认路由和必要的静态路由</span><br><span class="line">ip route 0.0.0.0 0.0.0.0 Tunnel0</span><br><span class="line">ip route 20.20.20.0 255.255.255.252 192.168.100.5</span><br><span class="line">ip route 192.168.50.0 255.255.255.0 192.168.100.5</span><br><span class="line">!</span><br><span class="line">! --- 配置 inside source list</span><br><span class="line">access-list 10 permit 192.168.50.0 0.0.0.255</span><br><span class="line">!</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">! --- R1 配置</span><br><span class="line">! --- 使用 e0/1 接口地址与 Faker_FW2 的 e0/0 接口地址建立隧道</span><br><span class="line">interface Tunnel0</span><br><span class="line"> ip vrf forwarding vpn_internet</span><br><span class="line"> ip address 2.2.2.2 255.255.255.252</span><br><span class="line"> tunnel source 20.20.20.2</span><br><span class="line"> tunnel destination 192.168.100.6</span><br><span class="line"> tunnel vrf vpn_internet</span><br><span class="line">! --- 配置需要走隧道的 VRF 静态路由，内网地址回程路由 track 跟踪</span><br><span class="line">ip route vrf vpn_internet 192.168.50.0 255.255.255.0 Tunnel0 track 1</span><br><span class="line">ip route vrf vpn_internet 200.1.1.3 255.255.255.255 Tunnel0</span><br><span class="line">! --- 配置 SLA 监测隧道对端的连通性</span><br><span class="line">ip sla 1</span><br><span class="line"> icmp-echo 192.168.100.6 source-interface Ethernet0/1</span><br><span class="line"> vrf vpn_internet</span><br><span class="line">ip sla schedule 1 life forever start-time now</span><br><span class="line">!</span><br><span class="line">track 1 ip sla 1 reachability</span><br><span class="line">!</span><br></pre></td></tr></tbody></table></figure>

<h3 id="Step-2：配置-Core-SW-静态路由使上网流量下一跳设备为防火墙"><a href="#Step-2：配置-Core-SW-静态路由使上网流量下一跳设备为防火墙" class="headerlink" title="Step 2：配置 Core-SW 静态路由使上网流量下一跳设备为防火墙"></a>Step 2：配置 Core-SW 静态路由使上网流量下一跳设备为防火墙</h3><figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">! --- Core-SW1 配置</span><br><span class="line">!         </span><br><span class="line">ip route vrf vpn_internet 0.0.0.0 0.0.0.0 192.168.100.6 track 1</span><br><span class="line">!</span><br><span class="line">ip sla 1</span><br><span class="line"> icmp-echo 192.168.100.6 source-interface Ethernet0/3</span><br><span class="line"> vrf vpn_internet</span><br><span class="line"> frequency 5</span><br><span class="line">!         </span><br><span class="line">track 1 ip sla 1 reachability</span><br><span class="line">!</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">! --- Core-SW2 配置</span><br><span class="line">!</span><br><span class="line">ip route vrf vpn_internet 0.0.0.0 0.0.0.0 192.168.100.2 track 1</span><br><span class="line">!</span><br><span class="line">ip sla 1</span><br><span class="line"> icmp-echo 192.168.100.2 source-interface Ethernet0/3</span><br><span class="line"> vrf vpn_internet</span><br><span class="line"> frequency 5</span><br><span class="line">!         </span><br><span class="line">track 1 ip sla 1 reachability</span><br><span class="line">!</span><br></pre></td></tr></tbody></table></figure>

<p>完成配置到这个步骤，再观察内网到 Internet 的流量路径,： <strong>Core-SW2 -&gt; Faker_FW2 -&gt; R2</strong>，而从 Internet 开启 debug ip icmp 观察到：Internet 返回的 reply  报文远端地址是 <strong>Faker_FW2</strong> 配置的 NAT 转换地址（200.1.1.4）。</p>
<p><img src="https://i.loli.net/2021/11/11/TktXihfwbMCjx9d.gif"></p>
<p>配置 Open_Server 和测试公网 SSH 访问</p>
<figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">! --- Open_Server 配置</span><br><span class="line">!</span><br><span class="line">interface Ethernet0/0</span><br><span class="line"> ip address 192.168.50.200 255.255.255.0</span><br><span class="line">!</span><br><span class="line">ip route 0.0.0.0 0.0.0.0 192.168.50.254</span><br><span class="line">!</span><br><span class="line">! --- 配置 SSH SERVICES</span><br><span class="line">!</span><br><span class="line">ip domain name test.com</span><br><span class="line">!</span><br><span class="line">crypto key generate rsa </span><br><span class="line">1024</span><br><span class="line">!</span><br><span class="line">ip ssh version 2</span><br><span class="line">!</span><br><span class="line">line vty 0 4</span><br><span class="line"> login local</span><br><span class="line"> transport input ssh</span><br><span class="line">!</span><br><span class="line">username cisco password 0 cisco</span><br><span class="line">!</span><br><span class="line">enable password cisco</span><br><span class="line">!</span><br></pre></td></tr></tbody></table></figure>

<p>NAT 静态映射已在 【<em><strong>Part 2  – Step 1</strong></em>】 中配置，将 Open_Server 的 22 端口映射到被访问公网 IP 地址的 2222 端口。测试结果如图：</p>
<p><img src="https://i.loli.net/2021/11/11/ciU36EwAlCWsIzG.gif"></p>
<h2 id="Part-3"><a href="#Part-3" class="headerlink" title="Part 3"></a>Part 3</h2><p><strong>网络冗余的设计</strong></p>
<p>本实验中探讨的是在网络中某段线路通断的情况下 Biz_B_PC 访问  Internet 环回接口地址 1.2.3.4 的路径切换。网络正常情况下，访问路径如下图：</p>
<p><img src="https://i.loli.net/2021/11/11/FR9PMsbqgIQNjzV.jpg"></p>
<ul>
<li><p><strong>情况 1：</strong>（假设 Faker_FW1、Core-SW1、OBR-SW1、R1 设备都正常，线路也正常 ）</p>
<p>当 Core-SW2 的 e0/3 状态为 DOWN；</p>
<p>当 Core-SW2 的 e0/0 状态为 DOWN；</p>
<p>当 OBR-SW2 的 e0/0 状态为 DOWN；</p>
<p>当 Core-SW2 的 e1/3 链路协议 DOWN；</p>
<p>以上四个条件有一个为真，即其中出现一个接口为 DOWN 状态， Core-SW2 降低 内网 VRRP 组的优先级， 同时将内网 VRRP 组切换至 Backup 状态，内网上网流量路径切换至 Core-SW1 进行转发。</p>
</li>
<li><p><strong>情况 2：</strong>（假设 Faker_FW2、 Core-SW2、OBR-SW2、R2 设备都正常，线路也正常 ）</p>
<p>当 Core-SW1 的 e0/3 状态为 DOWN；</p>
<p>当 Core-SW1 的 e0/0 状态为 DOWN；</p>
<p>当 OBR-SW1 的 e0/1 状态为 DOWN；</p>
<p>当 Core-SW1 的 e1/3 链路协议 DOWN；</p>
<p>以上四个条件有一个为真，即其中出现一个接口为 DOWN 状态， Core-SW1 降低 内网 VRRP 组的优先级，不进行 VRRP 状态切换。</p>
</li>
<li><p><strong>情况 3：</strong></p>
</li>
</ul>
<p><img src="https://i.loli.net/2021/11/11/SidCgVkOe76LKAo.jpg"></p>
<p>  当 A 组条件任一条件为真和 B 组任一条件为真时，此时 Core-SW1 和 Core-SW2 都降低 VRRP 组优先级，由于设置了 Core-SW2 的 VRRP 优先级为 120 （ Core-SW1 默认优先级 100），两台设备同时降低相同的优先级 21 。此时的 VRRP Master 设备是 Core-SW2 ，上网流量路径：<strong>Core-SW2</strong> -&gt; <strong>OBR-SW2</strong> -&gt; <strong>R2</strong> ，在 <strong>R2</strong> 上进行 <strong>NAT</strong> 最终出公网；当 B 组中的条件是：<strong>OBR-SW2 的 e0/0 状态为 DOWN</strong>，上网流量路径：<strong>Core-SW2</strong> -&gt; <strong>OBR-SW2</strong> -&gt; <strong>OBR-SW1</strong>-&gt; <strong>R1</strong>，在 <strong>R1</strong> 上进行 <strong>NAT</strong> 最终出公网。</p>
<p>分别手动 <strong>shutdown</strong> 以上任一条件中的接口（以 Core-SW2 的 e0/3 和 e1/3 为例），观察 Track 和 VRRP 状态的变化如下图：</p>
<p><img src="https://i.loli.net/2021/11/11/tjePOHGadCIg1mN.jpg"></p>
  <figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">! --- Core-SW2 配置</span><br><span class="line">!</span><br><span class="line">ip sla 1</span><br><span class="line"> icmp-echo 192.168.100.2 source-interface Ethernet0/3</span><br><span class="line"> vrf vpn_internet</span><br><span class="line"> frequency 5</span><br><span class="line">ip sla 2</span><br><span class="line"> icmp-echo 10.10.10.9 source-interface Ethernet0/0.200</span><br><span class="line"> vrf vpn_internet</span><br><span class="line"> frequency 5</span><br><span class="line">ip sla 3</span><br><span class="line"> icmp-echo 20.20.20.10 source-interface Ethernet0/0.200</span><br><span class="line"> vrf vpn_internet</span><br><span class="line"> frequency 5</span><br><span class="line">ip sla group schedule 11 1-3 schedule-together start-time now life forever</span><br><span class="line">!         </span><br><span class="line">track 1 ip sla 1</span><br><span class="line">!</span><br><span class="line">track 2 ip sla 2</span><br><span class="line">!</span><br><span class="line">track 3 ip sla 3</span><br><span class="line">!</span><br><span class="line">track 4 interface Ethernet1/3 line-protocol</span><br><span class="line">!</span><br><span class="line">track 11 list boolean and</span><br><span class="line"> object 1</span><br><span class="line"> object 2</span><br><span class="line"> object 3</span><br><span class="line"> object 4</span><br><span class="line">!         </span><br><span class="line">interface Vlan50</span><br><span class="line"> vrrp 50 priority 120</span><br><span class="line"> vrrp 50 track 11 decrement 21</span><br><span class="line">!</span><br></pre></td></tr></tbody></table></figure>

  <figure class="highlight plaintext hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">! --- Core-SW1 配置</span><br><span class="line">!</span><br><span class="line">ip sla 1</span><br><span class="line"> icmp-echo 192.168.100.6 source-interface Ethernet0/3</span><br><span class="line"> vrf vpn_internet</span><br><span class="line"> frequency 5</span><br><span class="line">ip sla 2</span><br><span class="line"> icmp-echo 10.10.10.1 source-interface Ethernet0/0.200</span><br><span class="line"> vrf vpn_internet</span><br><span class="line"> frequency 5</span><br><span class="line">ip sla 3</span><br><span class="line"> icmp-echo 20.20.20.1 source-interface Ethernet0/0.200</span><br><span class="line"> vrf vpn_internet</span><br><span class="line"> frequency 5</span><br><span class="line">ip sla group schedule 11 1-3 schedule-together start-time now life forever</span><br><span class="line">!         </span><br><span class="line">track 1 ip sla 1 reachability</span><br><span class="line">!</span><br><span class="line">track 2 ip sla 2 reachability</span><br><span class="line">!</span><br><span class="line">track 3 ip sla 3 reachability</span><br><span class="line">!</span><br><span class="line">track 4 interface Ethernet1/3 line-protocol</span><br><span class="line">!</span><br><span class="line">track 11 list boolean and</span><br><span class="line"> object 1</span><br><span class="line"> object 2</span><br><span class="line"> object 3</span><br><span class="line"> object 4</span><br><span class="line">!</span><br><span class="line">interface Vlan50</span><br><span class="line"> vrrp 50 ip 192.168.50.254</span><br><span class="line"> vrrp 50 track 11 decrement 21</span><br><span class="line">!</span><br></pre></td></tr></tbody></table></figure>

<h2 id="Ending"><a href="#Ending" class="headerlink" title="Ending"></a>Ending</h2><ul>
<li>码完字了，还是那句话（挺耗时间的）。尽管还有不满意的地方，比如还可以再完善配置，添加更多的配置参数，考虑更多扩展需求想解决思路，但是这是个“无底洞”。</li>
<li>文中可能有些配置未提及或内容术语表述的不规范，请见谅。</li>
<li>配置存阿里云盘了，这是链接：[<a target="_blank" rel="noopener" href="https://www.aliyundrive.com/s/HaEJNPJZEjq">分享的文件</a>]</li>
<li>欢迎“<del>来电</del>”来函探讨。</li>
</ul>
</body></html>
    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/Network-Emulator/">#Network Emulator</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/PNETLab/">#PNETLab</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/Cisco/">#Cisco</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/posts/1fa3e02b.html">No.004 Simple Case</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/posts/2da7a7a9.html">No.002 Simple Case</a>
            
        </span>
    </div>
    
</article>
<!-- 
DO NOT APPLY SHAREBOX

<div class="sharebox">
    
<div class="notification is-danger">
    You need to set <code>install_url</code> to use ShareThis. Please set it in <code>_config.yml</code>.
</div>

</div>

DO NOT APPLY COMMENTS

<div class="comments">
    <h3 class="title is-4">Comments</h3>
    
<div id="disqus_thread">
    
    <div class="notification is-danger">
        You forgot to set the <code>shortname</code> for Disqus. Please set it in <code>_config.yml</code>.
    </div>
    
    <noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</div>

-->
    </div>
</section>
<footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2023 Kir Aster&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        target="_blank" rel="noopener" href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            
        </div>
    </div>
</footer>
<div id="totop" class="ctotop">
<a title="返回顶部"><img src="/images/scrollup.png"/></a>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("en-AU");
</script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
</script>

    
    
    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof($.fn.justifiedGallery) === 'function') {
                $('.justified-gallery > p > .gallery-item').unwrap();
                $('.justified-gallery').justifiedGallery();
            }
        });
    })(jQuery);
</script>

    
    
    
    
    
    

    



<script src="/js/script.js"></script>


<script src="/js/totop.js"></script>


<div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Pages',
                CATEGORIES: 'Categories',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>

<script src="/js/insight.js"></script>


</body>
</html>
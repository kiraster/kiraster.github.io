<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on Kir's Blog</title><link>https://weeaster.github.io/post/</link><description>Recent content in Posts on Kir's Blog</description><generator>Hugo -- gohugo.io</generator><language>en</language><copyright>@kiraster</copyright><lastBuildDate>Sun, 15 Dec 2024 14:14:51 +0800</lastBuildDate><atom:link href="https://weeaster.github.io/post/index.xml" rel="self" type="application/rss+xml"/><item><title>当前主题与原版Stack主题不同的地方</title><link>https://weeaster.github.io/posts/3d1b11f0/</link><pubDate>Sun, 15 Dec 2024 14:14:51 +0800</pubDate><guid>https://weeaster.github.io/posts/3d1b11f0/</guid><description>&lt;p>尽管原生的Stack主题已经已经很好了，但是由于个人的审美和喜好，还是对其进行了一些自认为较合理的修改&lt;/p>
&lt;p>网上的教程很多，搜索引擎遨游一下便有修改方法，以下只列出修改的结果&lt;/p>
&lt;hr>
&lt;h2 id="首页">首页
&lt;/h2>&lt;h3 id="左侧-sidebar">左侧 sidebar
&lt;/h3>&lt;ul>
&lt;li>设置鼠标移动至头像进行旋转&lt;/li>
&lt;li>不显示社交媒体图标&lt;/li>
&lt;li>菜单栏图标与文字修改间隔（&amp;ndash;menu-icon-separation: 15px;）&lt;/li>
&lt;li>菜单项排序（调整weight值）&lt;/li>
&lt;/ul>
&lt;h3 id="中间内容">中间内容
&lt;/h3>&lt;ul>
&lt;li>添加卡片中显示文章&lt;code>&amp;lt;!--more--&amp;gt;&lt;/code>摘要&lt;/li>
&lt;li>文章正文行距设置（margin-top: 10px;， margin-bottom: 10px;）&lt;/li>
&lt;li>首页显示10片文章&lt;/li>
&lt;/ul>
&lt;h3 id="右侧-sidebar">右侧 sidebar
&lt;/h3>&lt;ul>
&lt;li>添加鼠标移动至元素上放大效果&lt;/li>
&lt;li>移除文字说明和修改分类图标&lt;/li>
&lt;li>分类和标签右侧显示计数&lt;/li>
&lt;li>分类和标签显示数量为10&lt;/li>
&lt;/ul>
&lt;h3 id="底部">底部
&lt;/h3>&lt;ul>
&lt;li>添加和设置 github，bilibili，mail图标和跳转&lt;/li>
&lt;/ul>
&lt;h2 id="归档页">归档页
&lt;/h2>&lt;ul>
&lt;li>修改分类矩形框大小&lt;/li>
&lt;li>显示双栏&lt;/li>
&lt;li>添加tags显示&lt;/li>
&lt;/ul>
&lt;h2 id="相册">相册
&lt;/h2>&lt;ul>
&lt;li>修改Links页面为Gallery&lt;/li>
&lt;li>相册使用&lt;code>fliphtml5&lt;/code>外部链接展示&lt;/li>
&lt;/ul>
&lt;h2 id="文章页">文章页
&lt;/h2>&lt;ul>
&lt;li>文章正文行距设置（margin-top: 10px;， margin-bottom: 10px;）&lt;/li>
&lt;li>添加Fancybox灯箱&lt;/li>
&lt;li>右侧目录修改了间距&lt;/li>
&lt;li>修改了代码块样式&lt;/li>
&lt;li>增加notice短代码&lt;/li>
&lt;li>设置选中内容背景色&lt;/li>
&lt;/ul>
&lt;h2 id="写作和推送脚本">写作和推送脚本
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>创建md并用typora打开&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 项目目录下hugo.yaml文件最后添加
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">security:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> exec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> allow:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &amp;#39;^(dart-)?sass(-embedded)?$&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &amp;#39;^go$&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &amp;#39;^git$&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &amp;#39;^npx$&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &amp;#39;^postcss$&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &amp;#39;^tailwindcss$&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &amp;#39;^typora$&amp;#39; # 添加 typora 到允许的执行列表
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> osEnv:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - &amp;#39;(?i)^((HTTPS?|NO)_PROXY|PATH(EXT)?|APPDATA|TE?MP|TERM|GO\w+|(XDG_CONFIG_)?HOME|USERPROFILE|SSH_AUTH_SOCK|DISPLAY|LANG|SYSTEMDRIVE)$&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 添加typora环境变量
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">系统--高级系统设置--环境变量--选中Path--编辑--新建--添加typora所在路径
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">typora测试：新开一个cmd窗口，输入typora--回车，能打开typora软件
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 创建md并用typora打开
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hugo new --editor typora post/xxx.md
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>git push bat脚本，双击运行自动执行git相关命令&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">@echo off
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">:: 设置当前日期和时间格式
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">for /f &amp;#34;tokens=2 delims==&amp;#34; %%I in (&amp;#39;&amp;#34;wmic os get localdatetime /value&amp;#34;&amp;#39;) do set datetime=%%I
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">set year=%datetime:~0,4%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">set month=%datetime:~4,2%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">set day=%datetime:~6,2%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">set hour=%datetime:~8,2%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">set minute=%datetime:~10,2%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">set second=%datetime:~12,2%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">:: 创建 commit 消息：格式为 &amp;#34;YYYY-MM-DD HH:MM:SS&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">set commit_message=%year%-%month%-%day% %hour%:%minute%:%second%
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">:: 显示正在执行的命令
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">echo Executing git add ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">:: 执行 git add . 命令
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git add .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">:: 显示正在执行的命令
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">echo Executing git commit with message: &amp;#34;Commit on %commit_message%&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">:: 执行 git commit 命令，使用动态生成的 commit 消息
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git commit -m &amp;#34;Commit on %commit_message%&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">:: 显示正在执行的命令
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">echo Executing git push ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">:: 执行 git push 命令
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git push
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">:: 提示完成
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">echo Git push completed with commit message: &amp;#34;Commit on %commit_message%&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">echo ---------- OK ----------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">echo 60 秒后自动关闭命令行窗口
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">:: 等待 60 秒后自动关闭命令行窗口
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">timeout /t 60 /nobreak &amp;gt;nul
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">exit
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>Github Action 自动部署自行搜索了，不是很复杂的东西&lt;/strong>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="说明">说明
&lt;/h2>&lt;ul>
&lt;li>本人不是搞软件的，纯属瞎鼓捣&lt;/li>
&lt;li>修改的使用的方法多来自网络和gpt对话&lt;/li>
&lt;li>有些地方改的不如意，将就着用（弄不出来）&lt;/li>
&lt;li>古德拜&lt;/li>
&lt;/ul></description></item><item><title>BLOG CHANGELOG</title><link>https://weeaster.github.io/posts/e2a2e564/</link><pubDate>Sat, 14 Dec 2024 00:02:00 +0000</pubDate><guid>https://weeaster.github.io/posts/e2a2e564/</guid><description>&lt;h3 id="2024-12-14">2024-12-14
&lt;/h3>&lt;ul>
&lt;li>更换博客静态网站生成器，主题为&lt;a class="link" href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener"
>hugo-theme-stack
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/li>
&lt;li>原因时之前的hexo主题，很多包提示过时（重装操作麻烦）&lt;/li>
&lt;li>且主题仓库自2022年已是公开只读&lt;/li>
&lt;li>主题设置抄了网上很多代码，不一一致谢了&lt;/li>
&lt;li>已经尽量不花里胡哨了&lt;/li>
&lt;li>将就着用&lt;/li>
&lt;/ul>
&lt;h3 id="2023-05-10">2023-05-10
&lt;/h3>&lt;ul>
&lt;li>&lt;del>添加发布时间久远文章的提示&lt;/del>&lt;/li>
&lt;li>&lt;del>添加插件 &lt;a class="link" href="https://github.com/u2sb/hexo-tag-mmedia" target="_blank" rel="noopener"
>hexo-tag-mmedia
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/del>&lt;/li>
&lt;li>&lt;del>修改已插入的 bilibili 视频&lt;/del>&lt;/li>
&lt;/ul>
&lt;h3 id="2023-04-16">2023-04-16
&lt;/h3>&lt;ul>
&lt;li>&lt;del>更换行内代码字体颜色为 #000(黑色)&lt;/del>&lt;/li>
&lt;li>&lt;del>禁用代码块行号显示&lt;/del>&lt;/li>
&lt;li>&lt;del>禁用代码块复制功能&lt;/del>&lt;/li>
&lt;li>&lt;del>更换部分文章图片尺寸&lt;/del>&lt;/li>
&lt;li>&lt;del>文章页是有目录的，鼠标向上滚动&amp;ndash;&amp;gt;导航栏最右侧的图标&lt;/del>&lt;/li>
&lt;/ul>
&lt;h3 id="2022-11-07">2022-11-07
&lt;/h3>&lt;ul>
&lt;li>更换博客&lt;del>主题为 :&lt;a class="link" href="https://github.com/ppoffice/hexo-theme-minos" target="_blank" rel="noopener"
>Minos
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/del>&lt;/li>
&lt;li>&lt;del>移除 Minos 主题中分享和评论组件&lt;/del>&lt;/li>
&lt;li>&lt;del>移除 About 页面 发布日期/阅读时间 元素&lt;/del>&lt;/li>
&lt;li>&lt;del>修改网站字体为 思源黑体&lt;/del>&lt;/li>
&lt;li>&lt;del>修改归档页和标签页 不分页&lt;/del>&lt;/li>
&lt;li>&lt;del>添加相册页面（有点简陋）&lt;/del>&lt;/li>
&lt;li>&lt;del>其它边边角角修改&lt;/del>&lt;/li>
&lt;li>&lt;del>谢原作者https://github.com/ppoffice/&lt;/del>&lt;/li>
&lt;/ul>
&lt;h3 id="2021-11-20">2021-11-20
&lt;/h3>&lt;ul>
&lt;li>&lt;del>首页导航栏不显示 Category 页面入口链接&lt;/del>&lt;/li>
&lt;li>&lt;del>分类页 Category 内容侧边栏显示&lt;/del>&lt;/li>
&lt;li>&lt;del>清除 Jade 无用代码&lt;/del>&lt;/li>
&lt;li>&lt;del>修正 Jade 部分代码&lt;/del>&lt;/li>
&lt;li>&lt;del>修正 CSS 样式文件&lt;/del>&lt;/li>
&lt;/ul>
&lt;h3 id="2021-11-15">2021-11-15
&lt;/h3>&lt;ul>
&lt;li>&lt;del>修改首页内容展示方式&lt;/del>&lt;/li>
&lt;li>&lt;del>修改 pagination 样式&lt;/del>&lt;/li>
&lt;/ul>
&lt;h3 id="2021-11-07">2021-11-07
&lt;/h3>&lt;ul>
&lt;li>&lt;del>修改网站字体为思源黑体&lt;/del>&lt;/li>
&lt;/ul>
&lt;h3 id="2021-10-30">2021-10-30
&lt;/h3>&lt;ul>
&lt;li>&lt;del>修改 Archive 页样式&lt;/del>&lt;/li>
&lt;li>&lt;del>修改链接样式&lt;/del>&lt;/li>
&lt;/ul>
&lt;h3 id="2021-10-30-1">2021-10-30
&lt;/h3>&lt;ul>
&lt;li>&lt;del>添加本地搜索&lt;/del>&lt;/li>
&lt;/ul>
&lt;h3 id="2021-10-29">2021-10-29
&lt;/h3>&lt;ul>
&lt;li>&lt;del>修改 post 文章页和其他页面的 date_format 参数&lt;/del>&lt;/li>
&lt;/ul>
&lt;h3 id="2021-10-26">2021-10-26
&lt;/h3>&lt;ul>
&lt;li>&lt;del>修改 archive 页面条目显示数量&lt;/del>&lt;/li>
&lt;li>&lt;del>添加文章页底部 Published、Tags&lt;/del>&lt;/li>
&lt;/ul>
&lt;h3 id="2021-10-24">2021-10-24
&lt;/h3>&lt;ul>
&lt;li>&lt;del>修改样式中的 &lt;strong>media query&lt;/strong> 参数&lt;/del>&lt;/li>
&lt;/ul>
&lt;h3 id="2021-10-22">2021-10-22
&lt;/h3>&lt;ul>
&lt;li>&lt;del>修改文章页，移除左侧 sidebar，page_main 添加边框样式&lt;/del>&lt;/li>
&lt;li>&lt;del>修改 about 页面底部 contact 信息&lt;/del>&lt;/li>
&lt;li>&lt;del>移除 article-toc 文章目录&lt;/del>&lt;/li>
&lt;li>&lt;del>移除 sidebar CV 信息标签&lt;/del>&lt;/li>
&lt;/ul>
&lt;h3 id="2021-10-16">2021-10-16
&lt;/h3>&lt;ul>
&lt;li>&lt;del>添加文章页版权信息&lt;/del>&lt;/li>
&lt;li>&lt;del>修改 md 文件信息&lt;/del>&lt;/li>
&lt;/ul>
&lt;h3 id="2021-10-12">2021-10-12
&lt;/h3>&lt;ul>
&lt;li>&lt;del>使用 &lt;a class="link" href="https://github.com/PhosphorW/hexo-theme-academia" target="_blank" rel="noopener"
>Academic
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a> 主题，感谢作者 &lt;a class="link" href="https://phower.me/" target="_blank" rel="noopener"
>Le Phower&amp;rsquo;s
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/del>&lt;/li>
&lt;li>&lt;del>博客从 Gitee 迁移到 GitHub&lt;/del>&lt;/li>
&lt;li>&lt;del>修改主题配置文件&lt;/del>&lt;/li>
&lt;li>&lt;del>修改 sidebar 的 social 内容&lt;/del>&lt;/li>
&lt;li>&lt;del>主页 content 修改为显示最近十篇文章&lt;/del>&lt;/li>
&lt;li>&lt;del>主页 content 添加置顶文章&lt;/del>&lt;/li>
&lt;li>&lt;del>除 category 页和 about 页外添加 pagination&lt;/del>&lt;/li>
&lt;li>&lt;del>添加 category 页，添加 tag-cloud&lt;/del>&lt;/li>
&lt;li>&lt;del>添加 archive 页&lt;/del>&lt;/li>
&lt;li>&lt;del>添加 about 页&lt;/del>&lt;/li>
&lt;li>&lt;del>post 页面侧边栏添加 article-toc 文章目录&lt;/del>&lt;/li>
&lt;li>添加百度统计，谷歌统计，谷歌收录，bing 收录&lt;/li>
&lt;li>&lt;del>侧边栏添加 aplayer 播放器，显示效果不美观，已注释代码&lt;/del>&lt;/li>
&lt;li>&lt;del>page_main 的 div CSS 浮动问题未解决&lt;/del>&lt;/li>
&lt;/ul>
&lt;h3 id="2021-01-23">2021-01-23
&lt;/h3>&lt;ul>
&lt;li>&lt;del>添加文章页评论邮件提醒功能&lt;/del>&lt;/li>
&lt;/ul>
&lt;h3 id="2021-01-14">2021-01-14
&lt;/h3>&lt;ul>
&lt;li>&lt;del>修改博客网站访问地址不带二级目录&lt;/del>&lt;/li>
&lt;li>&lt;del>修正修改访问地址后文章阅读次数显示为 0 问题&lt;/del>&lt;/li>
&lt;li>&lt;del>修正 whoami 页面显示双 footer 栏问题&lt;/del>&lt;/li>
&lt;/ul>
&lt;h3 id="2021-01-08">2021-01-08
&lt;/h3>&lt;ul>
&lt;li>&lt;del>修正文章阅读次数显示为 0 问题&lt;/del>&lt;/li>
&lt;li>&lt;del>添加文章模板 updated 参数&lt;/del>&lt;/li>
&lt;li>&lt;del>对网站添加百度统计&lt;/del>&lt;/li>
&lt;/ul>
&lt;h3 id="2021-01-06">2021-01-06
&lt;/h3>&lt;ul>
&lt;li>&lt;del>制作修改博客 Logo，更改 cover 图片&lt;/del>&lt;/li>
&lt;li>&lt;del>修改导航栏标签为中文&lt;/del>&lt;/li>
&lt;li>&lt;del>启用 valine 评论代码&lt;/del>&lt;/li>
&lt;li>&lt;del>添加文章页 END 结束分割线&lt;/del>&lt;/li>
&lt;li>&lt;del>添加文章页上一篇下一篇链接&lt;/del>&lt;/li>
&lt;li>&lt;del>添加 post 文章模板，添加 categories,series,cover,tags 参数&lt;/del>&lt;/li>
&lt;li>&lt;del>修改网页底部 footer，添加网站运行时间记录&lt;/del>&lt;/li>
&lt;li>&lt;del>更换图标库链接&lt;/del>&lt;/li>
&lt;li>&lt;del>添加网站图床&lt;/del>&lt;/li>
&lt;li>&lt;del>更换文章页播放音乐&lt;/del>&lt;/li>
&lt;li>&lt;del>更换网站首页 Website slogans 动态文字&lt;/del>&lt;/li>
&lt;li>&lt;del>文章页和 about 页添加网易云音乐&lt;/del>&lt;/li>
&lt;li>&lt;del>文章页添加“友情链接”&lt;/del>&lt;/li>
&lt;li>&lt;del>更换部分页面左上角图标返回链接&lt;/del>&lt;/li>
&lt;li>&lt;del>添加 abbrlink 插件，修改文章页 url 链接&lt;/del>&lt;/li>
&lt;li>&lt;del>博客网站本地初始调试工作完成，推送至 Gitee&lt;/del>&lt;/li>
&lt;/ul>
&lt;hr></description></item><item><title>电脑微信自动登陆进入主窗口</title><link>https://weeaster.github.io/posts/fdccc10e/</link><pubDate>Fri, 06 Dec 2024 10:57:11 +0000</pubDate><guid>https://weeaster.github.io/posts/fdccc10e/</guid><description>&lt;p>实现功能：电脑开机启动微信自动登陆进入主窗口&lt;/p>
&lt;p>实现逻辑：微信启动后将窗口置顶，模拟输入回车键&lt;/p>
&lt;p>前提：微信自动登陆已开启，启动微信后显示&lt;code>进入微信&lt;/code>按钮&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/12/06/LjwQXnR5bPqJTov.png">
&lt;img src="https://s2.loli.net/2024/12/06/LjwQXnR5bPqJTov.png"
loading="lazy"
alt="image-20241206115449070"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="操作步骤">操作步骤
&lt;/h2>&lt;h3 id="安装pywinauto库">安装pywinauto库
&lt;/h3>&lt;p>全局安装或虚拟环境（我使用conda虚拟环境）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">conda create -n wechatautologin python=3.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pip install pywinauto
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="编写三个文件和创建快捷方式">编写三个文件和创建快捷方式
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>&lt;code> wechatautologin.py&lt;/code>，python代码文件&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">from pywinauto.application import Application
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">from pywinauto.keyboard import send_keys
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 启动应用程序
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">app = Application(&amp;#39;uia&amp;#39;).start(r&amp;#34;D:\Program Files (x86)\Tencent\WeChat\WeChat.exe&amp;#34;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 查找微信窗口，使用正则表达式匹配标题包含“微信”
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dlg = app.window(title_re=&amp;#34;微信&amp;#34;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 增加等待时间，确保窗口加载完成
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dlg.wait(&amp;#39;visible&amp;#39;, timeout=30) # 等待窗口可见，最大等待 30 秒
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 将窗口置顶并获取焦点
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dlg.set_focus()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 模拟按下 Enter 键
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">send_keys(&amp;#34;{ENTER}&amp;#34;)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;code>wechatautologin.bat&lt;/code>，bat文件，用于进入虚拟环境，运行&lt;code> wechatautologin.py&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">@echo off
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">REM 确保脚本运行时的工作目录是批处理文件所在的目录
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cd /d %~dp0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">REM 激活conda虚拟环境
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">call D:\miniconda3\Scripts\activate.bat wechatautologin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">REM 启动应用
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">python wechatautologin.py
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;code>wechatautologin.vbs&lt;/code>，单独运行bat文件会显示cmd窗口，套一层vbs解决&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Set WshShell = CreateObject(&amp;#34;WScript.Shell&amp;#34;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WshShell.Run &amp;#34;&amp;#34;&amp;#34;F:\wechatautologin\wechatautologin.bat&amp;#34;&amp;#34;&amp;#34;, 0, False
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;code>wechatautologin.lnk&lt;/code>，&lt;code>wechatautologin.vbs&lt;/code>文件的快捷方式，右键&lt;code>wechatautologin.vbs&lt;/code>在菜单中点击&lt;code>创建快捷方式&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="添加开机启动">添加开机启动
&lt;/h3>&lt;p>将上一步骤创建的快捷方式复制或剪切到以下路径（两个位置，二选一）&lt;/p>
&lt;ul>
&lt;li>&lt;code>C:\Users\xxx\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup&lt;/code>&lt;/li>
&lt;li>&lt;code>C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp&lt;/code>&lt;/li>
&lt;/ul>
&lt;h2 id="最后">最后
&lt;/h2>&lt;ul>
&lt;li>&lt;code>Pywinauto&lt;/code>文档 &lt;a class="link" href="https://static.kancloud.cn/gnefnuy/pywinauto_doc/1193035" target="_blank" rel="noopener"
>https://static.kancloud.cn/gnefnuy/pywinauto_doc/1193035
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/li>
&lt;li>如果出现微信启动后没有自动点击&lt;code>进入微信&lt;/code>按钮，可添加一定时间&lt;code>time.sleep&lt;/code>等待&lt;/li>
&lt;li>注意替换微信安装位置，我这安装在D盘&lt;/li>
&lt;li>小玩意儿，省一个点击鼠标或敲回车的时间&lt;/li>
&lt;/ul></description></item><item><title>HP440笔记本有线无线自动切换问题</title><link>https://weeaster.github.io/posts/85530671/</link><pubDate>Fri, 22 Nov 2024 15:17:57 +0000</pubDate><guid>https://weeaster.github.io/posts/85530671/</guid><description>&lt;p>惠普440笔记本安装win10后，有线无线自动切换，只能二选一问题&lt;/p>
&lt;p>拔插网线显示如下：&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/11/22/PnNvRUVaA9fWpGw.gif">
&lt;img src="https://s2.loli.net/2024/11/22/PnNvRUVaA9fWpGw.gif"
loading="lazy"
alt="问题复现"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>查看官网社区帖子，提示关闭BIOS的自动切换功能，无效&lt;/p>
&lt;p>需要关闭两个服务才可&lt;/p>
&lt;h2 id="解决方法">解决方法
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>去掉BIOS设置里的LAN/WLAN Switch选项&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Ctrl+R，输入&lt;code>services.msc&lt;/code>找到如下两个服务关闭&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/11/22/h46zfntoGZHIQSC.png">
&lt;img src="https://s2.loli.net/2024/11/22/h46zfntoGZHIQSC.png"
loading="lazy"
alt="ScreenCaputure241122153441"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/11/22/UobM9dNWjnCDeX3.png">
&lt;img src="https://s2.loli.net/2024/11/22/UobM9dNWjnCDeX3.png"
loading="lazy"
alt="ScreenCaputure241122151135"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="效果">效果
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/11/22/hY5LJ3seWEIRqzk.gif">
&lt;img src="https://s2.loli.net/2024/11/22/hY5LJ3seWEIRqzk.gif"
loading="lazy"
alt="问题解决"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ol></description></item><item><title>非旺玖原装的pl2303请联系供应商-驱动替换</title><link>https://weeaster.github.io/posts/a0365ff4/</link><pubDate>Fri, 22 Nov 2024 14:19:42 +0000</pubDate><guid>https://weeaster.github.io/posts/a0365ff4/</guid><description>&lt;p>USB转串口转接线显示&lt;code>非旺玖原装的pl2303请联系供应商&lt;/code>问题&lt;/p>
&lt;p>之前也出现过这个问题，解决方法是重装驱动，但是windows自动更新又把驱动升级了，又出现这个问题&lt;/p>
&lt;p>网上的解释是驱动问题，确实也是&lt;/p>
&lt;p>看到一篇文章说驱动文件替换可解决此问题，记录一下&lt;/p>
&lt;h2 id="陪伴多年的好伙伴">陪伴多年的&amp;quot;好伙伴&amp;quot;
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/11/22/94DritJUwkGKblY.jpg">
&lt;img src="https://s2.loli.net/2024/11/22/94DritJUwkGKblY.jpg"
loading="lazy"
alt="20241122142856"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>淘宝买的，刚去查了一下，这么多年了居然还是当时的价格（真保值）&lt;/li>
&lt;li>这是转接线，转接线RJ45接口&amp;ndash;&amp;gt;568B标准网线&amp;ndash;&amp;gt;设备console接口（看介绍支持20米连接，我最长也就连接15米左右，正常使用）&lt;/li>
&lt;li>远离机柜噪音，远离空调冻西瓜，舒适蹲角落配置设备，无需DB9线&lt;/li>
&lt;/ul>
&lt;h2 id="驱动替换">驱动替换
&lt;/h2>&lt;ol>
&lt;li>查看显示&lt;code>非旺玖原装的pl2303请联系供应商&lt;/code>&lt;/li>
&lt;/ol>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/11/22/yZvFVoqmRGSQipN.png">
&lt;img src="https://s2.loli.net/2024/11/22/yZvFVoqmRGSQipN.png"
loading="lazy"
alt="ScreenCaputure241122140020"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ol start="2">
&lt;li>查看驱动版本，显示2024/5/29，3.8.43.0，就是这个windows自动更新导致的问题，下一步替换图右侧显示的第一个文件&lt;/li>
&lt;/ol>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/11/22/xsUrH1CageLz7XB.png">
&lt;img src="https://s2.loli.net/2024/11/22/xsUrH1CageLz7XB.png"
loading="lazy"
alt="ScreenCaputure241122140346"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ol start="3">
&lt;li>下载&lt;code>ser2pl64.zip&lt;/code>，解压后复制文件粘贴到&lt;code>C:\Windows\System32\drivers&lt;/code>，提示替换文件&lt;/li>
&lt;/ol>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/11/22/ry7vRLImqHbEN8B.png">
&lt;img src="https://s2.loli.net/2024/11/22/ry7vRLImqHbEN8B.png"
loading="lazy"
alt="ScreenCaputure241122140508"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ol start="4">
&lt;li>点击替换会提示文件正在使用，此时拔掉USB转串口转接线，点击重试可替换成功&lt;/li>
&lt;/ol>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/11/22/q2vrwVm6ol8FEfc.png">
&lt;img src="https://s2.loli.net/2024/11/22/q2vrwVm6ol8FEfc.png"
loading="lazy"
alt="ScreenCaputure241122140527"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ol start="5">
&lt;li>最后在设备管理器查看，已正常显示com接口&lt;/li>
&lt;/ol>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/11/22/oe2zERhHjxtQF7w.png">
&lt;img src="https://s2.loli.net/2024/11/22/oe2zERhHjxtQF7w.png"
loading="lazy"
alt="ScreenCaputure241122142232"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="驱动文件">驱动文件
&lt;/h2>&lt;ul>
&lt;li>&lt;a class="link" href="https://aoian.lanzoue.com/b00r6oisj" target="_blank" rel="noopener"
>https://aoian.lanzoue.com/b00r6oisj
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a> ，（5678）&lt;/li>
&lt;li>&lt;a class="link" href="https://www.alipan.com/s/EhKkRT3VcKr" target="_blank" rel="noopener"
>https://www.alipan.com/s/EhKkRT3VcKr
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>修改Van Nav搜索结果不显示百度谷歌必应搜索</title><link>https://weeaster.github.io/posts/ae17cb36/</link><pubDate>Thu, 21 Nov 2024 17:36:11 +0000</pubDate><guid>https://weeaster.github.io/posts/ae17cb36/</guid><description>&lt;p>Van Nav是一个轻量的导航站&lt;/p>
&lt;p>Github开源仓库：https://github.com/Mereithhh/van-nav&lt;/p>
&lt;p>现在的浏览器地址栏都集成了搜索功能，用不上导航站里的在线搜索，以下列出去除该功能的操作步骤&lt;/p>
&lt;p>我将其定位为半内网使用的一个导航站&lt;/p>
&lt;h2 id="下载源码">下载源码
&lt;/h2>&lt;p>git clone 或 Download ZIP&lt;/p>
&lt;h2 id="修改npm为阿里云镜像">修改npm为阿里云镜像
&lt;/h2>&lt;p>国内连接官方的npm时常抽风，替换yarn.lock 里面的resolved为registry.npmmirror.com，从阿里云镜像源下载依赖.&lt;/p>
&lt;p>两个文件的路径为：&lt;/p>
&lt;ul>
&lt;li>ui/admin/yarn.lock&lt;/li>
&lt;li>ui/website/yarn.lock&lt;/li>
&lt;/ul>
&lt;h2 id="修改相应代码">修改相应代码
&lt;/h2>&lt;p>修改代码&lt;code>ui\website\src\components\Content\index.tsx&lt;/code>文件&lt;/p>
&lt;p>Line：13 （删除此行import）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">import { generateSearchEngineCard } from &amp;#34;../../utils/serachEngine&amp;#34;;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Line：87-116 （替换内容）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="k">const&lt;/span> &lt;span class="n">filteredData&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">useMemo&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tools&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">null&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="err">如果没有&lt;/span> &lt;span class="n">tools&lt;/span> &lt;span class="err">属性，直接返回&lt;/span> &lt;span class="n">null&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">const&lt;/span> &lt;span class="n">localResult&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tools&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">.&lt;/span>&lt;span class="n">filter&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">any&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">const&lt;/span> &lt;span class="n">hide&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">item&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">hide&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">hide&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="bp">true&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="err">如果&lt;/span> &lt;span class="n">item&lt;/span> &lt;span class="err">没有&lt;/span> &lt;span class="n">hide&lt;/span> &lt;span class="err">属性，保留该项&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">hide&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">isLogin&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="bp">false&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="err">如果&lt;/span> &lt;span class="n">item&lt;/span> &lt;span class="err">隐藏且用户已登录，丢弃该项&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="bp">false&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="err">默认丢弃该项&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">.&lt;/span>&lt;span class="n">filter&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">any&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">currTag&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="s2">&amp;#34;全部工具&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="bp">true&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="err">如果当前标签是“全部工具”，保留该项&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">item&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">catelog&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="n">currTag&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="err">只保留与当前标签匹配的项&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">.&lt;/span>&lt;span class="n">filter&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">any&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">searchString&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="bp">true&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="err">如果搜索字符串为空，保留该项&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="err">保留与搜索字符串匹配的项&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mutiSearch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">searchString&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">||&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mutiSearch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">desc&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">searchString&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">||&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mutiSearch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">item&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">searchString&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">localResult&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="err">返回过滤后的结果&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">},&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">currTag&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">searchString&lt;/span>&lt;span class="p">]);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="构建镜像">构建镜像
&lt;/h2>&lt;p>将代码文件夹上传至linux，需提前安装号docker（网络上教程多如牛毛，一搜便知）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker build -t my-nav:v0.1 .
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/11/21/bcrsQkaBHpdASVX.png">
&lt;img src="https://s2.loli.net/2024/11/21/bcrsQkaBHpdASVX.png"
loading="lazy"
alt="image-20241121175134975"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="创建容器">创建容器
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -d --name my-van-nav --restart always -p 6412:6412 -v /opt/superE/van-nav-data:/app/data my-nav:v0.1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="访问van-nav">访问Van Nav
&lt;/h2>&lt;p>地址栏输入访问服务器的IP+端口号（我本地自建了dns+nginx，所以显示如下）&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/11/21/wblkB3sXCEJice7.png">
&lt;img src="https://s2.loli.net/2024/11/21/wblkB3sXCEJice7.png"
loading="lazy"
alt="image-20241121175623917"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/11/21/jPsG4d69EC2gWnz.png">
&lt;img src="https://s2.loli.net/2024/11/21/jPsG4d69EC2gWnz.png"
loading="lazy"
alt="image-20241121175700154"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/11/21/KT6WhIYeuVC1UNR.png">
&lt;img src="https://s2.loli.net/2024/11/21/KT6WhIYeuVC1UNR.png"
loading="lazy"
alt="image-20241121175740609"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/11/21/cWSvxRq36Dut4LC.png">
&lt;img src="https://s2.loli.net/2024/11/21/cWSvxRq36Dut4LC.png"
loading="lazy"
alt="image-20241121175812069"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>通过观察发现，输入关键字后，结果中并没有必应谷歌百度的选项列出，效果达成&lt;/p>
&lt;hr>
&lt;h2 id="最后">最后
&lt;/h2>&lt;ul>
&lt;li>自动获取网站logo图标不好使，可F12查看&amp;ndash;网络&amp;ndash;image，将图标的URL地址手动添加&lt;/li>
&lt;li>图标会储存到数据库，我也不知道怎么实现的，设置完成后即使网络断开或对应的服务网站没开启导航站也能加载图标&lt;/li>
&lt;li>如果将导航站部署在服务器，所有人打开的页面都是一致的，不能做到每个人都自定义其访问链接（适合定位为统一入口）&lt;/li>
&lt;li>如果个人使用部署可以下载对应的安装包（各种跨平台的都有），需要设置开机自启，访问地址为：http://localhost:6412&lt;/li>
&lt;li>惊叹到Go语言编写的程序占用空间如此之小&lt;/li>
&lt;/ul></description></item><item><title>Rocky Linux 8.7 Flask应用docker容器化</title><link>https://weeaster.github.io/posts/297bc3bd/</link><pubDate>Thu, 10 Oct 2024 22:47:44 +0000</pubDate><guid>https://weeaster.github.io/posts/297bc3bd/</guid><description>&lt;p>本文为Flask应用进行容器化的笔记&lt;/p>
&lt;h2 id="上传代码至rockylinux">上传代码至RockyLinux
&lt;/h2>&lt;p>将代码文件&lt;code>IPA_VIEW_v0.2.zip&lt;/code>上传至&lt;code>/opt&lt;/code>路径下（可选择其他路径）&lt;/p>
&lt;p>解压在当前目录&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">unzip IPA_VIEW_v0.2.zip
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>或解压到指定目录&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">unzip IPA_VIEW_v0.2.zip -d /IPA_VIEW
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h2 id="在项目根目录下创建dockerfile文件">在项目根目录下创建Dockerfile文件
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 使用官方的 Python 镜像作为基础镜像
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">FROM python:3.10-slim
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 设置工作目录
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WORKDIR /app
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 将当前目录的内容复制到容器的工作目录中
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">COPY . .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 设置时区为 Asia/Shanghai
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RUN echo &amp;#34;Asia/Shanghai&amp;#34; &amp;gt; /etc/timezone
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 安装所需的依赖
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># RUN pip install --no-cache-dir -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 有时上面这个清华源不好使，可替换阿里云，网络畅通可以直接连接官方源
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RUN pip install --no-cache-dir -i https://mirrors.aliyun.com/pypi/simple/ -r requirements.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 运行数据库初始化脚本
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RUN flask init
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 运行generate_secret_key.py随机生成32 字节的 SECRET_KEY，然后自动写入configs.py文件
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RUN python generate_secret_key.py
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 暴露应用使用的端口
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 只是一个标记指示，实际操作中使用其他端口并不影响
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 规范使用的话与实际使用的端口一致
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">EXPOSE 8080
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 运行 Flask 应用
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CMD [&amp;#34;waitress-serve&amp;#34;, &amp;#34;--call&amp;#34;, &amp;#34;pear_admin:create_app&amp;#34;]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="构建镜像">构建镜像
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker build -t ipa-view:v0.2 .
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>说明：ipa-view:v0.2 ，{镜像名称}:{TAG}&lt;/strong>&lt;/p>
&lt;h2 id="创建并运行-docker-容器">创建并运行 Docker 容器
&lt;/h2>&lt;p>&lt;strong>以下创建容器的方式，根据需要选择其中之一即可&lt;/strong>&lt;/p>
&lt;h3 id="方式一简易启动">方式一：简易启动
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -d --restart always -p 5666:8080 ipa-view:v0.2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="方式二指定name和network">方式二：指定name和network
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 创建network，用于隔离，属于不同network的容器之间互相隔离不能互访
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker network create ipa-view-net
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -d --name ipa-view-container --network ipa-view-net --restart always -p 5666:8080 ipa-view:v0.2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>参数说明：&lt;/p>
&lt;ul>
&lt;li>-d，后台运行&lt;/li>
&lt;li>&amp;ndash;name ipa-view-container， 设置容器名称，不设置会随机生成&lt;/li>
&lt;li>&amp;ndash;network ipa-view-net， 设置network，使用该参数前需要手动创建ipa-view-net，否则提示错误&lt;code>docker: Error response from daemon: network ipa-view-net not found.&lt;/code>&lt;/li>
&lt;li>&amp;ndash;restart always ，无论何种原因导致容器退出，都重启容器&lt;/li>
&lt;li>-p 5666:8080，宿主机端口:容器内flask应用端口&lt;/li>
&lt;li>ipa-view:v0.2，上一步构建的镜像&lt;/li>
&lt;/ul>
&lt;h3 id="方式三docker-volumes持久化">方式三：Docker Volumes（持久化）
&lt;/h3>&lt;p>在默认情况下，Docker Volumes 会被创建在 &lt;code>/var/lib/docker/volumes&lt;/code> 目录下&lt;/p>
&lt;p>将容器内日志目录和数据库目录保存至宿主机，便于数据库备份和查看日志&lt;/p>
&lt;p>1、创建目录：在宿主机上，建一个目录作为Volumes的保存位置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">mkdir -p /opt/ipa_view_data/sqlite_db
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir -p /opt/ipa_view_data/log
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>2、创建 Docker Volumes：使用 &lt;code>docker volume create&lt;/code> 命令创建 Docker Volumes，并指定自定义的位置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker volume create --driver local --opt o=bind --opt type=none --opt device=/opt/ipa_view_data/sqlite_db sqlite_db
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker volume create --driver local --opt o=bind --opt type=none --opt device=/opt/ipa_view_data/log log
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>3、创建容器&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -d -v sqlite_db:/app/instance -v log:/app/log --name ipa-view-container --network ipa-view-net --restart always -p 5666:8080 ipa-view:v0.2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="查看容器">查看容器
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@localhost IPA_VIEW_v0.2]# docker ps
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">a72fd1a21a30 ipa-view:v0.2 &amp;#34;waitress-serve --ca…&amp;#34; 21 seconds ago Up 19 seconds 0.0.0.0:5666-&amp;gt;8080/tcp, :::5666-&amp;gt;8080/tcp ipa-view-container
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="进入容器">进入容器
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker exec -it a72fd1a21a30 /bin/bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">or
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker exec -it ipa-view-container /bin/bash
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="访问应用">访问应用
&lt;/h2>&lt;p>浏览器输入http://your_ip_address:5666&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/10/10/GRcvhDBldKo1api.png">
&lt;img src="https://s2.loli.net/2024/10/10/GRcvhDBldKo1api.png"
loading="lazy"
alt="image-20241010225328437"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;hr>
&lt;h2 id="常见问题记录">常见问题记录
&lt;/h2>&lt;h3 id="容器内flask应用访问网络">容器内flask应用访问网络
&lt;/h3>&lt;p>最简单的方法是直接使用宿主机的 IP 地址来访问宿主机所在的网络中的其他主机&lt;/p>
&lt;p>通常情况下，容器可以通过宿主机的 IP 地址来访问外部网络&lt;/p>
&lt;p>容器内IP地址访问外部设备会经过宿主机的NAT转发出去&lt;/p>
&lt;h3 id="外部网络访问flask应用">外部网络访问flask应用
&lt;/h3>&lt;p>防火墙放行端口&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">firewall&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cmd&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">permanent&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">port&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">5666&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tcp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">firewall&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cmd&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">reload&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="日志查看">日志查看
&lt;/h3>&lt;p>直接docker命令查看&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">localhost&lt;/span> &lt;span class="n">IPA_VIEW_v0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># docker logs ipa-view-container&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">INFO&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="mi">2024&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">09&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">30&lt;/span> &lt;span class="mi">06&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">39&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">08&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">049&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="n">base&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">py&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">181&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="n">Scheduler&lt;/span> &lt;span class="n">started&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">DEBUG&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="mi">2024&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">09&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">30&lt;/span> &lt;span class="mi">06&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">39&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">08&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">051&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="n">base&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">py&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">954&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="n">Looking&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">jobs&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">run&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">DEBUG&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="mi">2024&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">09&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">30&lt;/span> &lt;span class="mi">06&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">39&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">08&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">095&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="n">base&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">py&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">1030&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="n">No&lt;/span> &lt;span class="n">jobs&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="n">waiting&lt;/span> &lt;span class="n">until&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">job&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">added&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">INFO&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="mi">2024&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">09&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">30&lt;/span> &lt;span class="mi">06&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">39&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">08&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">169&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="n">wasyncore&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">py&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">485&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="n">Serving&lt;/span> &lt;span class="n">on&lt;/span> &lt;span class="n">http&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">8080&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">INFO&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="mi">2024&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">09&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">30&lt;/span> &lt;span class="mi">06&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">489&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="n">__init__&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">py&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">76&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="mf">172.31&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">100.2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Sep&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2024&lt;/span> &lt;span class="mi">06&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="s2">&amp;#34;GET / HTTP/1.1&amp;#34;&lt;/span> &lt;span class="mi">200&lt;/span> &lt;span class="o">-&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">INFO&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="mi">2024&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">09&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">30&lt;/span> &lt;span class="mi">06&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">588&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="n">__init__&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">py&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">76&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="mf">172.31&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">100.2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Sep&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2024&lt;/span> &lt;span class="mi">06&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="s2">&amp;#34;GET /static/component/pear/css/pear.css HTTP/1.1&amp;#34;&lt;/span> &lt;span class="mi">200&lt;/span> &lt;span class="o">-&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">INFO&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="mi">2024&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">09&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">30&lt;/span> &lt;span class="mi">06&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">592&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="n">__init__&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">py&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">76&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="mf">172.31&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">100.2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Sep&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2024&lt;/span> &lt;span class="mi">06&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="s2">&amp;#34;GET /static/admin/css/admin.css HTTP/1.1&amp;#34;&lt;/span> &lt;span class="mi">200&lt;/span> &lt;span class="o">-&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">INFO&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="mi">2024&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">09&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">30&lt;/span> &lt;span class="mi">06&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">596&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="n">__init__&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">py&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">76&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="mf">172.31&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">100.2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Sep&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2024&lt;/span> &lt;span class="mi">06&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="s2">&amp;#34;GET /static/admin/css/admin.dark.css HTTP/1.1&amp;#34;&lt;/span> &lt;span class="mi">200&lt;/span> &lt;span class="o">-&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">INFO&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="mi">2024&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">09&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">30&lt;/span> &lt;span class="mi">06&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">603&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="n">__init__&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">py&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">76&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="mf">172.31&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">100.2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Sep&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2024&lt;/span> &lt;span class="mi">06&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="s2">&amp;#34;GET /static/admin/css/variables.css HTTP/1.1&amp;#34;&lt;/span> &lt;span class="mi">200&lt;/span> &lt;span class="o">-&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">WARNING&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="mi">2024&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">09&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">30&lt;/span> &lt;span class="mi">06&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">608&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="n">task&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">py&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">114&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="n">Task&lt;/span> &lt;span class="n">queue&lt;/span> &lt;span class="n">depth&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">WARNING&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="mi">2024&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">09&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">30&lt;/span> &lt;span class="mi">06&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">613&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="n">task&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">py&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">114&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="n">Task&lt;/span> &lt;span class="n">queue&lt;/span> &lt;span class="n">depth&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">INFO&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="mi">2024&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">09&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">30&lt;/span> &lt;span class="mi">06&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">634&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="n">__init__&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">py&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">76&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="mf">172.31&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">100.2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Sep&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2024&lt;/span> &lt;span class="mi">06&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="s2">&amp;#34;GET /static/admin/css/reset.css HTTP/1.1&amp;#34;&lt;/span> &lt;span class="mi">200&lt;/span> &lt;span class="o">-&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">WARNING&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="mi">2024&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">09&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">30&lt;/span> &lt;span class="mi">06&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">637&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="n">task&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">py&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">114&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="n">Task&lt;/span> &lt;span class="n">queue&lt;/span> &lt;span class="n">depth&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>进入Docker Volumes（持久化）的目录查看&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> cd /opt/ipa_view_data/log/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@localhost log]# pwd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/opt/ipa_view_data/log
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@localhost log]# cat log.log | more
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[2024-10-09 15:43:55,150][MainThread:140080137403264][task_id:apscheduler.scheduler][base.py:181][INFO][Scheduler started]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[2024-10-09 15:43:55,152][APScheduler:140080083592896][task_id:apscheduler.scheduler][base.py:954][DEBUG][Looking for jobs to run]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[2024-10-09 15:43:55,193][APScheduler:140080083592896][task_id:apscheduler.scheduler][base.py:1030][DEBUG][No jobs; waiting until a job is added]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[2024-10-09 15:43:55,286][MainThread:140080137403264][task_id:waitress][wasyncore.py:485][INFO][Serving on http://0.0.0.0:8080]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[2024-10-09 15:43:55,292][waitress-0:140080074151616][task_id:access_log][__init__.py:76][INFO][172.31.100.2 - - [09/Oct/2024 15:43:55] &amp;#34;GET /api/v1/scheduler/jobs HTTP/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1.1&amp;#34; 200 -]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="设置容器自动重启">设置容器自动重启
&lt;/h3>&lt;p>&lt;strong>前面docker run命令已设置，跳过&lt;/strong>&lt;/p>
&lt;p>Docker 容器的重启策略如下：
&amp;ndash;restart具体参数值详细信息：
no　　　　　　　 // 默认策略,容器退出时不重启容器；
on-failure　　 // 在容器非正常退出时（退出状态非0）才重新启动容器；
on-failure:3 // 在容器非正常退出时重启容器，最多重启3次；
always　　　　 // 无论退出状态是如何，都重启容器；&lt;/p>
&lt;p>修改已有容器restart参数&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker update --restart=always a72fd1a21a30
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="容器时间与宿主机时间问题">容器时间与宿主机时间问题
&lt;/h3>&lt;p>&lt;strong>前面dockerfile已设置，跳过&lt;/strong>&lt;/p>
&lt;p>经过测试，容器内的时间能与宿主机同步，但是时区不能&lt;/p>
&lt;p>解决方式一：&lt;/p>
&lt;p>在 Dockerfile 中设置时区。确保在容器构建阶段就设置好时区
在Dockerfile文件内添加如下代码&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 设置时区为 Asia/Shanghai
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RUN echo &amp;#34;Asia/Shanghai&amp;#34; &amp;gt; /etc/timezone
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>解决方式二：&lt;/p>
&lt;p>通过环境变量设置时区，在启动容器时设置环境变量&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">docker run -e TZ=Asia/Shanghai -d --name ipa-view-container-v2.2 --network ipa-view-net --restart always -p 5667:8080 ipa-view:v0.2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>配置Gogs和Github免密git push</title><link>https://weeaster.github.io/posts/fe1c1d91/</link><pubDate>Thu, 19 Sep 2024 14:35:00 +0000</pubDate><guid>https://weeaster.github.io/posts/fe1c1d91/</guid><description>&lt;p>本文描述的是在windows系统上配置免密&lt;code>git push&lt;/code>至&lt;code>Gogs&lt;/code>仓库和&lt;code>Gthub&lt;/code>仓库&lt;/p>
&lt;p>之前也弄过类似操作，但是由于那次重装系统给干没了&lt;/p>
&lt;p>Gogs为本地使用，设计为不联网&lt;/p>
&lt;p>Github为在线使用，同时使用的还有Github Pages的博客更新&lt;/p>
&lt;h2 id="前提">前提
&lt;/h2>&lt;ol>
&lt;li>本机中已有Github的免密配置，也就是在Github上传了公钥，不变更这部分内容&lt;/li>
&lt;li>Github配置的是全局用户，不变更这部分内容，新增的Gogs使用local user进行配置&lt;/li>
&lt;li>尽量保持不改动Github部分的配置&lt;/li>
&lt;/ol>
&lt;h2 id="生成用于gogs的密钥对">生成用于Gogs的密钥对
&lt;/h2>&lt;p>在任意目录下启动git bash 窗口（&lt;code>gogs@gogs.net&lt;/code>邮箱地址为Gogs上的用户邮箱，不是实际互联网上存在的）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ ssh-keygen -t ed25519 -C &amp;#34;gogs@gogs.net&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Generating public/private ed25519 key pair.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enter file in which to save the key (/c/Users/xxx/.ssh/id_ed25519): gogs_id_ed25519
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enter passphrase (empty for no passphrase):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enter same passphrase again:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Your identification has been saved in gogs_id_ed25519
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Your public key has been saved in gogs_id_ed25519.pub
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The key fingerprint is:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="密钥对拷贝至ssh目录">密钥对拷贝至.ssh目录
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>由于在创建ssh-key时没有指定保存到.ssh目录，所以手动复制到该目录(C:\Users\xxx\ .ssh)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>也可以在稍后创建的config文件中指定密钥对的路径，但是不妥，还是放在统一的目录&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="创建config文件">创建config文件
&lt;/h2>&lt;ul>
&lt;li>资源管理器打开目录&lt;code>C:\Users\xxx\.ssh&lt;/code>，创建一个config文件（注意没有后缀）&lt;/li>
&lt;li>gogs_id_ed25519为前面步骤中创建的密钥对名称&lt;/li>
&lt;li>id_ed25519为我正在使用的github密钥对名称&lt;/li>
&lt;/ul>
&lt;p>注意：gogs使用的是root用户，因为当初没有创建git用户（如果你创建了git用户，则使用git）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># gogs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Host 172.31.100.225
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> HostName 172.31.100.225
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PreferredAuthentications publickey
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IdentityFile C:/Users/xxx/.ssh/gogs_id_ed25519
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> User root
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># github
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Host github.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> HostName github.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PreferredAuthentications publickey
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IdentityFile C:/Users/xxx/.ssh/id_ed25519
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> User git
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="上传ssh公钥和测试">上传ssh公钥和测试
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>登陆Gogs，头像&amp;ndash;用户设置&amp;ndash;SSH 密钥&amp;ndash;增加密钥&lt;/p>
&lt;/li>
&lt;li>
&lt;p>记事本打开gogs_id_ed25519.pub，复制内容粘贴至密钥内容，填写一个密钥名称，点击增加密钥&lt;/p>
&lt;/li>
&lt;li>
&lt;p>测试&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># Gogs测试
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ssh -T root@172.31.100.225
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Hi there, You&amp;#39;ve successfully authenticated, but Gogs does not provide shell access.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">If this is unexpected, please log in with password and setup Gogs under another user.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Github测试
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ssh -T git@github.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Hi kiraster! You&amp;#39;ve successfully authenticated, but GitHub does not provide shell access.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="git配置和初始化懂的跳过">git配置和初始化(懂的跳过)
&lt;/h2>&lt;ol>
&lt;li>为了演示操作，需要在Gogs创建一个仓库&lt;/li>
&lt;/ol>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/09/19/ydGzBlLg6VIQNbR.png">
&lt;img src="https://s2.loli.net/2024/09/19/ydGzBlLg6VIQNbR.png"
loading="lazy"
alt="image-5706"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ol start="2">
&lt;li>
&lt;p>在本地创建一个目录test&lt;/p>
&lt;/li>
&lt;li>
&lt;p>打开创建的test目录&lt;/p>
&lt;/li>
&lt;li>
&lt;p>右键git bash here打开窗口，执行git初始化命令和配置local user&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">git init
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 使用local配置用户，配置的local user仅对当前本地仓库起作用
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># gogs@gogs.net邮箱地址为Gogs上的用户邮箱，不是实际互联网上存在的
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git config --local user.name &amp;#34;gogs&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git config --local user.email &amp;#34;gogs@gogs.net&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">$ git init
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Initialized empty Git repository in D:/test/.git/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ git config --local user.name &amp;#34;gogs&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ git config --local user.email &amp;#34;gogs@gogs.net&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>修改remote仓库地址（由于当时省事没有修改domian）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">git remote add origin root@172.31.100.225:gogs/test.git
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>执行剩下命令&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">touch README.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git add README.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git commit -m &amp;#34;first commit&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git push -u origin master
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ touch README.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ git add README.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ git commit -m &amp;#34;first commit&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[master (root-commit) 6b281e3] first commit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 file changed, 0 insertions(+), 0 deletions(-)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> create mode 100644 README.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ git push -u origin master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enumerating objects: 3, done.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Counting objects: 100% (3/3), done.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Writing objects: 100% (3/3), 200 bytes | 200.00 KiB/s, done.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total 3 (delta 0), reused 0 (delta 0), pack-reused 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">To 172.31.100.225:gogs/test.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * [new branch] master -&amp;gt; master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Branch &amp;#39;master&amp;#39; set up to track remote branch &amp;#39;master&amp;#39; from &amp;#39;origin&amp;#39;.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>Gogs上查看&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/09/19/JGkVoUsThd6Lx4g.png">
&lt;img src="https://s2.loli.net/2024/09/19/JGkVoUsThd6Lx4g.png"
loading="lazy"
alt="image-8002"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ol></description></item><item><title>在Rocky Linux 8.7虚拟机安装Gogs的记录</title><link>https://weeaster.github.io/posts/5745efe9/</link><pubDate>Wed, 18 Sep 2024 11:22:42 +0000</pubDate><guid>https://weeaster.github.io/posts/5745efe9/</guid><description>&lt;p>Gogs 是一款极易搭建的自助 Git 服务。&lt;/p>
&lt;p>Gogs官网：https://gogs.io/&lt;/p>
&lt;p>以下内容为本次安装过程的一个记录&lt;/p>
&lt;h2 id="准备环境">准备环境
&lt;/h2>&lt;p>按照官方文档指示的环境要求处理， &lt;a class="link" href="https://gogs.io/docs/installation" target="_blank" rel="noopener"
>https://gogs.io/docs/installation
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/p>
&lt;h3 id="一台虚拟机">一台虚拟机
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>选择你熟悉和中意的linux，不必在意我以下使用的发行版（留了模板）&lt;/p>
&lt;/li>
&lt;li>
&lt;p>此处选用&lt;code>Rocky8.7&lt;/code>是因为本机VMware里躺着一个虚拟机模版，果断完整克隆一份（省时）&lt;/p>
&lt;/li>
&lt;li>
&lt;p>传闻消耗资源少？，就分个2核1G内存的丐版（不够再加）&lt;/p>
&lt;/li>
&lt;li>
&lt;p>配置静态IP地址， 配置可连接互联网（基操）&lt;/p>
&lt;/li>
&lt;li>
&lt;p>虚拟机硬件资源配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@localhost /]# lscpu | grep -E &amp;#39;CPU|Core&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CPU op-mode(s): 32-bit, 64-bit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CPU(s): 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">On-line CPU(s) list: 0,1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Core(s) per socket: 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CPU family: 16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CPU MHz: 3013.536
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NUMA node0 CPU(s): 0,1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@localhost /]# free -h
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> total used free shared buff/cache available
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Mem: 777Mi 284Mi 78Mi 3.0Mi 413Mi 358Mi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Swap: 2.0Gi 8.0Mi 2.0Gi
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@localhost /]#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h3 id="数据库">数据库
&lt;/h3>&lt;p>跳过此项，使用sqlite&lt;/p>
&lt;h3 id="安装git">安装git
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>检查是否安装Git，如发现已安装，检查版本是否满足环境要求所需版本&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@localhost ~]# git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-bash: git: command not found
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>安装git&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">dnf update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dnf install git -y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@localhost ~]# git --version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git version 2.43.5
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="ssh服务器">SSH服务器
&lt;/h3>&lt;p>该版本已安装ssh服务，可远程ssh登陆（不懂是之前手动安装的还是系统自带的，不重要）&lt;/p>
&lt;h2 id="安装必要工具和依赖">安装必要工具和依赖
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@localhost ~]# tar --version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tar (GNU tar) 1.30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Copyright (C) 2017 Free Software Foundation, Inc.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">License GPLv3+: GNU GPL version 3 or later &amp;lt;https://gnu.org/licenses/gpl.html&amp;gt;.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">This is free software: you are free to change and redistribute it.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">There is NO WARRANTY, to the extent permitted by law.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Written by John Gilmore and Jay Fenlason.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@localhost ~]# wget --version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GNU Wget 1.19.5 built on linux-gnu.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>经过检查，系统已安装tar和wget，如未安装，使用如下命令安装&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">dnf install wget tar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>##　下载Gogs二进制源码&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;code>/opt &lt;/code>路径下创建Gogs目录，用于存放源码文件&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">cd /opt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir Gogs_0.13.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@localhost opt]# ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x. 2 root root 6 Sep 17 05:14 Gogs_0.13.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@localhost opt]#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>wget下载二进制源码（当前日期20240917最新github release 版本）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">wget&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">github&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">gogs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">gogs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">releases&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">download&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">v0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">13.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">gogs_0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">13.0&lt;/span>&lt;span class="n">_linux_amd64&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tar&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">gz&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 发现从github下载速度慢，从官网 https://dl.gogs.io/0.13.0/ 下载&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">wget&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">dl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">gogs&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">0.13&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">gogs_0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">13.0&lt;/span>&lt;span class="n">_linux_amd64&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tar&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">gz&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">localhost&lt;/span> &lt;span class="n">Gogs_0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">13.0&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># ll&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">total&lt;/span> &lt;span class="mi">29352&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span>&lt;span class="n">rw&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="o">--&lt;/span>&lt;span class="n">r&lt;/span>&lt;span class="o">--.&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">root&lt;/span> &lt;span class="n">root&lt;/span> &lt;span class="mi">30054955&lt;/span> &lt;span class="n">Feb&lt;/span> &lt;span class="mi">25&lt;/span> &lt;span class="mi">2023&lt;/span> &lt;span class="n">gogs_0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">13.0&lt;/span>&lt;span class="n">_linux_amd64&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tar&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">gz&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">root&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">localhost&lt;/span> &lt;span class="n">Gogs_0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">13.0&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="c1"># &lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="解压下载的-tar-包">解压下载的 tar 包
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@localhost Gogs_0.13.0]# tar -xzf gogs_0.13.0_linux_amd64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@localhost Gogs_0.13.0]# ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total 29352
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x. 3 1000 1000 85 Feb 25 2023 gogs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r--. 1 root root 30054955 Feb 25 2023 gogs_0.13.0_linux_amd64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@localhost Gogs_0.13.0]#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="运行gogs">运行Gogs
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>防火墙设置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 确保允许访问 Gogs 使用的端口（默认是 3000）,主要使用物理机访问使用，且我这Rocky8.7没安装图形界面，所以……&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">firewall&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cmd&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">permanent&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">port&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">3000&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tcp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">firewall&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cmd&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">reload&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 修改实际使用的端口号，下一步骤中修改30000，当然使用3000也是可以的&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">firewall&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cmd&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">permanent&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">port&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">30000&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">tcp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">firewall&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cmd&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">reload&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>使用命令 &lt;code>cd&lt;/code> 进入到解压后的目录。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>执行命令 &lt;code>./gogs web&lt;/code>。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Gogs 默认会在端口 &lt;code>3000&lt;/code> 启动 HTTP 服务，访问 &lt;code>/install&lt;/code> 以进行初始配置（例如 http://localhost:3000/install ）。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@localhost gogs]# ./gogs web
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024/09/17 05:44:24 [ WARN] Custom config &amp;#34;/opt/Gogs_0.13.0/gogs/custom/conf/app.ini&amp;#34; not found. Ignore this warning if you&amp;#39;re running for the first time
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024/09/17 05:44:24 [TRACE] Log mode: Console (Trace)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024/09/17 05:44:24 [ INFO] Gogs 0.13.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024/09/17 05:44:24 [TRACE] Work directory: /opt/Gogs_0.13.0/gogs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024/09/17 05:44:24 [TRACE] Custom path: /opt/Gogs_0.13.0/gogs/custom
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024/09/17 05:44:24 [TRACE] Custom config: /opt/Gogs_0.13.0/gogs/custom/conf/app.ini
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024/09/17 05:44:24 [TRACE] Log path: /opt/Gogs_0.13.0/gogs/log
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024/09/17 05:44:24 [TRACE] Build time: 2023-02-25 02:30:34 UTC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024/09/17 05:44:24 [TRACE] Build commit: 8c21874c00b6100d46b662f65baeb40647442f42
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024/09/17 05:44:24 [ INFO] Run mode: Development
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024/09/17 05:44:24 [ INFO] Available on http://localhost:3000/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="从外部访问虚拟机中gogs">从外部访问虚拟机中Gogs
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>访问 &lt;code>/install&lt;/code> 以进行初始配置（例如 &lt;a class="link" href="http://172.31.100.xx:3000/install" target="_blank" rel="noopener"
>http://172.31.100.xx:3000/install
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a> ）,可以自由发挥（以下是我的配置）&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/09/18/13LyVlzKSFjtUbD.jpg">
&lt;img src="https://s2.loli.net/2024/09/18/13LyVlzKSFjtUbD.jpg"
loading="lazy"
alt="ScreenCaputure3638"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/09/18/LU64HDirj9aOnk3.jpg">
&lt;img src="https://s2.loli.net/2024/09/18/LU64HDirj9aOnk3.jpg"
loading="lazy"
alt="ScreenCaputure4848"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>&lt;strong>上面配置中邮件服务留空了，本地没有邮件服务器，也不想联网&lt;/strong>&lt;/p>
&lt;p>&lt;strong>上面配置中的创建管理员用户可以不设置，第一个注册的用户自动成为管理员，我在此处截胡了&lt;/strong>&lt;/p>
&lt;p>&lt;strong>没有邮件服务，引起的问题：用户不能通过邮箱找回密码，需要管理员用户重置&lt;/strong>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>重启Gogs，进行登陆&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/09/18/eSBrWzUCOPcDopT.jpg">
&lt;img src="https://s2.loli.net/2024/09/18/eSBrWzUCOPcDopT.jpg"
loading="lazy"
alt="ScreenCaputure5350"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/09/18/NIqsjCHUPJogcSD.jpg">
&lt;img src="https://s2.loli.net/2024/09/18/NIqsjCHUPJogcSD.jpg"
loading="lazy"
alt="ScreenCaputure5446"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>中文显示&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/09/18/sEQJU2wPd1XWI7C.jpg">
&lt;img src="https://s2.loli.net/2024/09/18/sEQJU2wPd1XWI7C.jpg"
loading="lazy"
alt="ScreenCaputure5638"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/09/18/Dg6ETvwxOZFCHMt.jpg">
&lt;img src="https://s2.loli.net/2024/09/18/Dg6ETvwxOZFCHMt.jpg"
loading="lazy"
alt="ScreenCaputure5824"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="设置-gogs-服务开机启动">设置 Gogs 服务开机启动
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>将&lt;code>/opt/Gogs_0.13.0/gogs/scripts/systemd&lt;/code>路径下的&lt;code>gogs.service&lt;/code>文件复制到&lt;code>/etc/systemd/system &lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@localhost systemd]# cp gogs.service /etc/systemd/system
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>修改&lt;code>/etc/systemd/system&lt;/code>路径下的&lt;code>gogs.service&lt;/code>文件&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[Unit]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Description=Gogs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">After=syslog.target
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">After=network.target
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># After=mariadb.service mysql.service mysqld.service postgresql.service memcached.service $
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[Service]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Modify these two values and uncomment them if you have
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># repos with lots of files and get an HTTP error 500 because
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># of that
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">###
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#LimitMEMLOCK=infinity
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#LimitNOFILE=65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type=simple
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">User=root
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Group=root
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WorkingDirectory=/opt/Gogs_0.13.0/gogs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ExecStart=/opt/Gogs_0.13.0/gogs/gogs web
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Restart=always
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Environment=USER=git HOME=/home/root
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Some distributions may not support these hardening directives. If you cannot start the s$
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># to an unknown option, comment out the ones not supported by your version of systemd.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ProtectSystem=full
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PrivateDevices=yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PrivateTmp=yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NoNewPrivileges=true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[Install]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WantedBy=multi-user.target
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>重新加载 systemd 配置并启动 Gogs 服务&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">systemctl&lt;/span> &lt;span class="n">daemon&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">reload&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">systemctl&lt;/span> &lt;span class="n">start&lt;/span> &lt;span class="n">gogs&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">systemctl&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="n">gogs&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="外部仓库克隆测试">外部仓库克隆测试
&lt;/h2>&lt;p>以https方式 git clone 一个仓库至本地，（github把https方式克隆仓库给ban了，现在都需要验证，去gitee克隆）&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/09/18/QbcJGNxt2U7wBDA.jpg">
&lt;img src="https://s2.loli.net/2024/09/18/QbcJGNxt2U7wBDA.jpg"
loading="lazy"
alt="ScreenCaputure0823"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/09/18/goN6IM5VJCRDSL1.jpg">
&lt;img src="https://s2.loli.net/2024/09/18/goN6IM5VJCRDSL1.jpg"
loading="lazy"
alt="ScreenCaputure0907"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="再次进行初始化">再次进行初始化
&lt;/h2>&lt;p>种种原因可能需要再次进行初始化（比如修改数据库，更改管理员等）&lt;/p>
&lt;ol>
&lt;li>
&lt;p>删除/root/gogs-repositories 目录&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@localhost ~]# rm -rf gogs-repositories/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>删除/opt/Gogs_0.13.0/gogs 目录&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@localhost Gogs_0.13.0]# rm -rf gogs
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>再次解压，运行Gogs&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@localhost gogs]# ./gogs web
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024/09/17 12:12:01 [ WARN] Custom config &amp;#34;/opt/Gogs_0.13.0/gogs/custom/conf/app.ini&amp;#34; not found. Ignore this warning if you&amp;#39;re running for the first time
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024/09/17 12:12:01 [TRACE] Log mode: Console (Trace)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024/09/17 12:12:01 [ INFO] Gogs 0.13.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024/09/17 12:12:01 [TRACE] Work directory: /opt/Gogs_0.13.0/gogs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024/09/17 12:12:01 [TRACE] Custom path: /opt/Gogs_0.13.0/gogs/custom
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024/09/17 12:12:01 [TRACE] Custom config: /opt/Gogs_0.13.0/gogs/custom/conf/app.ini
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024/09/17 12:12:01 [TRACE] Log path: /opt/Gogs_0.13.0/gogs/log
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024/09/17 12:12:01 [TRACE] Build time: 2023-02-25 02:30:34 UTC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024/09/17 12:12:01 [TRACE] Build commit: 8c21874c00b6100d46b662f65baeb40647442f42
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024/09/17 12:12:01 [ INFO] Run mode: Development
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024/09/17 12:12:01 [ INFO] Available on http://localhost:3000/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024/09/17 12:12:01 [FATAL] [gogs.io/gogs/internal/cmd/web.go:776 runWeb()] Failed to start server: listen tcp 0.0.0.0:3000: bind: address already in use
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@localhost gogs]#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>提示端口已经在使用，关闭进程或重启系统解决&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 查找进程ID，终止进程
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@localhost gogs]# lsof -i :3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gogs 1543 root 10u IPv6 29519 0t0 TCP *:hbci (LISTEN)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@localhost gogs]# kill 1543
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@localhost gogs]# lsof -i :3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@localhost gogs]#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol></description></item><item><title>2022-2023华为ICT大赛（全国）实验题研究</title><link>https://weeaster.github.io/posts/8f2ea734/</link><pubDate>Wed, 24 Jul 2024 16:16:07 +0000</pubDate><guid>https://weeaster.github.io/posts/8f2ea734/</guid><description>&lt;p>上一篇文整了个大阵仗（内容太多，浏览器好像有些受不了）&lt;/p>
&lt;p>经过在搜索引擎遨游，最终发现这些题其实在华为的ICT学院课程网站上有&lt;/p>
&lt;p>&lt;a class="link" href="https://talent.shixizhi.huawei.com" target="_blank" rel="noopener"
>https://talent.shixizhi.huawei.com
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a> &amp;ndash;&amp;raquo; 搜索ICT &amp;ndash;&amp;raquo; 华为ICT大赛 - 网络赛道学习空间（中国区）&lt;/p>
&lt;p>还有其他内容，有兴趣可以点击看看&lt;/p>
&lt;p>本次研究研究，搓一搓的图如标题所示&lt;/p>
&lt;p>文章末尾，附上ensp拓扑文件和配置导出文件&lt;/p>
&lt;h2 id="说明">说明
&lt;/h2>&lt;ul>
&lt;li>ensp版本：1.3.00.100 V100R003C00SPC100&lt;/li>
&lt;li>电脑：Win10 ltsc （CPU：不配拥有名称，RAM=16GB）&lt;/li>
&lt;li>我电脑跑这图是真的卡&lt;/li>
&lt;li>遇到FW启动错误代码40，建议先启动FW，再启动其他设备&lt;/li>
&lt;li>AR路由器我整不出G0/0/3接口，使用G3/0/0代替&lt;/li>
&lt;/ul>
&lt;h2 id="实验拓扑">实验拓扑
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/24/n4ubkLNCS3E2PXa.jpg">
&lt;img src="https://s2.loli.net/2024/07/24/n4ubkLNCS3E2PXa.jpg"
loading="lazy"
alt="ENSP拓扑"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="配置">配置
&lt;/h2>&lt;h3 id="任务1vlan">任务1：VLAN
&lt;/h3>&lt;ul>
&lt;li>按照给出的表格数据配置对应设备的vlan、Trunk、Access&lt;/li>
&lt;li>路由器接口注意配置子接口dot1q termination vid xx ，arp broadcast enable&lt;/li>
&lt;li>防火墙接口注意配置 vlan-type dot1q xx&lt;/li>
&lt;/ul>
&lt;h3 id="任务2ip地址">任务2：IP地址
&lt;/h3>&lt;ul>
&lt;li>按照给出的表格数据配置对应设备的IP地址&lt;/li>
&lt;/ul>
&lt;h3 id="任务3mstp配置">任务3：MSTP配置
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>SW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stp mode mstp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stp region-configuration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> region-name RG1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> instance 1 vlan 2 to 9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> instance 2 vlan 10 to 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> active region-configuration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> stp edged-port enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> stp edged-port enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>SW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stp mode mstp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stp region-configuration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> region-name RG1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> instance 1 vlan 2 to 9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> instance 2 vlan 10 to 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> active region-configuration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stp instance 1 priority 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stp instance 2 priority 4096
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> stp root-protection
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> stp disable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>SW3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stp mode mstp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stp region-configuration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> region-name RG1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> instance 1 vlan 2 to 9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> instance 2 vlan 10 to 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> active region-configuration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stp instance 1 priority 4096
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stp instance 2 priority 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> stp edged-port enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> stp root-protection
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> stp disable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>验证: dis stp&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="任务4防火墙安全域配置">任务4：防火墙安全域配置
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>FW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/5.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/5.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/3.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone dmz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/5.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/5.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/3.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone dmz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>验证：dis zone interface&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="任务5防火墙vrrp双机热备和安全策略配置">任务5：防火墙VRRP、双机热备和安全策略配置
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>FW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/5.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 1 virtual-ip 192.168.1.254 active
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/5.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 2 virtual-ip 192.168.2.254 standby
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hrp enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hrp interface GigabitEthernet1/0/1 remote 15.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hrp mirror session enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">security-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name web
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 192.168.1.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 100.1.1.1 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service protocol tcp destination-port 8080
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name Wireless
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 192.168.2.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/5.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 1 virtual-ip 192.168.1.254 standby
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/5.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 2 virtual-ip 192.168.2.254 active
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hrp enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hrp interface GigabitEthernet1/0/1 remote 15.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hrp mirror session enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 配置hrp后，安全策略配置从HRP_M[FW1]同步，不能在HRP_S[FW2]配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nat server 0 protocol tcp global 100.1.1.1 8080 inside 172.16.1.1 www
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">security-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name web
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 172.16.1.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service http
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>验证&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="任务6公网静态路由配置">任务6：公网静态路由配置
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>FW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 10.2.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 100.1.1.1 255.255.255.255 10.2.2.2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 10.3.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 100.1.1.1 255.255.255.255 10.3.2.2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 20.1.3.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 100.1.1.1 255.255.255.255 NULL0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>PE1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ip route-static 192.168.2.0 255.255.255.0 10.2.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 192.168.2.0 255.255.255.0 10.3.1.1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h3 id="任务7公网动态路由配置">任务7：公网动态路由配置
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>PE1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">isis 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> is-level level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network-entity 01.0000.0010.0100.1001.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> domain-authentication-mode md5 cipher ICTEXAM
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 1.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2.2.2.2 as-number 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2.2.2.2 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>PE2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">isis 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> is-level level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network-entity 01.0000.0020.0200.2002.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> domain-authentication-mode md5 cipher ICTEXAM
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 3.3.3.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2.2.2.2 as-number 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2.2.2.2 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 20.1.4.2 as-number 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>P&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">isis 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> is-level level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network-entity 01.0000.0030.0300.3003.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> domain-authentication-mode md5 cipher ICTEXAM
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 2.2.2.2 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 2.2.2.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> group ibgpv4 internal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.1 as-number 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.1 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 3.3.3.3 as-number 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 3.3.3.3 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 reflect-client
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.1 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 3.3.3.3 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>Internet&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 16.16.16.16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 20.1.4.1 as-number 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 16.16.16.16 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default-route-advertise
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> area 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 30.1.1.1 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ospf network-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>DC-GW&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ospf network-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ospf 100 router-id 11.11.11.11
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> area 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 11.11.11.11 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 30.1.1.2 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 30.1.2.1 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 30.1.3.1 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>Leaf1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ospf 100 router-id 12.12.12.12
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> area 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 12.12.12.12 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 30.1.2.2 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.1.254 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>Leaf2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ospf 100 router-id 13.13.13.13
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> area 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 13.13.13.13 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 30.1.3.2 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>验证&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="任务8mpls-vpn">任务8：MPLS VPN
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>PE1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> import-route static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family vpnv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2.2.2.2 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls lsr-id 1.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance ToDC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> route-distinguisher 100:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn-target 200:1 both
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance ToDC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.2.2.2 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet3/0/0.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance ToDC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.3.2.2 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static vpn-instance ToDC 192.168.0.0 255.255.0.0 10.2.2.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static vpn-instance ToDC 192.168.0.0 255.255.0.0 10.3.2.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family vpn-instance ToDC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> import-route static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>PE2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2.2.2.2 next-hop-local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family vpnv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2.2.2.2 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls lsr-id 3.3.3.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance ToDC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> route-distinguisher 100:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn-target 200:1 both
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance ToDC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 20.1.3.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family vpn-instance ToDC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 20.1.3.2 as-number 300
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>P&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family vpnv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> undo policy vpn-target
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 reflect-client
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.1 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 3.3.3.3 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls lsr-id 2.2.2.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 300
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 20.1.3.1 as-number 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> import-route static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis bgp vpnv4 all peer&lt;/p>
&lt;/li>
&lt;li>
&lt;p>dis mpls ldp int&lt;/p>
&lt;/li>
&lt;li>
&lt;p>dis mpls ldp peer&lt;/p>
&lt;/li>
&lt;li>
&lt;p>dis ip vpn-instance verbose&lt;/p>
&lt;/li>
&lt;li>
&lt;p>dis bgp vpnv4 all routing-table&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="任务9gre">任务9：GRE
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>Leaf1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 173.1.2.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel-protocol gre
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source 12.12.12.12
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination 13.13.13.13
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 172.16.2.0 255.255.255.0 173.1.2.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>Leaf2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 173.1.2.2 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel-protocol gre
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source 13.13.13.13
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination 12.12.12.12
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 172.16.3.0 255.255.255.0 173.1.2.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h3 id="任务10wlan">任务10：WLAN
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>FW1/FW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/5.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service-manage ping permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/5.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service-manage ping permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AC&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vlan batch 19 to 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dhcp enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip pool For_AP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gateway-list 192.168.19.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 192.168.19.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip pool STA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gateway-list 192.168.2.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 192.168.2.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> excluded-ip-address 192.168.2.1 192.168.2.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlanif19
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.19.254 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp select global
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlanif20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.2.1 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp select global
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">capwap source interface vlanif19
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wlan
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security-profile name s1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security wpa-wpa2 psk pass-phrase Huawei@123 aes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssid-profile name s1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssid ICT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vap-profile name p1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> forward-mode tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service-vlan vlan-id 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssid-profile s1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security-profile s1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-group name default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> radio 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vap-profile p1 wlan 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-id 1 type-id 56 ap-mac 00e0-fcef-0250 ap-sn 2102354483100961AE61
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-group default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="综合测试">综合测试
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>Web-Client访问Web-Server&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/24/bpNLtzCIxgWQ4S9.png">
&lt;img src="https://s2.loli.net/2024/07/24/bpNLtzCIxgWQ4S9.png"
loading="lazy"
alt="image-20240724115158242"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>FW3查看会话&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;FW3&amp;gt;dis firewall session table verbose
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024-07-24 03:54:01.520
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Current Total Sessions : 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> http VPN: public --&amp;gt; public ID: c487fdedb993138324f66a07acf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Zone: untrust --&amp;gt; trust TTL: 00:00:10 Left: 00:00:05
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Recv Interface: GigabitEthernet1/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Interface: GigabitEthernet1/0/1 NextHop: 30.1.1.2 MAC: 00e0-fc45-0d43
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;--packets: 5 bytes: 515 --&amp;gt; packets: 6 bytes: 399
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 192.168.1.1:2050 --&amp;gt; 100.1.1.1:8080[172.16.1.1:80] PolicyName: web
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> TCP State: close
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp VPN: public --&amp;gt; public ID: c487fdedb99d128393566a074da
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Zone: untrust --&amp;gt; local TTL: 00:20:00 Left: 00:20:00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Recv Interface: GigabitEthernet1/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Interface: InLoopBack0 NextHop: 127.0.0.1 MAC: 0000-0000-0000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;--packets: 64 bytes: 3,158 --&amp;gt; packets: 68 bytes: 3,404
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 20.1.3.1:49928 --&amp;gt; 20.1.3.2:179 PolicyName: ---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> TCP State: established
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;FW3&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>VM1和VM2互相ping测试&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/24/mFkQPCidowfUa4I.png">
&lt;img src="https://s2.loli.net/2024/07/24/mFkQPCidowfUa4I.png"
loading="lazy"
alt="image-20240724120153111"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>无线客户端PC1 ping测试&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/24/H7yilKcuSU4jg69.png">
&lt;img src="https://s2.loli.net/2024/07/24/H7yilKcuSU4jg69.png"
loading="lazy"
alt="image-20240724120408833"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="最后">最后
&lt;/h2>&lt;ul>
&lt;li>个人觉得整个拓扑的就必上一篇文的规模小多了，量也没那么大，技术要点也不考察那么细致&lt;/li>
&lt;li>貌似模拟器的USG防火墙有bug，拓扑中FW3与PE2建立EBGP，FW3与DC-GW建立OSPF，均不用配置安全策略就能建立起邻居关系&lt;/li>
&lt;li>就不过多总结了，都在敲击键盘的过程中了&lt;/li>
&lt;li>把文中的配置复制粘贴进对应设备最终就能实现综合测试的结果&lt;/li>
&lt;li>……&lt;/li>
&lt;li>可能有更好的实现需求的配置答案（山外有山）&lt;/li>
&lt;li>文件存阿里云盘了，这是链接：[&lt;a class="link" href="https://www.alipan.com/s/6HwHnenuSqn" target="_blank" rel="noopener"
>分享的文件
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>]&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨。&lt;/li>
&lt;/ul></description></item><item><title>2021-2022华为ICT大赛（全球）实验题研究</title><link>https://weeaster.github.io/posts/e6429fe7/</link><pubDate>Fri, 19 Jul 2024 15:54:31 +0000</pubDate><guid>https://weeaster.github.io/posts/e6429fe7/</guid><description>&lt;p>在公众号【易联无界】看到文章 [&lt;a class="link" href="https://mp.weixin.qq.com/s/uMLXHcPn-ke4HpI7IddU-g" target="_blank" rel="noopener"
>华为2021-2022全球总决赛实验题
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>]&lt;/p>
&lt;p>研究研究，搓一搓&lt;/p>
&lt;p>文章很长，建议电脑端网页查看&lt;/p>
&lt;p>文章末尾，附上ensp拓扑文件和配置导出文件&lt;/p>
&lt;h2 id="说明">说明
&lt;/h2>&lt;ul>
&lt;li>ensp版本：1.3.00.100 V100R003C00SPC100&lt;/li>
&lt;li>电脑：Win10 ltsc （CPU：不配拥有名称，RAM=16GB）&lt;/li>
&lt;li>FW桥接网卡只是直观查看会话和状态&lt;/li>
&lt;li>我电脑跑这图是真的卡&lt;/li>
&lt;li>遇到FW启动错误代码40，建议先启动两台FW，再启动其他设备&lt;/li>
&lt;li>AR路由器我整不出G0/0/3接口，使用G3/0/0代替&lt;/li>
&lt;li>Video server 地址修改为100.1.100.2&lt;/li>
&lt;li>PC4手动配置IPv6地址 2001:200:1:200::254/64&lt;/li>
&lt;/ul>
&lt;h2 id="实验拓扑">实验拓扑
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/oPik8cpRV5KH2Fw.jpg">
&lt;img src="https://s2.loli.net/2024/07/19/oPik8cpRV5KH2Fw.jpg"
loading="lazy"
alt="ENSP拓扑图"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="需求分析和配置">需求分析和配置
&lt;/h2>&lt;h3 id="41-task-1-basic-data-configuration">4.1 Task 1: Basic Data Configuration
&lt;/h3>&lt;h4 id="411-configuring-vlans">4.1.1 Configuring VLANs
&lt;/h4>&lt;ul>
&lt;li>按照给出的表格数据配置对应设备的vlan、Trunk、Access&lt;/li>
&lt;li>路由器接口注意配置子接口dot1q termination vid xx ，arp broadcast enable&lt;/li>
&lt;li>防火墙接口注意配置 vlan-type dot1q xx&lt;/li>
&lt;/ul>
&lt;h4 id="412-configuring-ip-addresses">4.1.2 Configuring IP Addresses
&lt;/h4>&lt;ul>
&lt;li>按照给出的表格数据配置对应设备的IP地址、IPv6地址&lt;/li>
&lt;li>对于vrf接口和防火墙vsys接口，可先配置description描述&lt;/li>
&lt;li>配置必要的接口描述（后续配置静态路由时快速查看和检查）&lt;/li>
&lt;/ul>
&lt;h3 id="42-task-2-route-deployment-on-the-man">4.2 Task 2: Route Deployment on the MAN
&lt;/h3>&lt;h4 id="421-configuring-igp">4.2.1 Configuring IGP
&lt;/h4>&lt;ul>
&lt;li>配置IS-IS，进程号100，区域ID 86.0010，level-2路由器，系统ID的换算，直连不选举DIS&lt;/li>
&lt;li>配置接口cost，（设置cost-style wide）&lt;/li>
&lt;li>IS-IS收敛参数，spf计算参数，lsp 快速泛洪&lt;/li>
&lt;li>IS-IS hello md5认证&lt;/li>
&lt;li>IPv6 IS-IS，IPv6的IS-IS cost&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>AR1/AR2/AR3/AR4/CR1/CR2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 区域ID + 系统ID换算
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">AR1:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">network-entity 86.0010.0010.0100.1001.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">AR2:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">network-entity 86.0010.0010.0100.1002.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">AR3:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">network-entity 86.0010.0010.0100.1003.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">AR4:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">network-entity 86.0010.0010.0100.1004.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CR1:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">network-entity 86.0010.0010.0100.1005.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CR2:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">network-entity 86.0010.0010.0100.1006.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># AR1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bfd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">isis 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # level-2路由器
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> is-level level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # 设置IS-IS设备接收和发送路由的开销类型，默认narro的值范围为1-63，wide的值范围1-16777215
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> cost-style wide
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # IS-IS收敛参数
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timer lsp-generation 1 50 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # lsp 快速泛洪
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> flash-flood level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # bfd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bfd all-interfaces enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network-entity 86.0010.0010.0100.1001.00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # spf计算参数
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timer spf 1 20 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # IPv6拓扑类型
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable topology ipv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># loopback 0 接口运行isis
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 200 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 200 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 200 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 200 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 200 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 200 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR4&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 200 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 200 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>CR1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 300 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 300 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>CR2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 300 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 300 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 enable 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis circuit-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis authentication-mode md5 Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis ipv6 cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> isis cost 100 level-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>验证&lt;/p>
&lt;ul>
&lt;li>
&lt;p>dis ip routing-table protocol isis （配置完成6台路由器，查看路由表学到其他5台路由器的loopback0地址）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">AR1&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">dis&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">routing&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">table&lt;/span> &lt;span class="n">protocol&lt;/span> &lt;span class="n">isis&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Route&lt;/span> &lt;span class="n">Flags&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">relay&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">download&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">fib&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">------------------------------------------------------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Public&lt;/span> &lt;span class="n">routing&lt;/span> &lt;span class="n">table&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">ISIS&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Destinations&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">Routes&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ISIS&lt;/span> &lt;span class="n">routing&lt;/span> &lt;span class="n">table&lt;/span> &lt;span class="n">status&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Active&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Destinations&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">Routes&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Destination&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">Mask&lt;/span> &lt;span class="n">Proto&lt;/span> &lt;span class="n">Pre&lt;/span> &lt;span class="n">Cost&lt;/span> &lt;span class="n">Flags&lt;/span> &lt;span class="n">NextHop&lt;/span> &lt;span class="n">Interface&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">ISIS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">L2&lt;/span> &lt;span class="mi">15&lt;/span> &lt;span class="mi">200&lt;/span> &lt;span class="n">D&lt;/span> &lt;span class="mf">10.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">2.2&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.3&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">ISIS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">L2&lt;/span> &lt;span class="mi">15&lt;/span> &lt;span class="mi">200&lt;/span> &lt;span class="n">D&lt;/span> &lt;span class="mf">10.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">5.1&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">ISIS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">L2&lt;/span> &lt;span class="mi">15&lt;/span> &lt;span class="mi">400&lt;/span> &lt;span class="n">D&lt;/span> &lt;span class="mf">10.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">5.1&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">ISIS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">L2&lt;/span> &lt;span class="mi">15&lt;/span> &lt;span class="mi">100&lt;/span> &lt;span class="n">D&lt;/span> &lt;span class="mf">10.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">5.1&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.6&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">ISIS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">L2&lt;/span> &lt;span class="mi">15&lt;/span> &lt;span class="mi">300&lt;/span> &lt;span class="n">D&lt;/span> &lt;span class="mf">10.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">2.2&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ISIS&lt;/span> &lt;span class="n">routing&lt;/span> &lt;span class="n">table&lt;/span> &lt;span class="n">status&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Inactive&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Destinations&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">Routes&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">AR1&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis ipv routing-table protocol isis （IPv6）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;CR2&amp;gt;dis ipv routing-table protocol isis | i 2022::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Public Routing Table : ISIS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Summary Count : 11
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ISIS Routing Table&amp;#39;s Status : &amp;lt; Active &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Summary Count : 11
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Destination : 2022::1 PrefixLength : 128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Destination : 2022::2 PrefixLength : 128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Destination : 2022::3 PrefixLength : 128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Destination : 2022::4 PrefixLength : 128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Destination : 2022::5 PrefixLength : 128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ISIS Routing Table&amp;#39;s Status : &amp;lt; Inactive &amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Summary Count : 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;CR2&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="422-configuring-bgp">4.2.2 Configuring BGP
&lt;/h4>&lt;ul>
&lt;li>配置MAN IBGP，AS64812，CR1和CR2为RR反射器（v4,vpnv4,v6），使用对等体组命令，使用loopback0作为源&lt;/li>
&lt;li>配置与DataCenter的EBGP，AS62022，使用loopback0（EBGP多跳）（v4,v6），LSW1和LSW2配置指向CR1,CR2的默认路由（后边有配置静态路由的需求）&lt;/li>
&lt;li>配置CR1,CR2 的v4 EBGP邻居md5认证&lt;/li>
&lt;li>配置CR1,CR2路由阻尼dampening&lt;/li>
&lt;li>配置CR1和CR2条件通告默认路由到AR1-AR4&lt;/li>
&lt;li>配置AR1,和AR3优选下一跳CR1，AR2和AR4优选下一跳CR2&lt;/li>
&lt;li>配置BGP network组播源服务器网段&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>CR1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 1.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> group ibgpv4 internal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> group ibgpv6 internal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv6 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.1 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.2 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.3 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.4 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::1 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::2 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::3 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::4 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::6 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.8 as-number 62022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.8 ebgp-max-hop 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.8 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.8 password cipher Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::8 as-number 62022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::8 ebgp-max-hop 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::8 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reflector cluster-id 56.56.56.56
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dampening 10 2000 3000 10000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.1.100.0 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 reflect-client
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 next-hop-local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 default-route-advertise conditional-route-match-all 100.1.200.0 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> undo peer 1.1.1.6 default-route-advertise
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.8 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reflector cluster-id 56.56.56.56
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dampening 10 2000 3000 10000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::8 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv6 reflect-client
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv6 next-hop-local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::1 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::2 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::3 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::4 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::6 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family vpnv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reflector cluster-id 56.56.56.56
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> undo policy vpn-target
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 reflect-client
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.1 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.2 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.3 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.4 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 1.1.1.8 255.255.255.255 10.5.8.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 route-static 2022::8 128 2001:5:8::1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>CR2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 1.1.1.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> group ibgpv4 internal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> group ibgpv6 internal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv6 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.1 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.2 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.3 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.4 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::1 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::2 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::3 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::4 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::5 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.9 as-number 62022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.9 ebgp-max-hop 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.9 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.9 password cipher Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::9 as-number 62022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::9 ebgp-max-hop 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::9 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reflector cluster-id 56.56.56.56
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dampening 10 2000 3000 10000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.1.100.0 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 reflect-client
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 next-hop-local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 default-route-advertise conditional-route-match-all 100.1.200.0 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> undo peer 1.1.1.5 default-route-advertise
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.9 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reflector cluster-id 56.56.56.56
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dampening 10 2000 3000 10000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::9 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv6 reflect-client
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv6 next-hop-local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::1 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::2 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::3 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::4 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::5 group ibgpv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family vpnv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reflector cluster-id 56.56.56.56
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> undo policy vpn-target
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer ibgpv4 reflect-client
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.1 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.2 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.3 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.4 group ibgpv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 1.1.1.9 255.255.255.255 10.6.9.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 route-static 2022::9 128 2001:6:9::1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR1/AR2/AR3/AR4/，注意修改各路由器的router-id&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># AR1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 1.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 as-number 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 as-number 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::5 as-number 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::5 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::6 as-number 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::6 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 next-hop-local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 next-hop-local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::5 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::5 next-hop-local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::6 next-hop-local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family vpnv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> policy vpn-target
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR1/AR3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 preferred-value 2000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 preferred-value 1000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR2/AR4&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 preferred-value 1000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 preferred-value 2000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 10.5.8.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 route-static :: 0 2001:5:8::2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 62022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 1.1.1.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 as-number 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 ebgp-max-hop 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 password cipher Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::5 as-number 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::5 ebgp-max-hop 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::5 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::5 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 10.6.9.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 route-static :: 0 2001:6:9::2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 62022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 1.1.1.9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 as-number 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 ebgp-max-hop 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 password cipher Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::6 as-number 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::6 ebgp-max-hop 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::6 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 2022::6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>验证&lt;/p>
&lt;ul>
&lt;li>
&lt;p>dis bgp peer （IPv4peer）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;AR1&amp;gt;dis bgp peer
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> BGP local router ID : 1.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Local AS number : 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total number of peers : 2 Peers in established state : 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Peer V AS MsgRcvd MsgSent OutQ Up/Down State PrefRcv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1.1.1.5 4 64812 15 14 0 00:12:14 Established 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1.1.1.6 4 64812 15 14 0 00:12:14 Established 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;AR1&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis bgp ipv6 peer （IPv6 peer）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;AR2&amp;gt;dis bgp ipv6 peer
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> BGP local router ID : 1.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Local AS number : 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total number of peers : 2 Peers in established state : 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Peer V AS MsgRcvd MsgSent OutQ Up/Down State PrefRcv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2022::5 4 64812 12 12 0 00:10:23 Established 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2022::6 4 64812 12 12 0 00:10:22 Established 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;AR2&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis bgp vpnv4 all peer （vpnv4 peer）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;CR1&amp;gt;dis bgp vpnv4 all peer
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> BGP local router ID : 1.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Local AS number : 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total number of peers : 4 Peers in established state : 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Peer V AS MsgRcvd MsgSent OutQ Up/Down State PrefRcv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1.1.1.1 4 64812 21 23 0 00:19:24 Established 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1.1.1.2 4 64812 19 21 0 00:17:19 Established 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1.1.1.3 4 64812 19 21 0 00:17:52 Established 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1.1.1.4 4 64812 18 20 0 00:16:52 Established 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;CR1&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis bgp routing-table&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;AR4&amp;gt;dis bgp routing-table
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> BGP Local router ID is 1.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Status codes: * - valid, &amp;gt; - best, d - damped,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> h - history, i - internal, s - suppressed, S - Stale
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Origin : i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total Number of Routes: 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network NextHop MED LocPrf PrefVal Path/Ogn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 100.1.100.0/30 1.1.1.5 0 100 2000 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * i 1.1.1.5 0 100 1000 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;AR4&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis bgp routing-table 100.1.100.0&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;AR4&amp;gt;dis bgp routing-table 100.1.100.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> BGP local router ID : 1.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Local AS number : 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Paths: 2 available, 1 best, 1 select
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> BGP routing table entry information of 100.1.100.0/30:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> From: 1.1.1.6 (1.1.1.6)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Route Duration: 00h03m40s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Relay IP Nexthop: 10.3.4.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Relay IP Out-Interface: GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Original nexthop: 1.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Qos information : 0x0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> AS-path Nil, origin igp, MED 0, localpref 100, pref-val 2000, valid, internal, best, select, active, pre 255, IGP cost 300
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Originator: 1.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Cluster list: 56.56.56.56
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Not advertised to any peer yet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> BGP routing table entry information of 100.1.100.0/30:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> From: 1.1.1.5 (1.1.1.5)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Route Duration: 00h03m40s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Relay IP Nexthop: 10.3.4.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Relay IP Out-Interface: GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Original nexthop: 1.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Qos information : 0x0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> AS-path Nil, origin igp, MED 0, localpref 100, pref-val 1000, valid, internal, pre 255, IGP cost 300, not preferred for PreVal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Not advertised to any peer yet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;AR4&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="43-task-3-data-center-internet-service-deployment">4.3 Task 3: Data Center Internet Service Deployment
&lt;/h3>&lt;h4 id="431-connecting-the-web-server-to-the-network">4.3.1 Connecting the Web Server to the Network
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>配置LSW1,LSW2的eth-trunk 12，静态lacp，src-mac 负载均衡&lt;/p>
&lt;/li>
&lt;li>
&lt;p>创建vrf intvpn，不传vpnv4用不到RD和RT&lt;/p>
&lt;/li>
&lt;li>
&lt;p>vlan200,下配置vrrp，vrid 2，virtual-ip 192.168.200.1/24，LSW2为master，优先级120，抢占延迟20s，track接口G0/0/2状态，失效优先级减21成为backup&lt;/p>
&lt;/li>
&lt;li>
&lt;p>配置nqa探测，LSW1-CR1,LSW2-CR2，类型icmp，5s间隔周期探测时间，&lt;/p>
&lt;/li>
&lt;li>
&lt;p>配置出向静态路由，backup路由优先级90，看示意图，LSW1-CR1，LSW2-CR2 的默认路由track nqa，配置默认路由备份路由指向 LSW1 LSW2&lt;/p>
&lt;/li>
&lt;li>
&lt;p>配置入向静态路由，看示意图&lt;/p>
&lt;/li>
&lt;li>
&lt;p>FW1配置安全策略，看示意图&lt;/p>
&lt;/li>
&lt;li>
&lt;p>FW1配置NAT映射，策略包含80端口，放行icmp&lt;/p>
&lt;/li>
&lt;li>
&lt;p>LSW1和LSW2之间的备份路由在出口全部宕机的情况下的环路处理&lt;/p>
&lt;/li>
&lt;li>
&lt;p>BGP network （web服务器公网映射网段路由）&lt;/p>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>LSW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">undo&lt;/span> &lt;span class="n">eth&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">trunk&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">undo&lt;/span> &lt;span class="n">eth&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">trunk&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Eth&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Trunk12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">lacp&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">load&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">balance&lt;/span> &lt;span class="n">src&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mac&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">eth&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">trunk&lt;/span> &lt;span class="mi">12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">eth&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">trunk&lt;/span> &lt;span class="mi">12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">vpn&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">intvpn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ipv4&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">family&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Vlanif200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">VPN&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">intvpn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">binding&lt;/span> &lt;span class="n">vpn&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">intvpn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">200.8&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">vrrp&lt;/span> &lt;span class="n">vrid&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">virtual&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ip&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">200.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">vrrp&lt;/span> &lt;span class="n">vrid&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">preempt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mode&lt;/span> &lt;span class="n">timer&lt;/span> &lt;span class="n">delay&lt;/span> &lt;span class="mi">20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Vlanif30&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">VPN&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">intvpn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">binding&lt;/span> &lt;span class="n">vpn&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">intvpn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">3.1&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nqa&lt;/span> &lt;span class="n">test&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">toCR&lt;/span> &lt;span class="n">toCR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">test&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">icmp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">destination&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">address&lt;/span> &lt;span class="n">ipv4&lt;/span> &lt;span class="mf">10.5&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">frequency&lt;/span> &lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">interval&lt;/span> &lt;span class="n">seconds&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">probe&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">count&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">start&lt;/span> &lt;span class="n">now&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">10.5&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.2&lt;/span> &lt;span class="n">track&lt;/span> &lt;span class="n">nqa&lt;/span> &lt;span class="n">toCR&lt;/span> &lt;span class="n">toCR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">9.2&lt;/span> &lt;span class="n">preference&lt;/span> &lt;span class="mi">90&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">100.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">200.0&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.0&lt;/span> &lt;span class="mf">100.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">4.2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="n">vpn&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">intvpn&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">3.2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bgp&lt;/span> &lt;span class="mi">62022&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ipv4&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">family&lt;/span> &lt;span class="n">unicast&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">network&lt;/span> &lt;span class="mf">100.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">200.0&lt;/span> &lt;span class="mi">24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 阻止LSW1-LSW2备份路由形成的环路&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nqa&lt;/span> &lt;span class="n">test&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">PREVENT_LOOP&lt;/span> &lt;span class="n">PREVENT_LOOP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">test&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">icmp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">destination&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">address&lt;/span> &lt;span class="n">ipv4&lt;/span> &lt;span class="mf">10.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">9.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">frequency&lt;/span> &lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">interval&lt;/span> &lt;span class="n">seconds&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">probe&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">count&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">start&lt;/span> &lt;span class="n">now&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">10.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">9.1&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.255&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">9.2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">9.2&lt;/span> &lt;span class="n">preference&lt;/span> &lt;span class="mi">90&lt;/span> &lt;span class="n">track&lt;/span> &lt;span class="n">nqa&lt;/span> &lt;span class="n">PREVENT_LOOP&lt;/span> &lt;span class="n">PREVENT_LOOP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">undo&lt;/span> &lt;span class="n">eth&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">trunk&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">undo&lt;/span> &lt;span class="n">eth&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">trunk&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Eth&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Trunk12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">port&lt;/span> &lt;span class="n">link&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">trunk&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">port&lt;/span> &lt;span class="n">trunk&lt;/span> &lt;span class="n">allow&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">pass&lt;/span> &lt;span class="n">vlan&lt;/span> &lt;span class="mi">90&lt;/span> &lt;span class="mi">100&lt;/span> &lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">mode&lt;/span> &lt;span class="n">lacp&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">load&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">balance&lt;/span> &lt;span class="n">src&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mac&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">eth&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">trunk&lt;/span> &lt;span class="mi">12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">eth&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">trunk&lt;/span> &lt;span class="mi">12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">vpn&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">intvpn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ipv4&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">family&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Vlanif200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">VPN&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">intvpn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">binding&lt;/span> &lt;span class="n">vpn&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">intvpn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">200.9&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">vrrp&lt;/span> &lt;span class="n">vrid&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">virtual&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ip&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">200.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">vrrp&lt;/span> &lt;span class="n">vrid&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">priority&lt;/span> &lt;span class="mi">120&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">vrrp&lt;/span> &lt;span class="n">vrid&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">preempt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mode&lt;/span> &lt;span class="n">timer&lt;/span> &lt;span class="n">delay&lt;/span> &lt;span class="mi">20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">vrrp&lt;/span> &lt;span class="n">vrid&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">track&lt;/span> &lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="n">reduced&lt;/span> &lt;span class="mi">21&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Vlanif30&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">VPN&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">intvpn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">binding&lt;/span> &lt;span class="n">vpn&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">intvpn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">30.1&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nqa&lt;/span> &lt;span class="n">test&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">toCR&lt;/span> &lt;span class="n">toCR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">test&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">icmp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">destination&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">address&lt;/span> &lt;span class="n">ipv4&lt;/span> &lt;span class="mf">10.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">9.2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">frequency&lt;/span> &lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">interval&lt;/span> &lt;span class="n">seconds&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">probe&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">count&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">start&lt;/span> &lt;span class="n">now&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">10.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">9.2&lt;/span> &lt;span class="n">track&lt;/span> &lt;span class="n">nqa&lt;/span> &lt;span class="n">toCR&lt;/span> &lt;span class="n">toCR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">9.1&lt;/span> &lt;span class="n">preference&lt;/span> &lt;span class="mi">90&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">100.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">200.0&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.0&lt;/span> &lt;span class="mf">100.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">40.2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="n">vpn&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">intvpn&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">30.2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bgp&lt;/span> &lt;span class="mi">62022&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ipv4&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">family&lt;/span> &lt;span class="n">unicast&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">network&lt;/span> &lt;span class="mf">100.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">200.0&lt;/span> &lt;span class="mi">24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 阻止LSW1-LSW2备份路由形成的环路&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nqa&lt;/span> &lt;span class="n">test&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">PREVENT_LOOP&lt;/span> &lt;span class="n">PREVENT_LOOP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">test&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">icmp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">destination&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">address&lt;/span> &lt;span class="n">ipv4&lt;/span> &lt;span class="mf">10.5&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">frequency&lt;/span> &lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">interval&lt;/span> &lt;span class="n">seconds&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">timeout&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">probe&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">count&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">start&lt;/span> &lt;span class="n">now&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">10.5&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.1&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.255&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">9.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">9.1&lt;/span> &lt;span class="n">preference&lt;/span> &lt;span class="mi">90&lt;/span> &lt;span class="n">track&lt;/span> &lt;span class="n">nqa&lt;/span> &lt;span class="n">PREVENT_LOOP&lt;/span> &lt;span class="n">PREVENT_LOOP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 100.1.40.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 100.1.4.1 preference 90
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 192.168.200.0 255.255.255.0 192.168.30.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 192.168.200.0 255.255.255.0 192.168.3.1 preference 90
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/1.40
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/2.40
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone dmz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/1.30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/2.30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">security-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name untrust2dmz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone dmz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 192.168.200.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nat server web_server protocol tcp global 100.1.200.254 www inside 192.168.200.254 www
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nat server icmp_server protocol icmp global 100.1.200.254 inside 192.168.200.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR4&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 200.1.200.0 24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>PC4 ping测试和Http Client 测试&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/qFvnT38SRItHifa.png">
&lt;img src="https://s2.loli.net/2024/07/19/qFvnT38SRItHifa.png"
loading="lazy"
alt="image-004420171"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="432-connecting-the-simulated-ipv6-servers-to-the-network">4.3.2 Connecting the Simulated IPv6 Servers to the Network
&lt;/h4>&lt;ul>
&lt;li>LSW1和LSW2创建loopback1，配置IPv6地址&lt;/li>
&lt;li>配置ospfv3，进程号200，vlanif90 建立邻居，改网络类型不选DR&lt;/li>
&lt;li>BGP 仅 import 两loopback1 IPv6地址，挂上route-map ，prefix配置&lt;/li>
&lt;li>配置路由聚合，112掩码&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>LSW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ospfv3 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 1.1.1.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface LoopBack1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address 2001:100:1:200::8/128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ospfv3 200 area 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlanif90
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ospfv3 200 area 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ospfv3 network-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip ipv6-prefix V6_SERVER permit 2001:100:1:200::8 128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip ipv6-prefix V6_SERVER permit 2001:100:1:200::9 128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-policy V6_SERVER permit node 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if-match ipv6 address prefix-list V6_SERVER
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 62022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> aggregate 2001:100:1:200:: 112 detail-suppressed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> import-route ospfv3 200 route-policy V6_SERVER
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ospfv3 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 1.1.1.9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface LoopBack1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address 2001:100:1:200::9/128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ospfv3 200 area 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlanif90
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ospfv3 200 area 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ospfv3 network-type p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip ipv6-prefix V6_SERVER permit 2001:100:1:200::8 128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip ipv6-prefix V6_SERVER permit 2001:100:1:200::9 128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-policy V6_SERVER permit node 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if-match ipv6 address prefix-list V6_SERVER
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 62022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> aggregate 2001:100:1:200:: 112 detail-suppressed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> import-route ospfv3 200 route-policy V6_SERVER
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR4&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 2001:200:1:200:: 64
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>PC4 配置IPv6地址-2001:200:1:200::254/64； IPv6网关-2001:200:1:200::1&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/RxG8AWwrXqpVNtT.png">
&lt;img src="https://s2.loli.net/2024/07/19/RxG8AWwrXqpVNtT.png"
loading="lazy"
alt="image-140018166"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>PC4 ping测试&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/HqWUsa9yk1YZtfu.png">
&lt;img src="https://s2.loli.net/2024/07/19/HqWUsa9yk1YZtfu.png"
loading="lazy"
alt="image-013227537"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/kib3dspezqgWt1c.png">
&lt;img src="https://s2.loli.net/2024/07/19/kib3dspezqgWt1c.png"
loading="lazy"
alt="image-013202951"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="433-configuring-security-protection-on-the-firewall">4.3.3 Configuring Security Protection on the Firewall
&lt;/h4>&lt;ul>
&lt;li>拉黑200.1.200.200地址&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>FW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[FW1]firewall blacklist enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[FW1]firewall blacklist item source-ip 200.1.200.200
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h3 id="44-task-4-enterprise-hq-network-deployment">4.4 Task 4: Enterprise HQ Network Deployment
&lt;/h3>&lt;h4 id="441-configuring-a-layer-2-network">4.4.1 Configuring a Layer 2 Network
&lt;/h4>&lt;ul>
&lt;li>端口安全，动态安全地址，mac 抖动，最大mac地址2，aging time 1200m&lt;/li>
&lt;li>端口学习mac地址的优先级&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>LSW3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mac-learning priority 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port-security enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port-security protect-action shutdown
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port-security max-mac-num 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port-security mac-address sticky
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port-security aging-time 1200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW4&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mac-learning priority 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port-security enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port-security protect-action shutdown
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port-security max-mac-num 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port-security mac-address sticky
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port-security aging-time 1200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h4 id="442-configuring-basic-services-on-the-firewall">4.4.2 Configuring Basic Services on the Firewall
&lt;/h4>&lt;ul>
&lt;li>配置安全策略，HQ 172.16.100.0/24和Branch172.17.100.0/24上互联网（NAT need）&lt;/li>
&lt;li>配置安全策略，HQ 172.16.101.0/24 访问OA 192.168.100.0/24（FW1上做了映射公网）&lt;/li>
&lt;li>配置ip-link ,FW2-AR1, FW2-AR2，搭配后续的出向默认路由使用&lt;/li>
&lt;li>出向静态路由&lt;/li>
&lt;li>入向静态路由，AR1和AR2 （200.1.100.0/24）指向 FW2；FW2配置特定主备路由指向LSW3 LSW4&lt;/li>
&lt;li>配置NAT，接入互联网，最终ping通WEB服务器和Video服务器需要这个，转换地址池200.1.100.2 - 200.1.100.10&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>FW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/3.30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/4.40
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/3.60
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/4.70
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip-link check enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip-link name toar1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination 200.1.6.1 interface GigabitEthernet1/0/3.60 mode arp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip-link name toar2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination 200.1.7.1 interface GigabitEthernet1/0/4.70 mode arp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">security-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name trust2untrust01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.16.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.17.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name trust2untrust02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.16.101.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 192.168.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 200.1.6.1 track ip-link toar1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 200.1.7.1 track ip-link toar2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 172.16.100.0 255.255.255.0 172.16.3.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 172.16.100.0 255.255.255.0 172.16.4.1 preference 90
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 172.16.101.0 255.255.255.0 172.16.4.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 172.16.101.0 255.255.255.0 172.16.3.1 preference 90
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 172.17.100.0 255.255.255.0 172.16.3.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 172.17.100.0 255.255.255.0 172.16.4.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nat address-group addressgroup1 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mode pat
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> section 0 200.1.100.2 200.1.100.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nat-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name policy_nat1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.16.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.17.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 100.1.0.0 mask 255.255.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action source-nat address-group addressgroup1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 172.16.3.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW4&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 172.16.4.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 200.1.100.0 255.255.255.0 200.1.6.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> import-route static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 200.1.100.0 255.255.255.0 200.1.7.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> import-route static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>验证&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/7F9dWlTxU3eag6q.png">
&lt;img src="https://s2.loli.net/2024/07/19/7F9dWlTxU3eag6q.png"
loading="lazy"
alt="image-124106425"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/1J4VLSmGzk7ZYsq.png">
&lt;img src="https://s2.loli.net/2024/07/19/1J4VLSmGzk7ZYsq.png"
loading="lazy"
alt="image-124147896"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h4 id="443-configuring-url-filtering-on-the-firewall">4.4.3 Configuring URL Filtering on the Firewall
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>url-filter profile的配置，去网页点点看&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profile type url-filter name url_profile_deny
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add blacklist url www.example1.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add blacklist url www.example2.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> category pre-defined control-level medium
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> https-filter enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h4 id="444-configuring-the-ips-function-on-the-firewall">4.4.4 Configuring the IPS Function on the Firewall
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>ips profile的配置，去网页点点看&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">profile type ips name Profile_ips_pc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> collect-attack-evidence enable # 依赖硬盘，ensp不起作用
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> signature-set name filter_web
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> target client
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> severity high
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> protocol HTTP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">security-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name trust2untrust01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> profile ips Profile_ips_pc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h4 id="445-configuring-traffic-management-on-the-firewall">4.4.5 Configuring Traffic Management on the Firewall
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>配置流量管理，去网页点点看&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> time-range work_time
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> period-range 09:00:00 to 18:00:00 working-day
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">traffic-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> profile profile_p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bandwidth maximum-bandwidth whole both 50000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bandwidth connection-limit whole both 2000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> profile profile_email
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bandwidth guaranteed-bandwidth whole both 100000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bandwidth priority 7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name policy_p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address address-set 172.16.100.0&amp;amp;172.17.100.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application app BT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application app YouKu
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action qos profile profile_p2p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name policy_email
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.16.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.17.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application app LotusNotes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application app OWA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> application category Business_Systems sub-category Email
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action qos profile profile_email
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h3 id="45-task-5-enterprise-branch-network-deployment">4.5 Task 5: Enterprise Branch Network Deployment
&lt;/h3>&lt;h4 id="451-configuring-dhcp">4.5.1 Configuring DHCP
&lt;/h4>&lt;ul>
&lt;li>LSW5配置DHCP，此DHCP Server后续的无线sta获取地址也需要用到&lt;/li>
&lt;li>DHCP参数，vlanif100接口，dns 8.8.8.8，lease 2d&lt;/li>
&lt;li>LSW6，配置DHCP snooping，上联dhcp server接口trusted&lt;/li>
&lt;li>可能的bug（PC3和STA1获取不到IP地址，在LSW5去掉DHCP配置再重新刷入配置解决）&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>LSW5&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dhcp enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlanif100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp select interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp server lease day 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp server dns-list 8.8.8.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW6&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dhcp enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dhcp snooping enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">arp dhcp-snooping-detect enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp snooping check dhcp-rate enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp snooping check dhcp-rate 80
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port trunk pvid vlan 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp snooping check dhcp-rate enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp snooping check dhcp-rate 80
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp snooping enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp snooping trusted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h4 id="452-configuring-a-wlan">4.5.2 Configuring a WLAN
&lt;/h4>&lt;ul>
&lt;li>配置旁挂二层直接转发+ vrrp热备冗余+hsb状态同步&lt;/li>
&lt;li>黑名单拉黑sta2接入&lt;/li>
&lt;li>动态拉黑攻击者mac&lt;/li>
&lt;li>流量模板限速&lt;/li>
&lt;li>ensp要是支持配置同步功能就厉害了&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>AC1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dhcp enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 下面这行说dhcp信息可以从文件恢复，很重要么这点信息？
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># dhcp server database enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlanif200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 172.17.200.2 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 1 virtual-ip 172.17.200.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> admin-vrrp vrid 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 1 priority 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp select interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp server excluded-ip-address 172.17.200.1 172.17.200.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">capwap source ip-address 172.17.200.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wlan
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 流量模板
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> traffic-profile name wlan-traffic
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rate-limit client up 5000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rate-limit vap up 100000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rate-limit client down 10000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rate-limit vap down 500000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 安全模板
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security-profile name wlan-security
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security wpa-wpa2 psk pass-phrase Huawei@123 aes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 黑名单拉黑sta2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sta-blacklist-profile name sta-blacklist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sta-mac 5489-988a-0449
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 空白的白名单
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sta-whitelist-profile name sta-whitelist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># SSID模板
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssid-profile name wlan-ssid
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssid ICT2022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># VAP模板
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vap-profile name wlan-vap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service-vlan vlan-id 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sta-access-mode whitelist sta-whitelist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssid-profile wlan-ssid
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security-profile wlan-security
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> traffic-profile wlan-traffic
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># WIDS模板
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> wids-profile name wlan-wids
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> brute-force-detect interval 80
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> brute-force-detect threshold 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> brute-force-detect quiet-time 800
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dynamic-blacklist enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># AP系统模板
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-system-profile name wlan-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dynamic-blacklist aging-time 300
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sta-access-mode blacklist sta-blacklist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># AP组
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-group name ap-group
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-system-profile wlan-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> wids-profile wlan-wids
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> radio 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vap-profile wlan-vap wlan 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-id 0 type-id 61 ap-mac 00e0-fcf8-2fb0 ap-sn 2102354483106349735D
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-name AP1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-group ap-group
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hsb-service 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service-ip-port local-ip 172.17.200.2 peer-ip 172.17.200.3 local-data-port 10241 peer-data-port 10241
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hsb-group 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> track vrrp vrid 1 interface Vlanif200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bind-service 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hsb enable # 配置完成其他配置再启用查看状态
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hsb-service-type access-user hsb-group 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hsb-service-type dhcp hsb-group 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hsb-service-type ap hsb-group 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AC2 ，修改参数即可，wlan配置与AC 1 一致，粘贴注意有时需要输入 Y 确认&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dhcp enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlanif200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 172.17.200.3 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 1 virtual-ip 172.17.200.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> admin-vrrp vrid 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp select interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp server excluded-ip-address 172.17.200.1 172.17.200.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">capwap source ip-address 172.17.200.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wlan
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 流量模板
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> traffic-profile name wlan-traffic
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rate-limit client up 5000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rate-limit vap up 100000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rate-limit client down 10000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rate-limit vap down 500000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 安全模板
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security-profile name wlan-security
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security wpa-wpa2 psk pass-phrase Huawei@123 aes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 黑名单拉黑sta2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sta-blacklist-profile name sta-blacklist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sta-mac 5489-988a-0449
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 空白的白名单
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sta-whitelist-profile name sta-whitelist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># SSID模板
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssid-profile name wlan-ssid
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssid ICT2022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># VAP模板
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vap-profile name wlan-vap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service-vlan vlan-id 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sta-access-mode whitelist sta-whitelist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssid-profile wlan-ssid
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security-profile wlan-security
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> traffic-profile wlan-traffic
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># WIDS模板
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> wids-profile name wlan-wids
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> brute-force-detect interval 80
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> brute-force-detect threshold 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> brute-force-detect quiet-time 800
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dynamic-blacklist enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># AP系统模板
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-system-profile name wlan-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dynamic-blacklist aging-time 300
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sta-access-mode blacklist sta-blacklist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># AP组
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-group name ap-group
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-system-profile wlan-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> wids-profile wlan-wids
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> radio 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vap-profile wlan-vap wlan 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-id 0 type-id 61 ap-mac 00e0-fcf8-2fb0 ap-sn 2102354483106349735D
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-name AP1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ap-group ap-group
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hsb-service 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service-ip-port local-ip 172.17.200.3 peer-ip 172.17.200.2 local-data-port 10241 peer-data-port 10241
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hsb-group 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> track vrrp vrid 1 interface Vlanif200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bind-service 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hsb enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hsb-service-type access-user hsb-group 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hsb-service-type dhcp hsb-group 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hsb-service-type ap hsb-group 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>校验&lt;/p>
&lt;ul>
&lt;li>
&lt;p>dis vrrp&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[AC1]dis vrrp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Vlanif200 | Virtual Router 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> State : Master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Virtual IP : 172.17.200.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Master IP : 172.17.200.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PriorityRun : 222
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PriorityConfig : 222
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> MasterPriority : 222
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Preempt : YES Delay Time : 0 s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> TimerRun : 1 s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> TimerConfig : 1 s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Auth type : NONE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Virtual MAC : 0000-5e00-0101
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Check TTL : YES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Config type : admin-vrrp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Backup-forward : disabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Create time : 2024-07-16 21:14:14 UTC-05:13
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Last change time : 2024-07-16 21:14:27 UTC-05:13
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC1]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC2]dis vrrp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Vlanif200 | Virtual Router 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> State : Backup
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Virtual IP : 172.17.200.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Master IP : 172.17.200.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PriorityRun : 111
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PriorityConfig : 111
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> MasterPriority : 222
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Preempt : YES Delay Time : 0 s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> TimerRun : 1 s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> TimerConfig : 1 s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Auth type : NONE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Virtual MAC : 0000-5e00-0101
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Check TTL : YES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Config type : admin-vrrp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Backup-forward : disabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Create time : 2024-07-16 20:19:15 UTC-05:13
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Last change time : 2024-07-16 21:14:58 UTC-05:13
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis hsb-group 0&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[AC1]dis hsb-group 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Hot Standby Group Information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> HSB-group ID : 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Vrrp Group ID : 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Vrrp Interface : Vlanif200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Service Index : 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Group Vrrp Status : Master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Group Status : Active
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Group Backup Process : Realtime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Peer Group Device Name : AC6005
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Peer Group Software Version : V200R007C10SPC300B220
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Group Backup Modules : Access-user
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> DHCP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> AP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC1]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC2]dis hsb-group 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Hot Standby Group Information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> HSB-group ID : 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Vrrp Group ID : 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Vrrp Interface : Vlanif200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Service Index : 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Group Vrrp Status : Backup
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Group Status : Inactive
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Group Backup Process : Realtime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Peer Group Device Name : AC6005
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Peer Group Software Version : V200R007C10SPC300B220
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Group Backup Modules : Access-user
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> DHCP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> AP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC2]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis hsb-service 0&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[AC1]dis hsb-service 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Hot Standby Service Information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Local IP Address : 172.17.200.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Peer IP Address : 172.17.200.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Source Port : 10241
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Destination Port : 10241
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Keep Alive Times : 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Keep Alive Interval : 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Service State : Connected
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Service Batch Modules :
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC1]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC2]dis hsb-service 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Hot Standby Service Information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Local IP Address : 172.17.200.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Peer IP Address : 172.17.200.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Source Port : 10241
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Destination Port : 10241
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Keep Alive Times : 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Keep Alive Interval : 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Service State : Connected
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Service Batch Modules :
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC2]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis ap all&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[AC1]dis ap all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Info: This operation may take a few seconds. Please wait for a moment.done.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total AP information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nor : normal [1]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ID MAC Name Group IP Type State STA Uptime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">0 00e0-fcf8-2fb0 AP1 ap-group 172.17.200.132 AP4050DN-E nor 1 22M:17S
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC1]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC2]dis ap all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Info: This operation may take a few seconds. Please wait for a moment.done.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total AP information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">stdby: standby [1]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ID MAC Name Group IP Type State STA Uptime
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">0 00e0-fcf8-2fb0 AP1 ap-group 172.17.200.132 AP4050DN-E stdby 0 -
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC2]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis station all&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[AC1]dis station all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Rf/WLAN: Radio ID/WLAN ID
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Rx/Tx: link receive rate/link transmit rate(Mbps)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----------------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">STA MAC AP ID Ap name Rf/WLAN Band Type Rx/Tx RSSI VLAN IP address SSID
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----------------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5489-9811-592c 0 AP1 0/1 2.4G - -/- - 100 172.17.100.254 ICT2022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----------------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total: 1 2.4G: 1 5G: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC1]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC2]dis station all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Rf/WLAN: Radio ID/WLAN ID
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Rx/Tx: link receive rate/link transmit rate(Mbps)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">STA MAC AP ID Ap name Rf/WLAN Band Type Rx/Tx RSSI VLAN IP address SSID
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total: 0 2.4G: 0 5G: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC2]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis station online-fail-record all&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[AC1]dis station online-fail-record all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Rf/WLAN: Radio ID/WLAN ID
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">STA MAC AP ID Ap name Rf/WLAN Last record time
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Reason
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5489-988a-0449 0 AP1 0/1 2024-07-19/10:35:02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> The STA is in the global blacklist.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total stations: 1 Total records: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AC1]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="46-task-6-service-deployment-for-communication-between-the-enterprise-hq-and-branch">4.6 Task 6: Service Deployment for Communication Between the Enterprise HQ and Branch
&lt;/h3>&lt;h4 id="461-configuring-an-mplsvpn">4.6.1 Configuring an MPLSVPN
&lt;/h4>&lt;ul>
&lt;li>配置ldp，loopback0接口地址为lsr-id，&lt;/li>
&lt;li>AR1/AR2/AR3/AR4，配置vrf entvpn，需要配置RD，RT&lt;/li>
&lt;li>AR1/AR2/LSW3/LSW4配置ospf，进程号100，area0，LSW3/LSW4下发默认路由，面向PC的vlanif接口配置passive被动接口&lt;/li>
&lt;li>LSW5/AR3/AR4/配置EBGP，AS62012，branch使用network起源宣告网段&lt;/li>
&lt;li>vpnv4的反射器，AR1/AR2重分布默认路由进BGP vpn地址族&lt;/li>
&lt;li>配置AS-PATH添加，route-map，对收到的路由进行选路干预&lt;/li>
&lt;li>LSW5收到的默认路由负载均衡，最大优选路径设置2&lt;/li>
&lt;li>当HQ两条出口链路中断，LSW3/LSW4的去往branch 172.17.100.0/24的不走FW2的默认路由 ，track默认路由检测互联AR1/AR2的链路&lt;/li>
&lt;li>AR路由器的故障快速切换，在VPN路由收敛前切换&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>AR1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls lsr-id 1.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> route-distinguisher 64812:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn frr route-policy VPN-FRR
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn-target 64812:345 both
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 172.16.1.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ospf 100 router-id 1.1.1.1 vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> import-route bgp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> area 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.1.1 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default-route imported
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> import-route ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-policy VPN-FRR permit node 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> apply backup-nexthop auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls lsr-id 1.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> route-distinguisher 64812:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn frr route-policy VPN-FRR
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn-target 64812:345 both
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2.20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 172.16.2.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ospf 100 router-id 1.1.1.2 vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> import-route bgp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> area 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.2.1 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default-route imported
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> import-route ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-policy VPN-FRR permit node 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> apply backup-nexthop auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls lsr-id 1.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> route-distinguisher 64812:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn frr route-policy VPN-FRR
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn-target 64812:345 both
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 172.17.1.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 172.17.1.2 as-number 62012
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-policy VPN-FRR permit node 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> apply backup-nexthop auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR4&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls lsr-id 1.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> route-distinguisher 64812:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn frr route-policy VPN-FRR
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn-target 64812:345 both
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet3/0/0.20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 172.17.2.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 172.17.2.2 as-number 62012
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-policy VPN-FRR permit node 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> apply backup-nexthop auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>CR1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls lsr-id 1.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>CR2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls lsr-id 1.1.1.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default-route-advertise
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> silent-interface Vlanif100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> area 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.1.2 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.5.1 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.100.1 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nqa test-instance toAR1 toAR1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> test-type icmp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address ipv4 172.16.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> frequency 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> interval seconds 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> probe-count 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> start now
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 172.16.3.2 track nqa toAR1 toAR1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW4&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default-route-advertise
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> silent-interface Vlanif101
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> area 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.2.2 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.5.2 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.101.1 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nqa test-instance toAR2 toAR2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> test-type icmp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address ipv4 172.16.2.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> frequency 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> interval seconds 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> probe-count 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> start now
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 172.16.4.2 track nqa toAR2 toAR2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW5&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">bgp&lt;/span> &lt;span class="mi">62012&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">peer&lt;/span> &lt;span class="mf">172.17&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span> &lt;span class="n">as&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">number&lt;/span> &lt;span class="mi">64812&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">peer&lt;/span> &lt;span class="mf">172.17&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">2.1&lt;/span> &lt;span class="n">as&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">number&lt;/span> &lt;span class="mi">64812&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ipv4&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">family&lt;/span> &lt;span class="n">unicast&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">network&lt;/span> &lt;span class="mf">172.17&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">100.0&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">maximum&lt;/span> &lt;span class="nb">load&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">balancing&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">peer&lt;/span> &lt;span class="mf">172.17&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">policy&lt;/span> &lt;span class="n">AS_PATH_ODD&lt;/span> &lt;span class="n">import&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">peer&lt;/span> &lt;span class="mf">172.17&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">2.1&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">policy&lt;/span> &lt;span class="n">AS_PATH_EVEN&lt;/span> &lt;span class="n">import&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">policy&lt;/span> &lt;span class="n">AS_PATH_EVEN&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="n">node&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">match&lt;/span> &lt;span class="n">acl&lt;/span> &lt;span class="mi">2010&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">apply&lt;/span> &lt;span class="n">as&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">path&lt;/span> &lt;span class="mi">100&lt;/span> &lt;span class="n">additive&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">policy&lt;/span> &lt;span class="n">AS_PATH_EVEN&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="n">node&lt;/span> &lt;span class="mi">20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">policy&lt;/span> &lt;span class="n">AS_PATH_ODD&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="n">node&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">match&lt;/span> &lt;span class="n">acl&lt;/span> &lt;span class="mi">2020&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">apply&lt;/span> &lt;span class="n">as&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">path&lt;/span> &lt;span class="mi">100&lt;/span> &lt;span class="n">additive&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">policy&lt;/span> &lt;span class="n">AS_PATH_ODD&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="n">node&lt;/span> &lt;span class="mi">20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">acl&lt;/span> &lt;span class="n">number&lt;/span> &lt;span class="mi">2010&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rule&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="mf">172.16&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">254.255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">acl&lt;/span> &lt;span class="n">number&lt;/span> &lt;span class="mi">2020&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rule&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="mf">172.16&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">254.255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>验证&lt;/p>
&lt;ul>
&lt;li>
&lt;p>PC3 172.17.100.0/24 去往HQ的流量路径&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/c5FrskDQpWo9xHa.png">
&lt;img src="https://s2.loli.net/2024/07/19/c5FrskDQpWo9xHa.png"
loading="lazy"
alt="image-124208233"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>PC3 172.17.100.0/24 访问internet&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/5pzSk7K6GmJawCO.png">
&lt;img src="https://s2.loli.net/2024/07/19/5pzSk7K6GmJawCO.png"
loading="lazy"
alt="image-124336943"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>AR3查看FRR&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">AR3&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="n">dis&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">rou&lt;/span> &lt;span class="n">vpn&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">instance&lt;/span> &lt;span class="n">entvpn&lt;/span> &lt;span class="mf">172.16&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">100.0&lt;/span> &lt;span class="n">v&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Route&lt;/span> &lt;span class="n">Flags&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">relay&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">download&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">fib&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">------------------------------------------------------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Routing&lt;/span> &lt;span class="n">Table&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">entvpn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Summary&lt;/span> &lt;span class="n">Count&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Destination&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">172.16&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">100.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Protocol&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">IBGP&lt;/span> &lt;span class="n">Process&lt;/span> &lt;span class="n">ID&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Preference&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">255&lt;/span> &lt;span class="n">Cost&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">NextHop&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span> &lt;span class="n">Neighbour&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">State&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Active&lt;/span> &lt;span class="n">Adv&lt;/span> &lt;span class="n">Relied&lt;/span> &lt;span class="n">Age&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="n">h01m41s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Tag&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">Priority&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">low&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="ne">Label&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1054&lt;/span> &lt;span class="n">QoSInfo&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mh">0x0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">IndirectID&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mh">0x10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RelayNextHop&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">10.3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">5.1&lt;/span> &lt;span class="n">Interface&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TunnelID&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mh">0x1&lt;/span> &lt;span class="n">Flags&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">RD&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">BkNextHop&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span> &lt;span class="n">BkInterface&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">BkLabel&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1053&lt;/span> &lt;span class="n">SecTunnelID&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mh">0x0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">BkPETunnelID&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mh">0x3&lt;/span> &lt;span class="n">BkPESecTunnelID&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mh">0x0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">BkIndirectID&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mh">0x14&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="n">AR3&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="47-task-7-service-deployment-for-communication-between-the-enterprise-and-data-center-servers">4.7 Task 7: Service Deployment for Communication Between the Enterprise and Data Center Servers
&lt;/h3>&lt;h4 id="471-configuring-a-virtual-system-on-the-firewall">4.7.1 Configuring a Virtual System on the Firewall
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>FW1配置vsys，服务OA server，鼠标点点也挺快&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vsys enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">resource-class ent_resource
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resource-item-limit session reserved-number 1000 maximum 5000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resource-item-limit bandwidth 8 outbound
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resource-item-limit policy reserved-number 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resource-item-limit user reserved-number 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resource-item-limit l2tp-tunnel reserved-number 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> resource-item-limit ipsec-tunnel reserved-number 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 绑定vpn-instance，重新配置IP地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vsys name entvsys
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> assign interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> assign interface GigabitEthernet1/0/1.50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> assign interface GigabitEthernet1/0/1.60
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> assign interface GigabitEthernet1/0/2.50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> assign interface GigabitEthernet1/0/2.60
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> assign resource-class ent_resource
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/1.50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/2.50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/1.60
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet1/0/2.60
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h4 id="472-connecting-the-oa-server-to-the-network">4.7.2 Connecting the OA Server to the Network
&lt;/h4>&lt;ul>
&lt;li>LSW1/LSW2配置vrf entvpn，vlanif100 划入entvpn&lt;/li>
&lt;li>vrrp配置，virtual-ip 192.168.100.1/24，LSW1 master，优先级120，抢占延迟20s&lt;/li>
&lt;li>LSW1 track G0/0/1 接口，中断后优先级减21，LSW2抢占为master&lt;/li>
&lt;li>配置出向路由，交换机默认路由指向FW1；FW1的vsys entvsys，配置出向的主备份路由&lt;/li>
&lt;li>配置入向路由，交换机配置指向100.1.1.10/32 的静态路由指向FW1；FW1配置去往OA192.168.100.0/24的主备路由&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>LSW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlanif100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> description VPN-entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.100.8 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 1 virtual-ip 192.168.100.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 1 priority 120
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 1 preempt-mode timer delay 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 1 track interface GigabitEthernet0/0/1 reduced 21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlanif50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> description VPN-entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.5.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 100.1.1.10 255.255.255.255 100.1.6.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static vpn-instance entvpn 0.0.0.0 0.0.0.0 192.168.5.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlanif100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> description VPN-entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.100.9 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 1 virtual-ip 192.168.100.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp vrid 1 preempt-mode timer delay 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlanif50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> description VPN-entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance entvpn
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.50.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 100.1.1.10 255.255.255.255 100.1.60.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static vpn-instance entvpn 0.0.0.0 0.0.0.0 192.168.50.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">switch vsys entvsys
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 100.1.6.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 0.0.0.0 0.0.0.0 100.1.60.1 preference 90
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 192.168.100.0 255.255.255.0 192.168.5.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route-static 192.168.100.0 255.255.255.0 192.168.50.1 preference 90
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h4 id="473-configuring-ipsec-tunnels">4.7.3 Configuring IPsec Tunnels
&lt;/h4>&lt;ul>
&lt;li>配置172.16.100.0/24和172.17.100.0/24 走ipsec访问OA 192.168.100.0/24&lt;/li>
&lt;li>使用IKE 协商模式&lt;/li>
&lt;li>自动触发建立隧道&lt;/li>
&lt;li>看图表设置参数&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>AR1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 200.1.6.0 255.255.255.252
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 200.1.7.0 255.255.255.252
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp 62022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.1.6.0 255.255.255.252
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>LSW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp 62022
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.1.60.0 255.255.255.252
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl number 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 5 permit ip source 192.168.100.0 0.0.0.255 destination 172.16.100.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 10 permit ip source 192.168.100.0 0.0.0.255 destination 172.17.100.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipsec proposal ipsec_proposal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> esp authentication-algorithm sha2-256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> esp encryption-algorithm aes-256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ike proposal 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> encryption-algorithm aes-256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dh group14
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> authentication-algorithm sha2-256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> authentication-method pre-share
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> integrity-algorithm hmac-sha2-256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> prf hmac-sha2-256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ike peer fw0201
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pre-shared-key Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ike-proposal 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> remote-id-type any
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> remote-address 200.1.6.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ike peer fw0202
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pre-shared-key Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ike-proposal 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> remote-id-type any
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> remote-address 200.1.7.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipsec policy ipsec01 10 isakmp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security acl 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ike-peer fw0201
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proposal ipsec_proposal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipsec policy ipsec02 10 isakmp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security acl 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ike-peer fw0202
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proposal ipsec_proposal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # undo policy enable # 策略禁用命令
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/1.60
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipsec policy ipsec01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/2.60
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipsec policy ipsec02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">security-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name ipsec_in_sp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 200.1.6.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 200.1.7.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name ipsec_out_sp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 200.1.6.2 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 200.1.7.2 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name trust2untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 192.168.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 172.16.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 172.17.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name untrust2trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.16.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.17.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 192.168.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl number 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 5 permit ip source 172.16.100.0 0.0.0.255 destination 192.168.100.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 10 permit ip source 172.17.100.0 0.0.0.255 destination 192.168.100.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipsec proposal ipsec_proposal # 使用默认值，不用敲以下2行命令
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> esp authentication-algorithm sha2-256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> esp encryption-algorithm aes-256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ike proposal 10 # 使用默认值，不用敲以下6行命令
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> encryption-algorithm aes-256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dh group14
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> authentication-algorithm sha2-256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> authentication-method pre-share
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> integrity-algorithm hmac-sha2-256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> prf hmac-sha2-256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ike peer fw0101
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pre-shared-key Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ike-proposal 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> remote-id-type any
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> remote-address 100.1.6.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ike peer fw0102
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pre-shared-key Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ike-proposal 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> remote-id-type any
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> remote-address 100.1.60.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipsec policy ipsec01 10 isakmp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security acl 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ike-peer fw0101
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proposal ipsec_proposal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipsec policy ipsec02 10 isakmp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> security acl 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ike-peer fw0102
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proposal ipsec_proposal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/3.60
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipsec policy ipsec01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/4.70
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipsec policy ipsec02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">security-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name trust2untrust01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.16.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.17.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> profile ips Profile_ips_pc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name trust2untrust02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.16.101.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 192.168.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name ipsec_out_sp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 100.1.6.2 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 100.1.60.2 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name ipsec_in_sp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 100.1.6.2 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 100.1.60.2 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name untrust2trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 192.168.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 172.16.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 172.17.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>校验&lt;/p>
&lt;ul>
&lt;li>
&lt;p>dis ipsec sa&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[FW1-entvsys]dis ipsec sa
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024-07-17 09:00:34.530
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipsec sa information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">===============================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Interface: GigabitEthernet1/0/1.60
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">===============================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IPSec policy name: &amp;#34;ipsec01&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Sequence number : 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl group : 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl rule : 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Mode : ISAKMP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Connection ID : 7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Encapsulation mode: Tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Holding time : 0d 1h 12m 55s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel local : 100.1.6.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel remote : 200.1.6.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow source : 192.168.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow destination : 172.16.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Outbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 199477355 (0xbe3c86b)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485721/2324
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max sent sequence-number: 665
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA encrypted packets (number/bytes): 664/39936
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Inbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 187864131 (0xb329443)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485760/2324
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max received sequence-number: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA decrypted packets (number/bytes): 0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay : Enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay window size: 1024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IPSec policy name: &amp;#34;ipsec01&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Sequence number : 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl group : 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl rule : 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Mode : ISAKMP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Connection ID : 6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Encapsulation mode: Tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Holding time : 0d 0h 39m 25s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel local : 100.1.6.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel remote : 200.1.6.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow source : 192.168.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow destination : 172.17.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Outbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 192541812 (0xb79f474)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485722/1237
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max sent sequence-number: 666
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA encrypted packets (number/bytes): 665/39900
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Inbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 186945386 (0xb248f6a)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485754/1237
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max received sequence-number: 64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA decrypted packets (number/bytes): 106/6360
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay : Enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay window size: 1024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">===============================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Interface: GigabitEthernet1/0/2.60
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">===============================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IPSec policy name: &amp;#34;ipsec02&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Sequence number : 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl group : 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl rule : 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Mode : ISAKMP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Connection ID : 8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Encapsulation mode: Tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Holding time : 0d 0h 53m 39s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel local : 100.1.60.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel remote : 200.1.7.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow source : 192.168.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow destination : 172.16.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Outbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 195126685 (0xba1659d)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485760/3407
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max sent sequence-number: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA encrypted packets (number/bytes): 0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Inbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 195412318 (0xba5c15e)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485753/3407
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max received sequence-number: 128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA decrypted packets (number/bytes): 133/7980
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay : Enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay window size: 1024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IPSec policy name: &amp;#34;ipsec02&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Sequence number : 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl group : 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl rule : 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Mode : ISAKMP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Connection ID : 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Encapsulation mode: Tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Holding time : 0d 0h 42m 10s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel local : 100.1.60.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel remote : 200.1.7.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow source : 192.168.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow destination : 172.17.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Outbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 184686406 (0xb021746)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485760/1071
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max sent sequence-number: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA encrypted packets (number/bytes): 0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Inbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 187927920 (0xb338d70)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485699/1071
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max received sequence-number: 1216
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA decrypted packets (number/bytes): 1044/63024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay : Enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay window size: 1024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[FW1-entvsys]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis ipsec sa&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[FW2]dis ipsec sa
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024-07-17 09:01:41.270
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipsec sa information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">===============================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Interface: GigabitEthernet1/0/3.60
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">===============================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IPSec policy name: &amp;#34;ipsec01&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Sequence number : 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl group : 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl rule : 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Mode : ISAKMP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Connection ID : 47
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Encapsulation mode: Tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Holding time : 0d 1h 14m 2s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel local : 200.1.6.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel remote : 100.1.6.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow source : 172.16.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow destination : 192.168.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Outbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 187864131 (0xb329443)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485760/2257
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max sent sequence-number: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA encrypted packets (number/bytes): 0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Inbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 199477355 (0xbe3c86b)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485719/2257
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max received sequence-number: 704
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA decrypted packets (number/bytes): 708/42576
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay : Enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay window size: 1024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IPSec policy name: &amp;#34;ipsec01&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Sequence number : 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl group : 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl rule : 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Mode : ISAKMP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Connection ID : 45
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Encapsulation mode: Tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Holding time : 0d 0h 40m 31s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel local : 200.1.6.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel remote : 100.1.6.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow source : 172.17.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow destination : 192.168.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Outbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 186945386 (0xb248f6a)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485754/1170
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max sent sequence-number: 107
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA encrypted packets (number/bytes): 106/6360
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Inbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 192541812 (0xb79f474)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485719/1170
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max received sequence-number: 704
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA decrypted packets (number/bytes): 707/42420
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay : Enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay window size: 1024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">===============================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Interface: GigabitEthernet1/0/4.70
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">===============================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IPSec policy name: &amp;#34;ipsec02&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Sequence number : 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl group : 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl rule : 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Mode : ISAKMP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Connection ID : 48
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Encapsulation mode: Tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Holding time : 0d 0h 54m 40s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel local : 200.1.7.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel remote : 100.1.60.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow source : 172.16.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow destination : 192.168.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Outbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 195412318 (0xba5c15e)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485750/3347
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max sent sequence-number: 178
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA encrypted packets (number/bytes): 177/10620
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Inbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 195126685 (0xba1659d)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485760/3347
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max received sequence-number: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA decrypted packets (number/bytes): 0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay : Enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay window size: 1024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IPSec policy name: &amp;#34;ipsec02&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Sequence number : 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl group : 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Acl rule : 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Mode : ISAKMP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -----------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Connection ID : 44
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Encapsulation mode: Tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Holding time : 0d 0h 43m 11s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel local : 200.1.7.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel remote : 100.1.60.2:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow source : 172.17.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Flow destination : 192.168.100.0/255.255.255.0 0/0-65535
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Outbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 187927920 (0xb338d70)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485683/1011
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max sent sequence-number: 1317
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA encrypted packets (number/bytes): 1316/79344
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [Inbound ESP SAs]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SPI: 184686406 (0xb021746)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Proposal: ESP-ENCRYPT-AES-256 ESP-AUTH-SHA2-256-128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA remaining key duration (kilobytes/sec): 10485760/1011
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Max received sequence-number: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UDP encapsulation used for NAT traversal: N
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SA decrypted packets (number/bytes): 0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay : Enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Anti-replay window size: 1024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[FW2]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>PC1 ping OA&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/KslP3dvnjWorawu.png">
&lt;img src="https://s2.loli.net/2024/07/19/KslP3dvnjWorawu.png"
loading="lazy"
alt="image-170314062"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>PC3 ping OA&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/pGxZKakoYJ7ldiC.png">
&lt;img src="https://s2.loli.net/2024/07/19/pGxZKakoYJ7ldiC.png"
loading="lazy"
alt="image-170423691"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="474-configuring-an-l2tp-over-ipsec-tunnel">4.7.4 Configuring an L2TP over IPsec Tunnel
&lt;/h4>&lt;ul>
&lt;li>配置l2tp over ipsec&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>FW1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 切换虚拟系统，以下配置都在entvsys下配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">switch vsys entvsys
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 创建user001，每次启动都需要操作一次，产品手册中指示存于数据库中，而模拟器没硬盘没这货
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user-manage user user0001
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">password Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Virtual-Template0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ppp authentication-mode chap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> remote address 30.30.30.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 30.30.30.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone dmz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface Virtual-Template0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">l2tp enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">l2tp-group 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel password cipher Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel name lns
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> allow l2tp virtual-template 0 remote lac
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl number 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 15 permit udp source-port eq 1701
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">security-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name trust2dmz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone dmz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 192.168.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 30.30.30.0 mask 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name dmz2trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone dmz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 30.30.30.0 mask 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 192.168.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name untrust2local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 200.1.1.11 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 100.1.1.10 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name any
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> l2tp enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">l2tp-group 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel password cipher Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel name lac
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel source LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> start l2tp ip 100.1.1.10 fullusername user001
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Virtual-Template0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ppp authentication-mode chap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ppp chap user user001
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ppp chap password cipher Huawei@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address ppp-negotiate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> call-lns local-user user001
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">policy-based-route
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name l2tp 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.16.101.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 192.168.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action pbr egress-interface Virtual-Template0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nat-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name l2tp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> egress-interface Virtual-Template0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.16.101.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 192.168.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action source-nat easy-ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl number 3000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 15 permit udp destination-port eq 1701
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">security-policy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name trust2dmz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone dmz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 172.16.101.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 192.168.100.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name dmz2trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone dmz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 30.30.30.2 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 172.16.101.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule name local2untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone untrust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-address 200.1.1.11 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-address 100.1.1.10 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>验证&lt;/p>
&lt;ul>
&lt;li>
&lt;p>PC1 PC2 PC3 ping OA 192.168.100.254&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/HyokRSbtgxev79u.png">
&lt;img src="https://s2.loli.net/2024/07/19/HyokRSbtgxev79u.png"
loading="lazy"
alt="image-042024690"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>FW2查看l2tp隧道&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[FW2]dis l2tp tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024-07-18 20:01:48.860
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">L2TP::Total Tunnel: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> LocalTID RemoteTID RemoteAddress Port Sessions RemoteName VpnInstance
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 1 100.1.1.10 1701 1 lns
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total 1, 1 printed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[FW2]dis l2tp session
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024-07-18 20:01:51.360
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">L2TP::Total Session: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> LocalSID RemoteSID LocalTID RemoteTID UserID UserName VpnInstance
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 69 41 1 1 user001
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total 1, 1 printed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[FW2]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW2查看加密计数&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[FW2]dis ipsec statistics
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2024-07-18 20:21:08.960
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IPSec statistics information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Number of IPSec tunnels: 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Number of standby IPSec tunnels: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> the security packet statistics:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input/output security packets: 5082/5457
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input/output security bytes: 335843/362318
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> input/output dropped security packets: 4/7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> the encrypt packet statistics:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> send chip: 5457, recv chip: 5457, send err: 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> local cpu: 5457, other cpu: 0, recv other cpu: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> intact packet: 5457, first slice: 0, after slice: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> the decrypt packet statistics:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> send chip: 5082, recv chip: 5082, send err: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> local cpu: 5082, other cpu: 0, recv other cpu: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reass first slice: 0, after slice: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dropped security packet detail:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> can not find SA: 0, wrong SA: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> authentication: 0, replay: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> front recheck: 0, after recheck: 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> change cpu enc: 0, dec change cpu: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fib search: 0, output l3: 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> flow err: 5, slice err: 0, byte limit: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slave drop: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> negotiate about packet statistics:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IKE fwd packet ok: 46, err: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IKE ctrl packet inbound ok: 46, outbound ok: 68
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SoftExpr: 0, HardExpr: 0, DPDOper: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> trigger ok: 29, switch sa: 12, sync sa: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> recv IKE nat keepalive: 0, IKE input: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[FW2]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>FW查看ipsec状态&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/PqFutpOGhkfn9ig.png">
&lt;img src="https://s2.loli.net/2024/07/19/PqFutpOGhkfn9ig.png"
loading="lazy"
alt="image-042144749"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="48-task-8-multicast-service-deployment-on-the-man">4.8 Task 8: Multicast Service Deployment on the MAN
&lt;/h3>&lt;h4 id="481-configuring-the-multicast-service">4.8.1 Configuring the Multicast Service
&lt;/h4>&lt;ul>
&lt;li>配置MAN网络的组播网络，AR4 igmpv2，&lt;/li>
&lt;li>CR1/CR2的loopback0接口选举bsr，配置优先级确保CR1成为bsr&lt;/li>
&lt;li>配置anycast RP，创建loopback10 0100.100.100./32，loopback10地址为c-rp&lt;/li>
&lt;li>配置msdp组播源发现协议&lt;/li>
&lt;li>AR4的g0/0/01.100，限制组播地址&lt;/li>
&lt;li>igmp加速离组&lt;/li>
&lt;/ul>
&lt;hr>
&lt;ul>
&lt;li>
&lt;p>AR1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> multicast routing-enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> multicast routing-enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR3&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> multicast routing-enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AR4&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> multicast routing-enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl number 2000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 5 permit source 224.1.1.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1.100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> igmp enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> igmp group-policy 2000 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> igmp prompt-leave group-policy 2000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>CR1&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> multicast routing-enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet1/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface LoopBack10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 100.100.100.100 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.100.100.100 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pim
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> c-bsr hash-length 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> c-bsr priority 255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> c-bsr LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> c-rp LoopBack10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">msdp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> originating-rp LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.6 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>CR2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> multicast routing-enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface LoopBack10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 100.100.100.100 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pim sm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bgp 64812
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> #
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv4-family unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.100.100.100 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pim
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> c-bsr hash-length 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> c-bsr LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> c-rp LoopBack10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">msdp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> originating-rp LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer 1.1.1.5 connect-interface LoopBack0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>验证&lt;/p>
&lt;ul>
&lt;li>
&lt;p>dis pim rp-info&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[AR4]dis pim bsr-info
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> VPN-Instance: public net
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Elected AdminScoped BSR Count: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Elected BSR Address: 1.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Priority: 255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Hash mask length: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> State: Accept Preferred
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Scope: Not scoped
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Uptime: 00:00:50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Expires: 00:01:20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> C-RP Count: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AR4]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AR4]dis pim rp-info
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> VPN-Instance: public net
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PIM-SM BSR RP Number:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Group/MaskLen: 224.0.0.0/4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RP: 100.100.100.100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Priority: 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Uptime: 00:00:56
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Expires: 00:01:34
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AR4]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>dis pim routing-table&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[CR1]dis pim routing-table
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> VPN-Instance: public net
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total 0 (*, G) entry; 1 (S, G) entry
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> (100.1.100.2, 224.1.1.1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RP: 100.100.100.100 (local)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Protocol: pim-sm, Flag: SPT 2MSDP LOC ACT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UpTime: 00:03:16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Upstream interface: Ethernet1/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Upstream neighbor: NULL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RPF prime neighbor: NULL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Downstream interface(s) information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total number of downstreams: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1: GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Protocol: pim-sm, UpTime: 00:03:16, Expires: 00:03:14
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[CR1]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[CR2]dis pim routing-table
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> VPN-Instance: public net
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total 1 (*, G) entry; 1 (S, G) entry
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> (*, 224.1.1.1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RP: 100.100.100.100 (local)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Protocol: pim-sm, Flag: WC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UpTime: 00:17:28
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Upstream interface: Register
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Upstream neighbor: NULL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RPF prime neighbor: NULL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Downstream interface(s) information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total number of downstreams: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1: GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Protocol: pim-sm, UpTime: 00:17:28, Expires: 00:03:02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> (100.1.100.2, 224.1.1.1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RP: 100.100.100.100 (local)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Protocol: pim-sm, Flag: SPT MSDP ACT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UpTime: 00:03:41
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Upstream interface: GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Upstream neighbor: 10.5.6.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RPF prime neighbor: 10.5.6.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Downstream interface(s) information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total number of downstreams: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1: GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Protocol: pim-sm, UpTime: 00:03:41, Expires: 00:02:49
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[CR2]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AR4]dis pim routing-table
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> VPN-Instance: public net
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total 1 (*, G) entry; 1 (S, G) entry
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> (*, 224.1.1.1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RP: 100.100.100.100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Protocol: pim-sm, Flag: WC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UpTime: 00:17:42
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Upstream interface: GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Upstream neighbor: 10.4.6.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RPF prime neighbor: 10.4.6.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Downstream interface(s) information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total number of downstreams: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1: GigabitEthernet0/0/1.100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Protocol: igmp, UpTime: 00:17:42, Expires: -
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> (100.1.100.2, 224.1.1.1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RP: 100.100.100.100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Protocol: pim-sm, Flag: SPT ACT
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UpTime: 00:03:55
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Upstream interface: GigabitEthernet0/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Upstream neighbor: 10.4.6.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> RPF prime neighbor: 10.4.6.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Downstream interface(s) information:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Total number of downstreams: 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1: GigabitEthernet0/0/1.100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Protocol: pim-sm, UpTime: 00:03:55, Expires: -
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[AR4]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>电脑安装vlc，ensp选择vlc安装路径，启动组播源服务器和PC4接收视频&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/19/cS86XbI1GBgy4dH.png">
&lt;img src="https://s2.loli.net/2024/07/19/cS86XbI1GBgy4dH.png"
loading="lazy"
alt="image-152518086"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="最后">最后
&lt;/h2>&lt;ul>
&lt;li>个人觉得整个拓扑的配置项还是挺多的，涉及的协议、框架、模型也挺多，有一定挑战&lt;/li>
&lt;li>现场8个小时给我整，我是整不出来，在没有做充足准备的前提下&lt;/li>
&lt;li>毕竟是实验，没有整防火墙双机热备&lt;/li>
&lt;li>毕竟是实验，RR还能跑数据和接入EBGP对等体&lt;/li>
&lt;li>毕竟是实验，AC与AC之间没有物理连线做状态监测&lt;/li>
&lt;li>毕竟是实验，单线路多逻辑互联&lt;/li>
&lt;li>……&lt;/li>
&lt;li>可能有更好的实现需求的配置答案（山外有山）&lt;/li>
&lt;li>文件存阿里云盘了，这是链接：[&lt;a class="link" href="https://www.alipan.com/s/sKaEyJg38HD" target="_blank" rel="noopener"
>分享的文件
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>]&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨。&lt;/li>
&lt;/ul></description></item><item><title>使用Selenium打开PNETLab拓扑并开启所有节点</title><link>https://weeaster.github.io/posts/ccacf283/</link><pubDate>Fri, 05 Jul 2024 12:37:38 +0000</pubDate><guid>https://weeaster.github.io/posts/ccacf283/</guid><description>&lt;p>在玩PNETLab模拟器实验遇到的小问题，从登陆PNETLab到能登陆拓扑里的设备这一段时间是很无聊且每次都是重复动作&lt;/p>
&lt;p>以前做测试就点点点没觉得是什么问题，但是设备数量多的大型拓扑，那是一个超长等待时间&lt;/p>
&lt;p>想过的方法是查查API，无功而返，而且也不熟&lt;/p>
&lt;p>最后使用Selenium实现功能&lt;/p>
&lt;h2 id="环境说明">环境说明
&lt;/h2>&lt;ul>
&lt;li>Selenium==4.22.0&lt;/li>
&lt;li>Python==Python 3.10.13&lt;/li>
&lt;li>PNETLab== 5.3.13&lt;/li>
&lt;li>ChromeDriver==126.0.6478.126&lt;/li>
&lt;li>PNETLab关闭验证码验证&lt;/li>
&lt;/ul>
&lt;h2 id="效果展示">效果展示
&lt;/h2>&lt;p>显示窗口执行（控制台同时输出）&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/05/mL9CGZEpQP34tKz.gif">
&lt;img src="https://s2.loli.net/2024/07/05/mL9CGZEpQP34tKz.gif"
loading="lazy"
alt="pnetlabstartall-2"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>无显示窗口执行（控制台输出）&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/07/05/SVGsxuDU84K97lw.gif">
&lt;img src="https://s2.loli.net/2024/07/05/SVGsxuDU84K97lw.gif"
loading="lazy"
alt="pnetlabstartall-4"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="脚本代码">脚本代码
&lt;/h2>&lt;p>就不过多文字描述了，代码里的注释有说明&lt;/p>
&lt;p>&lt;strong>Note1：PNETLab的打开速度和拓扑文件的载入速度有很多影响因素（电脑硬件，拓扑文件大小，镜像等）&lt;/strong>&lt;/p>
&lt;p>&lt;strong>Note2：如果你在本地运行代码后提示错误，大概率可以通过调整显式等待时间和隐式等待时间解决（PNETLab的版本也要考虑，有可能定位元素有变动）&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">selenium&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">webdriver&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">selenium.webdriver.common.by&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">By&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">selenium.webdriver.chrome.options&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Options&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">selenium.webdriver.chrome.service&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">selenium.webdriver.support.ui&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">WebDriverWait&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">selenium.webdriver.support&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">expected_conditions&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">EC&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">selenium.webdriver.common.action_chains&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">ActionChains&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">time&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">random&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 创建 ChromeOptions 对象&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">options&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">webdriver&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ChromeOptions&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 添加参数headless后不显示窗口&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">options&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_argument&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;--headless&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 控制台不显示INFO:CONSOLE，默认0，显示与服务端的的交互内容&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">options&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_argument&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;--log-level=3&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 4.6版本前需要指定路径，使用本地驱动&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 其实前后版本都可以使用本地驱动（本地好使，加载快，无须联网下载ChromeDriver）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 指定浏览器驱动路径，以Chrome为例（与电脑安装的谷歌浏览器版本大版本号一致即可或添加参数忽略（自己查））&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 当前日期（20240704）使用最新版本selenium==4.22.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># chromedriver_bin = &amp;#39;D:/Plugs/ChromeDriver/126.0.6478.126/chrome-win64/chromedriver.exe&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">chromedriver_bin&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;D:\Plugs\ChromeDriver\126.0.6478.126\chrome-win64\chromedriver.exe&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">service&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">webdriver&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ChromeService&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">executable_path&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">chromedriver_bin&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">driver&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">webdriver&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Chrome&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">service&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">service&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">options&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">options&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 4.6版本之后使用默认的实例，使用如下代码（自动联网下载ChromeDriver）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 当前日期（20240704）使用最新版本selenium==4.22.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># service = Service()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># driver = webdriver.Chrome(options=options, service=service)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># selenium参数定义&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 显式等待设置，等待最多10秒钟，每0.5秒检查一次条件是否满足&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 该参数对需要控制的元素定位起作用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">wait&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">WebDriverWait&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">driver&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 设置一个隐式等待时间，因为点击open后的loading时间不可预计&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 可能的因素有拓扑unl文件大小，电脑硬件配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 设置隐式等待时间为6秒，该参数全局作用，按需调整数值&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">driver&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">implicitly_wait&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 本地PNETLab登陆参数定义&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">login_url&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;http://x.x.x.x/&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">username&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;admin&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">password&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;pnet&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 自动登陆操作&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">pnetlab_login&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 打开PNETLab登陆页面登陆&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">driver&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">login_url&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 定位用户名输入框并输入用户名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">username_input&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">wait&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">until&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EC&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">visibility_of_element_located&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">By&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">XPATH&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;//input[@placeholder=&amp;#34;Username&amp;#34;]&amp;#39;&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">username_input&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">clear&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">username_input&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send_keys&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">username&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 定位密码输入框并输入密码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">password_input&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">wait&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">until&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EC&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">visibility_of_element_located&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">By&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">XPATH&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;//input[@placeholder=&amp;#34;Password&amp;#34;]&amp;#39;&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">password_input&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">clear&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">password_input&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send_keys&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">password&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 定位登录按钮并点击&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">login_button&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">driver&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_element&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">By&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">XPATH&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;//div[@class=&amp;#34;button btn btn-info&amp;#34; and text()=&amp;#34;Login&amp;#34;]&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">login_button&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">click&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 使用显式等待来等待搜索框元素出现&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">search_element&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">wait&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">until&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EC&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">visibility_of_element_located&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">By&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">XPATH&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;//input[@placeholder=&amp;#34;Search Labs&amp;#34;]&amp;#39;&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;登录成功!&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">True&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="ne">Exception&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;登录失败或者无法找到搜索框元素.&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">False&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 随机抽一个lab文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">random_lab&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lab_names&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;H1 CFG SPOTO Ver_1.unl&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;H1 Plus CFG SPOTO Ver_1.unl&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;H2 CFG SPOTO CCIE RS Ver_1.unl&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;H2 Plus CFG SPOTO Ver_1.unl&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;H3 SPOTO CCIE RS Ver_1.unl&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">chosen_lab&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">choice&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">lab_names&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">chosen_lab&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 登陆&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sign_in&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">pnetlab_login&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">sign_in&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&amp;gt;&amp;gt;&amp;gt;登陆有问题&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 随机抽&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">chosen_lab&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">random_lab&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;-&amp;#39;&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">50&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="sa">f&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">本次抽中的lab是:&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">chosen_lab&lt;/span>&lt;span class="p">[:&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 搜索框输入lab文件名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">search_element&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">wait&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">until&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EC&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">visibility_of_element_located&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">By&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">XPATH&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;//input[@placeholder=&amp;#34;Search Labs&amp;#34;]&amp;#39;&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">search_element&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">clear&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">search_element&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send_keys&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">chosen_lab&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 等待第一个搜索结果可见并点击&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sleep&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">first_button&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">wait&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">until&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">EC&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">visibility_of_element_located&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">By&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">XPATH&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;//div[@id=&amp;#39;search_lab_suggest&amp;#39;]/div[@class=&amp;#39;button&amp;#39;][1]&amp;#34;&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">first_button&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">click&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 等待第二个搜索结果可见并点击&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># second_button = wait.until(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># EC.visibility_of_element_located((By.XPATH, &amp;#34;//div[@id=&amp;#39;search_lab_suggest&amp;#39;]/div[@class=&amp;#39;button&amp;#39;][2]&amp;#34;)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># second_button.click()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 点击open按钮&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">open_button&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">driver&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_element&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">By&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CSS_SELECTOR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;div.box_flex &amp;gt; div.btn-info:nth-child(1)&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">open_button&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">click&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 等不到加载完成页面报错，调大隐式等待时间&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 触发左侧菜单的元素，左下角log图片class类&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">leftmenu_trigger&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">driver&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_element&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">By&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CLASS_NAME&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;logo_img&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 创建 ActionChains 对象&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">actions&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ActionChains&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">driver&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 移动鼠标到左侧菜单触发元素上，触发菜单显示&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">actions&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">move_to_element&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">leftmenu_trigger&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">perform&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 点击Setup Nodes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">setup_nodes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">driver&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_element&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">By&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">XPATH&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;//span[text()=&amp;#34;Setup Nodes&amp;#34;]&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">setup_nodes&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">click&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Start All Nodes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">start_all&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">driver&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_element&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">By&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CLASS_NAME&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s2">&amp;#34;action-nodesstart&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">start_all&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">click&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 查看已启动的IOL Nodes 的数值&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 移动鼠标到左侧菜单触发元素上，触发菜单显示&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">actions&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">move_to_element&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">leftmenu_trigger&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">perform&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 点击System status&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">system_status&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">driver&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_element&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">By&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">XPATH&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;//span[text()=&amp;#34;System Status&amp;#34;]&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">system_status&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">click&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;-&amp;#39;&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">50&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">正在启动设备&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 30秒后获取已启动设备数值&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># time.sleep(30)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 循环获取启动的设备数值，间隔10秒获取一次，共5分钟&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="n">x&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">30&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sleep&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">started&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">wait&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">until&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EC&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">presence_of_element_located&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">By&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">XPATH&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;//td/strong[@style=&amp;#39;color: red;&amp;#39;]&amp;#34;&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 打印已启动设备数值&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;已启动设备数:&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">started&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">text&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nb">int&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">started&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">text&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="mi">40&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sleep&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s1">&amp;#39;设备启动完成，打开链接&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">login_url&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s1">,开始实验&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">3&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;-&amp;#39;&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">50&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># //////////////////////////////////////////////////////////////////////////////////&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># # destroy lab 退出&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># # 测试用，随后可能用不到&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># # time.sleep(10)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># print(&amp;#39;正在关闭设备\n&amp;#39;)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># # 移动鼠标到左侧菜单触发元素上，触发菜单显示&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># actions.move_to_element(leftmenu_trigger).perform()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># # 点击Destroy Lab&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># destroy_lab = driver.find_element(By.XPATH, &amp;#39;//span[text()=&amp;#34;Destroy Lab&amp;#34;]&amp;#39;)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># destroy_lab.click()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># # 定位弹窗的 Destroy 按钮&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># destroy_button = driver.find_element(By.CLASS_NAME, &amp;#34;swal2-confirm&amp;#34;)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># # 定位弹窗的 Cancel 按钮&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># # cancel_button = driver.find_element(By.CLASS_NAME, &amp;#34;swal2-cancel&amp;#34;)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># # 二次确认点击&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># destroy_button.click()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># # 循环获取启用的设备数值，间隔10秒获取一次，共5分钟&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># x = 600&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># while x &amp;gt; 0:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># time.sleep(10)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># started = WebDriverWait(driver, 10).until(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># EC.presence_of_element_located((By.XPATH, &amp;#34;//td/strong[@style=&amp;#39;color: red;&amp;#39;]&amp;#34;))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># )&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># # 打印剩余启动设备数值&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># print(&amp;#34;剩余启动设备数:&amp;#34;, started.text)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># if int(started.text) &amp;lt; 10:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># break&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># x -= 1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># print(&amp;#39;设备已关闭\n&amp;#39; * 3 + &amp;#39;-&amp;#39; * 50)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># time.sleep(10)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># //////////////////////////////////////////////////////////////////////////////////&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="ne">Exception&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&amp;gt;&amp;gt;&amp;gt;OPS,FUCKED UP&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">finally&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 关闭浏览器驱动&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">driver&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">quit&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="vm">__name__&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">main&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="最后">最后
&lt;/h2>&lt;ul>
&lt;li>忽略代码中变量名的命名拼写错误，词汇量紧张&lt;/li>
&lt;li>部分代码来自GPT，官网示例（注意看版本对应的示例）&lt;/li>
&lt;li>大部分时间都耗在定位元素了，pnet为了玩花样或是抄来不想改这html前端也是无限套壳&lt;/li>
&lt;li>有些是前端渲染代码是通过java函数生成的，这就有点不好玩了&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨。&lt;/li>
&lt;/ul></description></item><item><title>多子网分支的第3阶段分层DMVPN实验</title><link>https://weeaster.github.io/posts/638be305/</link><pubDate>Fri, 17 May 2024 16:13:59 +0000</pubDate><guid>https://weeaster.github.io/posts/638be305/</guid><description>&lt;p>以前了解过DMVPN组网，没发现还有这么个分层组网的模型，于是玩一玩做个记录&lt;/p>
&lt;p>Cisco网站文档链接： &lt;a class="link" href="https://www.cisco.com/c/zh_cn/support/docs/security/dynamic-multipoint-vpn-dmvpn/211292-Configure-Phase-3-Hierarchical-DMVPN-wit.html" target="_blank" rel="noopener"
>https://www.cisco.com/c/zh_cn/support/docs/security/dynamic-multipoint-vpn-dmvpn/211292-Configure-Phase-3-Hierarchical-DMVPN-wit.html
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/p>
&lt;p>华为的说法是Hub级联网络部署DSVPN&lt;/p>
&lt;p>华为网站文档链接： &lt;a class="link" href="https://support.huawei.com/enterprise/zh/doc/EDOC1100271739/baf3c434" target="_blank" rel="noopener"
>https://support.huawei.com/enterprise/zh/doc/EDOC1100271739/baf3c434
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/p>
&lt;p>&lt;strong>一段蹩脚的Cisco网站机器翻译原文&lt;/strong>&lt;/p>
&lt;p>分层设置（大于一级）允许更复杂的基于树的DMVPN网络拓扑。基于树的拓扑允许使用区域集线器构建DMVPN网络，区域集线器是中心集线器的分支。此体系结构允许区域中心处理其区域分支的数据和下一跳解析协议(NHRP)控制流量。但是，它仍允许在DMVPN网络内的任何分支之间构建分支到分支隧道，无论它们是否位于同一区域。此架构还允许DMVPN网络布局更紧密地匹配区域或分层数据流模式。&lt;/p>
&lt;h2 id="dmvpn的组成">DMVPN的组成
&lt;/h2>&lt;ol>
&lt;li>多GRE隧道&lt;/li>
&lt;li>NHRP&lt;/li>
&lt;li>动态路由协议&lt;/li>
&lt;li>IPSec加密&lt;/li>
&lt;/ol>
&lt;p>配置思路也是分这四个步骤，本人觉得DMVPN的精髓在于NHRP协议，这个协议可以使Spoke站点之间动态建立隧道，新增Spoke站点无须改动Hub端配置，看上去很智能哦&lt;/p>
&lt;h2 id="实验逻辑拓扑">实验逻辑拓扑
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/05/17/R8tbOLimrvfyBKJ.png">
&lt;img src="https://s2.loli.net/2024/05/17/R8tbOLimrvfyBKJ.png"
loading="lazy"
alt="image-20240516152212789"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="实验物理拓扑">实验物理拓扑
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/05/17/J4mckBb8fnpIDFe.png">
&lt;img src="https://s2.loli.net/2024/05/17/J4mckBb8fnpIDFe.png"
loading="lazy"
alt="image-20240516025005087"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>&lt;strong>最终的效果&lt;/strong>（例如：R4的192.168.4.0/24网段去往R6的192.168.6.0/24网段一跳可达）&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/05/17/ZE1AL9r4OXimSuh.png">
&lt;img src="https://s2.loli.net/2024/05/17/ZE1AL9r4OXimSuh.png"
loading="lazy"
alt="image-20240516233604433"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="配置过程">配置过程
&lt;/h2>&lt;h3 id="基础配置">基础配置
&lt;/h3>&lt;p>包括IP地址，去往ISP的默认路由等&lt;/p>
&lt;p>基础配置完成后各Hub路由器和Spoke路由器可以ping通各个公网IP地址&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1#ping 100.28.28.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte ICMP Echos to 100.28.28.2, timeout is 2 seconds:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">..!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 60 percent (3/5), round-trip min/avg/max = 4/5/7 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#ping 200.28.28.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte ICMP Echos to 200.28.28.2, timeout is 2 seconds:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 2/2/3 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#ping 100.38.38.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte ICMP Echos to 100.38.38.3, timeout is 2 seconds:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 2/2/4 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#ping 200.38.38.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte ICMP Echos to 200.38.38.3, timeout is 2 seconds:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 2/2/4 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#ping 100.48.48.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte ICMP Echos to 100.48.48.4, timeout is 2 seconds:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 2/3/5 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#ping 100.58.58.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte ICMP Echos to 100.58.58.5, timeout is 2 seconds:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 2/3/4 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#ping 100.68.68.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte ICMP Echos to 100.68.68.6, timeout is 2 seconds:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 2/2/4 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#ping 100.78.78.7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte ICMP Echos to 100.78.78.7, timeout is 2 seconds:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 2/3/4 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#ping 8.8.8.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte ICMP Echos to 8.8.8.8, timeout is 2 seconds:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 1/1/2 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="多gre隧道">多GRE隧道
&lt;/h3>&lt;p>Central Hub 与 Hub1，Hub2 配置tunnel&lt;/p>
&lt;p>mGRE与单GRE的配置区别在于隧道模式 multipoint 和填写远端destination地址&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">！配置R1,R2,R3的tunnel，注意修改tunnel的IP地址，R2，R3 如法炮制
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">！R1 Tunnel0 （R1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.0.0.1 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel source Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel mode gre multipoint
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel key 12345
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Hub1，Hub2 ，Spoke配置tunnel&lt;/p>
&lt;p>在Hub1，Hub2上配置tunnel 1（与Spoke建立隧道使用）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">！ Hub1 Tunnel1 （R2)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.0.1.2 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip redirects
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel source Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel mode gre multipoint
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel key 12345
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">！ Hub2 Tunnel1 （R3)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.0.2.3 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip redirects
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel source Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel mode gre multipoint
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel key 12345
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">！ Spoke1 （R4)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.0.1.4 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip redirects
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel source Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel mode gre multipoint
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel key 12345
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ！ 其他Spoke站点如法炮制
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="nhrp">NHRP
&lt;/h3>&lt;p>Central Hub的配置（R1)&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">！Central Hub （R1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip nhrp authentication cisco # 配置nhrp认证(可选)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip nhrp map multicast dynamic # 动态接受组播映射，(Version 15.7(3)M2 版本默认开启)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip nhrp network-id 123 # network-id，很重要，当前这个拓扑需要同一配置，原因是影响nhrp解析请求的发送
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip nhrp redirect # nhrp的重定向，Hub向spoke发送重定向消息
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Hub1和Hub2的配置（以Hub1为例（R2)）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">！ Hub 1 （R2)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip nhrp authentication cisco
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip nhrp map 10.0.0.1 100.18.18.1 # 隧道地址对应的公网地址映射
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip nhrp map multicast 100.18.18.1 # 组播对应的公网地址映射
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip nhrp network-id 123 # network-id，很重要，当前这个拓扑需要同一配置，原因是影响nhrp解析请求的发送
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip nhrp nhs 10.0.0.1 # 配置nhs，spoke向nhs注册
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip nhrp shorcut # Hub1和Hub2是Central Hub的Spoke (Version 15.7(3)M2 版本默认开启)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip nhrp redirect # 当前这个拓扑，需要配置这一项，因为在配置动态路由协议后，R3去往R4和R5业务网段的下一跳是R2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip nhrp authentication cisco
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip nhrp network-id 123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip nhrp redirect
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Spoke1,2,3,4的配置（以Spoke1和Spoke3为例）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">！Spoke 1 （R4)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip nhrp authentication cisco
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip nhrp map 10.0.1.2 200.28.28.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip nhrp map multicast 200.28.28.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip nhrp network-id 123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip nhrp nhs 10.0.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">！Spoke 3 （R6)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip nhrp authentication cisco
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip nhrp network-id 123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip nhrp nhs 10.0.2.3 nbma 200.38.38.3 multicast # 一次性配置nhs,映射地址
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>在配置完成mGRE和NHRP之后，产生流量之后（ping测试）应该可以观察到以下现象&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Hub1(R2)到Hub2(R3)的tunnel地址形成动态映射和动态隧道，跟踪路径查看到一跳可达&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/05/17/fvQMnquVr98ytge.png">
&lt;img src="https://s2.loli.net/2024/05/17/fvQMnquVr98ytge.png"
loading="lazy"
alt="image-20240516170204803"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Spoke1(R4)到Spoke2(R5)的tunnel地址形成动态映射和动态隧道，跟踪路径查看到一跳可达&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/05/17/OEwfcxm1dbiLQrn.png">
&lt;img src="https://s2.loli.net/2024/05/17/OEwfcxm1dbiLQrn.png"
loading="lazy"
alt="image-20240516170409590"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Spoke3(R6)到Spoke4(R7)的tunnel地址形成动态映射和动态隧道，跟踪路径查看到一跳可达&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/05/17/2fE4NeGJSnqyHul.png">
&lt;img src="https://s2.loli.net/2024/05/17/2fE4NeGJSnqyHul.png"
loading="lazy"
alt="image-20240516170521889"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="动态路由协议">动态路由协议
&lt;/h3>&lt;p>可选的协议RIP、EIGRP、OSPF、BGP、ODR&lt;/p>
&lt;p>本实验业务网络选用OSPF，Central Hub，Hub1和Hub2设计在Area0；Hub1和Spoke1，Spoke2设计在Area1；Hub2和Spoke3，Spoke4设计在Area2；&lt;/p>
&lt;p>根据组网情况分析，OSPF的网络类型可选的有广播、点到多点；&lt;/p>
&lt;p>本实验选用广播，因为在配置tunnel 的ospf网络类型为广播后，同一个hub下的spoke站点能学习到优化下一跳后的路由，注意修改Spoke的ospf优先级为0不参与DR选举；&lt;/p>
&lt;p>（配置tunnel 的ospf网络类型为点到多点后，spoke站点在产生分支站点流量后会对路由进行override， % - next hop override ，O之后有%符号）&lt;/p>
&lt;p>Central Hub，Hub1和Hub2的OSPF配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">！Central Hub （R1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 110
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 1.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 10.0.0.1 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.1.1 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf network broadcast # 修改tunnel0接口ospf网络类型为广播
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Loopback1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf network point-to-point # 修改环回接口网络类型为点到点
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">！ Hub 1 （R2)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 110
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 2.2.2.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 10.0.0.2 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.2.1 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf network broadcast # 修改tunnel0接口ospf网络类型为广播
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf priority 0 # 修改ospf 优先级为0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Loopback1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf network point-to-point # 修改环回接口网络类型为点到点
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">！Hub 2 （R3)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 110
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 3.3.3.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 10.0.0.3 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.3.1 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf network broadcast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf priority 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Loopback1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf network point-to-point
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Hub1和Spoke1，Spoke2的配置；Hub2和Spoke3，Spoke4的配置如法炮制即可&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">！ Hub 1 （R2)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 110
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 10.0.1.2 0.0.0.0 area 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf network broadcast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">！Spoke 1 （R4)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 4.4.4.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 10.0.1.4 0.0.0.0 area 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 192.168.4.1 0.0.0.0 area 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf network broadcast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf priority 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Loopback1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf network point-to-point
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">！Spoke 2 （R5)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 110
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 5.5.5.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 10.0.1.5 0.0.0.0 area 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 192.168.5.1 0.0.0.0 area 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf network broadcast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf priority 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Loopback1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf network point-to-point
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>配置完成以上内容后，可以观察到的现象（例如：R5的192.168.5.0/24网段去往R7的192.168.7.0/24网段一跳可达）&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/05/17/v28wm1Rp6qoQSzj.png">
&lt;img src="https://s2.loli.net/2024/05/17/v28wm1Rp6qoQSzj.png"
loading="lazy"
alt="image-20240516233848193"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="ipsec加密">IPSec加密
&lt;/h3>&lt;p>配置ISAKMP第一阶段策略&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">crypto isakmp policy 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> encr 3des
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hash md5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> authentication pre-share
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> group 2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>配置ISAKMP预共享密码&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">crypto isakmp key Cisco@123 address 0.0.0.0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>配置IPSec策略（转换集）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">crypto ipsec transform-set DMVPN esp-3des esp-md5-hmac
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mode transport
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>配置IPSec profile&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">crypto ipsec profile DMVPN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set transform-set DMVPN
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>调用IPSec profile&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">interface Tunnel0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel protection ipsec profile DMVPN
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>以上命令配置完成后，使用命令sh run | s crypto 查看配置，复制粘贴到其他设备上，然后在在tunnel接口调用&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1#sh run | s crypto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">crypto isakmp policy 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> encr 3des
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hash md5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> authentication pre-share
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> group 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">crypto isakmp key Cisco@123 address 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">crypto ipsec transform-set DMVPN esp-3des esp-md5-hmac
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mode transport
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">crypto ipsec profile DMVPN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set transform-set DMVPN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Hub1和Hub2接口调用时后边添加share可能遇到只有一个隧道起来的情况（不懂是模拟器bug还是怎么滴），按照思科官网配置两个不同名称的ipsec profile再次进行调用，可以解决&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2#sh run | s crypto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">crypto isakmp policy 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> encr 3des
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hash md5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> authentication pre-share
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> group 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">crypto isakmp key Cisco@123 address 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">crypto ipsec transform-set DMVPN esp-3des esp-md5-hmac
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mode transport
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">crypto ipsec profile DMVPN-0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set transform-set DMVPN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">crypto ipsec profile DMVPN-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set transform-set DMVPN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>验证加密&lt;/strong>&lt;/p>
&lt;p>在R4上清空会话&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4#clea crypto session
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#sh crypto engine connections active
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Crypto Engine Connections
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ID Type Algorithm Encrypt Decrypt LastSeqN IP-Address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 45 IPsec 3DES+MD5 0 2 2 100.48.48.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 46 IPsec 3DES+MD5 2 0 0 100.48.48.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1016 IKE MD5+3DES 0 0 0 100.48.48.4
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>使用ping命令产生数据&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4#ping 192.168.7.1 source 192.168.4.1 repeat 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 100, 100-byte ICMP Echos to 192.168.7.1, timeout is 2 seconds:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Packet sent with a source address of 192.168.4.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (100/100), round-trip min/avg/max = 4/10/27 ms
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>查看加解密数据包计数&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4#sh crypto engine connections active
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Crypto Engine Connections
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ID Type Algorithm Encrypt Decrypt LastSeqN IP-Address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 45 IPsec 3DES+MD5 0 13 13 100.48.48.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 46 IPsec 3DES+MD5 13 0 0 100.48.48.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 47 IPsec 3DES+MD5 0 0 0 100.48.48.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 48 IPsec 3DES+MD5 92 0 0 100.48.48.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 49 IPsec 3DES+MD5 0 93 93 100.48.48.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 50 IPsec 3DES+MD5 0 0 0 100.48.48.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1016 IKE MD5+3DES 0 0 0 100.48.48.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1017 IKE MD5+3DES 0 0 0 100.48.48.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1018 IKE MD5+3DES 0 0 0 100.48.48.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示，加密或解密的数量分别超过100&lt;/p>
&lt;h2 id="nhrp工作流程">NHRP工作流程
&lt;/h2>&lt;p>详细的可以去思科网站看看，这里贴个图&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/05/17/QJ2OBd39G4HR6cL.gif">
&lt;img src="https://s2.loli.net/2024/05/17/QJ2OBd39G4HR6cL.gif"
loading="lazy"
alt="img"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>大致单向流程（以Spoke1（192.168.4.1）到Spoke4（192.168.7.1）为例）：&lt;/p>
&lt;ol>
&lt;li>当Spoke1首次与Spoke4进行通信（第一个数据包流，比如ping）或动态隧道已过期，icmp request 到达Hub1，查询nhrp缓存，发现没有192.168.7.1的缓存记录，icmp request 根据路由表和nhrp迭代转发到Hub1&lt;/li>
&lt;li>Hub1收到icmp request ，由于Hub1不是192.168.7.1的终点，于是向Spoke1发送nhrp 重定向（指示Spoke1发nhrp request），同时icmp request 根据路由表和nhrp迭代转发到Central Hub&lt;/li>
&lt;li>Central Hub收到icmp request，由于Central Hub不是192.168.7.1的终点，于是向Spoke1发送nhrp 重定向（往tunnel0发送，Hub1收到后再转发到tunnel1上，指示Spoke1发nhrp request，），同时icmp request 根据路由表和nhrp迭代转发到Hub2&lt;/li>
&lt;li>Hub2收到icmp request，由于Hub2不是192.168.7.1的终点，于是向Spoke1发送nhrp 重定向（往tunnel0发送，再转发到tunnel1，指示Spoke1发nhrp request），同时icmp request 根据路由表和nhrp迭代转发到Spoke4&lt;/li>
&lt;li>Spoke4收到icmp request，由于Spoke4是192.168.7.1的终点，在收到Spoke1的nhrp request于是向Spoke1发送Resolution Reply（沿着来的的路径逐条转发回去） ，icmp request 到达目的地&lt;/li>
&lt;/ol>
&lt;p>返回流程也是经过一轮重定向的操作，因为当icmp request 到达目的地后，Spoke4的nhrp缓存也没有192.168.4.1的条目或者说没有形成动态的tunnel&lt;/p>
&lt;p>通过debug nhrp packet观察，nhrp的重定向、 request 消息在几十毫秒内全部完成&lt;/p>
&lt;p>R2和R3之间也会发送重定向和request，因为运行了ospf协议，R2和R3之间有Spoke的路由（例如R2去往R6，R7的下一跳是R3的tunnel接口地址）&lt;/p>
&lt;p>假设R2和R3直接已经形成动态隧道（R2ping通R3的tunnel0接口）那么Spoke1（192.168.4.1）到Spoke4（192.168.7.1）的首次通信跟踪路径如下&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4#tra 192.168.6.1 sou 192.168.4.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Tracing the route to 192.168.6.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">VRF info: (vrf in name/id, vrf out name/id)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 10.0.1.2 9 msec 8 msec 8 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2 10.0.0.3 11 msec 11 msec 15 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3 10.0.2.6 19 msec * 14 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">在路由器上使用命令清空nhrp缓存，再次使用trace可以看到数据包经过了R1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#clea ip nhrp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#clea ip nhrp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3#clea ip nhrp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#clea ip nhrp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R6#clea ip nhrp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#tra 192.168.6.1 sou 192.168.4.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Tracing the route to 192.168.6.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">VRF info: (vrf in name/id, vrf out name/id)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 10.0.1.2 11 msec 11 msec 9 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2 10.0.0.1 11 msec 11 msec 17 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3 10.0.0.3 19 msec 13 msec 12 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 4 10.0.2.6 18 msec * 14 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="spoke站点外网地址">Spoke站点外网地址
&lt;/h2>&lt;p>Spoke站点是静态或动态的公网IP不影响&lt;/p>
&lt;p>但是如果Spoke站点的出口地址是私网地址呢？不要惊奇，十几年前就发现有这种现象了，或者说Spoke站点上一级有NAT设备，这种情况下DMVPN仍然可用（前提是运营商没把UDP500给干掉）&lt;/p>
&lt;p>在上面的拓扑R7和R8之间添加R9，配置NAT，R7和R9之间配置10.79.79.0网段，完成配置后发现R7学习路由和连通性测试没有问题，R3上观察nhrp缓存如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3#sh ip nhrp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">10.0.0.1/32 via 10.0.0.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel0 created 00:12:47, never expire
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type: static, Flags: used
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> NBMA address: 100.18.18.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">10.0.2.6/32 via 10.0.2.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel1 created 00:12:35, expire 00:09:08
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type: dynamic, Flags: registered used nhop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> NBMA address: 100.68.68.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">10.0.2.7/32 via 10.0.2.7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tunnel1 created 00:00:25, expire 00:09:35
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Type: dynamic, Flags: registered used nhop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> NBMA address: 100.89.89.9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> (Claimed NBMA address: 10.79.79.7)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">比正常的显示多了一行 (Claimed NBMA address: 10.79.79.7)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>R9上查看NAT转换，是不是很熟悉哈，在IPSec VPN穿越NAT的时候也出现过这种情况，所以我想说DMVPN是IPSec VPN 的PLUS+PRO+MAX升级版&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R9#sh ip nat translations
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Pro Inside global Inside local Outside local Outside global
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">udp 100.89.89.9:500 10.79.79.7:500 100.58.58.5:500 100.58.58.5:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">udp 100.89.89.9:500 10.79.79.7:500 200.38.38.3:500 200.38.38.3:500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">udp 100.89.89.9:4500 10.79.79.7:4500 100.58.58.5:4500 100.58.58.5:4500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">udp 100.89.89.9:4500 10.79.79.7:4500 200.38.38.3:4500 200.38.38.3:4500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R9#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="经典结尾扯蛋">经典结尾扯蛋
&lt;/h2>&lt;ul>
&lt;li>整了这么个实验，精华部分也就是nhrp的重定向和Spoke站点之间的动态隧道&lt;/li>
&lt;li>在本人接触过的Hub和Spoke组网的项目中，也就接触过IPSec VPN，分支站点向中心传数据的情况，至于站点和站点互通的少见&lt;/li>
&lt;li>其实使用DMVPN组网也能完成分支站点仅向中心传数据；在实际的项目中怀疑是参杂了一些利益因素导致这种组网少见，可能是我见识短浅；因为这种技术也不会向友商设备提供对接，跟你对接了我岂不是少赚钱了&lt;/li>
&lt;li>而IPSec VPN则不同，它是一个安全框架，遵守框架开发理论上都能对接，本人提到的第二点的项目中对接的设备有深信服，华三，华为，迈普，绿盟，都组网正常运行了&lt;/li>
&lt;li>做完这个实验去瞄了一眼华为的DSVPN，配置项差不多，命令表现形式不一样&lt;/li>
&lt;li>配置存阿里云盘了，这是链接：[&lt;a class="link" href="https://www.alipan.com/s/Bpdw7YeYPZt" target="_blank" rel="noopener"
>分享的文件
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>]&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨。&lt;/li>
&lt;/ul></description></item><item><title>Miniconda安装使用（简单版）</title><link>https://weeaster.github.io/posts/f2cfb11/</link><pubDate>Fri, 08 Mar 2024 21:43:10 +0000</pubDate><guid>https://weeaster.github.io/posts/f2cfb11/</guid><description>&lt;p>因为之前重装了系统，很多软件设置需要恢复，特别是&lt;code>Python环境&lt;/code>。最近小玩了一下&lt;code>Pyqt&lt;/code>，接触到了&lt;code>Anaconda&lt;/code>这个巨无霸软件&lt;/p>
&lt;p>看了官网介绍它的用途，觉得完全用不到这么多功能，安装&lt;code>Anaconda&lt;/code>后文件已经到达10G&lt;/p>
&lt;p>再翻了翻发现还有个类似精简版的&lt;code>Miniconda&lt;/code>，觉得可以用来管理虚拟环境&lt;/p>
&lt;p>这篇文记录安装和使用过程&lt;/p>
&lt;hr>
&lt;h2 id="下载miniconda">下载Miniconda
&lt;/h2>&lt;p>官网下载链接：https://docs.anaconda.com/free/miniconda/miniconda-other-installer-links/&lt;/p>
&lt;p>本着稳定能用的优先原则，并考虑到之前编写的代码一直使用Python3.10版本，我选择这个版本&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/03/08/twhCPopiSqu5KUH.jpg">
&lt;img src="https://s2.loli.net/2024/03/08/twhCPopiSqu5KUH.jpg"
loading="lazy"
alt="ScreenCaputure240308220008"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>&lt;strong>注意&lt;/strong>：使用这个版本只是为了全局使用Python3.10，仍然可以通过指定高版本的Python创建虚拟环境，安装完成后可以通过命令&lt;code>conda search python&lt;/code> 查看虚拟环境支持的版本&lt;/p>
&lt;hr>
&lt;h2 id="安装miniconda">安装Miniconda
&lt;/h2>&lt;p>基本一路Next按钮，以下几个步骤需注意&lt;/p>
&lt;ol>
&lt;li>
&lt;p>安装类型，由于我的电脑叫PC，我选Just Me&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/03/08/JWKzRZk4si1qrGE.jpg">
&lt;img src="https://s2.loli.net/2024/03/08/JWKzRZk4si1qrGE.jpg"
loading="lazy"
alt="ScreenCaputure240308220726"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>虽然是Mini版本，但是安装完成后占用的磁盘空间还是挺大，选其他盘&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/03/08/Su2Q7pyb5xcLElq.jpg">
&lt;img src="https://s2.loli.net/2024/03/08/Su2Q7pyb5xcLElq.jpg"
loading="lazy"
alt="ScreenCaputure240308221015"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>高级选项&lt;/p>
&lt;ol>
&lt;li>第一个复选框是创建开始菜单（觉得用处不大，保持默认）&lt;/li>
&lt;li>第二个复选框是添加软件的环境变量，红字已经提示不推荐并列明了原因，也可以不勾后面自己手动去添加环境变量&lt;/li>
&lt;li>第三个复选框是指定Python3.10为默认版本，相当于给电脑安装Python，所以如果在安装Miniconda前安装了Python，原先安装的就用不到了，可删；安装完成后Python的路径在minicoda3路径下；如果你不是这重装系统的情况，建议先把原来使用的全局环境或虚拟环境导出requirements.txt（pip freeze &amp;gt; requirements.txt），以便于恢复全局环境或虚拟环境&lt;/li>
&lt;/ol>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/03/08/RikcgzMxaNrQTtU.jpg">
&lt;img src="https://s2.loli.net/2024/03/08/RikcgzMxaNrQTtU.jpg"
loading="lazy"
alt="ScreenCaputure240308221251"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="设置miniconda">设置Miniconda
&lt;/h2>&lt;p>这是清华开源软件镜像站的一个网页，Anaconda 镜像使用帮助https://mirrors.tuna.tsinghua.edu.cn/help/anaconda/&lt;/p>
&lt;p>我看了一下目前用不到这些内容，conda软件自带包管理（它本身就是管理），例如&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> 安装包：
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> conda install package_name 安装满足依赖关系的最新版本的包
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> conda install package_name=x.x 安装指定版本的包
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pip install netmiko==3.4.0 安装指定版本的包
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pip install netmiko&amp;gt;=3.4.0 安装指定版本及以上的包
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 卸载包：
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> conda uninstall xxx，conda remove xxx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pip uninstall SomePackage
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>我还是习惯用pip命令，但是还是照着网页的说明操作了，也不知道为什么&lt;/p>
&lt;hr>
&lt;h2 id="基本使用">基本使用
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>查看全局的Python版本和Python路径&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">D:\&amp;gt;python -V
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Python 3.10.13
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">D:\&amp;gt;where python
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">D:\miniconda3\python.exe
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示当前的Python版本是3.10.13，安装路径是D:\miniconda3\python.exe，以上输出表明安装完成&lt;/p>
&lt;/li>
&lt;li>
&lt;p>查看conda信息，命令：&lt;code>conda info&lt;/code>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/03/08/YMqWuQy5tIwA8No.jpg">
&lt;img src="https://s2.loli.net/2024/03/08/YMqWuQy5tIwA8No.jpg"
loading="lazy"
alt="ScreenCaputure240308225050"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>结果显示 &lt;code>package cache&lt;/code>和 &lt;code>envs directories&lt;/code>的路径在 &lt;code>D:\miniconda3\&lt;/code>， package cache是缓存已下载的包文件，envs directories是存放虚拟环境文件&lt;/p>
&lt;/li>
&lt;li>
&lt;p>创建一个名称为&lt;code>pyqt-base&lt;/code>的虚拟环境（指定Python版本3.8，默认安装3.8的最高版本，也可以指定具体的版本如python=3.8.8）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">D&lt;/span>&lt;span class="p">:&lt;/span>\&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">conda&lt;/span> &lt;span class="n">create&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="n">pyqt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">base&lt;/span> &lt;span class="n">python&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">3.8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Channels&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">defaults&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Platform&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">win&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Collecting&lt;/span> &lt;span class="n">package&lt;/span> &lt;span class="n">metadata&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">repodata&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">json&lt;/span>&lt;span class="p">):&lt;/span> &lt;span class="n">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Solving&lt;/span> &lt;span class="n">environment&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">## Package Plan ##&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">environment&lt;/span> &lt;span class="n">location&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">D&lt;/span>&lt;span class="p">:&lt;/span>\&lt;span class="n">miniconda3&lt;/span>\&lt;span class="n">envs&lt;/span>\&lt;span class="n">pyqt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">base&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">added&lt;/span> &lt;span class="o">/&lt;/span> &lt;span class="n">updated&lt;/span> &lt;span class="n">specs&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">python&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">3.8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">The&lt;/span> &lt;span class="n">following&lt;/span> &lt;span class="n">packages&lt;/span> &lt;span class="n">will&lt;/span> &lt;span class="n">be&lt;/span> &lt;span class="n">downloaded&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">package&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">build&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">---------------------------|-----------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ca&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">certificates&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">2023.12&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">12&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">haa95532_0&lt;/span> &lt;span class="mi">127&lt;/span> &lt;span class="n">KB&lt;/span> &lt;span class="n">defaults&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pip&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">23.3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">py38haa95532_0&lt;/span> &lt;span class="mf">2.8&lt;/span> &lt;span class="n">MB&lt;/span> &lt;span class="n">defaults&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">python&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">3.8&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">18&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">h1aa4202_0&lt;/span> &lt;span class="mf">20.5&lt;/span> &lt;span class="n">MB&lt;/span> &lt;span class="n">defaults&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">setuptools&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">68.2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">py38haa95532_0&lt;/span> &lt;span class="mi">933&lt;/span> &lt;span class="n">KB&lt;/span> &lt;span class="n">defaults&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sqlite&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">3.41&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">h2bbff1b_0&lt;/span> &lt;span class="mi">894&lt;/span> &lt;span class="n">KB&lt;/span> &lt;span class="n">defaults&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">vc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">14.2&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">h21ff451_1&lt;/span> &lt;span class="mi">8&lt;/span> &lt;span class="n">KB&lt;/span> &lt;span class="n">defaults&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">wheel&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">0.41&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="n">py38haa95532_0&lt;/span> &lt;span class="mi">126&lt;/span> &lt;span class="n">KB&lt;/span> &lt;span class="n">defaults&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">------------------------------------------------------------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Total&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">25.3&lt;/span> &lt;span class="n">MB&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">The&lt;/span> &lt;span class="n">following&lt;/span> &lt;span class="n">NEW&lt;/span> &lt;span class="n">packages&lt;/span> &lt;span class="n">will&lt;/span> &lt;span class="n">be&lt;/span> &lt;span class="n">INSTALLED&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ca&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">certificates&lt;/span> &lt;span class="n">anaconda&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">pkgs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">main&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">win&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">ca&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">certificates&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">2023.12&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">12&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">haa95532_0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">libffi&lt;/span> &lt;span class="n">anaconda&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">pkgs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">main&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">win&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">libffi&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">3.4&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">hd77b12b_0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">openssl&lt;/span> &lt;span class="n">anaconda&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">pkgs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">main&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">win&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">openssl&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">3.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">13&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">h2bbff1b_0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pip&lt;/span> &lt;span class="n">anaconda&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">pkgs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">main&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">win&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">pip&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">23.3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">py38haa95532_0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">python&lt;/span> &lt;span class="n">anaconda&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">pkgs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">main&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">win&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">python&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">3.8&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">18&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">h1aa4202_0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">setuptools&lt;/span> &lt;span class="n">anaconda&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">pkgs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">main&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">win&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">setuptools&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">68.2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">py38haa95532_0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sqlite&lt;/span> &lt;span class="n">anaconda&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">pkgs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">main&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">win&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">sqlite&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">3.41&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">h2bbff1b_0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">vc&lt;/span> &lt;span class="n">anaconda&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">pkgs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">main&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">win&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">vc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">14.2&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">h21ff451_1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">vs2015_runtime&lt;/span> &lt;span class="n">anaconda&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">pkgs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">main&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">win&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">vs2015_runtime&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">14.27&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">29016&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">h5e58377_2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">wheel&lt;/span> &lt;span class="n">anaconda&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">pkgs&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">main&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">win&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">wheel&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">0.41&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">py38haa95532_0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Proceed&lt;/span> &lt;span class="p">([&lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="err">?&lt;/span> &lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Downloading&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">Extracting&lt;/span> &lt;span class="n">Packages&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Preparing&lt;/span> &lt;span class="n">transaction&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Verifying&lt;/span> &lt;span class="n">transaction&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Executing&lt;/span> &lt;span class="n">transaction&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># To activate this environment, use&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># $ conda activate pyqt-base&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># To deactivate an active environment, use&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># $ conda deactivate&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">D&lt;/span>&lt;span class="p">:&lt;/span>\&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>命令：conda create -n pyqt-base python=3.8&lt;/p>
&lt;/li>
&lt;li>
&lt;p>虚拟环境查看&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">D&lt;/span>&lt;span class="p">:&lt;/span>\&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">conda&lt;/span> &lt;span class="n">activate&lt;/span> &lt;span class="n">pyqt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">base&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="n">pyqt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">base&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">D&lt;/span>&lt;span class="p">:&lt;/span>\&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">python&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="n">V&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Python&lt;/span> &lt;span class="mf">3.8&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">18&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="n">pyqt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">base&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">D&lt;/span>&lt;span class="p">:&lt;/span>\&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">pip&lt;/span> &lt;span class="n">list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Package&lt;/span> &lt;span class="n">Version&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">----------&lt;/span> &lt;span class="o">-------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">pip&lt;/span> &lt;span class="mf">23.3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">setuptools&lt;/span> &lt;span class="mf">68.2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">wheel&lt;/span> &lt;span class="mf">0.41&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="n">pyqt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">base&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">D&lt;/span>&lt;span class="p">:&lt;/span>\&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示Python版本为Python 3.8.18，已安装的包有三个，窗口的提示符行前面多了虚拟环境的名称。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>conda设置全局pip国内源&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">(pyqt-base) D:\&amp;gt;pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Writing to C:\Users\xxx\AppData\Roaming\pip\pip.ini
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(pyqt-base) D:\&amp;gt;pip config list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">global.index-url=&amp;#39;https://pypi.tuna.tsinghua.edu.cn/simple&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(pyqt-base) D:\&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示，在C盘的C:\Users\xxx\AppData\Roaming\pip\创建了一个pip.ini文件，查看配置可以看到对应配置&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在虚拟环境下安装pyqt5&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="n">pyqt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">base&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">D&lt;/span>&lt;span class="p">:&lt;/span>\&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">pip&lt;/span> &lt;span class="n">install&lt;/span> &lt;span class="n">pyqt5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Looking&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">indexes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">pypi&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tuna&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tsinghua&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">edu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cn&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">simple&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Collecting&lt;/span> &lt;span class="n">pyqt5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Downloading&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">pypi&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tuna&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tsinghua&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">edu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cn&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">packages&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ca&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">ac&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">596e8&lt;/span>&lt;span class="n">ca16fd0634542d874c0d79219fc527ea7de73a5000092f60ecbf6e9&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">PyQt5&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">5.15&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cp37&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">abi3&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">win_amd64&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">whl&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mf">6.8&lt;/span> &lt;span class="n">MB&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">----------------------------------------&lt;/span> &lt;span class="mf">6.8&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">6.8&lt;/span> &lt;span class="n">MB&lt;/span> &lt;span class="mf">3.3&lt;/span> &lt;span class="n">MB&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">s&lt;/span> &lt;span class="n">eta&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Collecting&lt;/span> &lt;span class="n">PyQt5&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sip&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="mi">13&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="mf">12.13&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">from&lt;/span> &lt;span class="n">pyqt5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Downloading&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">pypi&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tuna&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tsinghua&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">edu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cn&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">packages&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">88&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">cd&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">dd21cdb92d053ca71c02c75ab7bd32874b82b33bef61d6d70b5d898e684b&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">PyQt5_sip&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">12.13&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cp38&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cp38&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">win_amd64&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">whl&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">78&lt;/span> &lt;span class="n">kB&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">----------------------------------------&lt;/span> &lt;span class="mf">78.3&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">78.3&lt;/span> &lt;span class="n">kB&lt;/span> &lt;span class="mf">189.0&lt;/span> &lt;span class="n">kB&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">s&lt;/span> &lt;span class="n">eta&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Collecting&lt;/span> &lt;span class="n">PyQt5&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Qt5&lt;/span>&lt;span class="o">&amp;gt;=&lt;/span>&lt;span class="mf">5.15&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">from&lt;/span> &lt;span class="n">pyqt5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Downloading&lt;/span> &lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">pypi&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tuna&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tsinghua&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">edu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cn&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">packages&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">37&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">97&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="n">d3b222b924fa2ed4c2488925155cd0b03fd5d09ee1cfcf7c553c11c9f66&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">PyQt5_Qt5&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">5.15&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">py3&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">none&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">win_amd64&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">whl&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mf">50.1&lt;/span> &lt;span class="n">MB&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">----------------------------------------&lt;/span> &lt;span class="mf">50.1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">50.1&lt;/span> &lt;span class="n">MB&lt;/span> &lt;span class="mf">7.8&lt;/span> &lt;span class="n">MB&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">s&lt;/span> &lt;span class="n">eta&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Installing&lt;/span> &lt;span class="n">collected&lt;/span> &lt;span class="n">packages&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">PyQt5&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Qt5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">PyQt5&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sip&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">pyqt5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Successfully&lt;/span> &lt;span class="n">installed&lt;/span> &lt;span class="n">PyQt5&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Qt5&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">5.15&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="n">PyQt5&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sip&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">12.13&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="n">pyqt5&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">5.15&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="n">pyqt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">base&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">D&lt;/span>&lt;span class="p">:&lt;/span>\&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">pip&lt;/span> &lt;span class="n">list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Package&lt;/span> &lt;span class="n">Version&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">----------&lt;/span> &lt;span class="o">-------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">pip&lt;/span> &lt;span class="mf">23.3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">PyQt5&lt;/span> &lt;span class="mf">5.15&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">PyQt5&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Qt5&lt;/span> &lt;span class="mf">5.15&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">PyQt5&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">sip&lt;/span> &lt;span class="mf">12.13&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">setuptools&lt;/span> &lt;span class="mf">68.2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">wheel&lt;/span> &lt;span class="mf">0.41&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="n">pyqt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">base&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">D&lt;/span>&lt;span class="p">:&lt;/span>\&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="一些conda命令">一些conda命令
&lt;/h2>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Command&lt;/th>
&lt;th>Useage&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>conda create -n myenv sqlite | python=x.x&lt;/td>
&lt;td>Create an environment containing the package sqlite or python&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>conda remove -n myenv &amp;ndash;all&lt;/td>
&lt;td>Remove all packages from environment &lt;code>myenv&lt;/code> and the environment itself&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>conda env list&lt;/td>
&lt;td>List the Conda environments&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>conda clean &amp;ndash;all&lt;/td>
&lt;td>Remove index cache, lock files, unused cache packages, tarballs, and logfiles&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>conda clean &amp;ndash;i&lt;/td>
&lt;td>Remove index cache&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>conda clean &amp;ndash;p&lt;/td>
&lt;td>Remove unused packages from writable package caches. WARNING: This does not check for packages installed using symlinks back to the package cache.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>conda search xxx&lt;/td>
&lt;td>Search for packages and display&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>conda activate myenv&lt;/td>
&lt;td>To activate this environment&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>conda deactivate&lt;/td>
&lt;td>To deactivate an active environment&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>conda create -n env2 &amp;ndash;clone path/to/file/env1&lt;/td>
&lt;td>Create an environment (env2) as a clone of an existing environment (env1)&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table></description></item><item><title>使用floccus插件同步谷歌浏览器书签</title><link>https://weeaster.github.io/posts/1e210a39/</link><pubDate>Tue, 27 Feb 2024 15:18:08 +0000</pubDate><guid>https://weeaster.github.io/posts/1e210a39/</guid><description>&lt;p>谷歌浏览器由于特殊地区原因无法使用原生同步功能，之前也一直使用这个插件实现书签同步，本来用着也就没什么事&lt;/p>
&lt;p>重装系统后想着能从云端把书签恢复回来，奈何忘记备份&lt;code>floccus插件&lt;/code>里面的加密密码了，而且是两台电脑都重装了，至此原先的书签彻底沦陷无法恢复，wc&lt;/p>
&lt;p>错误造成的后果已经无法挽回&lt;/p>
&lt;p>就写篇文记录一下floccus插件的安装使用过程&lt;/p>
&lt;hr>
&lt;h2 id="下载安装插件">下载安装插件
&lt;/h2>&lt;p>网址：https://floccus.org/download/&lt;/p>
&lt;p>github：https://github.com/floccusaddon/floccus/releases&lt;/p>
&lt;p>从网站中可以看到支持三大浏览器，我只用到谷歌的，其他两浏览器使用自带的同步功能&lt;/p>
&lt;p>如果不能从页面跳转后下载，自行&lt;code>想想办法&lt;/code>（比如github,gitee）&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/02/27/yswfGhoZ5crUBtd.jpg">
&lt;img src="https://s2.loli.net/2024/02/27/yswfGhoZ5crUBtd.jpg"
loading="lazy"
alt="ScreenCaputure240227153113"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="设置webdav">设置WebDAV
&lt;/h2>&lt;p>从你使用的各种网盘中找一个支持&lt;code>WebDAV协议&lt;/code>的，我使用坚果云&lt;/p>
&lt;ol>
&lt;li>
&lt;p>登陆坚果云网页版，导航栏右侧点击&lt;code>用户名称&lt;/code>，点击&lt;code>账户信息&lt;/code>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/02/27/cDUu9P6vMNXylhs.jpg">
&lt;img src="https://s2.loli.net/2024/02/27/cDUu9P6vMNXylhs.jpg"
loading="lazy"
alt="ScreenCaputure240227154328"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>选择&lt;code>安全选项&lt;/code>，点击&lt;code>添加应用&lt;/code>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/02/27/vZfNqecAWmCMsKD.jpg">
&lt;img src="https://s2.loli.net/2024/02/27/vZfNqecAWmCMsKD.jpg"
loading="lazy"
alt="ScreenCaputure240227154829"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>输入&lt;code>应用名称&lt;/code>，&lt;code>生产密码&lt;/code>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/02/27/cwrz4h1WPjKlOpt.jpg">
&lt;img src="https://s2.loli.net/2024/02/27/cwrz4h1WPjKlOpt.jpg"
loading="lazy"
alt="ScreenCaputure240227154911"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="创建xbel文件上传坚果云">创建.xbel文件上传坚果云
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>电脑本地创建一个&lt;code>.xbel&lt;/code>后缀的文件，文件命名没硬性要求，建议使用英文且标明文件用途的文件名，我使用&lt;code>bookmarks.xbel&lt;/code>。打开方式选记事本，输入以下内容后保存文件&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;!DOCTYPE xbel PUBLIC &amp;#34;+//IDN python.org//DTD XML Bookmark Exchange Language 1.0//EN//XML&amp;#34; &amp;#34;http://pyxml.sourceforge.net/topics/dtds/xbel.dtd&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;xbel version=&amp;#34;1.0&amp;#34;&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;/xbel&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>坚果云网页版新建一个文件夹&lt;code>Floccus_2024&lt;/code>，把&lt;code>bookmarks.xbel&lt;/code>文件上传至该文件夹&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/02/27/SwAcinUoqPMsalO.jpg">
&lt;img src="https://s2.loli.net/2024/02/27/SwAcinUoqPMsalO.jpg"
loading="lazy"
alt="ScreenCaputure240227155749"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="设置floccus参数">设置floccus参数
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>谷歌浏览器找到已经安装好的floccus插件，点击图标，点击新建账户&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/02/27/HB5knszTgYxFGRC.jpg">
&lt;img src="https://s2.loli.net/2024/02/27/HB5knszTgYxFGRC.jpg"
loading="lazy"
alt="ScreenCaputure240227160106"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在要如何同步中选择WebDAV分享&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/02/27/IaoDeQSsv9w27Og.jpg">
&lt;img src="https://s2.loli.net/2024/02/27/IaoDeQSsv9w27Og.jpg"
loading="lazy"
alt="ScreenCaputure240227160305"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在要同步到哪个服务器中填写参数，参数在坚果云网页版-安全选项，两个密码，第一个是坚果云的应用密码，第二个加密密码，我搞忘记的就第二个&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/02/27/WiYjGQHweL4vquZ.jpg">
&lt;img src="https://s2.loli.net/2024/02/27/WiYjGQHweL4vquZ.jpg"
loading="lazy"
alt="ScreenCaputure240227160858"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>填写书签路径，坚果云网页版中上传的.xbel文件路径，本地文件夹选书签栏&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/02/27/o8Vr9bPAFR4HTNK.jpg">
&lt;img src="https://s2.loli.net/2024/02/27/o8Vr9bPAFR4HTNK.jpg"
loading="lazy"
alt="ScreenCaputure240227161215"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>设置同步间隔，同步策略，没特殊喜好保持默认即可&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/02/27/IQdHX4DKVwA7fzs.jpg">
&lt;img src="https://s2.loli.net/2024/02/27/IQdHX4DKVwA7fzs.jpg"
loading="lazy"
alt="ScreenCaputure240227161355"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>创建完成&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/02/27/ISL6sqTYh8OilK3.jpg">
&lt;img src="https://s2.loli.net/2024/02/27/ISL6sqTYh8OilK3.jpg"
loading="lazy"
alt="ScreenCaputure240227161520"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>点击floccus插件图标，查看有无报错信息，至此已完成所有设置&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/02/27/O6sqTI3vbzMKg8u.jpg">
&lt;img src="https://s2.loli.net/2024/02/27/O6sqTI3vbzMKg8u.jpg"
loading="lazy"
alt="ScreenCaputure240227161639"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="测试同步功能">测试同步功能
&lt;/h2>&lt;p>在谷歌浏览器手动添加书签，然后点击floccus的同步按钮&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/02/27/HmdPSloOLKTurUs.jpg">
&lt;img src="https://s2.loli.net/2024/02/27/HmdPSloOLKTurUs.jpg"
loading="lazy"
alt="ScreenCaputure240227162047"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>再到坚果云网页版查看文件变化，从结果看已经添加了一个文件版本，由于使用了加密，将文件下载回本地打开查看会发现是类似乱码文件&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/02/27/3ebqxPsKUHNk9Zd.jpg">
&lt;img src="https://s2.loli.net/2024/02/27/3ebqxPsKUHNk9Zd.jpg"
loading="lazy"
alt="ScreenCaputure240227162226"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;hr>
&lt;h2 id="其它电脑同步">其它电脑同步
&lt;/h2>&lt;p>由于我还有另外的设备也使用谷歌浏览器，需要一并操作，可以手动操作重复上一步骤&lt;/p>
&lt;p>机智如我使用导入/导出 账户功能，在另外一台电脑的操作就不演示了，过程：安装插件&amp;ndash;导入&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/02/27/hTXBgpMoEkSWHD5.jpg">
&lt;img src="https://s2.loli.net/2024/02/27/hTXBgpMoEkSWHD5.jpg"
loading="lazy"
alt="ScreenCaputure240227162705"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/02/27/2REQ7CewWJvo5rd.jpg">
&lt;img src="https://s2.loli.net/2024/02/27/2REQ7CewWJvo5rd.jpg"
loading="lazy"
alt="ScreenCaputure240227162830"
>
&lt;/a>
&lt;/div>
&lt;/p></description></item><item><title>MPLS排错练习题-故障排除</title><link>https://weeaster.github.io/posts/464b24f1/</link><pubDate>Thu, 01 Feb 2024 16:57:52 +0000</pubDate><guid>https://weeaster.github.io/posts/464b24f1/</guid><description>&lt;p>在51cto博客https://blog.51cto.com/dashu666/2163481 看到达叔的这份MPLS排错练习题分享文章，心痒痒决定手搓玩一玩&lt;/p>
&lt;p>MPLS 环境如下图，现由于前面负责实施的工程师离职，留下烂尾工程，请按下面截图找出目前配置存在的错误并修复，要求项目部署完毕之后所有检查命令输出要和下面截图一致。
要求R7 和R8两个站点通信必须经过R6的全局处理、要求R6 的 vrfA 和 R7、R8能够直接通信&lt;/p>
&lt;p>同时要求交一份排除故障的文档。
要求在文档中指出配置错误的地方，以及产生的影响，解决的方案。
不能使用任何静态路由、不允许修改 R4、R5 的 VRF 配置、不允许修改 R6的BGP配置&lt;/p>
&lt;hr>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2024/02/01/cmZPLOSuElAsx3N.jpg">
&lt;img src="https://s2.loli.net/2024/02/01/cmZPLOSuElAsx3N.jpg"
loading="lazy"
alt="ScreenCaputure240201002259"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="排查r1到1011232的mpls标签转发问题">排查R1到10.1.1.2/32的MPLS标签转发问题
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>在R1上输入命令ping mpls ipv4 10.1.1.2/32 source 10.1.1.1，验证R1到10.1.1.2/32的MPLS标签转发过程问题存在&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1#ping mpls ipv4 10.1.1.2/32 source 10.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.2/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.....
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 0 percent (0/5)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>在R1上使用命令show mpls forwarding-table 查看LFIB&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1#show mpls forwarding-table
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Local Outgoing Prefix Bytes Label Outgoing Next Hop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Label Label or Tunnel Id Switched interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">102 Pop Label 10.1.1.3/32 0 Et0/0 13.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">103 304 10.1.1.2/32 0 Et0/0 13.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">104 307 10.1.1.5/32 0 Et0/0 13.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">105 306 10.1.1.4/32 0 Et0/0 13.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">106 No Label 10.6.6.6/32[V] 0 Et0/1.1 16.1.1.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">107 No Label 0.0.0.0/0[V] 0 Et0/1.2 16.1.2.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">108 No Label 10.6.6.6/32[V] 0 Et0/1.2 16.1.2.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R1去往R2的10.1.1.2有出方向标签，下一步检查R3设备的LFIB&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R3上使用命令show mpls forwarding-table 查看LFIB&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3#sh mpls forwarding-table
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Local Outgoing Prefix Bytes Label Outgoing Next Hop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Label Label or Tunnel Id Switched interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">300 No Label 13.1.1.0/24 0 drop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">301 No Label 23.1.1.0/24 0 drop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">302 No Label 34.1.1.0/24 0 drop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">303 No Label 35.1.1.0/24 0 drop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">304 No Label 10.1.1.2/32 0 drop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">305 No Label 10.1.1.1/32 0 drop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">306 No Label 10.1.1.4/32 0 drop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">307 No Label 10.1.1.5/32 0 drop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R3没有去往10.1.1.1/32和10.1.1.2/32的出方向标签，下一步检查R3上的LDP邻居关系&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R3上使用命令show mpls ldp neighbor 查看LDP邻居&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3#show mpls ldp neighbor
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Peer LDP Ident: 10.1.1.1:0; Local LDP Ident 10.1.1.3:0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> TCP connection: 10.1.1.1.646 - 10.1.1.3.59329
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> State: Oper; Msgs sent/rcvd: 56/52; Downstream
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Up time: 00:37:37
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> LDP discovery sources:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Ethernet0/0, Src IP addr: 13.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Addresses bound to peer LDP Ident:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 13.1.1.1 10.1.1.1 16.1.3.1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R3上有与R1的LDP邻居，没有与R2建立LDP邻居，下一步检查R3上LDP进程&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R3上使用命令show mpls ldp discovery 查看LDP进程信息&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3#show mpls ldp discovery
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Local LDP Identifier:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 10.1.1.3:0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Discovery Sources:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Interfaces:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Ethernet0/0 (ldp): xmit/recv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> LDP Id: 10.1.1.1:0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Ethernet0/1 (ldp): xmit/recv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> LDP Id: 10.22.22.22:0; no route
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Ethernet0/2 (ldp): xmit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Ethernet0/3 (ldp): xmit
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R3使用10.1.1.3为LDP router-id与对端建立LDP邻居，在Ethernet0/1收到 LDP ID为10.22.22.22的LDP报文且提示没有路由到达，而Ethernet0/1连接的是R2，怀疑R2上手动指定了10.22.22.22为LDP的router-id或LDP自动选举了该地址作为router-id，且该地址没有宣告底层IGP协议；R3与R1能建立LDP邻居，下一步检查R3的cef特性是否启用&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R3上使用用命令show ip cef 查看cef是否启用&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3#show ip cef
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">%IPv4 CEF not running
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R3没有启用cef特性，而FIB的形成依赖cef特性，因此需要启用设备的cef特性&lt;/p>
&lt;p>在R3上使用命令ip cef 启用cef&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3(config)#ip cef
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>在R3上使用命令show mpls forwarding-table 查看LFIB&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3#sh mpls forwarding-table
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Local Outgoing Prefix Bytes Label Outgoing Next Hop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Label Label or Tunnel Id Switched interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">304 No Label 10.1.1.2/32 0 Et0/1 23.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">305 Pop Label 10.1.1.1/32 0 Et0/0 13.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">306 No Label 10.1.1.5/32 0 Et0/3 35.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">307 No Label 10.1.1.4/32 0 Et0/2 34.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R3上已经有去往10.1.1.1/32的出方向标签，下一步检查R2的LDP配置&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R上使用命令show mpls ldp discovery 查看LDP进程信息&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2#show mpls ldp discovery
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Local LDP Identifier:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 10.22.22.22:0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Discovery Sources:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Interfaces:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Ethernet0/1 (ldp): xmit/recv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> LDP Id: 10.1.1.3:0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R2使用10.22.22.22作为LDP的router-id，下一步检查R2上是否手动指定了10.22.22.22为LDP的router-id或LDP自动选举了该地址作为router-id&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R2上使用命令show run | include router-id查看是否手动指定了LDP的router-id&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2#show run | include router-id
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mpls ldp router-id Loopback1 force
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R2上手动指定了Loopback1接口地址为router-id，下一步查看R2的所有环回接口地址配置&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R2上使用命令show ip interface brief | include Loopback 查看环回接口地址配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2#show ip interface brief | include Loopback
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Loopback0 10.1.1.2 YES TFTP up up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Loopback1 10.22.22.22 YES TFTP up up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>继续使用命令show running-config interface loopback 0 和 show running-config interface loopback 1 查看两个环回接口的配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2#show running-config interface loopback 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Building configuration...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Current configuration : 82 bytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Loopback0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.1.1.2 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf 110 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#show running-config interface loopback 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Building configuration...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Current configuration : 67 bytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Loopback1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.22.22.22 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>综合以上结果显示，R2使用了手动设置LDP的router-id，这样手动指定router-id的配置本身没有问题，然而Loopback1并没有宣告进OSPF 110 进程，导致R3上没有10.22.22.22/32的路由，双方不能形成LDP邻居关系；&lt;/p>
&lt;p>LDP邻居关系的建立是标签相互学习的的前提，需要解决R2和R3的LDP邻居建立问题&lt;/p>
&lt;p>解决方案：&lt;/p>
&lt;p>在R3使用命令手动指定Loopback0接口为LDP的router-id&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2(config)#mpls ldp router-id Loopback0 force
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>从命令show running-config interface loopback 0查看到的结果显示Loopback0配置24位掩码的地址，在ospf网络中思科路由器会默认认为环回接口的ospf网络类型为LOOPBACK，无论环回接口是否配置32位掩码地址都会以32位掩码地址宣告进ospf进程中&lt;/p>
&lt;p>R2本地LDP标签分配会为10.1.1.0/24分配标签，并不会为R2上不存在的10.1.1.2/32分配标签，R3虽然本地为10.1.1.2/32分配的本地标签，但是没有从R2上学习到10.1.1.2/32的标签&lt;/p>
&lt;p>解决方案如下&lt;/p>
&lt;p>R2上修改Loopback0的地址掩码为32位掩码&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2(config)#interface loopback 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2(config-if)# ip address 10.1.1.2 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2(config-if)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>在R1上输入命令ping mpls ipv4 10.1.1.2/32 source 10.1.1.1，验证R1到10.1.1.2/32的MPLS标签转发过程问题是否存在&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1#ping mpls ipv4 10.1.1.2/32 source 10.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.2/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 38/138/181 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R1到10.1.1.2/32的MPLS标签转发过程问题已经解决&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="排查mpls网络中其他设备标签转发问题">排查MPLS网络中其他设备标签转发问题
&lt;/h2>&lt;p>在上一步骤中在R3查看到没有R4和R5的LDP邻居，MPLS网络中IGP网络的标签转发出现问题，客户CE设备流量进入MPLS网络将不能转发到远端目的地。&lt;/p>
&lt;ol>
&lt;li>
&lt;p>检查R4的LDP配置&lt;/p>
&lt;ol>
&lt;li>
&lt;p>R4上使用show mpls ldp discovery 检查LDP进程&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4#show mpls ldp discovery
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示没有信息，下一步检查接口是否启用mpls ip和是否全局启用mpls ip&lt;/p>
&lt;/li>
&lt;li>
&lt;p>R4上使用show mpls interfaces 检查LDP接口信息&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4#show mpls interfaces
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Interface IP Tunnel BGP Static Operational
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R4的Ethernet0/2接口没有启用mpls ip，下一步在R4将接口启用mpls ip&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R4上使用命令mpls ip将ethernet 0/2启用LDP&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4(config)#interface ethernet 0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config-if)#mpls ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config-if)#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 30 17:52:31.200: %LDP-5-NBRCHG: LDP Neighbor 10.1.1.3:0 (1) is UP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config-if)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R4与10.1.1.3建立LDP邻居，下一步检查R4是否学习到MPLS网络中其他设备的出接口标签&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R4上使用命令show mpls forwarding-table 查看FLIB&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4#show mpls forwarding-table
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Local Outgoing Prefix Bytes Label Outgoing Next Hop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Label Label or Tunnel Id Switched interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">400 305 10.1.1.1/32 0 Et0/2 34.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">401 302 10.1.1.2/32 0 Et0/2 34.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">402 Pop Label 10.1.1.3/32 0 Et0/2 34.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">403 306 10.1.1.5/32 0 Et0/2 34.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R4上有到MPLS网络中其他设备的出接口标签&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>
&lt;p>检查R5的LDP配置&lt;/p>
&lt;ol>
&lt;li>
&lt;p>在R5上使用命令show mpls ldp discovery 检查LDP进程&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5#show mpls ldp discovery
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Local LDP Identifier:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 10.1.1.5:0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Discovery Sources:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Interfaces:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Ethernet0/3 (tdp): xmit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R5的Ethernet0/3使用标签协议为tdp，而R3上使用的是LDP协议，下一步修改R5使用LDP协议&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R5上使用命令mpls label protocol ldp 修改标签协议为LDP&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5(config)#mpls label protocol ldp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config)#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 30 18:07:49.748: %LDP-5-NBRCHG: LDP Neighbor 10.1.1.3:0 (1) is UP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示在R5上修改标签协议后已经和10.1.1.3建立了邻居，下一步检查R5是否学习到MPLS网络中其他设备的出接口标签&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R5上使用命令show mpls forwarding-table 查看LFIB&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5#show mpls forwarding-table
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Local Outgoing Prefix Bytes Label Outgoing Next Hop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Label Label or Tunnel Id Switched interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">501 307 10.1.1.4/32 0 Et0/3 35.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">502 Pop Label 10.1.1.3/32 0 Et0/3 35.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">503 302 10.1.1.2/32 0 Et0/3 35.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">504 305 10.1.1.1/32 0 Et0/3 35.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R5上有到MPLS网络中其他设备的出接口标签&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>
&lt;p>检查各PE设备环回接口之间的标签转发是否正常&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1#ping mpls ipv4 10.1.1.2/32 source 10.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.2/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 113/170/211 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#ping mpls ipv4 10.1.1.3/32 source 10.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.3/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 53/214/497 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#ping mpls ipv4 10.1.1.4/32 source 10.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.4/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 144/193/312 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#ping mpls ipv4 10.1.1.5/32 source 10.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.5/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 166/227/293 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2#ping mpls ipv4 10.1.1.1/32 source 10.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.1/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 81/167/201 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#ping mpls ipv4 10.1.1.3/32 source 10.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.3/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 69/144/169 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#ping mpls ipv4 10.1.1.4/32 source 10.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.4/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 47/205/442 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#ping mpls ipv4 10.1.1.5/32 source 10.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.5/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 26/146/196 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3#ping mpls ipv4 10.1.1.1/32 source 10.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.1/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 186/201/231 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3#ping mpls ipv4 10.1.1.2/32 source 10.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.2/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 191/218/281 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3#ping mpls ipv4 10.1.1.4/32 source 10.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.4/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 192/201/213 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3#ping mpls ipv4 10.1.1.5/32 source 10.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.5/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 189/224/314 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4#ping mpls ip 10.1.1.1/32 source 10.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.1/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 187/221/309 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#ping mpls ip 10.1.1.2/32 source 10.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.2/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 187/224/273 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#ping mpls ip 10.1.1.3/32 source 10.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.3/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 193/201/210 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#ping mpls ip 10.1.1.5/32 source 10.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.5/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 193/216/230 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5#ping mpls ip 10.1.1.1/32 source 10.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.1/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 64/177/230 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5#ping mpls ip 10.1.1.2/32 source 10.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.2/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 103/213/464 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5#ping mpls ip 10.1.1.3/32 source 10.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.3/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 62/154/187 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5#ping mpls ip 10.1.1.4/32 source 10.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte MPLS Echos to 10.1.1.4/32,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> timeout is 2 seconds, send interval is 0 msec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Codes: &amp;#39;!&amp;#39; - success, &amp;#39;Q&amp;#39; - request not sent, &amp;#39;.&amp;#39; - timeout,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;L&amp;#39; - labeled output interface, &amp;#39;B&amp;#39; - unlabeled output interface,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;D&amp;#39; - DS Map mismatch, &amp;#39;F&amp;#39; - no FEC mapping, &amp;#39;f&amp;#39; - FEC mismatch,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;M&amp;#39; - malformed request, &amp;#39;m&amp;#39; - unsupported tlvs, &amp;#39;N&amp;#39; - no label entry,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;P&amp;#39; - no rx intf label prot, &amp;#39;p&amp;#39; - premature termination of LSP,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;R&amp;#39; - transit router, &amp;#39;I&amp;#39; - unknown upstream index,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;X&amp;#39; - unknown return code, &amp;#39;x&amp;#39; - return code 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 173/278/642 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R1，R2，R3，R4，R5的标签转发为正常状态&lt;/p>
&lt;/li>
&lt;li>
&lt;p>MPLS优化&lt;/p>
&lt;ol>
&lt;li>
&lt;p>手动指定LDP的router-id&lt;/p>
&lt;p>R1，R3，R4，R5的LDP router-id为自动选举，当后续在这些路由器上创建的IP地址比loopback 0地址大时，LDP进程重启或设备重启，这些设备将自动选举地址大的环回接口为router-id，而这些环回接口地址很可能没有宣告进OSPF 100 ，这会导致LDP邻居不能建立从而产生MPLS标签断裂问题&lt;/p>
&lt;p>在R1，R3，R4，R5上使用命令mpls ldp router-id Loopback0 force手动指定LDP的router-id&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1(config)#mpls ldp router-id loopback 0 force
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3(config)#mpls ldp router-id loopback 0 force
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4(config)#mpls ldp router-id loopback 0 force
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5(config)#mpls ldp router-id loopback 0 force
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>R5上使用命令show running-config interface e 0/3查看Ethernet0/3接口配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5#show running-config interface e 0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Building configuration...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Current configuration : 182 bytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 35.1.1.5 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf network point-to-point
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf demand-circuit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf 110 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> duplex auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls propagate-cos
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示该接口下配置了mpls propagate-cos，该命令用于在PE-CE接口的出口处启用，此命令从MPLS报头中的EXP值派生IP DSCP值，然后在IP报头中重写此值。由于拓扑中的MPLS网络没有配置QoS内容，删除该命令不会对现有网络造成影响&lt;/p>
&lt;p>在R5上使用命令no mpls propagate-cos 删除该配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5(config)#interface ethernet 0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config-if)#no mpls propagate-cos
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config-if)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="排查r6r7和r8的路由问题">排查R6，R7和R8的路由问题
&lt;/h2>&lt;p>要求R7 和R8两个站点通信必须经过R6的全局处理、要求R6 的 vrfA 和 R7、R8能够直接通信&lt;/p>
&lt;p>不能使用任何静态路由、不允许修改 R4、R5 的 VRF 配置、不允许修改 R6的BGP配置&lt;/p>
&lt;h3 id="流量模型分析">流量模型分析
&lt;/h3>&lt;p>要求R7 和R8两个站点通信必须经过R6的全局处理&lt;/p>
&lt;ol>
&lt;li>根据需求可以判断出这是一个HUB-SPOKE组网结构，R6为HUB，R7和R8为SPOKE&lt;/li>
&lt;li>PE学习到总部CE和分支CE的路由，然后通过MPLS VPNV4传递到对端PE，总部CE和分支CE再从PE学习路由&lt;/li>
&lt;li>总部和分支同时使用BGP 200 AS号码，根据as-path防环原则，总部不会学习到分支路由，分支也不会学习到总部路由，需要在PE上设置as-override或在CE设备配置 allowas-in&lt;/li>
&lt;li>R7和R8处于BGP 200，且同时接入相同BGP 100 的不同PE，需要考虑R7和R8之间的不合理次优路径问题&lt;/li>
&lt;/ol>
&lt;h3 id="排查步骤">排查步骤
&lt;/h3>&lt;ol>
&lt;li>排查R1，R4和R5是否学习到客户CE上的路由&lt;/li>
&lt;li>排查R1，R4和R5是否能学习对应PE的路由&lt;/li>
&lt;li>排查R7和R8是否存在次优路径&lt;/li>
&lt;/ol>
&lt;h3 id="排查r1r4和r5是否学习到客户ce上的路由">排查R1，R4和R5是否学习到客户CE上的路由
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>在R1上使用命令show bgp vpnv4 unicast all 查看VPNV4路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1#show bgp vpnv4 unicast all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 4, local router ID is 10.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status codes: s suppressed, d damped, h history, * valid, &amp;gt; best, i - internal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> x best-external, a additional-path, c RIB-compressed,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> t secondary path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Origin codes: i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RPKI validation codes: V valid, I invalid, N Not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop Metric LocPrf Weight Path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 100:200 (default for vrf SPOKE)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 0.0.0.0 16.1.2.6 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.6.6.6/32 16.1.2.6 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 200:100 (default for vrf HUB)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.6.6.6/32 16.1.1.6 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R1学习到了R6上的10.6.6.6/32路由，下一步检查R4和R5&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R4上使用命令show bgp vpnv4 unicast all 查看VPNV4路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4#show bgp vpnv4 unicast all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 4, local router ID is 10.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status codes: s suppressed, d damped, h history, * valid, &amp;gt; best, i - internal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> x best-external, a additional-path, c RIB-compressed,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> t secondary path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Origin codes: i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RPKI validation codes: V valid, I invalid, N Not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop Metric LocPrf Weight Path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 100:200 (default for vrf A)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.7.7.7/32 47.1.1.7 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.8.8.8/32 10.1.1.5 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R4上学习到R7和R8上的路由，下一步检查R3上的VPNV4路由&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R3上使用命令show bgp vpnv4 unicast all 查看VPNV4路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3#show bgp vpnv4 unicast all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 18, local router ID is 10.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status codes: s suppressed, d damped, h history, * valid, &amp;gt; best, i - internal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> x best-external, a additional-path, c RIB-compressed,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> t secondary path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Origin codes: i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RPKI validation codes: V valid, I invalid, N Not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop Metric LocPrf Weight Path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 100:200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 0.0.0.0 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.6.6.6/32 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.7.7.7/32 10.1.1.4 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.8.8.8/32 10.1.1.5 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 200:100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.6.6.6/32 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R3上能学习到R6，R7和R8的路由，这说明R3与R1，R4和R5的VPNV4邻居关系正常，怀疑是R1，R4和R5上的VRF RT配置有问题，下一步检查R1，R4和R5上的VRF RT配置&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R1上使用命令&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1#show running-config | section vrf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vrf HUB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rd 200:100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vrf SPOKE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rd 100:200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip vrf forwarding HUB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip vrf forwarding SPOKE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> address-family ipv4 vrf HUB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 16.1.1.6 remote-as 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 16.1.1.6 activate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> address-family ipv4 vrf SPOKE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 16.1.2.6 remote-as 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 16.1.2.6 activate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R1上没有没有配置export RT和import RT，下一步查看R4和R5上的RT，然后在R1上配置RT&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R4和R5上分别使用命令show running-config | section vrf 查看VRF配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-zed" data-lang="zed">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R4&lt;/span>&lt;span class="nv">#show&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">running&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">|&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">section&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">definition&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">A&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">rd&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">100&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="err">200&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">address&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">family&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ipv4&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">export&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">47&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="err">47&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">16&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="err">16&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">26&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="err">26&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">58&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="err">58&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">exit&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">address&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">family&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">forwarding&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">A&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">address&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">family&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ipv4&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">A&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">neighbor&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">47&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="err">1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="err">1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="err">7&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">remote&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">as&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">200&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">neighbor&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">47&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="err">1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="err">1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="err">7&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">activate&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">R4&lt;/span>&lt;span class="err">#&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R5&lt;/span>&lt;span class="c1">#show running-config | section vrf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">A&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rd&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="mi">58&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">58&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="n">import&lt;/span> &lt;span class="mi">16&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">16&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="n">import&lt;/span> &lt;span class="mi">26&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">26&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="n">import&lt;/span> &lt;span class="mi">47&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">47&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">A&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">address&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">family&lt;/span> &lt;span class="n">ipv4&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">A&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">neighbor&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.8&lt;/span> &lt;span class="n">remote&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">as&lt;/span> &lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">neighbor&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.8&lt;/span> &lt;span class="n">activate&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R5&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R4和R5上配置了RT，下一步需要在R1上添加RT配置&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R1上使用命令route-target export/import ASN:nn配置RT&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#ip vrf HUB&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#route-target import 47:47&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#route-target import 58:58 &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#ip vrf SPOKE&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#route-target export 16:16&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>在R1上使用命令show bgp vpnv4 unicast all查看VPNV4路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1#show bgp vpnv4 unicast all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 10, local router ID is 10.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status codes: s suppressed, d damped, h history, * valid, &amp;gt; best, i - internal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> x best-external, a additional-path, c RIB-compressed,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> t secondary path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Origin codes: i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RPKI validation codes: V valid, I invalid, N Not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop Metric LocPrf Weight Path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 100:200 (default for vrf SPOKE)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 0.0.0.0 16.1.2.6 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.6.6.6/32 16.1.2.6 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.7.7.7/32 10.1.1.4 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.8.8.8/32 10.1.1.5 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 200:100 (default for vrf HUB)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.6.6.6/32 16.1.1.6 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.7.7.7/32 10.1.1.4 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.8.8.8/32 10.1.1.5 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示在配置RT后，R1可以学习到R4和R5传递过来的路由&lt;/p>
&lt;p>在R4和R5上分别使用命令show bgp vpnv4 unicast all查看VPNV4路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4#show bgp vpnv4 unicast all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 8, local router ID is 10.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status codes: s suppressed, d damped, h history, * valid, &amp;gt; best, i - internal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> x best-external, a additional-path, c RIB-compressed,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> t secondary path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Origin codes: i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RPKI validation codes: V valid, I invalid, N Not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop Metric LocPrf Weight Path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 100:200 (default for vrf A)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 0.0.0.0 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.6.6.6/32 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.7.7.7/32 47.1.1.7 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.8.8.8/32 10.1.1.5 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5#show bgp vpnv4 unicast all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 8, local router ID is 10.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status codes: s suppressed, d damped, h history, * valid, &amp;gt; best, i - internal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> x best-external, a additional-path, c RIB-compressed,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> t secondary path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Origin codes: i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RPKI validation codes: V valid, I invalid, N Not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop Metric LocPrf Weight Path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 100:200 (default for vrf A)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 0.0.0.0 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.6.6.6/32 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.7.7.7/32 10.1.1.4 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.8.8.8/32 58.1.1.8 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R1，R4和R5上都学习到了PE传递过来的VPNV4路由，下一步检查R6，R7和R8上的路由学习情况&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R6，R7和R8上分布使用命令show ip route bgp 查看bgp路由学习情况&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R6&lt;/span>&lt;span class="c1">#show ip route bgp &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">6.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">6.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">16.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">3.1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">31&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">13&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R6&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R7&lt;/span>&lt;span class="c1">#sh ip route bgp &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R7&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R8&lt;/span>&lt;span class="c1">#sh ip route b&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R8&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示，R6，R7和R8上没有从PE上学习的路由不符合要求，下一步检查PE和CE上是否配置as-override和 allowas-in&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在PE和CE设备上使用命令show running-config | include as-override和show running-config | include allowas-in 检查设备是否设置了as-override和 allowas-in&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1#show running-config | include as-override
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#show running-config | include allowas-in
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R上没有配置as-override和 allowas-in，经检查R1，R4，R5，R7，R8均没有设置这两项参数&lt;/p>
&lt;p>在当前组网情况下，有两种解决方案&lt;/p>
&lt;p>方案一：在R1，R4和R5上针对CE的BGP邻居设置as-override&lt;/p>
&lt;p>方案二：在R1上针对CE的BGP邻居设置as-override，在R7和R8上针对PE的BGP邻居设置allowas-in&lt;/p>
&lt;p>结合组网情况，本次使用方案一，下一步在R1，R4和R5上针对CE的BGP邻居设置as-override&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R1，R4和R5上使用命令neighbor x.x.x.x as-override&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1(config)#router bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1(config-router)# address-family ipv4 vrf HUB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1(config-router-af)# neighbor 16.1.1.6 as-override
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1(config-router-af)#exit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1(config-router)# address-family ipv4 vrf SPOKE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1(config-router-af)# neighbor 16.1.2.6 as-override
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1(config-router-af)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4(config)#router bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config-router)# address-family ipv4 vrf A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config-router-af)# neighbor 47.1.1.7 as-override
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config-router-af)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5(config)#router bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config-router)# address-family ipv4 vrf A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config-router-af)# neighbor 58.1.1.8 as-override
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config-router-af)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>在R6，R7和R8上分布使用命令show ip route bgp 查看bgp路由学习情况&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R6&lt;/span>&lt;span class="c1">#show ip route bgp &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">6.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">6.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">16.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">3.1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">47&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">49&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">10.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.7&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">7.7&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">16.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">02&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">31&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.8&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.8&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">16.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">02&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">31&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R6&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R7&lt;/span>&lt;span class="c1">#sh ip route bgp &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">54&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">10.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">54&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.8&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.8&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">54&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R7&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R8&lt;/span>&lt;span class="c1">#show ip route bgp &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">51&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">10.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">51&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.7&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">7.7&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">51&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R8&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R6，R7和R8已经从对应PE学习到路由，下一步traceroute测试R7到R8的10.8.8.8&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R7#traceroute 10.8.8.8 source loopback 0 numeric
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Tracing the route to 10.8.8.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">VRF info: (vrf in name/id, vrf out name/id)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 47.1.1.4 [AS 100] 1 msec 3 msec 1 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2 34.1.1.3 [AS 100] [MPLS: Labels 307/500 Exp 0] 5 msec 5 msec 6 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3 58.1.1.5 [AS 100] [MPLS: Label 500 Exp 0] 3 msec 3 msec 3 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 4 58.1.1.8 [AS 100] 5 msec * 11 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R7#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R7到R8的10.8.8.8连通性正常，但是不符合R7 和R8两个站点通信必须经过R6的全局处理设计要求&lt;/p>
&lt;p>按照拓扑图显示R7和R8应该建立IBGP邻居关系，给出的预配缺少配置，我猜这里考察的客户双CE接入同一AS不同PE的SOO防环知识点&lt;/p>
&lt;p>而添加IBGP配置后R7和R8互相通信又会走IBGP或IGP，又要配置策略阻止R7和R8的互相学习，我就不自己加戏了&lt;/p>
&lt;p>如果按照提供的预配来解决方案，只能在R4和R5编写route-map将R7和R8上的路由进行过滤，经过过滤后R4上不能学习到R8上的路由，R5上不能学习到R7的路由，最后结果符合设计要求&lt;/p>
&lt;p>下一步在R4和R5上配置route-map对路由进行过滤的解决方案&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R4和R5上配置route-map对路由进行过滤&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4(config)#ip prefix-list DENY-R8 permit 10.8.8.8/32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config)#route-map DENY-R8 deny 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config-route-map)#match ip address prefix-list DENY-R8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config-route-map)#route-map DENY-R8 permit 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config-route-map)#exit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config)#router bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config-router)#address-family vpnv4 unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config-router-af)#neighbor 10.1.1.3 route-map DENY-R8 in
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4(config-router-af)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5(config)#ip prefix-list DENY-R7 permit 10.7.7.7/32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config)#route-map DENY-R7 deny 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config-route-map)#match ip address prefix-list DENY-R7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config-route-map)#route-map DENY-R7 permit 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config-route-map)#exit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config)#router bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config-router)#address-family vpnv4 unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config-router-af)#nei 10.1.1.3 route-map DENY-R7 in
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5(config-router-af)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>在R4和R5上分别使用命令show bgp vpnv4 unicast all查看VPNV4路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4#show bgp vpnv4 unicast all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 10, local router ID is 10.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status codes: s suppressed, d damped, h history, * valid, &amp;gt; best, i - internal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> x best-external, a additional-path, c RIB-compressed,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> t secondary path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Origin codes: i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RPKI validation codes: V valid, I invalid, N Not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop Metric LocPrf Weight Path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 100:200 (default for vrf A)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 0.0.0.0 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.6.6.6/32 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.7.7.7/32 47.1.1.7 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5#sh run | s route-m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 10.1.1.3 route-map DENY-R7 in
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map DENY-R7 deny 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address prefix-list DENY-R7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map DENY-R7 permit 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5#show bgp vpnv4 unicast all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 10, local router ID is 10.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status codes: s suppressed, d damped, h history, * valid, &amp;gt; best, i - internal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> x best-external, a additional-path, c RIB-compressed,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> t secondary path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Origin codes: i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RPKI validation codes: V valid, I invalid, N Not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop Metric LocPrf Weight Path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 100:200 (default for vrf A)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 0.0.0.0 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.6.6.6/32 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.8.8.8/32 58.1.1.8 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示经过过滤后R4上不能学习到R8上的路由，R5上不能学习到R7的路由&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R7和R8上分布使用命令show ip route bgp 查看bgp路由学习情况&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R7&lt;/span>&lt;span class="c1">#show ip route bgp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">19&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">47&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">10.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">19&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">47&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R7&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R8&lt;/span>&lt;span class="c1">#show ip route bgp &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">19&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">10.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">19&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R8&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R7和R8不再通过PE学习到对端的路由，下一步traceroute测试R7到R8的10.8.8.8&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R7上使用命令traceroute 10.8.8.8 source loopback 0 numeric 进行traceroute测试&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R7#traceroute 10.8.8.8 source loopback 0 numeric
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Tracing the route to 10.8.8.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">VRF info: (vrf in name/id, vrf out name/id)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 47.1.1.4 [AS 100] 1 msec 2 msec 1 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2 34.1.1.3 [AS 100] [MPLS: Labels 306/106 Exp 0] 18 msec 5 msec 5 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3 16.1.2.1 [AS 100] [MPLS: Label 106 Exp 0] 5 msec 6 msec 5 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 4 16.1.2.6 [AS 100] 6 msec 5 msec 5 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 5 16.1.1.1 [AS 100] 5 msec 5 msec 6 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 6 13.1.1.3 [AS 100] [MPLS: Labels 307/500 Exp 0] 10 msec 14 msec 11 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 7 58.1.1.5 [AS 100] [MPLS: Label 500 Exp 0] 10 msec 9 msec 10 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 8 58.1.1.8 [AS 100] 10 msec * 14 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R7#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示符合设计要求，R7以loopback 0 测试到10.8.8.8 的路径从R4进入MPLS网络到达R6再穿过MPLS网络到底R8，数据流量穿越MPLS网络中的标签值不符合截图输出没有影响,这是由于设备本地自主分配然后LDP邻居学习到的&lt;/p>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="排查ce路由表未完全学习r6上路由">排查CE路由表未完全学习R6上路由
&lt;/h2>&lt;p>经过前面步骤的排查，R1，R3，R4，R5，R6，R7和R8并没有学习到10.66.66.66和26.1.1.0的路由，下一步在R2上检查是否通过S1/1接口学习到R6的路由条目&lt;/p>
&lt;ol>
&lt;li>
&lt;p>在R2上使用命令show ip route vrf A查看路由表&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R2&lt;/span>&lt;span class="c1">#show ip route vrf A&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Routing&lt;/span> &lt;span class="n">Table&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">A&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R2&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R2上没有学习到R6的路由，且连直连接口路由都没有，下一步检查R2的S1/1接口配置&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R2上使用命令show running-config interface serial 1/1查看接口配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2#show running-config interface serial 1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Building configuration...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Current configuration : 169 bytes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Serial1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip vrf forwarding A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 26.1.1.2 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> encapsulation ppp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf 1 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ppp authentication chap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> serial restart-delay 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示该接口已经划入VRF A，启用了OSPF 1，并且配置了chap认证，下一步检查S1/1接口状态&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R2上使用命令show interfaces serial 1/1检查S1/1接口状态&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R2&lt;/span>&lt;span class="c1">#show interfaces serial 1/1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Serial1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">up&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">line&lt;/span> &lt;span class="n">protocol&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">down&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Hardware&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">M4T&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Internet&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="mf">26.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">MTU&lt;/span> &lt;span class="mi">1500&lt;/span> &lt;span class="n">bytes&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">BW&lt;/span> &lt;span class="mi">1544&lt;/span> &lt;span class="n">Kbit&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">sec&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">DLY&lt;/span> &lt;span class="mi">20000&lt;/span> &lt;span class="n">usec&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reliability&lt;/span> &lt;span class="mi">255&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">255&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">txload&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">255&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">rxload&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Encapsulation&lt;/span> &lt;span class="n">PPP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">LCP&lt;/span> &lt;span class="n">Closed&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">crc&lt;/span> &lt;span class="mi">16&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">loopback&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Keepalive&lt;/span> &lt;span class="n">set&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">10&lt;/span> &lt;span class="n">sec&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Restart&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Delay&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">secs&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Last&lt;/span> &lt;span class="n">input&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">output&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">output&lt;/span> &lt;span class="n">hang&lt;/span> &lt;span class="n">never&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Last&lt;/span> &lt;span class="n">clearing&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="s2">&amp;#34;show interface&amp;#34;&lt;/span> &lt;span class="n">counters&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">15&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="ne">Input&lt;/span> &lt;span class="n">queue&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">75&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">max&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">drops&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">flushes&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="n">Total&lt;/span> &lt;span class="n">output&lt;/span> &lt;span class="n">drops&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Queueing&lt;/span> &lt;span class="n">strategy&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">fifo&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Output&lt;/span> &lt;span class="n">queue&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">40&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">size&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">max&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">5&lt;/span> &lt;span class="n">minute&lt;/span> &lt;span class="n">input&lt;/span> &lt;span class="n">rate&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">bits&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">sec&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">packets&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">sec&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">5&lt;/span> &lt;span class="n">minute&lt;/span> &lt;span class="n">output&lt;/span> &lt;span class="n">rate&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">bits&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">sec&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">packets&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">sec&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">1689&lt;/span> &lt;span class="n">packets&lt;/span> &lt;span class="n">input&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">33540&lt;/span> &lt;span class="n">bytes&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">no&lt;/span> &lt;span class="n">buffer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Received&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">broadcasts&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="ne">IP&lt;/span> &lt;span class="n">multicasts&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">0&lt;/span> &lt;span class="n">runts&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">giants&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">throttles&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">0&lt;/span> &lt;span class="n">input&lt;/span> &lt;span class="n">errors&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">CRC&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">frame&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">overrun&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">ignored&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">abort&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">2102&lt;/span> &lt;span class="n">packets&lt;/span> &lt;span class="n">output&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">45387&lt;/span> &lt;span class="n">bytes&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">underruns&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">0&lt;/span> &lt;span class="n">output&lt;/span> &lt;span class="n">errors&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">collisions&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">410&lt;/span> &lt;span class="n">interface&lt;/span> &lt;span class="n">resets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">0&lt;/span> &lt;span class="n">unknown&lt;/span> &lt;span class="n">protocol&lt;/span> &lt;span class="n">drops&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">0&lt;/span> &lt;span class="n">output&lt;/span> &lt;span class="n">buffer&lt;/span> &lt;span class="n">failures&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">output&lt;/span> &lt;span class="n">buffers&lt;/span> &lt;span class="n">swapped&lt;/span> &lt;span class="n">out&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mi">410&lt;/span> &lt;span class="n">carrier&lt;/span> &lt;span class="n">transitions&lt;/span> &lt;span class="n">DCD&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">up&lt;/span> &lt;span class="n">DSR&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">up&lt;/span> &lt;span class="n">DTR&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">up&lt;/span> &lt;span class="n">RTS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">up&lt;/span> &lt;span class="n">CTS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">up&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R2&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示line protocol is down ，该结果显示链路层故障，联系到上一步骤中查看到ppp封装和chap认证，怀疑是认证出现了问题，下一步检查R6和R1之间的串口链路认证&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R2上使用debug ppp authentication 查看ppp认证交互信息，同时准备命令no debug all 随时终止debug消息&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2#debug ppp authentication
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PPP authentication debugging is on
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:10.131: Se1/1 PPP: Using default call direction
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:10.131: Se1/1 PPP: Treating connection as a dedicated line
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:10.131: Se1/1 PPP: Session handle[B200026C] Session id[620]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:10.168: Se1/1 CHAP: O CHALLENGE id 1 len 23 from &amp;#34;R2&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:10.183: Se1/1 CHAP: I RESPONSE id 1 len 23 from &amp;#34;R6&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:10.183: Se1/1 PPP: Sent CHAP LOGIN Request
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:10.183: Se1/1 PPP: Received LOGIN Response FAIL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:10.183: Se1/1 CHAP: O FAILURE id 1 len 25 msg is &amp;#34;Authentication failed&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:12.223: Se1/1 PPP: Using default call direction
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:12.223: Se1/1 PPP: Treating connection as a dedicated line
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:12.223: Se1/1 PPP: Session handle[FD00026D] Session id[621]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:12.251: Se1/1 CHAP: O CHALLENGE id 1 len 23 from &amp;#34;R2&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:12.268: Se1/1 CHAP: I RESPONSE id 1 len 23 from &amp;#34;R6&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:12.268: Se1/1 PPP: Sent CHAP LOGIN Request
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:12.268: Se1/1 PPP: Received LOGIN Response FAIL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:12.268: Se1/1 CHAP: O FAILURE id 1 len 25 msg is &amp;#34;Authentication failed&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#no debu
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:14.329: Se1/1 PPP: Using default call direction
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:14.329: Se1/1 PPP: Treating connection as a dedicated line
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:14.329: Se1/1 PPP: Session handle[E600026E] Session id[622]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:14.367: Se1/1 CHAP: O CHALLENGE id 1 len 23 from &amp;#34;R2&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:14.385: Se1/1 CHAP: I RESPONSE id 1 len 23 from &amp;#34;R6&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:14.385: Se1/1 PPP: Sent CHAP LOGIN Request
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:14.385: Se1/1 PPP: Received LOGIN Response FAIL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 14:21:14.385: Se1/1 CHAP: O FAILURE id 1 len 25 msg is &amp;#34;Authentication failed&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#no debu
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#no debug all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">All possible debugging has been turned off
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示S1/1接口Authentication failed，下一步检查R2和R6上的chap认证密码配置&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R2和R6上使用命令show running-config | section user 检查用户名密码配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2#show running-config | section user
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">username R6 password 0 cisco
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R6#show running-config | section user
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">username R2 password 0 cisc0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R6#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示两端密码不一致，虽然R6的S1/1接口配置了与R2相同的密码，但是思科路由器会优先使用全局配置的密码进行认证流程&lt;/p>
&lt;p>处理该认证失败故障有如下两种解决方案&lt;/p>
&lt;p>方案一：在R2上修改密码为cisc0&lt;/p>
&lt;p>方案二：在R6上修改密码为cisco&lt;/p>
&lt;p>本次故障排除采用方案一，在R2上使用命令username R6 password 0 cisc0修改密码&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2(config)#username R6 password 0 cisc0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 15:08:27.909: %SYS-5-CONFIG_I: Configured from console by console
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 15:08:27.926: %LINEPROTO-5-UPDOWN: Line protocol on Interface Serial1/1, changed state to up
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 15:08:28.024: %OSPF-5-ADJCHG: Process 1, Nbr 10.66.66.66 on Serial1/1 from LOADING to FULL, Loading Done
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2(config)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示修改密码后，S1/1的链路层协议UP，且R2与R6的OSPF邻居已经建立，下一步检查R2的路由学习情况&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R2上使用命令show bgp vpnv4 unicast all 查看VPNV4路由标&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2#show bgp vpnv4 unicast all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 11, local router ID is 10.22.22.22
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status codes: s suppressed, d damped, h history, * valid, &amp;gt; best, i - internal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> x best-external, a additional-path, c RIB-compressed,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> t secondary path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Origin codes: i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RPKI validation codes: V valid, I invalid, N Not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop Metric LocPrf Weight Path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 100:200 (default for vrf A)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.66.66.66/32 26.1.1.6 65 32768 ?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 26.1.1.0/24 0.0.0.0 0 32768 ?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R2已经学习到R6的路由，且VRF A的路由已经重分布进BGP，下一步检查其他PE是否学习到R2的VPNV4路由&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R4上使用命令show bgp vpnv4 unicast all 查看VPNV4路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4#show bgp vpnv4 unicast all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 10, local router ID is 10.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status codes: s suppressed, d damped, h history, * valid, &amp;gt; best, i - internal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> x best-external, a additional-path, c RIB-compressed,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> t secondary path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Origin codes: i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RPKI validation codes: V valid, I invalid, N Not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop Metric LocPrf Weight Path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 100:200 (default for vrf A)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 0.0.0.0 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.6.6.6/32 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.7.7.7/32 47.1.1.7 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R4没有学习到R2上的VPNV4路由，下一步检查R2的VRF RT配置&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R2上使用命令show running-config | section vrf查看VRF配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2#show running-config | section vrf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vrf A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rd 100:200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip vrf forwarding A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 1 vrf A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> redistribute bgp 100 subnets
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> address-family ipv4 vrf A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> redistribute ospf 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示VRF A没有配置RT，下一步配置R2的RT&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R2上使用命令route-target export/import ASN:nn配置RT&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#ip vrf A&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#route-target export 26:26&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#route-target import 16:16&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#route-target import 47:47&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#route-target import 58:58&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">vrf&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>在R4上使用命令show bgp vpnv4 unicast all 查看VPNV4路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4#show bgp vpnv4 unicast all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 14, local router ID is 10.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status codes: s suppressed, d damped, h history, * valid, &amp;gt; best, i - internal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> x best-external, a additional-path, c RIB-compressed,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> t secondary path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Origin codes: i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RPKI validation codes: V valid, I invalid, N Not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop Metric LocPrf Weight Path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 100:200 (default for vrf A)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 0.0.0.0 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.6.6.6/32 10.1.1.1 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.7.7.7/32 47.1.1.7 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.66.66.66/32 10.1.1.2 65 100 0 ?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 26.1.1.0/24 10.1.1.2 0 100 0 ?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R4已经学习到R2上的VPNV4路由，下一步检查R6，R7和R8上的路由学习情况&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R7和R8上使用命令show ip route bgp查看路由学习&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R7&lt;/span>&lt;span class="c1">#show ip route bgp &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">01&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">53&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">10.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">01&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">53&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.66&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">66.66&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">04&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">31&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">26.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">26.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">04&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">31&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R7&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R8&lt;/span>&lt;span class="c1">#show ip route bgp &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span>&lt;span class="o">*&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">01&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">53&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">10.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">01&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">53&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.66&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">66.66&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">04&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">51&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">26.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">26.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">04&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">51&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R8&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R7和R8学习到了对应的路由条目，且符合要求&lt;/p>
&lt;p>下一步配置R1上的VRF RT，之前排查PE路由学习的时候没有添加针对R2的 RT import 配置&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R1上使用命令route-target import ASN:nn配置RT&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1(config)#ip vrf HUB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1(config-vrf)# route-target import 26:26
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1(config-vrf)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>在R1上使用命令show bgp vpnv4 unicast all 查看VPNV4路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1#show bgp vpnv4 unicast all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 20, local router ID is 10.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Status codes: s suppressed, d damped, h history, * valid, &amp;gt; best, i - internal,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> x best-external, a additional-path, c RIB-compressed,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> t secondary path,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Origin codes: i - IGP, e - EGP, ? - incomplete
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RPKI validation codes: V valid, I invalid, N Not found
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop Metric LocPrf Weight Path
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 100:200 (default for vrf SPOKE)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 0.0.0.0 16.1.2.6 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.6.6.6/32 16.1.2.6 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.7.7.7/32 10.1.1.4 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.8.8.8/32 10.1.1.5 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.66.66.66/32 10.1.1.2 65 100 0 ?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 26.1.1.0/24 10.1.1.2 0 100 0 ?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Route Distinguisher: 200:100 (default for vrf HUB)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt; 10.6.6.6/32 16.1.1.6 0 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.7.7.7/32 10.1.1.4 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.8.8.8/32 10.1.1.5 0 100 0 200 i
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 10.66.66.66/32 10.1.1.2 65 100 0 ?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *&amp;gt;i 26.1.1.0/24 10.1.1.2 0 100 0 ?
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R1已经学习到R2的VPNV4路由条目，下一步检查R6是否学习到路由条目&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R6上使用命令show ip route bgp查看路由学习&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R6&lt;/span>&lt;span class="c1">#show ip route bgp &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">6.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">6.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">16.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">3.1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">02&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">57&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">10.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.7&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">7.7&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">16.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">02&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">45&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.8&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.8&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">16.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">02&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">45&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">10.66&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">66.66&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">16.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">01&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">57&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">26.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">26.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">16.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">01&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">57&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R6&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R6已经学习到对应路由条目，且符合要求&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R6上使用命令show ip route vrf A ospf查看路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R6&lt;/span>&lt;span class="c1">#show ip route vrf A ospf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Routing&lt;/span> &lt;span class="n">Table&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">A&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R6&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示没有路由条目，下一步在R2上检查是否把BGP路由重分布进VRF A 所在的路由协议&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R2上使用命令sh run | s r o 查看路由重复分布&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2#sh run | s r o
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 1 vrf A
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> redistribute bgp 100 subnets
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 110
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> prefix-suppression
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示已经将BGP路由重分布进OSPF 1进程&lt;/p>
&lt;p>能学习到R6的路由说明R2与R6的邻居建立没有问题，且在R2上没有发现针对R6的路由过滤，&lt;/p>
&lt;p>在R6和R2上发现使用划入VRF的接口进行互联，且将BGP重分布进ospf进程，这种组网情况要在PE上的ospf进程下启用vrf-lite&lt;/p>
&lt;p>思科的OSPF防环机制当绑定到 VRF 的 OSPF 进程在收到邻居的5类LSA或7类LSA会检查Tag，当Tag与VPN-TAG时，这些5类LSA或7类LSA不会参与SFP算法计算路由&lt;/p>
&lt;p>在R2使用命令capability vrf-lite 启用vrf-lite&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2(config)# router ospf 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2(config-router)#capability vrf-lite
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2(config-router)#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 15:46:59.140: %OSPF-5-ADJCHG: Process 1, Nbr 10.66.66.66 on Serial1/1 from FULL to DOWN, Neighbor Down: Interface down or detached
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*Jan 31 15:46:59.204: %OSPF-5-ADJCHG: Process 1, Nbr 10.66.66.66 on Serial1/1 from LOADING to FULL, Loading Done
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2(config-router)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示启用vrf-lite 后，R2与R6的ospf邻居重置，下一步检查R6是否学习到路由条目&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R6上使用命令show ip route vrf A ospf查看路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R6&lt;/span>&lt;span class="c1">#show ip route vrf A ospf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Routing&lt;/span> &lt;span class="n">Table&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">A&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">10.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">10.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">26.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">24&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">28&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Serial1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">10.7&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">7.7&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">26.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">24&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">28&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Serial1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">10.8&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.8&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">26.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">24&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">28&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Serial1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R6&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R6与学习到对应路由条目，下一步在R2的OSPF 1 进程下发默认路由&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R2上使用命令default-information originate 下发ospf默认路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2(config)# router ospf 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2(config-router)#default-information originate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2(config-router)#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>在R6上使用命令show ip route vrf A ospf查看路由&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R6&lt;/span>&lt;span class="c1">#show ip route vrf A ospf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Routing&lt;/span> &lt;span class="n">Table&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">A&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="mf">26.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">E2&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">26.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">01&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Serial1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">10.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">10.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">26.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">29&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">54&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Serial1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">10.7&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">7.7&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">26.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">29&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">54&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Serial1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">10.8&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.8&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">26.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">29&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">54&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Serial1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R6&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示R6已经学习到默认路由，且所以OSPF路由条目符合要求&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在R6上使用命令traceroute vrf A 10.7.7.7 source loopback 1 numeric 跟踪路径&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R6#traceroute vrf A 10.7.7.7 source loopback 1 numeric
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Tracing the route to 10.7.7.7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">VRF info: (vrf in name/id, vrf out name/id)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 26.1.1.2 [AS 100] 13 msec 16 msec 16 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2 23.1.1.3 [MPLS: Labels 304/405 Exp 0] 20 msec 21 msec 16 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3 47.1.1.4 [MPLS: Label 405 Exp 0] 14 msec 19 msec 16 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 4 47.1.1.7 21 msec * 19 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R6#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>结果显示符合要求&lt;/p>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="总结">总结
&lt;/h2>&lt;ul>
&lt;li>这份拓扑中包含了MP-BGP的大部分知识点&lt;/li>
&lt;li>完成MPLS网络的vpnv4邻居建立，接下来就靠VRF的RT控制接收和发送路由条目&lt;/li>
&lt;li>熟悉查看vpnv4的路由表很重要&lt;/li>
&lt;li>其实早几年我是玩过这个排错拓扑的，奈何脑子不够用学过等于又还回去了&lt;/li>
&lt;li>不知道大家对这种学习过的技术，而工作中又接触不到这些项目，技术的知识点淡忘如何看待&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨。&lt;/li>
&lt;/ul></description></item><item><title>网神 NSG 3600 和网神 SecSSL 3600 重置密码</title><link>https://weeaster.github.io/posts/f36f6dd3/</link><pubDate>Fri, 01 Dec 2023 09:46:59 +0000</pubDate><guid>https://weeaster.github.io/posts/f36f6dd3/</guid><description>&lt;p>记录网神设备重置密码。&lt;/p>
&lt;h2 id="网神-nsg-3600-防火墙重置密码">网神 NSG 3600 防火墙重置密码
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>运行SecureCRT软件，新建连接。协议选择Serial，端口选择COM口。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/12/01/4UhvQGkCNuwIL9r.png">
&lt;img src="https://s2.loli.net/2023/12/01/4UhvQGkCNuwIL9r.png"
loading="lazy"
alt="image-20231201095640020"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>连接设备后，使用用户名：ngfw9753124680qwer 密码：ngfw9753124680qwer 登陆设备，出现 “Admin password has been reset successful, Please use admin login again !” 表明已重置默认密码为 !1fw@2soc#3vpn&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Username:ngfw9753124680qwer
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Admin password has been reset successful,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Please use admin login again !
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">% Login invalid.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Username:admin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password:
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>网页端登陆网神 NSG 3600 防火墙管理界面，https://x.x.x.x （端口号如已修改注意替换），使用默认密码登陆会提示修改密码。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="网神-secssl-3600-安全接入网关系统-v50-重置密码">网神 SecSSL 3600 安全接入网关系统 V5.0 重置密码
&lt;/h2>&lt;p>该设备背部标签表示为：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">产品名称：网神SecSSL 3600安全接入网关系统 V5.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">产品型号：X1500-TY12
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">商品编码：X1500-TY12P-HW
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S/N:XXXXX
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">网神XXXXX公司
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol>
&lt;li>
&lt;p>运行SecureCRT软件，新建连接。协议选择Serial，端口选择COM口。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/12/01/4UhvQGkCNuwIL9r.png">
&lt;img src="https://s2.loli.net/2023/12/01/4UhvQGkCNuwIL9r.png"
loading="lazy"
alt="image-20231201095640020"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>连接设备后，重启设备，在开机阶段按 &lt;code>Crtl&lt;/code>+&lt;code>c&lt;/code> 进入&lt;code>Monitor&lt;/code>模式&lt;/p>
&lt;p>restore admin 恢复admin管理员的密码，恢复后默认密码是 !1fw@2soc#3vpn&lt;/p>
&lt;p>点击Y 确认&lt;/p>
&lt;p>reload 重启设备&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Welcome&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">SecSSL&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Entering&lt;/span> &lt;span class="n">Monitor&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">**********************************************&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="n">Welcome&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">Monitor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">v3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">03&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&lt;/span> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">**********************************************&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Monitor&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">resto&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Monitor&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">restore&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">admin&lt;/span> &lt;span class="n">default&lt;/span> &lt;span class="n">admin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">setting&lt;/span> &lt;span class="n">factory&lt;/span> &lt;span class="n">setting&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Monitor&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">restore&lt;/span> &lt;span class="n">admin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Monitor&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">restore&lt;/span> &lt;span class="n">admin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Restore&lt;/span> &lt;span class="n">default&lt;/span> &lt;span class="n">admin&lt;/span>&lt;span class="err">?&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">):&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Monitor&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">rel&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Monitor&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">reload&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Reload&lt;/span>&lt;span class="o">...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Restarting&lt;/span> &lt;span class="n">system&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>网页端登陆网神 SecSSL 3600 管理界面，https://x.x.x.x/admin 或 &lt;a class="link" href="https://x.x.x.x" target="_blank" rel="noopener"
>https://x.x.x.x
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>::4430/admin （端口号如已修改注意替换），使用默认密码登陆会提示修改密码。&lt;/p>
&lt;/li>
&lt;/ol></description></item><item><title>使用Selenium实现登陆网站并签到</title><link>https://weeaster.github.io/posts/14423df7/</link><pubDate>Mon, 28 Aug 2023 01:15:53 +0000</pubDate><guid>https://weeaster.github.io/posts/14423df7/</guid><description>&lt;p>由于不想亲自动手打开某网站登陆然后签到，所以制作一个python脚本实现自动操作。&lt;/p>
&lt;p>Selenium官网链接： &lt;a class="link" href="https://www.selenium.dev/" target="_blank" rel="noopener"
>https://www.selenium.dev/
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/p>
&lt;p>官网介绍说主要用于自动化web应用程序的测试目的，但当然不限于此。无聊的基于web的管理任务也可以(也应该)自动化。&lt;/p>
&lt;p>当然也表示了：What you do with that power is entirely up to you.&lt;/p>
&lt;p>如标题所说，我也就想自动签到。&lt;/p>
&lt;h2 id="安装">安装
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">pip&lt;/span> &lt;span class="n">install&lt;/span> &lt;span class="n">selenium&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>如果这一步出现什么问题去查看官方文档&lt;/p>
&lt;p>&lt;strong>当前日期（20230828）自动安装的版本是：selenium==4.11.2&lt;/strong>&lt;/p>
&lt;h2 id="代码">代码
&lt;/h2>&lt;p>&lt;strong>网站URL和用户密码就不贴出来了&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">selenium&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">webdriver&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">selenium.webdriver.common.by&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">By&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">selenium.webdriver.chrome.options&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Options&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">selenium.webdriver.chrome.service&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 添加option --headless 参数为不弹窗运行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">options&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Options&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">options&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_argument&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;--headless&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 4.6版本前需要指定路径，使用本地驱动 &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 指定浏览器驱动路径，以Chrome为例，需要下载对应版本的ChromeDriver并指定其路径&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># driver_path = &amp;#39;D:/xx/xx/chromedriver.exe&amp;#39; # 将路径替换为实际保存的ChromeDriver的路径&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># service = Service(executable_path=driver_path)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># driver = webdriver.Chrome(options=options, service=service)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># driver = webdriver.Chrome(service=service)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 4.6版本之后使用如下代码, 当然使用上面代码指定路径也可以运行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">service&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Service&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">driver&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">webdriver&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Chrome&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">options&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">options&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">service&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">service&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 打开指定网站登陆页面URL&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">url&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;https://www.xxx.com/login.html&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">driver&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 找到用户名和密码输入框&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">username_input&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">driver&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_element&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">By&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ID&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;user&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># 根据实际情况修改用户名输入框的定位方式&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">password_input&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">driver&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_element&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">By&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ID&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;password&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># 根据实际情况修改密码输入框的定位方式&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 清空输入框&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">username_input&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">clear&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">password_input&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">clear&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 输入用户名和密码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">username_input&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send_keys&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;username&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">password_input&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send_keys&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;password&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 提交登录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">login_button&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">driver&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_element&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">By&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">LINK_TEXT&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;登录&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># 根据实际情况 按钮的定位方式&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">login_button&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">click&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="c1"># 点击登录按钮&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 跳转到指定页面（签到页面的URL），如果签到按钮在登陆成功后跳转的页面可以跳过此步骤&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">qd_url&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;https://www.xxx.com/xx.html&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">driver&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">qd_url&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 在跳转后的页面找到签到按钮并点击&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">qd_button&lt;/span> &lt;span class="o">=&lt;/span>&lt;span class="n">driver&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_element&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">By&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">LINK_TEXT&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;签到&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># 根据实际情况修改签到按钮的定位方式&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># qd_button = driver.find_element(By.LINK_TEXT, &amp;#39;退出&amp;#39;) # 根据实际情况修改签到按钮的定位方式&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">qd_button&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">click&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 根据网页弹出对话框确认是否完成操作，一般签到成功后都有一个弹窗，如果没有，可以定位是否有“已签到”对应的元素来判断&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res_confirm&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">driver&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_element&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">By&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ID&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;tt-from&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">res_confirm&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;DONE&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;BAD&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">except&lt;/span> &lt;span class="ne">Exception&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;OPS,ERROR&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">finally&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 关闭浏览器驱动&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">driver&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">quit&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="注意">注意
&lt;/h2>&lt;p>使用以下代码，需要本地能访问 &lt;a class="link" href="https://googlechromelabs.github.io/chrome-for-testing/known-good-versions-with-downloads.json" target="_blank" rel="noopener"
>https://googlechromelabs.github.io/chrome-for-testing/known-good-versions-with-downloads.json
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a> 该文件，然后访问 &lt;a class="link" href="https://edgedl.me.gvt1.com" target="_blank" rel="noopener"
>https://edgedl.me.gvt1.com
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a> 下载对应的 &lt;strong>ChromeDriver&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 4.6版本之后使用如下代码, 当然使用上面代码指定路径也可以运行
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service = Service()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">driver = webdriver.Chrome(options=options, service=service)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>如此说来，这种方式需要实时联网操作，对于本地内部使用不是很友好&lt;/p>
&lt;p>如本地内部使用，还是去下载对应版本的 ChromeDriver&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>20230922 补充&lt;/strong>&lt;/p>
&lt;/blockquote></description></item><item><title>信锐NMC对接华为AC实现授权ACL下发</title><link>https://weeaster.github.io/posts/c09d2b9c/</link><pubDate>Mon, 24 Jul 2023 20:42:28 +0000</pubDate><guid>https://weeaster.github.io/posts/c09d2b9c/</guid><description>&lt;p>一个单位的无线网络要求内部员工和访客使用无线网络前进行认证&lt;/p>
&lt;p>内部员工账号认证通过后能同时访问内外网资源，访客账号认证通过后仅允许访问外网资源&lt;/p>
&lt;p>由于华为无线控制器内置portal认证的糟糕使用体验（无法实现MAC优先的portal认证），拟增加外置portal服务器&lt;/p>
&lt;p>华为和华三的软件方案报价令人xxx，一个字“贵”&lt;/p>
&lt;p>信锐的方案虽然也捆绑了硬件，但是鉴于之前的接触，服务还不错，而且还提供测试设备进行对接和功能验证测试，荐之&lt;/p>
&lt;h2 id="对接">对接
&lt;/h2>&lt;p>按照信锐社区的对接配置手册就可以完成基本对接&lt;/p>
&lt;p>&lt;a class="link" href="http://bbs.sundray.com.cn/forum.php?mod=viewthread&amp;amp;tid=8442" target="_blank" rel="noopener"
>http://bbs.sundray.com.cn/forum.php?mod=viewthread&amp;tid=8442
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/07/24/piaEPHyQAUZq1mj.jpg">
&lt;img src="https://s2.loli.net/2023/07/24/piaEPHyQAUZq1mj.jpg"
loading="lazy"
alt="ScreenCaputure230724210655"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>但是，在web界面点点点不是我的风格，写好脚本一把梭才符合我的气质[🉑]&lt;/p>
&lt;h2 id="重点">重点
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/07/24/VRrSscPadBnfO6W.jpg">
&lt;img src="https://s2.loli.net/2023/07/24/VRrSscPadBnfO6W.jpg"
loading="lazy"
alt="ScreenCaputure230724210819"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>根据【信锐控制器对接华为AC6005系列_V3.8.0.3.pdf】文档第2页，可以看到两行红色字提示&lt;/p>
&lt;p>但是，【SUNDRAY_NMC_3.10.0_20221203.pdf】NMC手册第170页也给出了“角色将会通过 RADIUS 报文中的 Class 字段，以字符串的形式返回给 RADIUS 客户端”，这就留下了可操作的空间&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/07/24/bOxdoBuIFlzCATX.jpg">
&lt;img src="https://s2.loli.net/2023/07/24/bOxdoBuIFlzCATX.jpg"
loading="lazy"
alt="ScreenCaputure230724215525"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="华为控制器产品手册中的radius属性说明">华为控制器产品手册中的RADIUS属性说明
&lt;/h3>&lt;p>【无线接入控制器(AC和FIT AP) V200R022C00 产品文档】-【配置】-【配置指南（通过命令行）】-【用户接入与认证配置】-【AAA配置】-【AAA原理描述】-【RADIUS认证、授权和计费】-【RADIUS属性】&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/07/24/7WlX5ZyMtTa8LEu.jpg">
&lt;img src="https://s2.loli.net/2023/07/24/7WlX5ZyMtTa8LEu.jpg"
loading="lazy"
alt="ScreenCaputure230724213107"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/07/24/KnxfOaRvjBH5Yi1.jpg">
&lt;img src="https://s2.loli.net/2023/07/24/KnxfOaRvjBH5Yi1.jpg"
loading="lazy"
alt="ScreenCaputure230724213215"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="华为acl编号授权说明">华为ACL编号授权说明
&lt;/h3>&lt;p>&lt;a class="link" href="https://support.huawei.com/enterprise/zh/doc/EDOC1000113778/f42e57ed" target="_blank" rel="noopener"
>https://support.huawei.com/enterprise/zh/doc/EDOC1000113778/f42e57ed
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/p>
&lt;p>RADIUS服务器上配置了ACL编号下发功能，则授权信息中含有下发的ACL编号，设备端根据下发的ACL编号匹配相应的ACL规则，对用户权限进行控制&lt;/p>
&lt;ul>
&lt;li>ACL编号下发，使用的RADIUS属性为：(011)&lt;strong>Filter-Id&lt;/strong>&lt;/li>
&lt;li>AC上支持接受的ACL编号取值范围为3000～3031&lt;/li>
&lt;/ul>
&lt;h3 id="抓包分析信锐nmc返回的radius属性">抓包分析信锐NMC返回的radius属性
&lt;/h3>&lt;p>首先在信锐NMC上配置角色，名称同华为无线控制器的配置ACL编号一致，只需填写名称，其他选项都不用&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/07/25/USyG7lB56bWgw1N.jpg">
&lt;img src="https://s2.loli.net/2023/07/25/USyG7lB56bWgw1N.jpg"
loading="lazy"
alt="ScreenCaputure230725115751"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 华为无线控制器访客授权ACL示例，如要放行访客可以访问部分内网资源，按需修改
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 10.10.10.10 为信锐设备互联IP（不给看真实的，胡编一个）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl number 3020
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 5 permit ip destination 10.10.10.10 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 10 deny ip destination 10.0.0.0 0.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 15 deny ip destination 172.16.0.0 0.15.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 20 deny ip destination 192.168.0.0 0.0.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 25 permit ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>在【WEB 认证策略】-【权限设定】-【使用规则】-添加【认证类型条件】满足条件后分配角色 3020 ，此步骤对应华为NCE中的【授权规则】和【授权结果】&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/07/25/PGK3UTDeWnLu2Sd.jpg">
&lt;img src="https://s2.loli.net/2023/07/25/PGK3UTDeWnLu2Sd.jpg"
loading="lazy"
alt="ScreenCaputure230725115816"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/07/25/rFqgtB1Vm6WJsdL.jpg">
&lt;img src="https://s2.loli.net/2023/07/25/rFqgtB1Vm6WJsdL.jpg"
loading="lazy"
alt="ScreenCaputure230725115835"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>如下图，radius认证过程中，在信锐NMC返回给华为无线控制器的 Access-Accept 报文中，观察到Class属性中的值为 3020，正是在信锐NMC上配置的角色名称&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/07/26/ogUmpfMN5yxSR2q.jpg">
&lt;img src="https://s2.loli.net/2023/07/26/ogUmpfMN5yxSR2q.jpg"
loading="lazy"
alt="ScreenCaputure230726103600"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="华为无线控制器配置radius属性转换">华为无线控制器配置radius属性转换
&lt;/h3>&lt;p>华为无线控制器RADIUS属性转换功能，属性转换主要是为了兼容不同厂商RADIUS属性定义的差别。&lt;/p>
&lt;p>在本次对接中，需要将信锐返回的radius Class属性转换成Filter-Id属性，这样就实现了华为系的授权ACL下发功能（已验证，好使）&lt;/p>
&lt;p>在RADIUS服务器模板视图下添加如下命令&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">radius-server attribute translate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">radius-attribute translate Class Filter-Id receive
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="查看授权acl">查看授权ACL
&lt;/h3>&lt;p>先根据无线终端MAC地址或IP地址查找出user-id，再执行以下命令&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[AC] display access-user user-id xxxxx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Dynamic ACL ID(Effective) : 3020 ……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="总结">总结
&lt;/h2>&lt;ul>
&lt;li>对无线终端进行访问限制有多种方式如用户组向下绑定acl-id、流量模板、ACL，但是就这个场景只能基于用户做限制&lt;/li>
&lt;li>通过使用华为无线控制器上的radius属性转换功能，完成Class对Filter-Id的转换，进而实现授权ACL下发&lt;/li>
&lt;li>信锐无线设备中的授权是基于角色（猜的，没有看到信锐文档中的说明）&lt;/li>
&lt;li>华为NCE中的授权规则和授权结果与信锐NMC中的规则和角色，基本一个意思，有些许区别，不重要&lt;/li>
&lt;li>这个方法也是摸索出来，查阅了华为和信锐的手册，并在vmware虚拟机安装各种radius软件进行抓包检验&lt;/li>
&lt;li>再吐槽一句，华为的NCE代理商开的价真尼玛高，仅安装NCE软件这一项服务就好几十个K&lt;/li>
&lt;li>经此一役，可能要改写信锐对接手册中这一句话了（注：portal 服务器中的权限设定无法对无线用户生效，但对接 Aruba 时该角色名与 aruba设备上的认证后角色名必须保持一致才能认证通过）&lt;/li>
&lt;/ul></description></item><item><title>对网络设备进行批量操作的几个脚本</title><link>https://weeaster.github.io/posts/99580674/</link><pubDate>Sun, 09 Jul 2023 13:39:07 +0000</pubDate><guid>https://weeaster.github.io/posts/99580674/</guid><description>&lt;p>对网络设备进行批量操作的几个脚本&lt;/p>
&lt;p>netmiko基操&lt;/p>
&lt;p>32位windows下偷个懒使用&lt;/p>
&lt;p>在32位windows系统中无法使用之前编写的nornir脚本，原因是有几个第三方库从某个版本开始不再开发和维护32位系统的代码，而库的依赖最低版本大于最后发布的32位版本，或者装不上，亦或装上了无法用。So……&lt;/p>
&lt;p>github仓库地址：https://github.com/kiraster/netops_alpha_v1.1&lt;/p>
&lt;p>部分代码源码来自这位大佬：&lt;a class="link" href="https://space.bilibili.com/423820673" target="_blank" rel="noopener"
>点滴技术的个人空间_哔哩哔哩_bilibili
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/p>
&lt;p>有需要的自行研究哈，有建设性的好玩的想法的，欢迎来函探讨&lt;/p>
&lt;p>&lt;strong>如要使用试用把玩，建议虚拟环境下运行&lt;/strong>&lt;/p>
&lt;h2 id="add_configpy">add_config.py
&lt;/h2>&lt;p>批量对设备添加相同配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">os&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">settings&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 执行配置命令&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">run_cmd&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">task_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">cmds&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">enable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">enable&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">True&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;secret&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="kc">False&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">flag&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">conn&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">connect_handler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">flag&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 从返回提示符获取设备名称&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hostname&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">conn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_prompt&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&amp;lt;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&amp;gt;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;#&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;正在为设备[&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s1">]添加配置……&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hostname&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 文件保存路径和文件名 &amp;#39;当前目录\\EXPORT\\当天日期\\config_add\\hostname+ip+当前时间.txt&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">logtime&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">datetime&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;%H%M%S&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">output_filename&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">hostname&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;_&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;_&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">logtime&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;.txt&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">cmds&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 判断单元表里命令是否为空值&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">output&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">enable&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 判断是否需要进入enable特权模式&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enable&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">output&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">conn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send_config_set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config_commands&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">cmds&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">output&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">conn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send_config_set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config_commands&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">cmds&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 使用ftp/tftp/sftp/scp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">pass&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">disconnect&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># write_data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">write_to_file&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">task_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">output_filename&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">output&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sucessful_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39; &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">hostname&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">failed_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">pass&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="ne">Exception&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;run_cmd Failed: &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@timer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@result_write&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@result_count&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 代码运行主体框架设计&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 获取当前运行的Python文件的路径&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">current_file_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">abspath&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="vm">__file__&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 提取文件名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">task_name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">basename&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">current_file_path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">当前执行的脚本是[&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">task_name&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s1">]，程序正在执行中&amp;gt;&amp;gt;&amp;gt;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hosts&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">get_device_info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">task_name&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pool&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">t_pool&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># hosts是一个返回的生成器，需要进行循环遍历&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">host&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">hosts&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 单线程同步输出方式执行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># run_cmd(host, host[&amp;#39;cmd_list&amp;#39;])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 多线程异步处理&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pool&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apply_async&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">run_cmd&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">task_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;cmd_list&amp;#39;&lt;/span>&lt;span class="p">]))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pool&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pool&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">task_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sucessful_list&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">failed_list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="ne">Exception&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Something Wrong!&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="vm">__name__&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">main&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="backup_configpy">backup_config.py
&lt;/h2>&lt;p>批量导出设备配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">os&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">settings&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 执行display/show命令&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">run_cmd&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">task_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">cmds&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">enable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">enable&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">True&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;secret&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="kc">False&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">flag&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">conn&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">connect_handler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">flag&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 从返回提示符获取设备名称&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hostname&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">conn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_prompt&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&amp;lt;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&amp;gt;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;#&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;正在获取设备[&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">]的配置……&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hostname&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 文件保存路径和文件名 &amp;#39;当前目录\\EXPORT\\当天日期\\config_backup\\hostname+ip+当前时间.txt&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">logtime&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">datetime&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;%H%M%S&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">output_filename&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">hostname&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;_&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;_&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">logtime&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;.txt&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">cmds&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 判断单元表里命令是否为空值&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">output&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">cmd&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cmds&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">enable&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 判断是否需要进入enable特权模式&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enable&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">output&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;=&amp;#39;&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">100&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">cmd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">center&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;=&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">output&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">conn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send_command&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">command_string&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">cmd&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">output&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;=&amp;#39;&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">100&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">cmd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">center&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;=&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">output&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">conn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send_command&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">command_string&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">cmd&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 使用ftp/tftp/sftp/scp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">pass&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">disconnect&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># write_data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">write_to_file&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">task_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">output_filename&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">output&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sucessful_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39; &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">hostname&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">failed_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">pass&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="ne">Exception&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;run_cmd Failed: &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@timer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@result_write&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@result_count&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 代码运行主体框架设计&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 获取当前运行的Python文件的路径&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">current_file_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">abspath&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="vm">__file__&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 提取文件名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">task_name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">basename&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">current_file_path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">当前执行的脚本是[&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">task_name&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s1">]，程序正在执行中&amp;gt;&amp;gt;&amp;gt;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hosts&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">get_device_info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">task_name&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pool&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">t_pool&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># hosts是一个返回的生成器，需要进行循环遍历&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">host&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">hosts&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 单线程同步输出方式执行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># run_cmd(host, host[&amp;#39;cmd_list&amp;#39;])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 多线程异步处理&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pool&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apply_async&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">run_cmd&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">task_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;cmd_list&amp;#39;&lt;/span>&lt;span class="p">]))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pool&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pool&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">task_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sucessful_list&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">failed_list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="ne">Exception&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Something Wrong!&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="vm">__name__&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">main&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="pingpy">ping.py
&lt;/h2>&lt;p>批量对设备进行ping测试&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">os&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">ping3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">time&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">settings&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 批量ping测试&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">ping_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ping3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">EXCEPTIONS&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">True&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sleep&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ping3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ping&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{:&amp;lt;18}&lt;/span>&lt;span class="s2">ping测试成功.&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sucessful_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="n">ping3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">errors&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">HostUnknown&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{:&amp;lt;18}&lt;/span>&lt;span class="s2">ping测试失败. Host unknown error raised.&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">failed_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="n">ping3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">errors&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">PingError&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{:&amp;lt;18}&lt;/span>&lt;span class="s2">ping测试失败. A ping error raised.&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">failed_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@timer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@result_write&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@result_count&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 代码运行主体框架设计&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 获取当前运行的Python文件的路径&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">current_file_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">abspath&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="vm">__file__&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 提取文件名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">task_name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">basename&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">current_file_path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">当前执行的脚本是[&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">task_name&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s1">]，程序正在执行中&amp;gt;&amp;gt;&amp;gt;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hosts&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">get_device_info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">task_name&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pool&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">t_pool&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># hosts是一个返回的生成器，需要进行循环遍历&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">host&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">hosts&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 单线程同步输出方式执行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># run_cmd(host, host[&amp;#39;cmd_list&amp;#39;])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 多线程异步处理&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pool&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apply_async&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ping_test&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">,))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pool&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pool&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">task_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sucessful_list&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">failed_list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="ne">Exception&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Something Wrong!&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="vm">__name__&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">main&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ssh_connect_testpy">ssh_connect_test.py
&lt;/h2>&lt;p>批量对设备进行ssh连接测试&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">os&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">settings&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># SSH测试连接设备&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">connect_test&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">flag&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">conn&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">connect_handler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">flag&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 获取到设备名称则表示ssh连接测试成功&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hostname&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">conn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_prompt&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s1"> SSH测试连接成功,获取到设备提示符： &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">hostname&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">disconnect&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sucessful_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># SSH连接测试失败，同记录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s1"> SSH测试连接失败,未获取到设备提示符&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">failed_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="ne">Exception&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;connect_test Failed: &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">failed_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@timer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@result_write&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@result_count&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 代码运行主体框架设计&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 获取当前运行的Python文件的路径&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">current_file_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">abspath&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="vm">__file__&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 提取文件名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">task_name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">basename&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">current_file_path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">当前执行的脚本是[&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">task_name&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s1">]，程序正在执行中&amp;gt;&amp;gt;&amp;gt;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hosts&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">get_device_info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">task_name&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pool&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">t_pool&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># hosts是一个返回的生成器，需要进行循环遍历&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">host&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">hosts&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 单线程同步输出方式执行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># run_cmd(host, host[&amp;#39;cmd_list&amp;#39;])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 多线程异步处理&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pool&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apply_async&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">connect_test&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">,))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pool&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pool&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">task_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sucessful_list&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">failed_list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="ne">Exception&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Something Wrong!&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="vm">__name__&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">main&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="undifinedpy">undifined.py
&lt;/h2>&lt;p>批量对设备添加不同配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">os&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">settings&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="o">*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 执行配置命令&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">run_cmd&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">task_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">cmds&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">enable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">enable&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">True&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;secret&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="kc">False&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">flag&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">conn&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">connect_handler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">flag&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 从返回提示符获取设备名称&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hostname&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">conn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_prompt&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&amp;lt;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&amp;gt;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;#&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;正在为设备[&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s1">]添加配置……&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">hostname&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 文件保存路径和文件名 &amp;#39;当前目录\\EXPORT\\当天日期\\config_add\\hostname+ip+当前时间.txt&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">logtime&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">datetime&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;%H%M%S&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">output_filename&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">hostname&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;_&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;_&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">logtime&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;.txt&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">cmds&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 判断单元表里命令是否为空值&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">output&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">enable&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 判断是否需要进入enable特权模式&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">enable&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">output&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">conn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send_config_set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config_commands&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">cmds&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">output&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">conn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send_config_set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config_commands&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">cmds&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">pass&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">conn&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">disconnect&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># write_data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">write_to_file&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">task_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">output_filename&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">output&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sucessful_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39; &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">hostname&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">failed_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">conn&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">pass&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="ne">Exception&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;run_cmd Failed: &lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@timer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@result_write&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@result_count&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 代码运行主体框架设计&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 获取当前运行的Python文件的路径&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">current_file_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">abspath&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="vm">__file__&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 提取文件名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">task_name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">basename&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">current_file_path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">当前执行的脚本是[&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">task_name&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s1">]，程序正在执行中&amp;gt;&amp;gt;&amp;gt;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">hosts&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">get_undifined_device_info&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pool&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">t_pool&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># hosts是一个返回的生成器，需要进行循环遍历&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">host&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">hosts&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 单线程同步输出方式执行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># run_cmd(host, host[&amp;#39;cmd_list&amp;#39;])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 多线程异步处理&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pool&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apply_async&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">run_cmd&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">args&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">task_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;cmd_list&amp;#39;&lt;/span>&lt;span class="p">]))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pool&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pool&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">task_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sucessful_list&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">failed_list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="ne">Exception&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Something Wrong!&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="vm">__name__&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;__main__&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">main&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="settingspy">settings.py
&lt;/h2>&lt;p>定义一些参数、装饰器、共用函数&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">全局设置和共用函数
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">&amp;#39;&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">os&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">datetime&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">datetime&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">functools&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">wraps&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">ipaddress&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">openpyxl&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">load_workbook&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">multiprocessing.pool&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">ThreadPool&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">netmiko&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">ConnectHandler&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">NetMikoAuthenticationException&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">NetMikoTimeoutException&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">ssh_exception&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 项目根目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">BASE_PATH&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">dirname&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="vm">__file__&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 文件输出目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">EXPORT_PATH&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">BASE_PATH&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;EXPORT&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 定义目录名称为当天日期（格式：20220609）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">dir_name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">datetime&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;%Y%m&lt;/span>&lt;span class="si">%d&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 目录创建&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">new_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EXPORT_PATH&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dir_name&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">isdir&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">new_path&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">makedirs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">new_path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">backup_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">normpath&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EXPORT_PATH&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dir_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;config_backup&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">normpath&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EXPORT_PATH&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dir_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;config_add&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># generate_table = os.path.normpath(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># os.path.join(EXPORT_PATH, dir_name, &amp;#39;generate_table&amp;#39;))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">isdir&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">backup_path&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">makedirs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">backup_path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">isdir&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config_path&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">makedirs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config_path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># if not os.path.isdir(generate_table):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># os.makedirs(generate_table)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 表格数据文件路径&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">device_file&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;dev_data.xlsx&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ThreadPool 设定异步进程数为66&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">t_pool&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ThreadPool&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">66&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 定义列表保存执行成功和失败的主机IP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sucessful_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">failed_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 手动输入登陆信息&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">login_start&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># login module，校验由netmiko完成&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># login_user = input(&amp;#39;Login:&amp;#39;)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># login_pwd = getpass.getpass(&amp;#39;Passwd:&amp;#39;)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># # 明文写死在代码，不安全的方式&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># login_user = &amp;#39;admin&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># login_pwd = &amp;#39;xxx&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># return login_user, login_pwd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">pass&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 加载excel文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">load_excel&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">wb&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">load_workbook&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">device_file&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">wb&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="ne">FileNotFoundError&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2"> excel文件不存在&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">device_file&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="ne">Exception&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;载入读取&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2"> excel文件失败&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">device_file&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 获取设备数据信息&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">get_device_info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">task_name&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># by openpyxl&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># user, pwd = login_start()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">wb&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">load_excel&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ws1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">wb&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">wb&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sheetnames&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 选定单元格数据区域&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">row&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">iter_rows&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">min_row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">max_col&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">9&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 判断IP所在的列不为空值，则进行如下代码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nb">str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;#&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">continue&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">info_dict&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;username&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;password&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;protocol&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;port&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;secret&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;device_type&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;cmd_list&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">get_cmd_info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">task_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">wb&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lower&lt;/span>&lt;span class="p">()]),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">yield&lt;/span> &lt;span class="n">info_dict&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="ne">Exception&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;get_device_info failed: &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">finally&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">wb&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 获取命令信息&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">get_cmd_info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">task_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sheet_name&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cmd_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># by openpyxl&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">row&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">sheet_name&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">iter_rows&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">min_row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">max_col&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 若单元格使用“＃”进行注释或命令为空值，则跳过该行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nb">str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="s1">&amp;#39;#&amp;#39;&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">task_name&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;backup_config.py&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cmd_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">elif&lt;/span> &lt;span class="nb">str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="s1">&amp;#39;#&amp;#39;&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">task_name&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;add_config.py&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cmd_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">cmd_list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="ne">Exception&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;get_cmd_info Error: &amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 获取自定义设备数据信息&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">get_undifined_device_info&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># by openpyxl&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">wb&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">load_excel&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ws1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">wb&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">wb&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sheetnames&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row_number&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 选定单元格数据区域&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">row&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">iter_rows&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">min_row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">max_col&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">9&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 获取执行命令&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">undifined_cmd_info&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">cols&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">iter_cols&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">min_col&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">min_row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row_number&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">max_row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row_number&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">values_only&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">col&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cols&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">col&lt;/span> &lt;span class="ow">is&lt;/span> &lt;span class="kc">None&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">continue&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">undifined_cmd_info&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row_number&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 判断IP所在的列不为空值，执行如下代码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nb">str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;#&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">continue&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">info_dict&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;username&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;password&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;protocol&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;port&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;secret&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;device_type&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;cmd_list&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">undifined_cmd_info&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">yield&lt;/span> &lt;span class="n">info_dict&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="ne">Exception&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;get_device_info failed: &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">finally&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">wb&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># netmiko 连接处理&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">connect_handler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">connect&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 判断使用SSH协议&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 将“protocol”列单元格的内容大写转小写，去除前后空格对比是否为 ssh&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;protocol&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lower&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;ssh&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 判断“port”列单元格，若单元格填写的内容不是22或空，则定义为22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;port&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;port&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;port&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">22&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">None&lt;/span>&lt;span class="p">])&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="mi">22&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 剔除多余connectHandler 不需要的参数，protocol、secret、cmd_list，华为华为设备无特权密码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">host&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pop&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;protocol&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pop&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;cmd_list&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;huawei&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;device_type&amp;#39;&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">host&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pop&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;secret&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">connect&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ConnectHandler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">**&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">conn_timeout&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">elif&lt;/span> &lt;span class="s1">&amp;#39;hp_comware&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;device_type&amp;#39;&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">host&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pop&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;secret&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">connect&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ConnectHandler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">**&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">connect&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ConnectHandler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">**&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">conn_timeout&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 判断使用Telnet协议&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">elif&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;protocol&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">lower&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;telnet&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 判断“port”列单元格，若单元格填写的内容不是23或空，则定义为23&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;port&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;port&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;port&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">23&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">None&lt;/span>&lt;span class="p">])&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="mi">23&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 剔除多余connectHandler 不需要的参数，protocol、secret、cmd_list，华三华为设备无特权密码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">host&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pop&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;protocol&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pop&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;secret&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pop&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;cmd_list&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># netmiko 支持telnet协议，设备类型格式为：hp_comware_telnet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;device_type&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;device_type&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;_telnet&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># fast_cli=false,待测试参数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">connect&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ConnectHandler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">**&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">fast_cli&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 不在以上两种协议内的连接&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;暂不支持IP地址为&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">_的设备使用&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">协议登陆&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;protocol&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">raise&lt;/span> &lt;span class="ne">ValueError&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">True&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">connect&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="n">NetMikoTimeoutException&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2"> Can not connect to Device!&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">False&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">res&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="n">NetMikoAuthenticationException&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2"> username/password wrong!&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">False&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">res&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="n">ssh_exception&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2"> SSH parameter problem!&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">False&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">res&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="ne">Exception&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2"> Failed: &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">False&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">res&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 记录程序执行时间装饰器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">timer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">func&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@wraps&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">func&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">wrapper&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">**&lt;/span>&lt;span class="n">kwargs&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">start_time&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">datetime&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">func&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">**&lt;/span>&lt;span class="n">kwargs&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">end_time&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">datetime&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># print(&amp;#39;\n&amp;#39; + &amp;#39;-&amp;#39; * 42)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;执行完毕，共耗时 &lt;/span>&lt;span class="si">{:0.2f}&lt;/span>&lt;span class="s1"> 秒.&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="n">end_time&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">start_time&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">total_seconds&lt;/span>&lt;span class="p">()))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;-&amp;#39;&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">42&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># return res&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">wrapper&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 记录运行结果的装饰器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">result_count&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">func&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@wraps&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">func&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">wrapper&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">**&lt;/span>&lt;span class="n">kwargs&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">task_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sucessful_list&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">failed_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">func&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">**&lt;/span>&lt;span class="n">kwargs&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;设备总数 &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s1"> 台，成功 &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s1"> 台，失败 &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s1"> 台.&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sucessful_list&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">failed_list&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sucessful_list&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">failed_list&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;-&amp;#39;&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">42&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_count&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">normpath&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EXPORT_PATH&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dir_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="sa">f&lt;/span>&lt;span class="s1">&amp;#39;result_&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">dir_name&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s1">.log&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">运行结果保存路径: &lt;/span>&lt;span class="se">\&amp;#34;&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">result_path&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="se">\&amp;#34;\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">task_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sucessful_list&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">failed_list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">wrapper&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 写入文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">write_to_file&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">task_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">output_filename&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">output&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 写入结果到文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">task_name&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;backup_config.py&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">backup_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">output_filename&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="s1">&amp;#39;a&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;utf-8&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">output&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">elif&lt;/span> &lt;span class="n">task_name&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;add_config.py&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">output_filename&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="s1">&amp;#39;a&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;utf-8&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">output&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">elif&lt;/span> &lt;span class="n">task_name&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;undifined.py&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">output_filename&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="s1">&amp;#39;a&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;utf-8&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">output&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">pass&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 保存运行结果记录的装饰器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">result_write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">func&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@wraps&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">func&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">wrapper&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">**&lt;/span>&lt;span class="n">kwargs&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">task_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sucessful_list&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">failed_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">func&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="n">args&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">**&lt;/span>&lt;span class="n">kwargs&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;设备总数 &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s1"> 台，成功 &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s1"> 台，失败 &lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s1"> 台.&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sucessful_list&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">failed_list&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sucessful_list&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">failed_list&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># time_str = datetime.now()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">datetime&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%Y-%m-&lt;/span>&lt;span class="si">%d&lt;/span>&lt;span class="s1"> %H:%M:%S.&lt;/span>&lt;span class="si">%f&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">normpath&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">EXPORT_PATH&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dir_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="sa">f&lt;/span>&lt;span class="s1">&amp;#39;result_&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">dir_name&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s1">.log&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;a&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;utf-8&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log_title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">task_name&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">center&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;=&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time_str&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">center&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;=&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">log_title&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_count&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">执行成功设备列表：&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">sucessful_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">NG设备列表：&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">failed_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">task_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sucessful_list&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">failed_list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">wrapper&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 判断是否是正确格式的IP地址，IP地址网络，IP地址范围&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">is_valid_ipv4_input&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ipv4_str&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 尝试将输入解析为 IPv4Address&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ipaddress&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">IPv4Address&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ipv4_str&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">True&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="ne">ValueError&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">False&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># try:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># # 将输入拆分为两个 IP 地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># start, end = ipv4_str.split(&amp;#39;-&amp;#39;)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># # 尝试将输入解析为 IPv4Address&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ipaddress.IPv4Address(start.strip())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># ipaddress.IPv4Address(end.strip())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># return True&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># except ValueError as e:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># # 尝试将输入解析为 IPv4Network&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># try:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># network = ipaddress.IPv4Network(ipv4_str)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># if network.hostmask != &amp;#39;0.0.0.0&amp;#39;:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># return True&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># else:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># return False&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># except ValueError as e:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># # print(e)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># return False&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="dev_dataxlsx">dev_data.xlsx
&lt;/h2>&lt;p>定义设备登陆参数和命令&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/07/09/HQZDLa1dUeKV3F9.jpg">
&lt;img src="https://s2.loli.net/2023/07/09/HQZDLa1dUeKV3F9.jpg"
loading="lazy"
alt="ScreenCaputure230709135002"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="requirementstxt">requirements.txt
&lt;/h2>&lt;p>使用到的第三方库&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">bcrypt==4.0.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cffi==1.15.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cryptography==41.0.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">et-xmlfile==1.1.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">future==0.18.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">importlib-metadata==6.8.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">netmiko==3.4.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ntc-templates==3.4.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openpyxl==3.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">paramiko==3.2.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ping3==4.0.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">platformdirs==3.8.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pycparser==2.21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PyNaCl==1.5.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pyserial==3.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PyYAML==6.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">scp==0.14.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">six==1.16.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tenacity==8.2.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">textfsm==1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tomli==2.0.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">yapf==0.40.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">zipp==3.15.0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>GPT问答230615</title><link>https://weeaster.github.io/posts/61188c84/</link><pubDate>Thu, 15 Jun 2023 22:27:11 +0000</pubDate><guid>https://weeaster.github.io/posts/61188c84/</guid><description>&lt;p>&lt;strong>什么是第一性原理&lt;/strong>&lt;/p>
&lt;p>“第一性原理”是科学研究中的一个基本概念，指的是从基本的真实、可验证的事实出发，通过逻辑推导和数学计算等方式来推导出更复杂的现象和规律的方法。&lt;/p>
&lt;p>在理论物理学、化学、材料科学等领域中，第一性原理被广泛运用于对各种材料的物性和化学性质进行理论计算和分析。&lt;/p>
&lt;p>第一性原理的核心思想是通过对物质的基本组成和相互作用进行深入剖析，从而建立关于物质性质的准确数学模型。这些模型可以被用于预测和解释各种物质行为和性质，例如晶体结构、热力学性质、光学特性、电学特性、磁学特性等等。通俗地说，第一性原理就是“从零开始，自己推导”。&lt;/p>
&lt;p>第一性原理的研究可以通过高性能计算机等技术手段进行实现，其中最典型的方法是密度泛函理论，即把复杂的多体问题简化成单粒子问题，从而避开了系统中所有粒子的动力学行为的细节。这些方法使得科学家们不再受到实验条件限制，可以对材料的基本性质进行精确的计算和预测，从而推动了材料科学及相关领域的发展。&lt;/p>
&lt;p>&lt;strong>什么是技能&lt;/strong>&lt;/p>
&lt;p>“技能”是指在特定领域内掌握的某种技术或技巧，通常被定义为实际应用能力。技能具有普遍性和特殊性，普遍性指技能的应用范围很广，而特殊性指技能只能够用于特定的领域。&lt;/p>
&lt;p>技能的学习和掌握需要不断地练习和实践，只有通过长期的积累和不断的提高，才能够获得卓越的技能表现。不同的技能需要不同的专业知识、理论基础和实践经验，例如编程技能、绘画技能、演讲技能、烹饪技能等等。&lt;/p>
&lt;p>技能的重要性在现代社会中越来越凸显，因为随着科技的发展和经济的全球化，市场竞争越来越激烈，拥有优秀的技能已经成为获得并保持一份工作的关键。拥有高水平的技能可以帮助人们创造更多的价值，提升个人能力和职业素质，从而在职场上更加出色和成功。&lt;/p>
&lt;p>&lt;strong>什么是入门&lt;/strong>&lt;/p>
&lt;p>“入门”是指初学者刚开始接触某一领域或技能时需要掌握的基础知识和基本技能。在学术、职业、爱好等各种不同的领域中，都有其相应的入门要求和内容。&lt;/p>
&lt;p>通常情况下，入门的学习过程包括了基础理论知识的介绍和学习，相关技能和技术的掌握以及实践练习等环节。入门阶段的学习目标是掌握该领域或技能的基础知识，了解其基本概念和基本原理，并能够较为熟练地运用所学知识进行简单的实践操作。&lt;/p>
&lt;p>作为任何一个领域的起点，入门阶段的学习非常重要，因为这关系到后续深入学习的有效性和效果。只有掌握了基础知识和技能，才能够在后面的学习中更加轻松和自信地应对并取得更高的学习成果。&lt;/p>
&lt;p>同时，入门阶段的学习也需要持之以恒的坚持和不断的自我反思和修正。只有通过不断的学习和实践，才能够成为在该领域里的专家或者达到自己所期望的水平。&lt;/p></description></item><item><title>CentOS-8.0.1905 安装配置图形化桌面环境和TigerVNC(离线安装)</title><link>https://weeaster.github.io/posts/f652ccc4/</link><pubDate>Sat, 20 May 2023 18:18:21 +0000</pubDate><guid>https://weeaster.github.io/posts/f652ccc4/</guid><description>&lt;p>上一篇文描述的是在线安装，这篇文挑战一下离线安装，下载 &lt;code>Server with GUI&lt;/code>组件及其依赖项和&lt;code>TigerVNC&lt;/code>后上传服务器进行安装&lt;/p>
&lt;p>&lt;strong>操作流程：&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>先给虚拟机创建一个快照&lt;/li>
&lt;li>使用虚拟机下载安装软件包然后打包导出到本地&lt;/li>
&lt;li>还原快照&lt;/li>
&lt;li>上传软件包到虚拟机&lt;/li>
&lt;li>安装软件&lt;/li>
&lt;li>测试&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>环境说明&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Microsoft Windows 10 Pro 21H2&lt;/li>
&lt;li>VMware® Workstation 15.0.0&lt;/li>
&lt;li>OS: CentOS Linux 8&lt;/li>
&lt;li>IMG: CentOS-8-x86_64-1905-dvd1.iso&lt;/li>
&lt;li>Xvnc TigerVNC 1.11.0 - built Jul 21 2021 11:25:16&lt;/li>
&lt;/ul>
&lt;h2 id="配置华为云centos-vault-yum源">配置华为云CentOS-Vault yum源
&lt;/h2>&lt;p>使用华为云CentOS-Vault&lt;/p>
&lt;p>官网链接： &lt;a class="link" href="https://mirrors.huaweicloud.com/home" target="_blank" rel="noopener"
>https://mirrors.huaweicloud.com/home
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/20/TmgzICPbDUkwQMF.jpg">
&lt;img src="https://s2.loli.net/2023/05/20/TmgzICPbDUkwQMF.jpg"
loading="lazy"
alt="ScreenCaputure230518002717"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="备份etcyumreposd-目录下的文件">备份/etc/yum.repos.d 目录下的文件
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> cp -a /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>或&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> mkdir /etc/yum.repos.d/backup_repo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mv /etc/yum.repos.d/*.repo /etc/yum.repos.d/backup_repo/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="配置华为云centos-vault-yum源-1">配置华为云CentOS-Vault yum源
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> wget -O /etc/yum.repos.d/CentOS-Base.repo https://repo.huaweicloud.com/repository/conf/CentOS-8-reg.repo
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>执行&lt;strong>yum clean all&lt;/strong>清除原有yum缓存。&lt;/p>
&lt;p>执行&lt;strong>yum makecache&lt;/strong>（刷新缓存）或者&lt;strong>yum repolist all&lt;/strong>（查看所有配置可以使用的文件，会自动刷新缓存）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> yum clean all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> yum makecache
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="下载软件包和导出软件包到本地">下载软件包和导出软件包到本地
&lt;/h2>&lt;h3 id="创建一个目录来保存软件包创建-rootpackages-目录">创建一个目录来保存软件包。创建 &lt;code>/root/packages&lt;/code> 目录
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> mkdir /root/packages
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>运行以下命令以下载 &amp;ldquo;Server with GUI&amp;rdquo; 组件及其所有依赖项和TigerVNC 组件及其依赖项&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> dnf -y group install &lt;span class="s2">&amp;#34;Server with GUI&amp;#34;&lt;/span> --downloadonly --downloaddir&lt;span class="o">=&lt;/span>/root/packages
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dnf -y install tigervnc-server --downloadonly --downloaddir&lt;span class="o">=&lt;/span>/root/packages
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="打包tar导出软件包到本地">打包tar，导出软件包到本地
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> tar -cvf packages.tar /root/packages/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>使用工具将&lt;code>packages.tar&lt;/code>导出到本地存储上&lt;/p>
&lt;h3 id="还原快照和上传软件包">还原快照和上传软件包
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/21/LUjqTFuv4bJtXg9.jpg">
&lt;img src="https://s2.loli.net/2023/05/21/LUjqTFuv4bJtXg9.jpg"
loading="lazy"
alt="ScreenCaputure230521051856"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/21/lmgV6IwjMNSenJz.jpg">
&lt;img src="https://s2.loli.net/2023/05/21/lmgV6IwjMNSenJz.jpg"
loading="lazy"
alt="ScreenCaputure230521051752"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;hr>
&lt;h2 id="安装软件包和配置服务">安装软件包和配置服务
&lt;/h2>&lt;h3 id="关闭selinux后面配置完成再启用">关闭SELINUX，后面配置完成再启用
&lt;/h3>&lt;p>使用命令&lt;code> nano /etc/selinux/config&lt;/code>编辑该文件，将&lt;strong>SELINUX&lt;/strong>设置为&lt;strong>disabled&lt;/strong>，然后 &lt;strong>reboot&lt;/strong> 重启&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">SELINUX&lt;/span>&lt;span class="o">=&lt;/span>disabled
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>使用命令&lt;code> sestatus&lt;/code>查看防火墙状态，输出结果如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">SELinux status: disabled
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="将上传的packagestar解压">将上传的&lt;code>packages.tar&lt;/code>解压
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> tar -xvf /root/packages.tar
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="在rootpackages-目录下创建-localrepo-文件">在/root/packages 目录下创建 local.repo 文件
&lt;/h3>&lt;p>使用命令&lt;code> nano /root/packages/local.repo&lt;/code>创建文件，添加以下内容&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[packages]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">name=Local Repository
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">baseurl=file:///root/packages
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">enabled=1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gpgcheck=0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="运行以下命令以安装组件及其依赖项">运行以下命令以安装组件及其依赖项
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> dnf -c /root/packages/local.repo install /root/packages/*.rpm -y
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>在安装完以上软件包后，我的虚拟机貌似出问题了，执行之后步骤提示权限不足，明明是root用户下的操作，&lt;strong>强制重启&lt;/strong>虚拟机后再进行以下步骤&lt;/p>
&lt;h3 id="设置图形界面为默认运行级别">设置图形界面为默认运行级别
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> systemctl set-default graphical.target
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="启动图形界面">启动图形界面
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> systemctl start graphical.target
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="查看看服务状态">查看看服务状态
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> systemctl status graphical.target
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="重启">重启
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> reboot
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="重启后进入图形化桌面">重启后进入图形化桌面
&lt;/h2>&lt;h3 id="检查graphicaltarget服务">检查graphical.target服务
&lt;/h3>&lt;p>重启后发现没能自动进入图形化桌面，检查&lt;code>systemctl status graphical.target&lt;/code>输出结果是&lt;code>Active&lt;/code>&lt;/p>
&lt;h3 id="检查gdm-服务设置">检查GDM 服务设置
&lt;/h3>&lt;p>检查 GDM 服务的设置。使用以下命令检查 GDM 服务是否已启用：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> systemctl is-enabled gdm.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>如果输出结果为 &lt;code>disabled&lt;/code>，请使用以下命令启用 GDM 服务：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> systemctl &lt;span class="nb">enable&lt;/span> gdm.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>我的环境操作下启用GDM服务后reboot重启，可以进入图形化桌面&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/21/qtECgPLpSUzH139.jpg">
&lt;img src="https://s2.loli.net/2023/05/21/qtECgPLpSUzH139.jpg"
loading="lazy"
alt="ScreenCaputure230521035750"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>接下来的步骤与上一篇文的步骤一致，不多耗费篇幅&lt;/p>
&lt;h2 id="截图">截图
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/21/Is4ejZHX8Woihbu.jpg">
&lt;img src="https://s2.loli.net/2023/05/21/Is4ejZHX8Woihbu.jpg"
loading="lazy"
alt="ScreenCaputure230521042304"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/21/pnHIKCo9XtAkdDc.jpg">
&lt;img src="https://s2.loli.net/2023/05/21/pnHIKCo9XtAkdDc.jpg"
loading="lazy"
alt="ScreenCaputure230521042318"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/21/Txmqoa9A34tjNkg.jpg">
&lt;img src="https://s2.loli.net/2023/05/21/Txmqoa9A34tjNkg.jpg"
loading="lazy"
alt="ScreenCaputure230521042357"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="最后">最后
&lt;/h2>&lt;ul>
&lt;li>发现即使指定要求只下载&lt;code>Server with GUI&lt;/code>，但安装时查看到软件包列表还是发现很多包一并安装了，这可能会对已有运行服务产生影响，慎重使用，起码懂得回退的操作&lt;/li>
&lt;li>现在服务器操作系统一般都上虚拟化了，操作这些安装升级的时候要记得做个快照，备份之类的&lt;/li>
&lt;li>配置完成后别忘了开防火墙策略SELINUX=enforcing，重开SELINUX真耗时间&lt;/li>
&lt;li>业余选手，勿喷&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨&lt;/li>
&lt;/ul></description></item><item><title>CentOS-8.0.1905 安装配置图形化桌面环境和TigerVNC(在线安装)</title><link>https://weeaster.github.io/posts/a451a5f2/</link><pubDate>Sat, 20 May 2023 00:55:54 +0000</pubDate><guid>https://weeaster.github.io/posts/a451a5f2/</guid><description>&lt;p>&lt;code>CentOS 8.0.1905&lt;/code> 服务器上初始安装没有安装图形化桌面环境，现在需要对该服务器安装图形桌面化环境和安装&lt;code>TigerVNC&lt;/code>，并在本地（windows平台）使用&lt;code>VNC&lt;/code>客户端进行远程桌面连接&lt;/p>
&lt;p>&lt;strong>环境说明&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>Microsoft Windows 10 Pro 21H2&lt;/li>
&lt;li>VMware® Workstation 15.0.0&lt;/li>
&lt;li>OS: CentOS Linux 8&lt;/li>
&lt;li>IMG: CentOS-8-x86_64-1905-dvd1.iso&lt;/li>
&lt;li>Xvnc TigerVNC 1.11.0 - built Jul 21 2021 11:25:16&lt;/li>
&lt;/ul>
&lt;h2 id="使用华为云centos-vault">使用华为云CentOS-Vault
&lt;/h2>&lt;p>&lt;strong>现在 CentOS 8（非 Stream 版本）已被官方移除出该仓库。需要使用&lt;code>centos-vault&lt;/code>镜像&lt;/strong>&lt;/p>
&lt;p>先浏览官网链接，查看使用说明&lt;/p>
&lt;p>官网链接： &lt;a class="link" href="https://mirrors.huaweicloud.com/home" target="_blank" rel="noopener"
>https://mirrors.huaweicloud.com/home
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/20/TmgzICPbDUkwQMF.jpg">
&lt;img src="https://s2.loli.net/2023/05/20/TmgzICPbDUkwQMF.jpg"
loading="lazy"
alt="ScreenCaputure230518002717"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="备份etcyumreposd-目录下的文件">备份/etc/yum.repos.d 目录下的文件
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@centos-106 yum.repos.d&lt;span class="o">]&lt;/span>&lt;span class="c1"># cp -a /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>或&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 创建备份目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@centos-106 yum.repos.d&lt;span class="o">]&lt;/span>&lt;span class="c1"># mkdir repo_back&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 移动 *.repo 到 back_repo 目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@centos-106 yum.repos.d&lt;span class="o">]&lt;/span>&lt;span class="c1"># mv *.repo back_repo/&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="配置华为云centos-vault-yum源">配置华为云CentOS-Vault yum源
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@centos-106 yum.repos.d&lt;span class="o">]&lt;/span>&lt;span class="c1"># wget -O /etc/yum.repos.d/CentOS-Base.repo https://repo.huaweicloud.com/repository/conf/CentOS-8-reg.repo&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--2023-05-17 12:12:00-- https://repo.huaweicloud.com/repository/conf/CentOS-8-reg.repo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Resolving repo.huaweicloud.com &lt;span class="o">(&lt;/span>repo.huaweicloud.com&lt;span class="o">)&lt;/span>... 58.59.128.100, 58.59.128.102, 58.59.128.99
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Connecting to repo.huaweicloud.com &lt;span class="o">(&lt;/span>repo.huaweicloud.com&lt;span class="o">)&lt;/span>&lt;span class="p">|&lt;/span>58.59.128.100&lt;span class="p">|&lt;/span>:443... connected.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">HTTP request sent, awaiting response... &lt;span class="m">200&lt;/span> OK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Length: &lt;span class="m">2218&lt;/span> &lt;span class="o">(&lt;/span>2.2K&lt;span class="o">)&lt;/span> &lt;span class="o">[&lt;/span>application/octet-stream&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Saving to: ‘/etc/yum.repos.d/CentOS-Base.repo’
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/etc/yum.repos.d/CentOS-Base.repo 100%&lt;span class="o">[================================================================&lt;/span>&amp;gt;&lt;span class="o">]&lt;/span> 2.17K --.-KB/s in 0s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2023-05-17 12:12:01 &lt;span class="o">(&lt;/span>33.0 MB/s&lt;span class="o">)&lt;/span> - ‘/etc/yum.repos.d/CentOS-Base.repo’ saved &lt;span class="o">[&lt;/span>2218/2218&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>执行&lt;strong>yum clean all&lt;/strong>清除原有yum缓存。&lt;/p>
&lt;p>执行&lt;strong>yum makecache&lt;/strong>（刷新缓存）或者&lt;strong>yum repolist all&lt;/strong>（查看所有配置可以使用的文件，会自动刷新缓存）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@centos-106 yum.repos.d&lt;span class="o">]&lt;/span>&lt;span class="c1"># yum clean all&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="m">7&lt;/span> files removed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@centos-106 yum.repos.d&lt;span class="o">]&lt;/span>&lt;span class="c1"># yum makecache&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CentOS-8 - AppStream - repo.huaweicloud.com 3.9 MB/s &lt;span class="p">|&lt;/span> 8.4 MB 00:02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CentOS-8 - Base - repo.huaweicloud.com 2.7 MB/s &lt;span class="p">|&lt;/span> 4.6 MB 00:01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CentOS-8 - PowerTools - repo.huaweicloud.com 1.6 MB/s &lt;span class="p">|&lt;/span> 2.3 MB 00:01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CentOS-8 - Extras - repo.huaweicloud.com 4.9 kB/s &lt;span class="p">|&lt;/span> &lt;span class="m">10&lt;/span> kB 00:02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Metadata cache created.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="安装配置图形桌面环境">安装配置图形桌面环境
&lt;/h2>&lt;h3 id="关闭selinux后面配置完成再启用">关闭SELINUX，后面配置完成再启用
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@centos-106 selinux&lt;span class="o">]&lt;/span>&lt;span class="c1"># nano /etc/selinux/config&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">将SELINUX设置为disabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">SELINUX&lt;/span>&lt;span class="o">=&lt;/span>disabled
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">reboot重启
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>查看防火墙状态&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@centos-106 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># sestatus&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SELinux status: disabled
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="安装图形化桌面环境">安装图形化桌面环境
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@centos-106 yum.repos.d&lt;span class="o">]&lt;/span>&lt;span class="c1"># dnf groupinstall &amp;#34;Server with GUI&amp;#34; -y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Complete!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@centos-106 yum.repos.d&lt;span class="o">]&lt;/span>&lt;span class="c1"># &lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="设置图形界面为默认运行级别">设置图形界面为默认运行级别
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">systemctl set-default graphical.target
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="启动图形界面">启动图形界面
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">systemctl start graphical.target
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="重启">重启
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">reboot
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="向导设置">向导设置
&lt;/h3>&lt;p>重启后会看到图形化界面的一个向导，前面的基本点&lt;code>next&lt;/code>(定位服务可关)，最后几步有个新建用户的步骤，建立一个用户给下一步骤中的 VNC Server服务 使用（不一定非使用vncuser这个名称）&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/20/JobT3SVD6OiMhkK.jpg">
&lt;img src="https://s2.loli.net/2023/05/20/JobT3SVD6OiMhkK.jpg"
loading="lazy"
alt="ScreenCaputure230519172613"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/20/pHfTQuhFBtClPvz.jpg">
&lt;img src="https://s2.loli.net/2023/05/20/pHfTQuhFBtClPvz.jpg"
loading="lazy"
alt="ScreenCaputure230519172631"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/20/UlDIh8WmETvdA2V.jpg">
&lt;img src="https://s2.loli.net/2023/05/20/UlDIh8WmETvdA2V.jpg"
loading="lazy"
alt="ScreenCaputure230519172807"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="安装-vnc-server-服务">&lt;strong>安装 VNC Server 服务&lt;/strong>
&lt;/h2>&lt;h3 id="安装-tigervnc">安装 &lt;strong>TigerVNC&lt;/strong>
&lt;/h3>&lt;p>以 &lt;code>root&lt;/code> 用户身份运行以下命令，基本都使用&lt;code>root&lt;/code>用户权限操作（提示权限不足要在命令前加 sudo 很烦），需要切换&lt;code>vncuser&lt;/code>用户会说明&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@centos-106 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># dnf install tigervnc-server -y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Installed:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tigervnc-selinux-1.11.0-9.el8.noarch tigervnc-server-1.11.0-9.el8.x86_64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Complete!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@centos-106 ~&lt;span class="o">]&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="创建-vnc-用户并设置密码前面已创建可跳过">创建 vnc 用户并设置密码（前面已创建可跳过）
&lt;/h3>&lt;p>如不想使用在上一步骤建立的用户，可在这一步骤中新建用户&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@centos-106 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># useradd vnc_user&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@centos-106 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># passwd vnc_user&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Changing password &lt;span class="k">for&lt;/span> user uservnc.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">New password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Retype new password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">passwd: all authentication tokens updated successfully.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@centos-106 ~&lt;span class="o">]&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="拷贝-vncserverservice-文件">拷贝 vncserver@.service 文件
&lt;/h3>&lt;p>创建&lt;code>/etc/systemd/system/vncserver@.service&lt;/code> 配置文件。要创建这个文件，从&lt;code>/usr/lib/systemd/system/vncserver@.service&lt;/code> 复制&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@centos-106 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># ~]# cp /usr/lib/systemd/system/vncserver@.service /etc/systemd/system/vncserver@.service&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>不需要在文件名中包含显示号，因为 &lt;code>systemd 会自动根据需要&lt;/code> 在内存中创建适当的命名实例，将服务文件中的 &lt;code>'%i'&lt;/code> 替换为显示号。对于单个用户，无需重命名该文件。&lt;/p>
&lt;blockquote>
&lt;p>VNC 桌面的默认大小为 1024x768。&lt;/p>
&lt;p>可以使用 &lt;code>~/.vnc/config&lt;/code> 文件进一步配置用户的 VNC 会话。&lt;/p>
&lt;p>例如，要更改 VNC 窗口大小，请添加以下行：&lt;/p>
&lt;p>geometry= &lt;WIDTH> x &lt;HEIGHT>&lt;/p>
&lt;/blockquote>
&lt;h3 id="在-etctigervncvncserverusers-中为端口1配置用户-vncuser即1vncuser">在 /etc/tigervnc/vncserver.users 中为端口1配置用户 vncuser（即：1=vncuser）
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@centos-106 system&lt;span class="o">]&lt;/span>&lt;span class="c1"># nano /etc/tigervnc/vncserver.users &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">添加：
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">:1&lt;span class="o">=&lt;/span>vncuser
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="从-root-切换到-vncuser配置文件中定义的用户的连接密码">从 root 切换到 vncuser，配置文件中定义的用户的连接密码
&lt;/h3>&lt;p>这一步骤中需要设置一个连接密码(最长八个字符，多出的字符会被切掉）；在&lt;code>view-only password (y/n)? &lt;/code> 选 &lt;code>n&lt;/code>；选&lt;code>y&lt;/code>只能查看不能输入&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@centos-106 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># su - vncuser &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>vncuser@centos-106 ~&lt;span class="o">]&lt;/span>$ vncpasswd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Verify:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Would you like to enter a view-only password &lt;span class="o">(&lt;/span>y/n&lt;span class="o">)&lt;/span>? n
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">A view-only password is not used
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>vncuser@centos-106 ~&lt;span class="o">]&lt;/span>$ &lt;span class="nb">exit&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="查看-5901-端口-vnc-server-的监听状态">查看 5901 端口 VNC server 的监听状态
&lt;/h3>&lt;p>&lt;strong>lsof -i :5901&lt;/strong> 或 &lt;strong>netstat -tulpn | grep 5901&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>vncuser@centos-106 ~&lt;span class="o">]&lt;/span>$ lsof -i :5901
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Xvnc &lt;span class="m">2385&lt;/span> vncuser 6u IPv4 &lt;span class="m">46911&lt;/span> 0t0 TCP *:5901 &lt;span class="o">(&lt;/span>LISTEN&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Xvnc &lt;span class="m">2385&lt;/span> vncuser 7u IPv6 &lt;span class="m">46912&lt;/span> 0t0 TCP *:5901 &lt;span class="o">(&lt;/span>LISTEN&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>vncuser@centos-106 ~&lt;span class="o">]&lt;/span>$ netstat -tulpn &lt;span class="p">|&lt;/span> grep &lt;span class="m">5901&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">(&lt;/span>Not all processes could be identified, non-owned process info
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> will not be shown, you would have to be root to see it all.&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tcp &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> 0.0.0.0:5901 0.0.0.0:* LISTEN 2385/Xvnc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tcp6 &lt;span class="m">0&lt;/span> &lt;span class="m">0&lt;/span> :::5901 :::* LISTEN 2385/Xvnc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="配置防火墙开放-5901-端口">配置防火墙，开放 5901 端口：
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@centos-106 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># firewall-cmd --permanent --zone=public --add-port=5901/tcp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">success
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@centos-106 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># firewall-cmd --reload&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">success
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@centos-106 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># &lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="启动服务">启动服务
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 重新加载systemd守护程序配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl daemon-reload
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 将VNC服务器服务vncserver@:1.service设置为开机自启动&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl &lt;span class="nb">enable&lt;/span> vncserver@:1.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 将VNC服务器服务vncserver@:1.service启动&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl start vncserver@:1.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 在终端上输出有关VNC服务器服务vncserver@:1.service的当前状态信息&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl status vncserver@:1.service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="本地使用-vnc-客户端进行远程桌面连接">本地使用 VNC 客户端进行远程桌面连接
&lt;/h2>&lt;p>&lt;code>VNC&lt;/code>客户端的选择有很多，例如以下用到的&lt;code>UltraVNC Viewer&lt;/code>；还有&lt;code>VNC Viewer&lt;/code>、&lt;code>MobaXterm&lt;/code>，任君选择&lt;/p>
&lt;h3 id="打开软件输入-服务器地址端口号-点击-connect">打开软件，输入 服务器地址:端口号 ，点击 Connect
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/20/eokPTcQ9DN1mqfx.jpg">
&lt;img src="https://s2.loli.net/2023/05/20/eokPTcQ9DN1mqfx.jpg"
loading="lazy"
alt="ScreenCaputure230519175406"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="输入连接密码点击-log-on">输入连接密码，点击 Log On
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/20/7ki35TpPR9ursC1.jpg">
&lt;img src="https://s2.loli.net/2023/05/20/7ki35TpPR9ursC1.jpg"
loading="lazy"
alt="ScreenCaputure230519174918"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="登陆界面">登陆界面
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/20/mldZUyFNcri17YG.jpg">
&lt;img src="https://s2.loli.net/2023/05/20/mldZUyFNcri17YG.jpg"
loading="lazy"
alt="ScreenCaputure230520005726"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/20/6MGFkfhVWr2AKgR.jpg">
&lt;img src="https://s2.loli.net/2023/05/20/6MGFkfhVWr2AKgR.jpg"
loading="lazy"
alt="ScreenCaputure230520005831"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="踩坑">踩坑
&lt;/h2>&lt;h3 id="运行-yum-update-之后repo-文件的变化">运行 yum update 之后，repo 文件的变化
&lt;/h3>&lt;p>在配置华为云CentOS-Vault yum源之后，运行&lt;code>yum update&lt;/code>，好家伙把&lt;code>/etc/yum.repos.d/&lt;/code>目录下&lt;code>*.repo&lt;/code>文件给干掉了，又得重复一次&lt;code>配置华为云CentOS-Vault yum源&lt;/code>的步骤&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@centos-106 yum.repos.d&lt;span class="o">]&lt;/span>&lt;span class="c1"># ll&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r--. &lt;span class="m">1&lt;/span> root root &lt;span class="m">2218&lt;/span> May &lt;span class="m">18&lt;/span> 13:03 CentOS-Base.repo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x. &lt;span class="m">2&lt;/span> root root &lt;span class="m">4096&lt;/span> May &lt;span class="m">18&lt;/span> 12:41 repo_back
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x. &lt;span class="m">2&lt;/span> root root &lt;span class="m">4096&lt;/span> May &lt;span class="m">18&lt;/span> 13:03 repo_back2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="运行-vncserver-等旧格式命令的提示">运行 vncserver 等旧格式命令的提示
&lt;/h3>&lt;p>在运行&lt;code>vncserver&lt;/code>开头的命令后，会有一行提示如下&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">WARNING: vncserver has been replaced by a systemd unit and is about to be removed in future releases.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Please &lt;span class="nb">read&lt;/span> /usr/share/doc/tigervnc/HOWTO.md &lt;span class="k">for&lt;/span> more information.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>在处理这个步骤耗费了本人非常多的时间，例如启动报错，启动不报错能连接但是黑屏各种问题。最后在CentOS论坛看到一篇帖子，看到提示去找 Red Hat 官网手册才处理好这个问题；顺便说一句搜索引擎各种关于安装VNC Server 的中文资料没一个能用（没标明环境和版本，索骥失败），最终还是去看官网手册；看来少吃别人嚼过的东西&lt;/p>
&lt;h2 id="最后">最后
&lt;/h2>&lt;ul>
&lt;li>参考资料:&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">- vncserver failed by ShinShin on 2020/11/17 :
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">https://forums.centos.org/viewtopic.php?f=54&amp;amp;t=76387
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Red Hat Enterprise Linux 7 Deployment, configuration, and administration of RHEL 7 Chapter 13. TigerVNC:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/ch-tigervnc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>发现即使指定要求只下载&lt;code>Server with GUI&lt;/code>，但安装时查看到软件包列表还是发现很多包一并安装了，这可能对已有运行服务产生影响，慎重使用，起码懂得回退的操作&lt;/li>
&lt;li>现在服务器操作系统一般都上虚拟化了，操作这些安装升级的时候要记得做个快照，备份之类的&lt;/li>
&lt;li>如有需要玩这个的话，强烈建议先在虚拟机多轮测试再去实际操作，多建立快照&lt;/li>
&lt;li>配置完成后别忘了开防火墙策略SELINUX=enforcing，重开SELINUX真耗时间&lt;/li>
&lt;li>业余选手，勿喷&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨&lt;/li>
&lt;/ul></description></item><item><title>添加hexo文章时效性提示</title><link>https://weeaster.github.io/posts/9481f4f2/</link><pubDate>Thu, 11 May 2023 13:30:19 +0000</pubDate><guid>https://weeaster.github.io/posts/9481f4f2/</guid><description>&lt;p>之前的一些文章由于当时的软硬件版本或特性存在一定的时效性，比如一些解决方案，但随着时间推移可能已经推出新版本或新特性或变更不再适用当前。&lt;/p>
&lt;p>在这些文章页面给出提示信息，提示注意甄别。&lt;/p>
&lt;p>&lt;strong>效果如下：&lt;/strong>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/11/PMvTXZxS3C5tLKA.jpg">
&lt;img src="https://s2.loli.net/2023/05/11/PMvTXZxS3C5tLKA.jpg"
loading="lazy"
alt="ScreenCaputure230511143012"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="操作步骤">操作步骤
&lt;/h2>&lt;p>在主题文件夹的 layout 目录下找到文章页面的模板文件，一般为&lt;code>post.ejs&lt;/code>或者&lt;code>article.ejs&lt;/code>（这个要根据主题来确定，我使用的主题是 post.ejs 包了一层 article.ejs，所以在 article.ejs 中添加代码比较合适），在该文件中找到文章正文之上的行添加如下代码：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;!--&lt;/span> &lt;span class="n">add&lt;/span> &lt;span class="n">timeliness&lt;/span> &lt;span class="n">tips&lt;/span> &lt;span class="n">date&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">20230510&lt;/span> &lt;span class="o">--&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;%&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nb">typeof&lt;/span> &lt;span class="n">post&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">notips&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="s1">&amp;#39;undefined&amp;#39;&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="o">!&lt;/span>&lt;span class="n">post&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">notips&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="o">%&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;%&lt;/span> &lt;span class="k">var&lt;/span> &lt;span class="n">days&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">moment&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">diff&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">moment&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">post&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">date&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="s1">&amp;#39;days&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="o">%&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;%&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">days&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="mi">180&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="o">%&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">div&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="k">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;fa fa-exclamation-triangle&amp;#34;&lt;/span>&lt;span class="o">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">This&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">an&lt;/span> &lt;span class="n">article&lt;/span> &lt;span class="n">that&lt;/span> &lt;span class="n">was&lt;/span> &lt;span class="n">created&lt;/span> &lt;span class="o">&amp;lt;%=&lt;/span> &lt;span class="n">days&lt;/span> &lt;span class="o">%&amp;gt;&lt;/span> &lt;span class="n">days&lt;/span> &lt;span class="n">ago&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">information&lt;/span> &lt;span class="n">may&lt;/span> &lt;span class="n">have&lt;/span> &lt;span class="n">evolved&lt;/span> &lt;span class="ow">or&lt;/span> &lt;span class="n">changed&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;/&lt;/span>&lt;span class="n">div&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">br&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;%&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="o">%&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;%&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="o">%&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="代码说明">代码说明
&lt;/h2>&lt;p>这段 EJS 代码主要实现以下功能：&lt;/p>
&lt;ol>
&lt;li>判断文章是否需要显示警告信息，如果需要显示警告信息，则执行接下来的代码块；&lt;/li>
&lt;li>计算文章发布时间与当前时间之间的天数，并判断是否超过 180 天；&lt;/li>
&lt;li>如果超过 180 天，则显示一个带有警告图标开头的提示信息，告知读者文章内容可能已经过时或发生变化。&lt;/li>
&lt;/ol>
&lt;h3 id="notips字段的使用">notips字段的使用
&lt;/h3>&lt;p>在 Hexo 的文章 Front-matter 中定义&lt;code>notips&lt;/code> 字段，因为有一些类型的文章并不需要这个提示，比如一些感想思考想法。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;% if (typeof post.notips === &amp;#39;undefined&amp;#39; || !post.notips) { %&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>这一行代码首先判断 &lt;code>post.notips&lt;/code> 是否有定义。如果没有定义，即 &lt;code>typeof post.notips === 'undefined'&lt;/code> 为真，或者定义了但值为假（0、false、null、空字符串等），即 &lt;code>!post.notips&lt;/code> 为真，那么就执行接下来的代码块，否则跳过。&lt;/p>
&lt;p>&lt;strong>如果需要在文章中显示提示信息，则留空就行，不定义&lt;code>notips&lt;/code>就行&lt;/strong>&lt;/p>
&lt;p>&lt;strong>如果不需要在文章中显示提示信息，则把&lt;code>post.notips&lt;/code> 的值设置为真（即非零、非空、非 false）&lt;/strong>&lt;/p>
&lt;p>&lt;strong>如果想要又不想要，你自己分裂去&lt;/strong>&lt;/p>
&lt;p>以下是一个不需要在文章中显示提示信息的例子：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-markdown" data-lang="markdown">&lt;span class="line">&lt;span class="cl">title: title
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">notips: true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="其他行代码说明">其他行代码说明
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;%&lt;/span> &lt;span class="k">var&lt;/span> &lt;span class="n">days&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">moment&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">diff&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">moment&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">post&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">date&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="s1">&amp;#39;days&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="o">%&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>这一行代码使用 moment.js 库计算当前时间与文章发布时间之间的天数。具体来说&lt;code>moment().diff(moment(post.date), 'days')&lt;/code> 表示当前时间与 &lt;code>post.date&lt;/code> 这个 moment 对象之间的天数差值。将计算结果赋值给 &lt;code>days&lt;/code> 变量，以便后续使用。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;% if (days &amp;gt; 180) { %&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;div&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;i class=&amp;#34;fa fa-exclamation-triangle&amp;#34;&amp;gt;&amp;lt;/i&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> This is an article that was created &amp;lt;%= days %&amp;gt; days ago, and the information may have evolved or changed.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;/div&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;br&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;% } %&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>这一段代码实现了在文章过时时显示一个警告提示信息。具体来说，如果 &lt;code>days&lt;/code> 大于 180，即文章发布时间距今已经超过 180 天，则显示一个带警告图标开头的提示信息，里面包含了提示文字和当前时间与发布时间之间的天数差值。&lt;/p>
&lt;h2 id="最后">最后
&lt;/h2>&lt;ul>
&lt;li>以上方案部分代码内容来自GPT，但是点开参考来源是404页面，让人费解&lt;/li>
&lt;/ul></description></item><item><title>H3C 防火墙（v7）提取导出安全策略至表格(textfsm)</title><link>https://weeaster.github.io/posts/cce1f96e/</link><pubDate>Wed, 10 May 2023 17:24:57 +0000</pubDate><guid>https://weeaster.github.io/posts/cce1f96e/</guid><description>&lt;p>去年写过一版这个需求的python代码，使用的是&lt;code>if&lt;/code>判断语句进行匹配获取内容然后写入表格&lt;/p>
&lt;p>&lt;a class="link" href="https://kiraster.github.io/posts/f285fb93.html" target="_blank" rel="noopener"
>H3C 防火墙（v7）提取导出安全策略至表格
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/p>
&lt;p>当时主打一个使用最少的库，最易理解和最长代码原则（哈哈），现在改用&lt;code>textfsm&lt;/code>来实现这个需求&lt;/p>
&lt;h2 id="测试环境">测试环境
&lt;/h2>&lt;ul>
&lt;li>Microsoft Windows 10 Pro 21H2&lt;/li>
&lt;li>Visual studio code Update 1.77.3&lt;/li>
&lt;li>Python 3.10.10&lt;/li>
&lt;li>HCL 5.7.2&lt;/li>
&lt;li>DeviceModel：H3C SecPath F1090&lt;/li>
&lt;/ul>
&lt;h2 id="安装的库">安装的库
&lt;/h2>&lt;p>使用 pip 安装 openpyxl ，pandas ，wcwidth，ntc-templates-elinpf，其他库为第三方库安装时自动安装的依赖（除pip和setuptools外）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Package&lt;/span> &lt;span class="n">Version&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">--------------------&lt;/span> &lt;span class="o">-------&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">et&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">xmlfile&lt;/span> &lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">future&lt;/span> &lt;span class="mf">0.18&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ntc&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">templates&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">elinpf&lt;/span> &lt;span class="mf">3.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">numpy&lt;/span> &lt;span class="mf">1.24&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">openpyxl&lt;/span> &lt;span class="mf">3.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">pandas&lt;/span> &lt;span class="mf">1.5&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">pip&lt;/span> &lt;span class="mf">23.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">python&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dateutil&lt;/span> &lt;span class="mf">2.8&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">pytz&lt;/span> &lt;span class="mf">2023.3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">setuptools&lt;/span> &lt;span class="mf">65.5&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">six&lt;/span> &lt;span class="mf">1.16&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">textfsm&lt;/span> &lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tzdata&lt;/span> &lt;span class="mf">2023.3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">wcwidth&lt;/span> &lt;span class="mf">0.2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">6&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="textfsm模板">textfsm模板
&lt;/h2>&lt;p>编写三个&lt;code>textfsm&lt;/code>模板文件，分别处理以下命令的回显内容&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 查看安全策略
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dis security-policy ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 查看地址对象组
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dis object-group ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 查看服务对象组
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dis object-group service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="hp_comware_display_security-policy_ip_localtextfsm">hp_comware_display_security-policy_ip_local.textfsm
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Value Required RULE_ID (\d+)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value RULE_NAME (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value ACTIVE_STATE (Inactive|Active)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value ACTION (pass|drop)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value VRF (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value PROFILE (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value LOGGING (enable|disable)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value List COUNTING (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value TIME_RANGE (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value DESC (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value List SESSION (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value List SRC_ZONE (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value List DEST_ZONE (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value List SRC_IP (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value List DEST_IP (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value List SERVICE (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value List APPLICATION (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value List USER (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Start
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+rule \d+ name \S+ -&amp;gt; Continue
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+rule ${RULE_ID} name ${RULE_NAME} -&amp;gt; Continue
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+rule ${RULE_ID} name ${RULE_NAME} \(${ACTIVE_STATE}\)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+action ${ACTION}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+vrf ${VRF}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+profile ${PROFILE}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+logging ${LOGGING}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+counting ${COUNTING}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+time-range ${TIME_RANGE}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+description ${DESC}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+session ${SESSION}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+source-zone ${SRC_ZONE}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+destination-zone ${DEST_ZONE}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+source-ip ${SRC_IP}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+source-ip\S+ ${SRC_IP}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+destination-ip ${DEST_IP}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+destination-ip\S+ ${DEST_IP}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+service ${SERVICE}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+service-port ${SERVICE}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+application ${APPLICATION}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+user ${USER}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+source-mac ${SRC_IP}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^$$ -&amp;gt; Record
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="hp_comware_display_object-group_ip_localtextfsm">hp_comware_display_object-group_ip_local.textfsm
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Value Required OBJ_GROUP_NAME (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value List OBJ_ITEM (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value REFERENCED (in use|out of use)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value SEC_ZONE (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value DESC (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Start
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^Ip address object group -&amp;gt; Continue
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^Ip address object group ${OBJ_GROUP_NAME}: \d+ objects\(${REFERENCED}\)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^security-zone ${SEC_ZONE}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^&amp;lt; -&amp;gt; NoRecord
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^${DESC}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+object -&amp;gt; NoRecord
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+${OBJ_ITEM}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^$$ -&amp;gt; Record
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="hp_comware_display_object-group_service_localtextfsm">hp_comware_display_object-group_service_local.textfsm
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Value Required OBJ_GROUP_NAME (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value List OBJ_ITEM (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value REFERENCED (in use|out of use)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Value DESC (\S+(?:\s\S+)*)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Start
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^Service object group -&amp;gt; Continue
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^Service object group ${OBJ_GROUP_NAME}: \d+ objects\(${REFERENCED}\)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^&amp;lt; -&amp;gt; NoRecord
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^${DESC}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+object -&amp;gt; NoRecord
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^\s+${OBJ_ITEM}
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ^$$ -&amp;gt; Record
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="python脚本">python脚本
&lt;/h2>&lt;p>原理是使用textfsm模板对三个命令的回显内容进行处理然后写入表格&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">textfsm&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">TextFSM&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">pandas&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">pd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">openpyxl&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Workbook&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">openpyxl.styles&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">PatternFill&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">openpyxl&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">datetime&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">datetime&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">wcwidth&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">SP2EXCEL&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 初始化一些内容&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="fm">__init__&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">echo_content&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sp_textfsm_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;hp_comware_display_security-policy_ip_local.textfsm&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">obj_ip_textfsm_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;hp_comware_display_object-group_ip_local.textfsm&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">obj_service_textfsm_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;hp_comware_display_object-group_service_local.textfsm&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 回显内容读入内存&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">echo_content&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;r&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">contents&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">read&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 0、字典的value是列表的，将列表拼接为一个以换行符为分隔符的字符串&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">expand_list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">list_dict_res&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">d&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">list_dict_res&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">k&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">v&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">copy&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">items&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nb">isinstance&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nb">list&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 将列表拼接为一个以换行符为分隔符的字符串&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">obj_item_str&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">v&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 写回原字典&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">obj_item_str&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">list_dict_res&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 1、解析 dis security-policy ip 回显内容（安全策略）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">parse_sp&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sp_textfsm_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">template&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">TextFSM&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">template&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ParseTextToDicts&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">contents&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 对没有匹配到内容的设置默认值&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">d&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">res&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ACTIVE_STATE&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ACTIVE_STATE&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;Active&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;VRF&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;VRF&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;public&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;PROFILE&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;PROFILE&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;none&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;LOGGING&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;LOGGING&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;disable&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;COUNTING&amp;#39;&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;COUNTING&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;disable&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;TIME_RANGE&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;TIME_RANGE&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;none&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;DESC&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;DESC&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;none&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;SESSION&amp;#39;&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;SESSION&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;none&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;SRC_ZONE&amp;#39;&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;SRC_ZONE&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;any&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;DEST_ZONE&amp;#39;&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;DEST_ZONE&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;any&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;SRC_IP&amp;#39;&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;SRC_IP&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;any&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;DEST_IP&amp;#39;&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;DEST_IP&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;any&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;SERVICE&amp;#39;&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;SERVICE&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;any&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;APPLICATION&amp;#39;&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;APPLICATION&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;any&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;USER&amp;#39;&lt;/span>&lt;span class="p">]:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">d&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;USER&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;any&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 调用expand_list()处理字典value为列表的键值对&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">expand_list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">df&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">pd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DataFrame&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 安全策略表头&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">df_th&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="s1">&amp;#39;RULE_ID&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;ID&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;RULE_NAME&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;名称&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;ACTIVE_STATE&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;时间段状态&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;ACTION&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;动作&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;VRF&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;公网&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;PROFILE&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;内容安全&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;LOGGING&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;日志&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;COUNTING&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;统计&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;TIME_RANGE&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;时间段&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;DESC&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;描述&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;SESSION&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;会话&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;SRC_ZONE&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;源安全域&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;DEST_ZONE&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;目的安全域&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;SRC_IP&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;源地址&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;DEST_IP&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;目的地址&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;SERVICE&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;服务&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;APPLICATION&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;应用&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;USER&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;用户&amp;#39;&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sp_df&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">df&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rename&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">columns&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">df_th&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 下一步进行解析地址对象组回显内容&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parse_obj_ip&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 2、解析 dis object-group ip address 回显内容（地址对象组）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">parse_obj_ip&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">obj_ip_textfsm_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">template&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">TextFSM&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">template&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ParseTextToDicts&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">contents&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 调用expand_list()处理字典value为列表的键值对&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">expand_list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">df&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">pd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DataFrame&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 地址对象组表头&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">df_th&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="s1">&amp;#39;OBJ_GROUP_NAME&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;对象组名称&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;OBJ_ITEM&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;对象&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;REFERENCED&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;被引用&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;SEC_ZONE&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;安全域&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;DESC&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;描述&amp;#39;&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">obj_ip_df&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">df&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rename&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">columns&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">df_th&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 下一步进行解析服务对象组回显内容&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parse_obj_service&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 3、解析 dis object-group service 回显内容（服务对象组）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">parse_obj_service&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">obj_service_textfsm_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">template&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">TextFSM&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">template&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ParseTextToDicts&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">contents&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 调用expand_list()处理字典value为列表的键值对&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">expand_list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">df&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">pd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">DataFrame&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 服务对象组表头&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">df_th&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="s1">&amp;#39;OBJ_GROUP_NAME&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;对象组名称&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;OBJ_ITEM&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;对象&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;REFERENCED&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;被引用&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;DESC&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;描述&amp;#39;&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">obj_service_df&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">df&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rename&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">columns&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">df_th&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 4、表格写入&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">to_excel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 运行以上三个解析内容的函数，一个串一个&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">parse_sp&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 文件名时间部分，用于区别新旧&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">create_time&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">datetime&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;%Y%m&lt;/span>&lt;span class="si">%d&lt;/span>&lt;span class="s2">%H%M%S&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">output_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sa">f&lt;/span>&lt;span class="s1">&amp;#39;核心防火墙安全策略统计&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">create_time&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s1">.xlsx&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 创建ExcelWriter对象并指定文件名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="n">pd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ExcelWriter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">output_path&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">writer&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 将三个DataFrame写入不同的工作表中，并且不写入行索引&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sp_df&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to_excel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">writer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sheet_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;安全策略&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">index&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">obj_ip_df&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to_excel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">writer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sheet_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;地址对象组&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">index&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">obj_service_df&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to_excel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">writer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sheet_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;服务对象组&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">index&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 取出wb对象供define_excel_style()使用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">writer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">book&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sheet_names&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sheetnames&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">define_excel_style&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 5、调整表格样式&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">define_excel_style&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 三个sheet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sheet_names&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sheet_names&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sheet_names&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 以单元格中当行最长字符串长度调整列宽&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">sheet_name&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sheet_names&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">worksheet&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">sheet_name&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 遍历所有列，找出最宽的一列并调整列宽&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">col&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">worksheet&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">columns&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">max_width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">column&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">col&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column&lt;/span> &lt;span class="c1"># openpyxl 中的列索引从 1 开始&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 计算每个单元格中最宽行的显示宽度，并选取最宽的一行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">cell&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">col&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lines&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">max_line_width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">line&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">wcwidth&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wcswidth&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">line&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">width&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">max_line_width&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">max_line_width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">width&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">max_line_width&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">max_width&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">max_width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">max_line_width&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 将最宽行的显示宽度设置为该列的列宽&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">worksheet&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">openpyxl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">utils&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_column_letter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">column&lt;/span>&lt;span class="p">)]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">max_width&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 冻结首行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">freeze_panes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;A2&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">freeze_panes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;A2&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">freeze_panes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;A2&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 表头背景色&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">th_color_fill&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">PatternFill&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;solid&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">fgColor&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;D3D3D3&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">col&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">19&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fill&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">th_color_fill&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">col&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fill&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">th_color_fill&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">col&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fill&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">th_color_fill&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 垂直居中&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">sheet_name&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sheet_names&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">worksheet&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">sheet_name&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">r&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">worksheet&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">r&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">alignment&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">openpyxl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">styles&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Alignment&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">vertical&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;center&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">wrapText&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 保存&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">save&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">output_path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="vm">__name__&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 指定回显输出文件路径，同目录下直接 文件名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">echo_content_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;output.log&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 实例化对象&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">obj&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">SP2EXCEL&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">echo_content_path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 执行 4、表格写入&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">obj&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">to_excel&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;搞快点--&amp;gt;&amp;gt;搞快点--&amp;gt;&amp;gt;&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="生成的表格文件">生成的表格文件
&lt;/h2>&lt;h3 id="安全策略sheet">安全策略sheet
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/10/UrviOXJ4lNbCqoe.jpg">
&lt;img src="https://s2.loli.net/2023/05/10/UrviOXJ4lNbCqoe.jpg"
loading="lazy"
alt="ScreenCaputure230510175500"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="地址对象组sheet">地址对象组sheet
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/10/91m4Y7PkLqZeSUc.jpg">
&lt;img src="https://s2.loli.net/2023/05/10/91m4Y7PkLqZeSUc.jpg"
loading="lazy"
alt="ScreenCaputure230510175522"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="服务对象组sheet">服务对象组sheet
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/10/RUgkEiZq9rsCdhv.jpg">
&lt;img src="https://s2.loli.net/2023/05/10/RUgkEiZq9rsCdhv.jpg"
loading="lazy"
alt="ScreenCaputure230510180429"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/10/Sw1Rq3xob2WP7lc.png">
&lt;img src="https://s2.loli.net/2023/05/10/Sw1Rq3xob2WP7lc.png"
loading="lazy"
alt="image-20230510181500219"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="最后">最后
&lt;/h2>&lt;ul>
&lt;li>以上使用到的文件见github仓库： &lt;a class="link" href="https://github.com/kiraster/GenerateSp2Excelv2" target="_blank" rel="noopener"
>https://github.com/kiraster/GenerateSp2Excelv2
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨&lt;/li>
&lt;/ul></description></item><item><title>GPT问答230429</title><link>https://weeaster.github.io/posts/61f9c8a2/</link><pubDate>Sat, 29 Apr 2023 15:43:06 +0000</pubDate><guid>https://weeaster.github.io/posts/61f9c8a2/</guid><description>&lt;p>&lt;strong>如何理解对事物存在敬畏之心？&lt;/strong>&lt;/p>
&lt;p>对事物存在敬畏之心通常是指一种对某些事物的高度敬重和敬仰，这种敬畏并不是害怕或畏惧，而是建立在了个人对该事物所具有的价值、力量或影响力上的认知之上。这种敬畏可以体现在对自然现象、伟大人物、传统文化或道德信仰等方面，也可以表现为对于神秘力量或未知领域的虔诚崇拜。&lt;/p>
&lt;p>具有敬畏之心的人会从内心深处感受到对某些事物或价值观的肃穆和庄重，并将其视为自己生命中至关重要的东西，而不是简单地被其外表所吸引或追求其表面的好处。这种态度可以使人更加谦虚、勤奋、坚定和不屈不挠，更加容易遵循自己的信念和原则，并且能在困难时坚持下去。&lt;/p>
&lt;p>&lt;strong>如何理解事物的相对性？&lt;/strong>&lt;/p>
&lt;p>事物的相对性指的是事物在不同的情境和条件下可能呈现出不同的特征和表现。这是因为任何一个事物都必须在其周围的环境和与之相关的其他事物中存在和发展，而这些环境和事物可以通过不同角度和侧面来观察和理解，从而产生不同的认知和评价。&lt;/p>
&lt;p>比如说，在地球上，白昼与黑夜具有相对性，即当我们处于白天时，相对于太阳我们处于地球的阳面；而当我们处于晚上时，相对于太阳我们则处于地球的阴面。又比如，在人际关系中，好与坏、美与丑等概念也是相对的，因为它们的认定并不是绝对的，而是由我们的主观感受和价值观念所决定的。&lt;/p>
&lt;p>因此，理解事物的相对性需要从多个角度和侧面进行观察和分析，同时也需要考虑到各种社会文化和历史背景对事物认知和评价的影响。只有通过深入了解事物的多重属性和多元特征，才能更准确地把握其真正的本质和内涵。&lt;/p>
&lt;p>&lt;strong>地球上，是先有鸡还是先有蛋？&lt;/strong>&lt;/p>
&lt;p>这个问题有不同的回答，具体取决于你如何定义“鸡”和“蛋”。如果我们按照生物学的角度来看待这个问题，那么答案应该是先有蛋，而不是先有鸡。&lt;/p>
&lt;p>第一只属于“鸡”的鸟应该是由于演化过程中出现了基因突变，使其与其亲代有所不同。这种变异产生了特定的DNA序列，让这只鸟成为了一个独立的物种——就是我们今天所称呼的“鸡”。&lt;/p>
&lt;p>然而，这只“鸡”的DNA序列必须来自于两只亲代鸟，它们很可能并不是“鸡”，而是某种早期的禽鸟。在这种情况下，第一只“鸡”的想法最初是由一对“非鸡”亲代鸟产生的，并且它孵化于一个“非鸡”蛋里。由此可知，在这个意义上，“蛋”比“鸡”更早存在。&lt;/p>
&lt;p>因此，从生物学角度而言，先有蛋，后有鸡。&lt;/p></description></item><item><title>Github之pull requests提交分支</title><link>https://weeaster.github.io/posts/9a95f1cd/</link><pubDate>Sat, 29 Apr 2023 00:11:07 +0000</pubDate><guid>https://weeaster.github.io/posts/9a95f1cd/</guid><description>&lt;p>这篇文描述的是使用我注册的第二个Github账号对&lt;code>netops_v2.0_beta&lt;/code>仓库进行一次&lt;code>pull requests&lt;/code>&lt;/p>
&lt;p>计划是修改代码使其在Ubuntu环境也能正常运行，然后推送分支进行pull requests&lt;/p>
&lt;h2 id="登陆github">登陆Github
&lt;/h2>&lt;p>先fork原仓库至第二个账号（过程略），获取 Clone 链接 &lt;a class="link" href="https://github.com/weeaster/netops_v2.0_beta.git" target="_blank" rel="noopener"
>https://github.com/weeaster/netops_v2.0_beta.git
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>，克隆至本地&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kir@kir:~/my_repo/netops_v2.0_branch$ git clone https://github.com/weeaster/netops_v2.0_beta.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Cloning into &lt;span class="s1">&amp;#39;netops_v2.0_beta&amp;#39;&lt;/span>...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">remote: Enumerating objects: 67, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">remote: Counting objects: 100% &lt;span class="o">(&lt;/span>67/67&lt;span class="o">)&lt;/span>, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">remote: Compressing objects: 100% &lt;span class="o">(&lt;/span>49/49&lt;span class="o">)&lt;/span>, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">remote: Total &lt;span class="m">67&lt;/span> &lt;span class="o">(&lt;/span>delta 32&lt;span class="o">)&lt;/span>, reused &lt;span class="m">51&lt;/span> &lt;span class="o">(&lt;/span>delta 18&lt;span class="o">)&lt;/span>, pack-reused &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Receiving objects: 100% &lt;span class="o">(&lt;/span>67/67&lt;span class="o">)&lt;/span>, 42.97 KiB &lt;span class="p">|&lt;/span> 31.00 KiB/s, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Resolving deltas: 100% &lt;span class="o">(&lt;/span>32/32&lt;span class="o">)&lt;/span>, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/my_repo/netops_v2.0_branch$
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="修改代码">修改代码
&lt;/h2>&lt;ul>
&lt;li>不是重点&lt;/li>
&lt;li>主要内容是修改 msoffcrypto 替换 pywin32 库（原仓库已修改），修改系统的路径（左右斜杠符号）&lt;/li>
&lt;/ul>
&lt;h2 id="ubuntu本地git">Ubuntu本地Git
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>本地&lt;code>git config&lt;/code>配置（免密操作git push）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ git config --global user.name yourusername
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ git config --global user.email yourmail@nb.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ git config --list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user.name&lt;span class="o">=&lt;/span>username
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user.email&lt;span class="o">=&lt;/span>yourmail@nb.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">core.repositoryformatversion&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">core.filemode&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">core.bare&lt;span class="o">=&lt;/span>&lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">core.logallrefupdates&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">remote.origin.url&lt;span class="o">=&lt;/span>https://github.com/weeaster/netops_v2.0_beta.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">remote.origin.fetch&lt;span class="o">=&lt;/span>+refs/heads/*:refs/remotes/origin/*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">branch.main.remote&lt;span class="o">=&lt;/span>origin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">branch.main.merge&lt;span class="o">=&lt;/span>refs/heads/main
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>cd命令进入本地代码目录，执行&lt;code>git init&lt;/code>，提示重新初始化现有Git存储库（那么智能）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ git init
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Reinitialized existing Git repository in /home/kir/my_repo/netops_v2.0_branch/netops_v2.0_beta/.git/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>本地创建ssh-key（生成公钥和私钥）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kir@kir:~/$ ssh-keygen -t ed25519 -C &lt;span class="s2">&amp;#34;yourmail@nb.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Generating public/private ed25519 key pair.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enter file in which to save the key &lt;span class="o">(&lt;/span>/home/kir/.ssh/id_ed25519&lt;span class="o">)&lt;/span>:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enter passphrase &lt;span class="o">(&lt;/span>empty &lt;span class="k">for&lt;/span> no passphrase&lt;span class="o">)&lt;/span>:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enter same passphrase again:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Your identification has been saved in /home/kir/.ssh/id_ed25519
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Your public key has been saved in /home/kir/.ssh/id_ed25519.pub
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The key fingerprint is:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SHA256:xxxxxx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The key&lt;span class="err">&amp;#39;&lt;/span>s randomart image is:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+--&lt;span class="o">[&lt;/span>ED25519 256&lt;span class="o">]&lt;/span>--+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+----&lt;span class="o">[&lt;/span>SHA256&lt;span class="o">]&lt;/span>-----+
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>Github网站添加SSH keys（基操）&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/29/mI3gRykYl9XWvZK.jpg">
&lt;img src="https://s2.loli.net/2023/04/29/mI3gRykYl9XWvZK.jpg"
loading="lazy"
alt="ScreenCaputure230429024711"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>测试&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kir@kir:~/my_repo/netops_v2.0_branch/netops_v2.0_beta$ ssh -T git@github.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The authenticity of host &lt;span class="s1">&amp;#39;github.com (20.205.243.166)&amp;#39;&lt;/span> can&lt;span class="s1">&amp;#39;t be established.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">ED25519 key fingerprint is SHA256:xxxxxx
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">This key is not known by any other names
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Warning: Permanently added &amp;#39;&lt;/span>github.com&lt;span class="s1">&amp;#39; (ED25519) to the list of known hosts.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Hi weeaster! You&amp;#39;&lt;/span>ve successfully authenticated, but GitHub does not provide shell access.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>设置远程仓库地址（https//xxxx不好使，换成git@xxxx）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ git remote rm origin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ git remote add origin git@github.com:weeaster/netops_v2.0_beta.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ git remote -v
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">origin git@github.com:weeaster/netops_v2.0_beta.git &lt;span class="o">(&lt;/span>fetch&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">origin git@github.com:weeaster/netops_v2.0_beta.git &lt;span class="o">(&lt;/span>push&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>三板斧&lt;code>git add&lt;/code>,&lt;code>git commit&lt;/code>,&lt;code>git push&lt;/code>，推送到ubuntu-branch分支&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ git checkout -b ubuntu-branch
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ git add .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ git commit -m &lt;span class="s2">&amp;#34;ubuntu-branch push&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ git push origin ubuntu-branch
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>第7步中可能出现的插曲，原因是在github设置了&lt;code>Keep my email addresses private&lt;/code>，处理步骤如下&lt;/p>
&lt;ul>
&lt;li>
&lt;p>回显错误提示&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ git push origin ubuntu-branch
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enumerating objects: 25, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Counting objects: 100% &lt;span class="o">(&lt;/span>25/25&lt;span class="o">)&lt;/span>, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Delta compression using up to &lt;span class="m">4&lt;/span> threads
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Compressing objects: 100% &lt;span class="o">(&lt;/span>13/13&lt;span class="o">)&lt;/span>, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Writing objects: 100% &lt;span class="o">(&lt;/span>13/13&lt;span class="o">)&lt;/span>, 1.60 KiB &lt;span class="p">|&lt;/span> 327.00 KiB/s, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total &lt;span class="m">13&lt;/span> &lt;span class="o">(&lt;/span>delta 8&lt;span class="o">)&lt;/span>, reused &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>delta 0&lt;span class="o">)&lt;/span>, pack-reused &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">remote: Resolving deltas: 100% &lt;span class="o">(&lt;/span>8/8&lt;span class="o">)&lt;/span>, completed with &lt;span class="m">8&lt;/span> &lt;span class="nb">local&lt;/span> objects.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">remote: error: GH007: Your push would publish a private email address.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">remote: You can make your email public or disable this protection by visiting:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">remote: http://github.com/settings/emails
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">To github.com:weeaster/netops_v2.0_beta.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ! &lt;span class="o">[&lt;/span>remote rejected&lt;span class="o">]&lt;/span> ubuntu-branch -&amp;gt; ubuntu-branch &lt;span class="o">(&lt;/span>push declined due to email privacy restrictions&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">error: failed to push some refs to &lt;span class="s1">&amp;#39;github.com:weeaster/netops_v2.0_beta.git&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>在github网站：http://github.com/settings/emails 的&lt;code>keep my Email private&lt;/code> 选项下的找到匿名 Email； 格式是：id+username@users.noreply.github.com&lt;/p>
&lt;/li>
&lt;li>
&lt;p>重新设置git用户&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="nv">$git&lt;/span> config --global user.email &lt;span class="s2">&amp;#34;id+username@users.noreply.github.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>重置上次commit提交的作者信息&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ git commit --amend --reset-author
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>再次push&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">$ git push origin ubuntu-branch
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h2 id="comparepull-request">Compare&amp;amp;pull request
&lt;/h2>&lt;h3 id="切换到-ubuntu-branch-分支点击-compare--pull-request-按钮">切换到 ubuntu-branch 分支，点击 &lt;code>Compare &amp;amp; pull request&lt;/code> 按钮
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/29/7oHqder2x5ID9WF.jpg">
&lt;img src="https://s2.loli.net/2023/04/29/7oHqder2x5ID9WF.jpg"
loading="lazy"
alt="ScreenCaputure230429033544"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="填写信息">填写信息
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/29/jIKMVYg3yeRHzSo.jpg">
&lt;img src="https://s2.loli.net/2023/04/29/jIKMVYg3yeRHzSo.jpg"
loading="lazy"
alt="ScreenCaputure230429034912"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="原仓库账号处理pull-requests">原仓库账号处理pull requests
&lt;/h2>&lt;h3 id="查看pull-requests">查看pull requests
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/29/ns8Ma1GLtWJu52B.jpg">
&lt;img src="https://s2.loli.net/2023/04/29/ns8Ma1GLtWJu52B.jpg"
loading="lazy"
alt="ScreenCaputure230429040401"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="拒绝该次pull-requests">拒绝该次pull requests
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/29/g8ZMQuYT7xKHjDr.jpg">
&lt;img src="https://s2.loli.net/2023/04/29/g8ZMQuYT7xKHjDr.jpg"
loading="lazy"
alt="ScreenCaputure230429041738"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="原仓库账号创建分支">原仓库账号创建分支
&lt;/h3>&lt;p>提交pull request 的账号重新本地push到一个新分支；重复Compare&amp;amp;pull request步骤，提交pull request时注意选择原仓库创建的分支&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/29/BlHfkvEYKJRFnpj.jpg">
&lt;img src="https://s2.loli.net/2023/04/29/BlHfkvEYKJRFnpj.jpg"
loading="lazy"
alt="ScreenCaputure230429044039"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="同意合并">同意合并
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/29/VSzw8lbihor1UHn.jpg">
&lt;img src="https://s2.loli.net/2023/04/29/VSzw8lbihor1UHn.jpg"
loading="lazy"
alt="ScreenCaputure230429045452"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/29/V4oOeJREAZnhgyN.jpg">
&lt;img src="https://s2.loli.net/2023/04/29/V4oOeJREAZnhgyN.jpg"
loading="lazy"
alt="ScreenCaputure230429045738"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="检查">检查
&lt;/h2>&lt;p>打开&lt;code>Comparing&lt;/code>查看&lt;code>lib/comm.py&lt;/code>部分代码，可以看到路径的斜杠符号是左斜杠&lt;code>/&lt;/code>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/29/ke9thlyvnjLNmPF.jpg">
&lt;img src="https://s2.loli.net/2023/04/29/ke9thlyvnjLNmPF.jpg"
loading="lazy"
alt="ScreenCaputure230429050806"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="最后">最后
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/29/1TEwZhltcpQ3ieD.png">
&lt;img src="https://s2.loli.net/2023/04/29/1TEwZhltcpQ3ieD.png"
loading="lazy"
alt="pull request 1"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>知乎有个图画挺好，我画一下&lt;/li>
&lt;li>总体来说还行&lt;/li>
&lt;li>我不是搞软件的，这么一搞也就图一乐&lt;/li>
&lt;li>拜了个拜&lt;/li>
&lt;li>这篇文，不那么欢迎“&lt;del>来电&lt;/del>”来函探讨&lt;/li>
&lt;/ul></description></item><item><title>Ubuntu publickey方式SSH连接与vscode远程调试</title><link>https://weeaster.github.io/posts/837aa3ce/</link><pubDate>Thu, 27 Apr 2023 14:52:12 +0000</pubDate><guid>https://weeaster.github.io/posts/837aa3ce/</guid><description>&lt;p>Ubuntu服务端采用publickey方式验证客户端身份，客户端本地vscode连接至Ubuntu服务端进行python远程调试&lt;/p>
&lt;p>&lt;strong>环境描述：&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>vscode 1.77.3&lt;/li>
&lt;li>VMware Station 15.0&lt;/li>
&lt;li>Ubuntu 22.04.1&lt;/li>
&lt;li>Python 3.10.6&lt;/li>
&lt;/ul>
&lt;h2 id="本地用户密钥生成">本地用户密钥生成
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>生成安全的密钥&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">C:\Users\xxx&amp;gt; ssh-keygen -t ed25519
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>根据需要是否修改保存的路径和文件名（可能会与之前生成的密钥同名）&lt;/p>
&lt;/li>
&lt;li>
&lt;p>根据需要是否设置passphrase口令（如设置每次验证需要输入该密码）&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="上传pub文件至服务端">上传pub文件至服务端
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>将&lt;code>.pub&lt;/code>公钥文件上传至ubuntu 22.04 &lt;code>~/.ssh&lt;/code>(&lt;code>/home/kir/.ssh&lt;/code>)目录下&lt;/p>
&lt;/li>
&lt;li>
&lt;p>追加&lt;code>.pub&lt;/code>公钥文件至authorized_keys&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo cat id_ed25519.pub &amp;gt;&amp;gt; authorized_keys
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>重启ssh服务&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">systemctl restart sshd
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>本地连接测试&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">ssh kir@172.31.100.213
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The authenticity of host &lt;span class="s1">&amp;#39;172.31.100.213 (172.31.100.213)&amp;#39;&lt;/span> can&lt;span class="s1">&amp;#39;t be established.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">ECDSA key fingerprint is SHA256:xxxxxxx
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Warning: Permanently added &amp;#39;&lt;/span>172.31.100.213&lt;span class="err">&amp;#39;&lt;/span> &lt;span class="o">(&lt;/span>ECDSA&lt;span class="o">)&lt;/span> to the list of known hosts.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Welcome to Ubuntu 22.04.2 LTS &lt;span class="o">(&lt;/span>GNU/Linux 5.15.0-71-generic x86_64&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Last login: Thu Apr &lt;span class="m">27&lt;/span> 14:09:13 &lt;span class="m">2023&lt;/span> from 172.31.100.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~$
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="vscode设置">vscode设置
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>插件——搜索——安装 &lt;code>Remote - SSH 插件&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>点击左侧图标，点击REMOTE&amp;ndash;设置，弹出的菜单中选择电脑的config文件路径&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/27/N17QU5OaGHg9Pf2.jpg">
&lt;img src="https://s2.loli.net/2023/04/27/N17QU5OaGHg9Pf2.jpg"
loading="lazy"
alt="ScreenCaputure230427155731"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>由于我本机还设置了github和gitlab的公钥，只需在&lt;code>config&lt;/code>文件增加对应配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># GitLab Account
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Host xxx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Hostname xxx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PreferredAuthentications publickey
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IdentityFile C:\Users\xxx\.ssh\id_xxx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># GitHub Account
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Host github.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Hostname github.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PreferredAuthentications publickey
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IdentityFile C:\Users\xxx\.ssh\id_xxx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># python_ubuntu_server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Host 172.31.100.213
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Hostname 172.31.100.213
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PreferredAuthentications publickey
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IdentityFile C:\Users\xxx\.ssh\id_ubuntu
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>选择ubuntu服务器连接（连接前保存工作区或选择在新窗口打开）&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/27/93S1pcPJb2lrYqm.jpg">
&lt;img src="https://s2.loli.net/2023/04/27/93S1pcPJb2lrYqm.jpg"
loading="lazy"
alt="ScreenCaputure230427160840"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>登陆后，在控制台手动创建目录，再左侧添加目录&lt;/p>
&lt;ul>
&lt;li>
&lt;p>创建目录&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">kir@kir:~$ sudo mkdir -p ~/my_repo/test_dir
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>设置权限（为了方便，就设777）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">kir@kir:~$ sudo chmod 777 ~/my_repo/test_dir
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/27/CzfNSJBLAeU7c5w.jpg">
&lt;img src="https://s2.loli.net/2023/04/27/CzfNSJBLAeU7c5w.jpg"
loading="lazy"
alt="ScreenCaputure230427162332"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Python插件安装&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/27/JE7AGLq82rXwNyu.jpg">
&lt;img src="https://s2.loli.net/2023/04/27/JE7AGLq82rXwNyu.jpg"
loading="lazy"
alt="ScreenCaputure230427163329"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="服务端设置">服务端设置
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>安装pip&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo apt install python3-pip
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>安装第三方库&amp;ndash;测试&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">kir@kir:~/my_repo/test_dir$ sudo pip install ping3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Collecting ping3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Downloading ping3-4.0.4-py3-none-any.whl &lt;span class="o">(&lt;/span>&lt;span class="m">13&lt;/span> kB&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Installing collected packages: ping3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Successfully installed ping3-4.0.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">WARNING: Running pip as the &lt;span class="s1">&amp;#39;root&amp;#39;&lt;/span> user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/my_repo/test_dir$ pip show ping3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Name: ping3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Version: 4.0.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Summary: A pure python3 version of ICMP ping implementation using raw socket.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Home-page:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Author:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Author-email: Kyan &amp;lt;kai@kyan001.com&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">License: The MIT License &lt;span class="o">(&lt;/span>MIT&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>虚拟环境&amp;ndash;测试&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 安装python3.10-venv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/my_repo/test_dir$ sudo apt install python3.10-venv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 创建虚拟环境
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/my_repo/test_dir$ source venv/bin/activate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 退出虚拟环境
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(venv) kir@kir:~/my_repo/test_dir$ deactivate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/my_repo/test_dir$
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="最后">最后
&lt;/h2>&lt;ul>
&lt;li>总体来说能用，就是非root用户跑python有可能会遇到权限问题（可能需要sudo）&lt;/li>
&lt;li>为什么要搞远程python，因为发现在windows平台跑python时不时会遇到一些第三方库安装运行时出的一些不知道时什么不知道的问题&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨&lt;/li>
&lt;/ul></description></item><item><title>电脑开关机邮件提醒</title><link>https://weeaster.github.io/posts/1e32fc6d/</link><pubDate>Sat, 22 Apr 2023 16:20:52 +0000</pubDate><guid>https://weeaster.github.io/posts/1e32fc6d/</guid><description>&lt;p>最近测试了&lt;code>python&lt;/code>脚本执行钉钉机器人发消息和邮件发送，本想集成到上一篇文章中的脚本里，奈何想不到比较实用的场景。&lt;/p>
&lt;p>突然想到自己的台式电脑是来电自动开机的设置，略有所思后想到把开关机事件自动发送邮件。&lt;/p>
&lt;p>本人平生不知道注册多少个邮箱，想到163邮箱用的很少，所有就用它。登陆后发现里头有很多未读邮件，有安全提示和各种广告，都是几年前的了，估计是邮箱被盗用，全球各地的IP地址登陆和某位苹果玩家拿我邮箱修改了Apple ID……&lt;/p>
&lt;p>一顿操作后把授权码弄出来了（1毛短信费），这个钉钉机器人就不记录操作步骤了，搜索引擎遍地都是，下面记录电脑开关机事件自动发送邮件过程。&lt;/p>
&lt;h2 id="获取邮箱授权码">获取邮箱授权码
&lt;/h2>&lt;p>这个步骤各大在线邮箱都差不多，基本都能在设置中找到&lt;/p>
&lt;h2 id="安装yagmail库">安装yagmail库
&lt;/h2>&lt;p>这是个第三方库，看到搜索引擎上满满的手写一大段代码填写邮件参数，这玩意儿还能这么不智能，不就是跟foxmail客户端一样填那几样参数么，所以使用yagmail，简单&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="n">pip&lt;/span> &lt;span class="n">install&lt;/span> &lt;span class="n">yagmail&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="代码">代码
&lt;/h2>&lt;p>由于是两个不同的事件邮件，我分两个python脚本&lt;/p>
&lt;p>&lt;code>auto_email_strtup.py&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">yagmail&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">datetime&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">datetime&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 连接服务器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">yag&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">yagmail&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SMTP&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">user&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;一三九啤酒白酒葡萄酒@163.com&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">password&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;此处填写授权码&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;smtp.163.com&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 编辑邮件内容&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">time_str&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">datetime&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;%Y-%m-&lt;/span>&lt;span class="si">%d&lt;/span>&lt;span class="s2"> %H:%M:%S&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">content&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s1">&amp;#39;时间：&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">time_str&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;事件：台式电脑开机&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 发送邮件，to = 收件人邮箱 &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">yag&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">to&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;一三八吃吧吃吧吃吧吃吧@139.com&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">subject&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;电脑开关机事件&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">contents&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">content&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>auto_email_shutdown.py&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">yagmail&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">datetime&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">datetime&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 连接服务器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">yag&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">yagmail&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">SMTP&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">user&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;一三九啤酒白酒葡萄酒@163.com&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">password&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;此处填写授权码&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">host&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;smtp.163.com&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 编辑邮件内容&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">time_str&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">datetime&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;%Y-%m-&lt;/span>&lt;span class="si">%d&lt;/span>&lt;span class="s2"> %H:%M:%S&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">content&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s1">&amp;#39;时间：&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">time_str&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;事件：台式电脑关机&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 发送邮件，to = 收件人邮箱 &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">yag&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">to&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;一三八吃吧吃吧吃吧吃吧@139.com&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">subject&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;电脑开关机事件&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">contents&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">content&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>由于是windows电脑，还需要编写两个bat脚本中转运行以上代码&lt;/p>
&lt;p>&lt;code>auto_email_strtup.bat&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">python F:\xxxx\auto_email_startup.py
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>auto_email_shutdown.bat&lt;/code> (需手动指定python解释器路径)&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">C:\Python3.x.x\python.exe F:\xxxx\auto_email_shutdown.py
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="window设置计划任务和组策略">window设置计划任务和组策略
&lt;/h2>&lt;h3 id="开机自动邮件的设置">开机自动邮件的设置
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/22/cKrUfsE3tnFHlX6.jpg">
&lt;img src="https://s2.loli.net/2023/04/22/cKrUfsE3tnFHlX6.jpg"
loading="lazy"
alt="ScreenCaputure230422165806"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/22/QL1UZdf35OVlnau.jpg">
&lt;img src="https://s2.loli.net/2023/04/22/QL1UZdf35OVlnau.jpg"
loading="lazy"
alt="ScreenCaputure230422170340"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/22/QA6RHzGLOIkWhN2.jpg">
&lt;img src="https://s2.loli.net/2023/04/22/QA6RHzGLOIkWhN2.jpg"
loading="lazy"
alt="ScreenCaputure230422170354"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/22/fvrBQaOCYd4gyts.jpg">
&lt;img src="https://s2.loli.net/2023/04/22/fvrBQaOCYd4gyts.jpg"
loading="lazy"
alt="ScreenCaputure230422170403"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/22/ItfYEZo8DCFV24s.jpg">
&lt;img src="https://s2.loli.net/2023/04/22/ItfYEZo8DCFV24s.jpg"
loading="lazy"
alt="ScreenCaputure230422170421"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/22/2Nngy97KV5tZAUC.jpg">
&lt;img src="https://s2.loli.net/2023/04/22/2Nngy97KV5tZAUC.jpg"
loading="lazy"
alt="ScreenCaputure230422170440"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/22/Mi3YkeW7zJrOpT5.jpg">
&lt;img src="https://s2.loli.net/2023/04/22/Mi3YkeW7zJrOpT5.jpg"
loading="lazy"
alt="ScreenCaputure230422170550"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="关机自动邮件的设置">关机自动邮件的设置
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/22/jinzWR1w4v9YmO2.jpg">
&lt;img src="https://s2.loli.net/2023/04/22/jinzWR1w4v9YmO2.jpg"
loading="lazy"
alt="ScreenCaputure230422213012"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/22/RTsoFMV8bYGHtwj.jpg">
&lt;img src="https://s2.loli.net/2023/04/22/RTsoFMV8bYGHtwj.jpg"
loading="lazy"
alt="ScreenCaputure230422213535"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/22/e8iNBJhZLoO9rxT.jpg">
&lt;img src="https://s2.loli.net/2023/04/22/e8iNBJhZLoO9rxT.jpg"
loading="lazy"
alt="ScreenCaputure230422213610"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="dingtalkchatbot插件">dingtalkchatbot插件
&lt;/h2>&lt;p>夹带钉钉机器人发消息的代码，使用到以上这个库，具体见&lt;a class="link" href="https://github.com/zhuifengshen/DingtalkChatbot" target="_blank" rel="noopener"
>dingtalkchatbot插件
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/p>
&lt;p>首先登陆钉钉，创建一个群，添加机器人，记录生成的webhook等参数&lt;/p>
&lt;p>可以把以下代码组装成一个可传参的函数，调用的时候传递参数msg&lt;/p>
&lt;p>可以设置各种条件发送不同的msg&lt;/p>
&lt;p>电脑和手机已卸载钉钉，就没截图了&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">dingtalkchatbot.chatbot&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">DingtalkChatbot&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">ActionCard&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">CardItem&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># WebHook地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">webhook&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;WebHook地址&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">secret&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;secret&amp;#39;&lt;/span> &lt;span class="c1"># 可选：创建机器人勾选“加签”选项时使用&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 初始化机器人小丁&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># xiaoding = DingtalkChatbot(webhook) # 方式一：通常初始化方式&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">xiaoding&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">DingtalkChatbot&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">webhook&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">secret&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">secret&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># 方式二：勾选“加签”选项时使用（v1.5以上新功能）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># xiaoding = DingtalkChatbot(webhook, pc_slide=True) # 方式三：设置消息链接在PC端侧边栏打开（v1.5以上新功能）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Text消息是否@所有人&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">xiaoding&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send_text&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">msg&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;DSB,我就是小丁，小丁就是我！&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">is_at_all&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 返回结果显示&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="最后">最后
&lt;/h2>&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: center">
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/22/3SOAGXLNpdzVnBj.jpg">
&lt;img src="https://s2.loli.net/2023/04/22/3SOAGXLNpdzVnBj.jpg"
loading="lazy"
alt="20230422173407"
>
&lt;/a>
&lt;/div>
&lt;/th>
&lt;th>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/04/22/7JpBndN5HbhMcSs.jpg">
&lt;img src="https://s2.loli.net/2023/04/22/7JpBndN5HbhMcSs.jpg"
loading="lazy"
alt="20230422173130"
>
&lt;/a>
&lt;/div>
&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;/tbody>
&lt;/table>
&lt;ul>
&lt;li>
&lt;p>如果网络环境允许的话，可以编写python脚本探测设备的可达性、根据设备的告警阀值触发邮件发送和机器人信息发送，或其他条件触发&lt;/p>
&lt;/li>
&lt;li>
&lt;p>欢迎“&lt;del>来电&lt;/del>”来函探讨&lt;/p>
&lt;/li>
&lt;/ul></description></item><item><title>一个使用nornir框架编写的跑脚本工具</title><link>https://weeaster.github.io/posts/9571d5ee/</link><pubDate>Sun, 16 Apr 2023 23:33:58 +0000</pubDate><guid>https://weeaster.github.io/posts/9571d5ee/</guid><description>&lt;p>一个使用&lt;code>nornir&lt;/code>框架编写的跑脚本工具。之前写过一版这个菜单式跑python脚本的工具，简直臃肿的不堪入目，后面发现需要添加改进功能真让我头大。了解&lt;code>nornir&lt;/code>后，一直就想把功能移植过来，现在搞的差不多了，分享一下&lt;/p>
&lt;blockquote>
&lt;p>在32位windows系统中无法使用本脚本，原因是有几个第三方库从某个版本开始不再开发和维护32位系统的代码，而库的依赖最低版本大于最后发布的32位版本，或者装不上，亦或装上了无法用。So……&lt;/p>
&lt;/blockquote>
&lt;h2 id="介绍">介绍
&lt;/h2>&lt;ul>
&lt;li>在nornir 3.3.0框架上进行功能编写&lt;/li>
&lt;li>使用&lt;code>nornir&lt;/code>自带的并发机制，专注于功能的实现&lt;/li>
&lt;li>&lt;code>nornir&lt;/code>具有与其他开源模块的联动功能，如&lt;code>netbox&lt;/code>、&lt;code>sql&lt;/code>、&lt;code>scrapli&lt;/code>、&lt;code>napalm&lt;/code>等，具有强扩展性&lt;/li>
&lt;li>&lt;code>main&lt;/code>分支是在windows平台下运行的脚本&lt;/li>
&lt;li>&lt;code>ubuntu-branch&lt;/code>分支是在ubuntu server下运行的脚本（其他linux发行版，应该也可以）&lt;/li>
&lt;/ul>
&lt;h2 id="测试环境">测试环境
&lt;/h2>&lt;h3 id="windows">windows
&lt;/h3>&lt;ul>
&lt;li>Microsoft Windows 10 Pro 21H2&lt;/li>
&lt;li>Visual studio code Update 1.77.3&lt;/li>
&lt;li>Python 3.10.10&lt;/li>
&lt;li>nornir==3.3.0&lt;/li>
&lt;/ul>
&lt;h3 id="ubuntu">Ubuntu
&lt;/h3>&lt;ul>
&lt;li>Ubuntu 22.04.2 LTS&lt;/li>
&lt;li>Python 3.10.6&lt;/li>
&lt;li>nornir==3.3.0&lt;/li>
&lt;/ul>
&lt;h3 id="simulation-software">Simulation Software
&lt;/h3>&lt;ul>
&lt;li>HCL 5.7.2&lt;/li>
&lt;li>DeviceModel：H3C S5820V2-54QS-GE&lt;/li>
&lt;/ul>
&lt;h3 id="topology">Topology
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/05/L7nI9fTp3zEk6Rq.png">
&lt;img src="https://s2.loli.net/2023/05/05/L7nI9fTp3zEk6Rq.png"
loading="lazy"
alt="lab_test"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="运行界面">运行界面
&lt;/h2>&lt;h3 id="脚本启动界面">脚本启动界面
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/12/lFHy2EX741Ukucv.gif">
&lt;img src="https://s2.loli.net/2023/05/12/lFHy2EX741Ukucv.gif"
loading="lazy"
alt="01-startup"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="批量备份配置">批量备份配置
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/13/yWnmzFcgOACQLub.gif">
&lt;img src="https://s2.loli.net/2023/05/13/yWnmzFcgOACQLub.gif"
loading="lazy"
alt="02-export-conf.gif"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="批量修改配置">批量修改配置
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/12/7G4OLUnh1mPZyFt.gif">
&lt;img src="https://s2.loli.net/2023/05/12/7G4OLUnh1mPZyFt.gif"
loading="lazy"
alt="03-modify-conf"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="筛选--执行">筛选&amp;ndash;&amp;gt;执行
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/13/2ZHrXjtWL9MP8Cy.gif">
&lt;img src="https://s2.loli.net/2023/05/13/2ZHrXjtWL9MP8Cy.gif"
loading="lazy"
alt="04-filter-run"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="获取交换机-端口-mac地址-和-搜索mac地址对应设备">获取交换机 端口-MAC地址 和 搜索MAC地址对应设备
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/13/uS3BwMOZiPzFhnf.gif">
&lt;img src="https://s2.loli.net/2023/05/13/uS3BwMOZiPzFhnf.gif"
loading="lazy"
alt="05-get-mac-search.gif"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="批量snmp轮询">批量snmp轮询
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/12/HXq4kr5RgdENSmC.gif">
&lt;img src="https://s2.loli.net/2023/05/12/HXq4kr5RgdENSmC.gif"
loading="lazy"
alt="06-snmp"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="批量ssh可达性测试">批量ssh可达性测试
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/12/VujiXYQF8DBJ4lc.gif">
&lt;img src="https://s2.loli.net/2023/05/12/VujiXYQF8DBJ4lc.gif"
loading="lazy"
alt="07-ssh"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="批量ping可达性测试">批量ping可达性测试
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/13/FdADRmT7ijzwHkE.gif">
&lt;img src="https://s2.loli.net/2023/05/13/FdADRmT7ijzwHkE.gif"
loading="lazy"
alt="08-ping"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="批量保存配置">批量保存配置
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/12/aQxUnHKLV1Cdv7l.gif">
&lt;img src="https://s2.loli.net/2023/05/12/aQxUnHKLV1Cdv7l.gif"
loading="lazy"
alt="09-save"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="查看设备清单">查看设备清单
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/12/SEPBO96jQLzfAru.gif">
&lt;img src="https://s2.loli.net/2023/05/12/SEPBO96jQLzfAru.gif"
loading="lazy"
alt="10-all-device"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="导出诊断信息和日志tftp">导出诊断信息和日志（TFTP）
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/12/25vYimxPfXryE98.gif">
&lt;img src="https://s2.loli.net/2023/05/12/25vYimxPfXryE98.gif"
loading="lazy"
alt="11-diag"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="生成的文件">生成的文件
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/13/YjHq6JEcClrmv4F.gif">
&lt;img src="https://s2.loli.net/2023/05/13/YjHq6JEcClrmv4F.gif"
loading="lazy"
alt="12-file-saved"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="文件根目录">文件根目录
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/13/3fpAmPkHUjLeQhM.jpg">
&lt;img src="https://s2.loli.net/2023/05/13/3fpAmPkHUjLeQhM.jpg"
loading="lazy"
alt="ScreenCaputure230512235941"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="功能说明">功能说明
&lt;/h2>&lt;ol>
&lt;li>批量备份配置
&lt;ul>
&lt;li>根据加载的设备清单，读取ssh登陆信息登陆设备，执行display列中的display命令，将回显内容写入到&lt;code>EXPORT\当天日期\export_conf&lt;/code>文件夹下，每个设备的回显内容分别记录在一个txt文件(格式：name + ip + 当前时间.txt)，运行结果记录在&lt;code>EXPORT\当天日期\result_当天日期.log&lt;/code>文件&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>批量修改配置
&lt;ul>
&lt;li>根据加载的设备清单，读取ssh登陆信息登陆设备，执行config列中的config命令，将回显内容写入到&lt;code>EXPORT\当天日期\modify_conf&lt;/code>文件夹下，每个设备的回显内容分别记录在一个txt文件(格式：name + ip + 当前时间.txt)，运行结果记录在&lt;code>EXPORT\当天日期\result_当天日期.log&lt;/code>文件&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>筛选&amp;ndash;&amp;gt;执行
&lt;ul>
&lt;li>选择该功能选项后，会在二级菜单显示主菜单中的1、2、6、7、8、9功能&lt;/li>
&lt;li>选择对应功能后进入筛选菜单&lt;/li>
&lt;li>筛选菜单：
&lt;ul>
&lt;li>IP地址-筛选&lt;/li>
&lt;li>平台-筛选&lt;/li>
&lt;li>设备型号-筛选&lt;/li>
&lt;li>区域-筛选&lt;/li>
&lt;li>组合筛选&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>获取交换机 端口-MAC地址
&lt;ul>
&lt;li>该功能通过获取交换机MAC地址表和trunk接口信息，求差集获取到非trunk接口的MAC地址表，表格文件存储到&lt;code>EXPORT\当天日期\generate_table&lt;/code>，格式为：&lt;code>当天日期_当前时间_MAC地址表.xlsx&lt;/code>&lt;/li>
&lt;li>强烈建议在代码&lt;code>task.run&lt;/code>前进行filter过滤接入交换机的&lt;code>nr对象&lt;/code>&lt;/li>
&lt;li>运行结果记录在&lt;code>EXPORT\当天日期\result_当天日期.log&lt;/code>文件&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>搜索MAC地址对应设备
&lt;ul>
&lt;li>本功能依赖功能4中生成的MAC地址表，需要使用本功能先执行功能4&lt;/li>
&lt;li>输入的MAC地址格式任意，可以是全匹配如：4426-0f92-0d06，也可以是其中部分如：0d06 或 4426，或者任意字符（没有意义）&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>批量snmp轮询
&lt;ul>
&lt;li>根据加载的设备清单，执行snmp_get操作，将获取到的结果写入到SNMP轮询结果表，表格文件存储到&lt;code>EXPORT\当天日期\generate_table&lt;/code>，格式为：&lt;code>当天日期_当前时间_snmp轮询结果表.xlsx&lt;/code>&lt;/li>
&lt;li>运行结果记录在&lt;code>EXPORT\当天日期\result_当天日期.log&lt;/code>文件&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>批量ssh可达性测试
&lt;ul>
&lt;li>根据加载的设备清单，读取ssh登陆信息登陆设备，以获取到设备的&lt;code>prompt&lt;/code>作为依据判断ssh可达，运行结果记录在&lt;code>EXPORT\当天日期\result_当天日期.log&lt;/code>文件&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>批量ping可达性测试
&lt;ul>
&lt;li>根据加载的设备清单，执行ping操作，以没有异常作为依据判断ping可达，运行结果记录在&lt;code>EXPORT\当天日期\result_当天日期.log&lt;/code>文件&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>批量保存配置
&lt;ul>
&lt;li>根据加载的设备清单，执行&lt;code>netmiko_save_config&lt;/code>操作，以没有异常作为依据判断保存成功，运行结果记录在&lt;code>EXPORT\当天日期\result_当天日期.log&lt;/code>文件&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>显示设备清单
&lt;ul>
&lt;li>根据加载的设备清单，列出[&amp;rsquo;name&amp;rsquo;, &amp;lsquo;ip&amp;rsquo;, &amp;lsquo;platform&amp;rsquo;, &amp;lsquo;model&amp;rsquo;, &amp;lsquo;device_type&amp;rsquo;, &amp;lsquo;area&amp;rsquo;, &amp;rsquo;location&amp;rsquo;, &amp;lsquo;version&amp;rsquo;, &amp;lsquo;sn&amp;rsquo;]等内容&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>导出诊断信息和日志（TFTP）
&lt;ul>
&lt;li>根据&lt;code>nr.filter(hostname=device_ip)&lt;/code>过滤单台设备，对设备的诊断信息文件，诊断日志文件和日志文件上传到 TFTP 服务器&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h2 id="如何使用">如何使用
&lt;/h2>&lt;h3 id="下载">下载
&lt;/h3>&lt;p>&lt;code>Github&lt;/code>仓库地址：https://github.com/kiraster/netops_v2.0_beta&lt;/p>
&lt;h3 id="虚拟环境">虚拟环境
&lt;/h3>&lt;p>由于正常运行需要安装很多第三方库，且有些库的依赖需要降级版本才能正常运行，或可能与你当前python环境会有冲突，建议在虚拟环境下运行&lt;/p>
&lt;p>以&lt;code>vscode&lt;/code>软件举例:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>代码编辑打开目录并控制台切换到代码根目录&lt;/p>
&lt;/li>
&lt;li>
&lt;p>创建虚拟环境&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">python -m venv venv
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>激活虚拟环境&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">.\venv\Scripts\Activate.ps1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="安装-python-库">安装 python 库
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">pip install -r requirements.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>安装库的时候可能遇到&lt;code>timeout&lt;/code>提示，检查网络；如遇报错看提示去Google&lt;/p>
&lt;h2 id="运行前说明">运行前说明
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>查看&lt;code>nornir.yaml&lt;/code>文件，发现&lt;code>plugin: ExcelInventory&lt;/code>，是因为本代码使用了&lt;a class="link" href="https://github.com/jiujing/nornir_table_inventory" target="_blank" rel="noopener"
>【nornir_table_inventory 插件】
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>excel_file: &amp;quot;inventory/inventory_unprotected.xlsx&amp;quot;&lt;/code>，这行配置指示了需要的excel文件，注意看文件名（unprotected），这是一个不带保护密码的excel文件，具体说明见&lt;code>README&lt;/code>文件&lt;/p>
&lt;/li>
&lt;li>
&lt;p>inventory文件夹下还有一个&lt;code>inventory_protected.xlsx&lt;/code>文件，这是一个有保护密码的文件&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>inventory_protected.xlsx&lt;/code>文件需要自行制作并设置一个保护密码，以下是本机环境中的格式，可参照插件作者的示例增删改&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/13/8GgzxanbZYiEW9C.jpg">
&lt;img src="https://s2.loli.net/2023/05/13/8GgzxanbZYiEW9C.jpg"
loading="lazy"
alt="ScreenCaputure230513003040"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>inventory_protected.xlsx&lt;/code>文件中&lt;code>dispaly&lt;/code>和&lt;code>config&lt;/code>列的内容是查看命令和配置命令，每个命令之间使用逗号&lt;code>,&lt;/code>分隔；如在单元格内使用手动换行(换行符&lt;code>\n&lt;/code>)需要修改代码中&lt;code>cmds = task.host.get('display').split(',')&lt;/code>和&lt;code>cmds = task.host.get('config').split(',')&lt;/code>的&lt;code>split(',')&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>可以根据实际情况修改&lt;code>num_workers&lt;/code>并发进程数和日志记录&lt;/p>
&lt;/li>
&lt;li>
&lt;p>如修改inventory路径和excel文件名，自行更新代码中对应的路径变量&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="代码执行逻辑">代码执行逻辑
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/05/13/VXpg4r7GjTeOny8.jpg">
&lt;img src="https://s2.loli.net/2023/05/13/VXpg4r7GjTeOny8.jpg"
loading="lazy"
alt="ScreenCaputure230513004510"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="最后">最后
&lt;/h2>&lt;ul>
&lt;li>总有不足之处，可以提，但不一定改&lt;/li>
&lt;li>我总觉得使用display和show等命令去采集设备信息不是一个很妥的方式，特别是配合textfsm形成列表套字典再写入表格；且不说速度慢，每一个命令对应一个模板导致代码结构不简洁和繁多，每个厂商的命令也不尽相同，有时同厂商同命令的回显也有差异导致要修改模板；同一源IP地址过度使用ssh登陆可能会被安全设备记录异常行为，特别是设备不可达或密码错会被识别为爆破攻击。&lt;/li>
&lt;li>采集就由专业的snmp去干就好，速度快。很多公共的OID一轮询就得出结果。实在不济可以弄得专业点写个针对厂商和型号的snmp轮询模板（我不会），再专业点可以去下载设备的MIB文件鼓捣鼓捣（你来），很多厂商的网管平台号称可以纳管友商设备靠的不就是这个&lt;/li>
&lt;li>对于批量修改配置，我的看法是慎用，特别是涉及控制层面的配置；如果要使用尽量在风险可控的前提下使用，如改个设备名称，添加描述，设备开局的批量调试等等；如确实要跑脚本建议先验证再验证，先小范围跑一两台设备，重要设备就手敲；随时做好提桶跑路。&lt;/li>
&lt;li>现网运行业务的时候不要乱搞，看过一个运维的采购文件，中断一次扣多少钱，多长时间内不能恢复又扣钱，看的胆战心惊的，这很大程度上让我理解了为什么一个看似不大规模的运维项目最终报价高的离谱，可能也许包含了一部分这些风险&lt;/li>
&lt;li>欢乐的时光总是特别短，又到时候讲byebye&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨。&lt;/li>
&lt;/ul>
&lt;blockquote>
&lt;p>&lt;strong>20230513 更新了此文章内容&lt;/strong>&lt;/p>
&lt;/blockquote></description></item><item><title>H3C自动配置(HTTP Python方式)</title><link>https://weeaster.github.io/posts/c69db7e2/</link><pubDate>Sat, 18 Mar 2023 13:18:59 +0000</pubDate><guid>https://weeaster.github.io/posts/c69db7e2/</guid><description>&lt;p>一个小测试，实现&lt;code>HCL&lt;/code>模拟器下利用&lt;code>python&lt;/code>脚本根据交换机的背板MAC地址（真机环境可以换成序列号）自动加载配置。&lt;/p>
&lt;p>&lt;strong>环境介绍：&lt;/strong>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/03/18/YhVtMfHBAaFOSIZ.jpg">
&lt;img src="https://s2.loli.net/2023/03/18/YhVtMfHBAaFOSIZ.jpg"
loading="lazy"
alt="ScreenCaputure230318161432"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>HCL v5.7.1&lt;/li>
&lt;li>Python 3.10.10&lt;/li>
&lt;li>Tftpd64 version 4.60&lt;/li>
&lt;/ul>
&lt;h2 id="步骤">步骤
&lt;/h2>&lt;h3 id="编写python脚本">编写python脚本
&lt;/h3>&lt;p>制作一个后缀名为&lt;code>.py&lt;/code>的脚本。主要作用是空配置交换机开机执行自动配置，下载到本地并执行文件&lt;/p>
&lt;p>由于HCL模拟器里的交换机序列号都一样的，勉为其难改用背板MAC地址；如果是真机设备直接用序列号；脚本中预留了序列号的代码，简单修改一下便可&lt;/p>
&lt;ul>
&lt;li>设备 H3C S6850_1: MAC_ADDRESS:68-bf-6d-ad-01-04&lt;/li>
&lt;li>设备 H3C S6850_2: MAC_ADDRESS:68-45-dc-f1-02-04&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#!/usr/bin/python&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#-*-coding:utf-8-*-&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">import&lt;/span> &lt;span class="n">comware&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">import&lt;/span> &lt;span class="n">platformtools&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">do_reboot&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># scheduler job reboot&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">platformtools&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CLI&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;system-view ;scheduler job startup_reboot ;command 1 reboot force ;quit&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># exec-delay &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">platformtools&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CLI&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;system-view ;scheduler schedule do_reboot ;job startup_reboot ;time once delay 1&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">apply_sw1_config&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Specify system startup&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">platformtools&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CLI&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;restore startup-configuration from 172.31.100.2 sw1_config.cfg&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">do_reboot&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">apply_sw2_config&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Specify system startup&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">platformtools&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CLI&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;restore startup-configuration from 172.31.100.2 sw2_config.cfg&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">do_reboot&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># more device ...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># def apply_sw3_config():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># # Specify system startup&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># platformtools.CLI(&amp;#39;restore startup-configuration from 172.31.100.2 sw3_config.cfg&amp;#39;)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># do_reboot()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># find DEVICE_SERIAL_NUMBER&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">platformtools&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CLI&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;dis dev man&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">False&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">res&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_output&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># if &amp;#39;DEVICE_SERIAL_NUMBER&amp;#39; in i:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;68-bf-6d-ad-01-04&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">apply_sw1_config&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;68-45-dc-f1-02-04&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">apply_sw2_config&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># more device ...&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># if &amp;#39;DEVICE_SERIAL_NUMBER&amp;#39; in i:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># apply_sw2_config()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># break&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="准备设备配置文件">准备设备配置文件
&lt;/h3>&lt;ul>
&lt;li>&lt;code>sw1_config.cfg&lt;/code>&lt;/li>
&lt;li>&lt;code>sw2_config.cfg&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sysname sw1_s6850
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> telnet server enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssh server enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vlan 10 to 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">int vlan 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip add 172.31.100.10 24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">int vlan 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip add 192.168.10.254 24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet 1/0/23
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port link-type trunk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port trunk permit vlan all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> undo shutdown
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet 1/0/24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port link-type trunk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port trunk permit vlan all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> undo shutdown
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">local-user admin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">password simple Cisco123!@#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">authorization-attribute user-role network-admin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">authorization-attribute user-role network-operator
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service-type ssh telnet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">quit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">line vty 0 63
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">authentication-mode scheme
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user-role network-operator
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">return
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="启动http服务端">启动HTTP服务端
&lt;/h3>&lt;p>搭建一个简单的http服务端（可以使用网上的各种小工具，安全性自己判断），如果有&lt;code>python&lt;/code>环境可以直接启动一个简易的http服务端，搭建完成后使用浏览器打开链接，确保&lt;code>url&lt;/code>能正确指向第一步中的python脚本文件。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">PS D:\TEMP\tftpd64.460&amp;gt; python -m http.server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Serving HTTP on :: port 8000 (http://[::]:8000/) ...
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>浏览器URL测试&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/03/18/Sr4PKcJ8LOkw3CR.jpg">
&lt;img src="https://s2.loli.net/2023/03/18/Sr4PKcJ8LOkw3CR.jpg"
loading="lazy"
alt="ScreenCaputure230318172646"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="配置tftp服务端和dhcp服务端参数">配置TFTP服务端和DHCP服务端参数
&lt;/h3>&lt;ul>
&lt;li>TFTP目录选择设备配置文件的目录&lt;/li>
&lt;li>如果电脑有多块网卡，选择绑定需要用到的网卡IP地址&lt;/li>
&lt;li>DHCP填写的Boot File 是python脚本文件的URL&lt;/li>
&lt;/ul>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/03/18/vnz8uXmyatZfPqi.jpg">
&lt;img src="https://s2.loli.net/2023/03/18/vnz8uXmyatZfPqi.jpg"
loading="lazy"
alt="ScreenCaputure230318155000"
>
&lt;/a>
&lt;/div>
&lt;/th>
&lt;th>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/03/18/ChqJuWxT59BOQ7z.jpg">
&lt;img src="https://s2.loli.net/2023/03/18/ChqJuWxT59BOQ7z.jpg"
loading="lazy"
alt="ScreenCaputure230318155038"
>
&lt;/a>
&lt;/div>
&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;strong>Tips：为了方便使用建议把&lt;code>device.py&lt;/code>和设备&lt;code>.cfg&lt;/code>配置文件统一放到TFTP的目录下，http服务端的启动命令也在TFTP目录下启动。&lt;/strong>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/03/18/M6WgyK7xONael5B.jpg">
&lt;img src="https://s2.loli.net/2023/03/18/M6WgyK7xONael5B.jpg"
loading="lazy"
alt="ScreenCaputure230318164825"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="启动测试">启动测试
&lt;/h2>&lt;ol>
&lt;li>临时关闭本机环境中的其他DHCP服务端&lt;/li>
&lt;li>HCL模拟器里的交换机桥接到本地&lt;/li>
&lt;li>模拟器设备开机&lt;/li>
&lt;/ol>
&lt;p>TFTP软件观察发现已经分配两个地址&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/03/18/W1PQbp7dITu9vnN.jpg">
&lt;img src="https://s2.loli.net/2023/03/18/W1PQbp7dITu9vnN.jpg"
loading="lazy"
alt="ScreenCaputure230318161954"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>第一台S6850 启动，观察发现下载了&lt;code>device.py&lt;/code>文件，并按照&lt;code>py脚本&lt;/code>命令执行了一些配置&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/03/18/23YpwFZsAyEPavi.jpg">
&lt;img src="https://s2.loli.net/2023/03/18/23YpwFZsAyEPavi.jpg"
loading="lazy"
alt="ScreenCaputure230318161917"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>第二台S6850 启动，观察发现下载了&lt;code>device.py&lt;/code>文件，并按照&lt;code>py脚本&lt;/code>命令执行了一些配置&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/03/18/7OMIJQRbpiaTnAz.jpg">
&lt;img src="https://s2.loli.net/2023/03/18/7OMIJQRbpiaTnAz.jpg"
loading="lazy"
alt="ScreenCaputure230318161928"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>按照设定的1分钟后重启设备，观察到出现两次&lt;code>Press ENTER to get started.&lt;/code>表示已经重启了；设备名称也按照配置文件里的更改了&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/03/18/2j8Z71DLnxRAX9g.jpg">
&lt;img src="https://s2.loli.net/2023/03/18/2j8Z71DLnxRAX9g.jpg"
loading="lazy"
alt="ScreenCaputure230318162531"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/03/18/bHQ6R9YPXlLo7vg.jpg">
&lt;img src="https://s2.loli.net/2023/03/18/bHQ6R9YPXlLo7vg.jpg"
loading="lazy"
alt="ScreenCaputure230318162541"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>使用SSH登陆设备，能通过配置文件里配置的IP地址登陆设备&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/03/18/iRkwHB8UTflVjuE.jpg">
&lt;img src="https://s2.loli.net/2023/03/18/iRkwHB8UTflVjuE.jpg"
loading="lazy"
alt="ScreenCaputure230318162808"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/03/18/X56uDBxOsQdhgEF.jpg">
&lt;img src="https://s2.loli.net/2023/03/18/X56uDBxOsQdhgEF.jpg"
loading="lazy"
alt="ScreenCaputure230318162820"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>查看sw1的一些配置&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/03/18/izDftqmedHPpgwB.jpg">
&lt;img src="https://s2.loli.net/2023/03/18/izDftqmedHPpgwB.jpg"
loading="lazy"
alt="ScreenCaputure230318163152"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="结束">结束
&lt;/h2>&lt;ol>
&lt;li>HCL模拟器的序列号一致不能通过序列号操作，实为憾事&lt;/li>
&lt;li>这个方法可应用在一定规模的组网，前提条件是安装前要记录安装位置与设备序列号的对应关系&lt;/li>
&lt;li>这个方法只能应用在完全空配置的设备，保存过配置的交换机就不能操作了&lt;/li>
&lt;li>如果是真实设备使用，注意本机电脑的防火墙设置&lt;/li>
&lt;li>前线安装人员要确定设备已加电和设备端口的指示灯状态&lt;/li>
&lt;li>方法操作没有问题，但是有时候去实施，甲方看到你老是在电脑面前操作，这个体现不出工作量，需要注意，两天的活你半小时不到干完了&lt;/li>
&lt;li>修改一下脚本，还能用在没有console线的环境下应急，同样确保设备是空配置启动&lt;/li>
&lt;li>&lt;code>device.py&lt;/code>文件里的代码有一个重启设备的定时任务，由于是做实验我设置了1分钟后重启，如果是真实环境这个延时重启建议配置时间大一点&lt;/li>
&lt;/ol></description></item><item><title>观察OSPF虚链路和虚链路的替代办法</title><link>https://weeaster.github.io/posts/5c8077d9/</link><pubDate>Thu, 16 Mar 2023 22:45:33 +0000</pubDate><guid>https://weeaster.github.io/posts/5c8077d9/</guid><description>&lt;p>一个小实验，观察&lt;code>OSPF&lt;/code>虚链路、虚链路的替代办法。&lt;/p>
&lt;p>&lt;strong>拓扑图：&lt;/strong>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/03/16/L1V6fSaPcXrFZgq.jpg">
&lt;img src="https://s2.loli.net/2023/03/16/L1V6fSaPcXrFZgq.jpg"
loading="lazy"
alt="ScreenCaputure230316225301"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>如上图所示，右边 AREA 2、3、4 普通区域被 AREA 1 分割。&lt;/p>
&lt;p>要求：不改动物理连线的方式配置设备，使得 R1 学习到 R6、R7、R8上的路由。&lt;/p>
&lt;p>方式一：R2 &amp;ndash; R3 间配置跨 AREA 1 的虚链路&lt;/p>
&lt;p>方式二：R2 &amp;ndash; R4 间配置 Tunnel 隧道，配置宣告&lt;/p>
&lt;p>方式三：R5 上 配置 AREA 4 在另一个 OSPF 进程，配置重分布&lt;/p>
&lt;hr>
&lt;h2 id="方式一">方式一
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">!--- R2 commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> area 1 virtual-link 3.3.3.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!--- R3 commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> area 1 virtual-link 2.2.2.2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="方式二">方式二
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">!--- R2 commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 100.1.1.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel source 24.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel destination 24.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # 将Tunnel接口地址宣告进区域0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.1.1.1 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!--- R4 commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 100.1.1.2 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel source 24.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel destination 24.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # 将Tunnel接口地址宣告进区域0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.1.1.2 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="方式三">方式三
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5#sh run | s r o
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 5.5.5.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # 重分布
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> redistribute ospf 200 subnets
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 5.5.5.5 0.0.0.0 area 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 25.1.1.5 0.0.0.0 area 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 配置 AREA 4 在另一个 OSPF 进程
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 55.55.55.55
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # 重分布
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> redistribute ospf 100 subnets
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 58.1.1.5 0.0.0.0 area 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R5#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="观察">观察
&lt;/h2>&lt;p>R1 上查看 OSPF 路由，发现能学习到 R6，R7，R8上的环回口路由；Tunnel接口的地址也被学习到，而且是 O 表项路由属于区域 0 ，R8 的路由因为在R5 上进行了双向重分布显示为 OE2 表项。 R6，R7 则是区域间路由，逻辑上的直连区域0。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>&lt;span class="c1">#sh ip route ospf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">2.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="mf">2.2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">2.2&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">11&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">12.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">26&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">3.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="mf">3.3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">3.3&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">21&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">12.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">25&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">54&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">4.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="mf">4.4&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">4.4&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">21&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">12.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">26&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">03&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">5.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="mf">5.5&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">5.5&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">21&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">12.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">26&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">03&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">6.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="mf">6.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">31&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">12.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">25&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">54&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">7.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="mf">7.7&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">7.7&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1021&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">12.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">25&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">53&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">8.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">8.8&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.8&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">11&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">12.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">25&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">53&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">23.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="mf">23.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">12.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">26&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">24.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="mf">24.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">12.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">26&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">25.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="mf">25.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">12.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">26&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">36.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="mf">36.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">12.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">25&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">54&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">47.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1020&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">12.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">26&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">58.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">12.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">25&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">54&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">100.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">30&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="mf">100.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1010&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">12.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">26&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>&lt;span class="c1"># &lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>R2上查看 OSPF 邻居，发现除常规的邻居外，还有Tunnel0 的邻居和虚链路的邻居，两种邻居的区别在于虚链路邻居一旦邻居建立处于稳定状态，不发送hello报文，而且&lt;code>Dead Time &lt;/code>永不超时。而Tunnel0 的邻居有Dead Time 默认40秒，debug 查看 hello 会发现&lt;code>*Mar 16 15:24:11.782: OSPF-100 HELLO Tu0: Rcv hello from 4.4.4.4 area 0 100.1.1.2&lt;/code>，好像没什么用，好看&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R2#sh ip os nei
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Neighbor ID Pri State Dead Time Address Interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4.4.4.4 0 FULL/ - 00:00:30 100.1.1.2 Tunnel0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1.1.1.1 1 FULL/BDR 00:00:32 12.1.1.1 Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3.3.3.3 0 FULL/ - - 23.1.1.3 OSPF_VL0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5.5.5.5 1 FULL/DR 00:00:33 25.1.1.5 Ethernet0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4.4.4.4 1 FULL/DR 00:00:34 24.1.1.4 Ethernet0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3.3.3.3 1 FULL/DR 00:00:37 23.1.1.3 Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>R8上查看路由表，因为在R5上进行了重分布，R5是ASBR。所有看到的OSPF路由表项都是 OE&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R8&lt;/span>&lt;span class="c1">#sh ip rou os&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">L&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">local&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">C&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="k">static&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">RIP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">M&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">mobile&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">B&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">BGP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">D&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">EX&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EIGRP&lt;/span> &lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">O&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">IA&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">NSSA&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">E1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">su&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">summary&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L1&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">L2&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ia&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">IS&lt;/span> &lt;span class="n">inter&lt;/span> &lt;span class="n">area&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">candidate&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">U&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">per&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">user&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">o&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">ODR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">P&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">periodic&lt;/span> &lt;span class="n">downloaded&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">H&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">NHRP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">l&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">LISP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">a&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">application&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">replicated&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">hop&lt;/span> &lt;span class="n">override&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">overrides&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">PfR&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">1.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">21&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">42&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">2.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">2.2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">2.2&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">11&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">42&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">3.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">3.3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">3.3&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">21&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">42&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">4.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">4.4&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">4.4&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">21&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">42&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">5.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">5.5&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">5.5&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">42&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">6.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">6.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">31&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">7.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">7.7&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">7.7&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">31&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">01&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">46&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">12.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">12.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">42&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">23.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">23.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">42&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">24.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">24.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">42&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">25.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">25.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">42&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">36.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">36.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">42&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">47.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">47.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">30&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">01&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">46&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">100.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">30&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="n">E2&lt;/span> &lt;span class="mf">100.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1010&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">41&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">42&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R8&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R8&lt;/span>&lt;span class="c1"># sh ip os border-routers &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">OSPF&lt;/span> &lt;span class="n">Router&lt;/span> &lt;span class="n">with&lt;/span> &lt;span class="n">ID&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mf">8.8&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.8&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">Process&lt;/span> &lt;span class="n">ID&lt;/span> &lt;span class="mi">200&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Base&lt;/span> &lt;span class="n">Topology&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">MTID&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Internal&lt;/span> &lt;span class="n">Router&lt;/span> &lt;span class="n">Routing&lt;/span> &lt;span class="n">Table&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">Intra&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">area&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">I&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">Inter&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">area&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">i&lt;/span> &lt;span class="mf">55.55&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">55.55&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">58.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">ASBR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ne">Area&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">SPF&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R8&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>基于Django编写的SNMP轮询Demo</title><link>https://weeaster.github.io/posts/d70f2b4c/</link><pubDate>Mon, 13 Mar 2023 14:12:11 +0000</pubDate><guid>https://weeaster.github.io/posts/d70f2b4c/</guid><description>&lt;p>一个基于&lt;code>Django&lt;/code>编写的&lt;code>SNMP&lt;/code>轮询Demo，可以对设备（代码内置了H3C OID部分规则）进行&lt;code>SNMP&lt;/code>轮询，&lt;code>icmp&lt;/code>连通性检测，并将结果写入数据库，前端页面读取数据库数据进行直观的展示。效果图可点击本页面导航栏的&lt;code>Gallery&lt;/code>相册查看。&lt;/p>
&lt;h2 id="一个视频">一个视频
&lt;/h2>&lt;p>&lt;strong>无解说无字幕，嫌BGM太吵可静音&lt;/strong>&lt;/p>
&lt;div class="video-wrapper">
&lt;iframe src="https://player.bilibili.com/player.html?as_wide=1&amp;amp;high_quality=1&amp;amp;page=1&amp;aid=bv1d24y147sc"
scrolling="no"
frameborder="no"
framespacing="0"
allowfullscreen="true"
>
&lt;/iframe>
&lt;/div>
&lt;hr>
&lt;h2 id="缘由">缘由
&lt;/h2>&lt;p>&lt;strong>声明：我不是搞软件的&lt;/strong>&lt;/p>
&lt;p>当初仅为了在项目实施中显示设备的上线情况和快速查找到需要变更配置的设备；后来越搞越多，像首页，设备导出，修改页，查看配置，计划任务，清空数据等功能并不是我当初有计划要制作的；最后及时刹车，许多脑中风暴的功能没有继续写，也没有继续添加功能的计划。&lt;/p>
&lt;h2 id="代码组成及工作流">代码组成及工作流
&lt;/h2>&lt;p>&lt;strong>框架&lt;/strong>&lt;/p>
&lt;p>&lt;code>Bootstrap-3.3.7&lt;/code>+&lt;code>Django4.0.7&lt;/code>+&lt;code>MySql-5.7.39&lt;/code>（或&lt;code>sqlite&lt;/code>）&lt;/p>
&lt;p>&lt;strong>工作流&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>设备初始参数写入数据库&lt;/li>
&lt;li>设备的轮询，并对结果进行写入数据库&lt;/li>
&lt;li>前端页面对数据的展示&lt;/li>
&lt;/ol>
&lt;h2 id="页面及功能">页面及功能
&lt;/h2>&lt;ol>
&lt;li>首页
&lt;ol>
&lt;li>设备类型统计显示&lt;/li>
&lt;li>设备在线/离线、CPU使用率、内存使用率概览饼状图显示&lt;/li>
&lt;li>设备CPU使用率、内存使用率 TOP 10 显示&lt;/li>
&lt;li>关于&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>设备管理
&lt;ol>
&lt;li>设备数据显示&lt;/li>
&lt;li>设备添加
&lt;ol>
&lt;li>snmp测试&lt;/li>
&lt;li>继续添加&lt;/li>
&lt;li>添加并返回&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>设备导出&lt;/li>
&lt;li>设备详情
&lt;ol>
&lt;li>刷新&lt;/li>
&lt;li>执行查看配置&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>设备参数修改、同步、删除&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>计划任务
&lt;ol>
&lt;li>定时任务&lt;/li>
&lt;li>手动任务&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>更多操作
&lt;ol>
&lt;li>批量导入&lt;/li>
&lt;li>清空数据&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;h2 id="如何使用">如何使用
&lt;/h2>&lt;p>&lt;strong>clone 仓库代码至本地或使用浏览器下载压缩包&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">git clone https://github.com/kiraster/ndgv_demo.git
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>或 &lt;a class="link" href="https://github.com/kiraster/ndgv_demo" target="_blank" rel="noopener"
>https://github.com/kiraster/ndgv_demo
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a> &lt;strong>Code&lt;/strong> &amp;ndash;&amp;raquo; &lt;strong>Download ZIP&lt;/strong>&lt;/p>
&lt;h3 id="本地处理">本地处理
&lt;/h3>&lt;p>使用任意支持Python 的 IDE工具，将代码目录添加&lt;/p>
&lt;h3 id="安装环境">安装环境
&lt;/h3>&lt;p>&lt;strong>为了不影响你电脑的python环境，建议使用虚拟环境运行本代码&lt;/strong>（以下用&lt;strong>Visual Studio Code&lt;/strong> 软件举例）&lt;/p>
&lt;ol>
&lt;li>
&lt;p>IDE工具控制台切换到代码根目录&lt;/p>
&lt;/li>
&lt;li>
&lt;p>创建虚拟环境&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">python -m venv venv
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>激活虚拟环境&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">.\venv\Scripts\Activate.ps1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>可能遇到不能执行脚本的错误，可以以管理员身份打开&lt;code>powershell&lt;/code>，执行&lt;code> set-executionpolicy remotesigned&lt;/code>，选择&lt;code>y&lt;/code>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h4 id="安装python库">安装python 库
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">pip install -r requirements.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="初始化数据库">初始化数据库
&lt;/h3>&lt;ol>
&lt;li>修改&lt;code>ndgv1/settings.py &lt;/code>文件(78行开始)（以下是使用&lt;code>sqlite&lt;/code>数据的配置，如需使用&lt;code>MySQL&lt;/code>，把&lt;code>sqlite&lt;/code>部分注释，再把&lt;code>MySQL&lt;/code>注释部分取消即可）&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">DATABASES = {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;default&amp;#39;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;ENGINE&amp;#39;: &amp;#39;django.db.backends.sqlite3&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;#39;NAME&amp;#39;: BASE_DIR / &amp;#39;db.sqlite3&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # &amp;#39;default&amp;#39;: {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # &amp;#39;ENGINE&amp;#39;: &amp;#39;django.db.backends.mysql&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # &amp;#39;NAME&amp;#39;: &amp;#39;ndgv1.3&amp;#39;, # 数据库名称
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # &amp;#39;USER&amp;#39;: &amp;#39;root&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # &amp;#39;PASSWORD&amp;#39;: &amp;#39;xxxxxxxx&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # &amp;#39;HOST&amp;#39;: &amp;#39;127.0.0.1&amp;#39;,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # &amp;#39;PORT&amp;#39;: 3306,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # &amp;#39;CHARSET&amp;#39;: &amp;#39;utf8&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>
&lt;p>删除&lt;code>device_app/migrations&lt;/code> 和 &lt;code>scheduler_app/migrations&lt;/code> 除&lt;code>_init_.py &lt;/code>外的所有文件&lt;/p>
&lt;/li>
&lt;li>
&lt;p>删除 &lt;code>db.sqlite3&lt;/code> 文件&lt;/p>
&lt;/li>
&lt;li>
&lt;p>执行数据库迁移命令&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">python manage.py makemigrations
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">python manage.py migrate
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="修改清空数据功能代码">修改&lt;code>清空数据&lt;/code>功能代码
&lt;/h3>&lt;p>修改&lt;code>device_app/views&lt;/code>文件(683行开始)，以下是使用&lt;code>sqlite&lt;/code>数据的配置，如需使用&lt;code>MySQL&lt;/code>，把&lt;code>sqlite&lt;/code>部分注释，再把&lt;code>MySQL&lt;/code>注释部分取消即可&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">只直接使用原生 sql 语句 更快
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">from django.db import connection
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># sqlite 数据库
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sqlite_db = connection.cursor()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># MySQL 数据库
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># mysql_db = connection.cursor()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 执行 命令 重置 自增ID
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sqlite_db.execute(&amp;#39;DELETE FROM sqlite_sequence&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sqlite_db.execute(&amp;#39;DELETE FROM device_app_device&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sqlite_db.execute(&amp;#39;DELETE FROM device_app_devicedetail&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sqlite_db.execute(&amp;#39;DELETE FROM device_app_devicestate&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sqlite_db.execute(&amp;#39;DELETE FROM device_app_devicelocation&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sqlite_db.execute(&amp;#39;DELETE FROM scheduler_app_schedulerdetail&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sqlite_db.execute(&amp;#39;DELETE FROM django_apscheduler_djangojob&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sqlite_db.execute(&amp;#39;DELETE FROM django_apscheduler_djangojobexecution&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sqlite_db.execute(&amp;#39;DELETE FROM sqlite_sequence&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 取消外键约束
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># mysql_db.execute(&amp;#39;SET FOREIGN_KEY_CHECKS=0&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># mysql_db.execute(&amp;#39;truncate table device_app_device&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># mysql_db.execute(&amp;#39;truncate table device_app_devicedetail&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># mysql_db.execute(&amp;#39;truncate table device_app_devicestate&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># mysql_db.execute(&amp;#39;truncate table device_app_devicelocation&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># mysql_db.execute(&amp;#39;truncate table scheduler_app_schedulerdetail&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># mysql_db.execute(&amp;#39;truncate table django_apscheduler_djangojob&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># mysql_db.execute(&amp;#39;truncate table django_apscheduler_djangojobexecution&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 设置外键约束
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># mysql_db.execute(&amp;#39;SET FORE
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="运行代码">运行代码
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">python .\manage.py runserver
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="代码弊端">代码弊端
&lt;/h2>&lt;ol>
&lt;li>代码写死华三设备的oid&lt;/li>
&lt;li>代码中写死设备命名规则&lt;/li>
&lt;li>定时任务写死轮询时间&lt;/li>
&lt;li>前端页面展示以1080P分辨率屏幕编写&lt;/li>
&lt;li>首页展示，类别显示的规则写死华三设备型号&lt;/li>
&lt;li>……&lt;/li>
&lt;/ol>
&lt;h2 id="可能的问题或错误">可能的问题或错误
&lt;/h2>&lt;ol>
&lt;li>&lt;code>PermissionError: [WinError 10013] &lt;/code>以一种访问权限不允许的方式做了一个访问套接字的尝试。
&lt;ol>
&lt;li>使用管理员权限运行IDE编辑器&lt;/li>
&lt;li>检查是否端口占用&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>设备管理页面显示的数据不正确
&lt;ol>
&lt;li>由于是内置华三部分设备的&lt;code>OID&lt;/code>，有些设备的&lt;code>OID&lt;/code>值没有添加到代码&lt;/li>
&lt;li>有些数据根据设备命名规则解析出来的，如果设备名称不符合命名规则会显示不正确&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>设备同步后显示同步成功，但是没有数据
&lt;ol>
&lt;li>可能是snmp团体字不正确，或IP地址不可达&lt;/li>
&lt;li>或者本机防火墙限制&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>批量导入失败
&lt;ol>
&lt;li>上传文件中格式不准确或数据有误&lt;/li>
&lt;li>上传文件中数据与已有数据冲突，可使用清空数据再进行导入&lt;/li>
&lt;li>由于没有加入Django事务，对于已导入正确数据并不会进行回退&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>首页中类型统计不正确
&lt;ol>
&lt;li>统计规则是根据华三的设备型号中关键字定义的&lt;/li>
&lt;li>其他厂商设备不通用&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>页面显示不全或内容挤压
&lt;ol>
&lt;li>编写时候是以1080P分辨率屏幕显示为准&lt;/li>
&lt;li>没有对其他分辨率屏幕做调整&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol></description></item><item><title>配置跨域的Option C MPLS VPN（Cisco）</title><link>https://weeaster.github.io/posts/c0ba4ae2/</link><pubDate>Sat, 04 Mar 2023 01:05:34 +0000</pubDate><guid>https://weeaster.github.io/posts/c0ba4ae2/</guid><description>&lt;p>&lt;strong>Introduction&lt;/strong>&lt;/p>
&lt;p>This document describes how to configure and verify the Inter-AS Layer 3 Multiprotocol Label Switching (MPLS) VPN, option C feature. A sample network scenario and its configuration and outputs are shown for a better understanding.&lt;/p>
&lt;p>本文描述的是根据思科网站一篇配置文档（https://www.cisco.com/c/en/us/support/docs/multiprotocol-label-switching-mpls/mpls/200523-Configuration-and-Verification-of-Layer.html#）修改搭建的一个实验。&lt;/p>
&lt;hr>
&lt;h2 id="环境">环境
&lt;/h2>&lt;ul>
&lt;li>模拟器：PNET 4.2.10&lt;/li>
&lt;li>Cisco IOL： l3-ADVENTERPRISEK9-M-15.4-2T.bin&lt;/li>
&lt;/ul>
&lt;h2 id="配置">配置
&lt;/h2>&lt;h3 id="网络拓扑">网络拓扑
&lt;/h3>&lt;p>&lt;strong>网站原图&lt;/strong>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/03/07/oZLaRtUIcxgjFqe.jpg">
&lt;img src="https://s2.loli.net/2023/03/07/oZLaRtUIcxgjFqe.jpg"
loading="lazy"
alt="200523-Configuration-and-Verification-of-Layer-00"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>&lt;strong>搭建的拓扑&lt;/strong>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/03/07/S4HEnAgOUe6QYpj.jpg">
&lt;img src="https://s2.loli.net/2023/03/07/S4HEnAgOUe6QYpj.jpg"
loading="lazy"
alt="ScreenCaputure230304012642"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="拓扑规划">拓扑规划
&lt;/h3>&lt;ol>
&lt;li>每台路由配置环回接口 0 ，格式为 R1： 1.1.1.1/32&lt;/li>
&lt;li>互联接口为：设备编号1 + 设备编号2 + .1.1 + 设备编号1，例如 R1 e0/0 接口IP地址：12.1.1.1/24&lt;/li>
&lt;li>R7、R8、R9、R10 为 CE，R11 和 R12 为 反射器&lt;/li>
&lt;li>ISP1，ISP2 底层 IGP 运行 OSPF 协议&lt;/li>
&lt;li>A1，A2 的 CE 与 PE 运行 OSPF 协议&lt;/li>
&lt;li>B1，B2 的 CE 与 PE 运行 BGP 协议&lt;/li>
&lt;/ol>
&lt;h3 id="配置思路">配置思路
&lt;/h3>&lt;ol>
&lt;li>配置 ISP 底层 OSPF IGP ，验证：show ip os nei / show ip route ospf&lt;/li>
&lt;li>配置 ISP 启用 MPLS LDP，验证：show mpls interface / show mpls ldp discovery&lt;/li>
&lt;li>配置 PE VRF，配置与 CE 互联接口划分到 VRF，验证：show ip vrf int / show ip route vrf &lt;strong>X&lt;/strong>&lt;/li>
&lt;li>配置 ISP 的 BGP 邻居，验证：show ip b summ / show ip b vpnv4 all summ&lt;/li>
&lt;li>配置 RR1 和 RR2 的 MP-eBGP，验证：show ip b vpnv4 all summ&lt;/li>
&lt;li>配置 CE 和 PE 间的路由协议，验证：show ip route vrf &lt;strong>X&lt;/strong> / show ip os nei / show ip b summ&lt;/li>
&lt;li>配置 PE 上 双向重分布&lt;/li>
&lt;/ol>
&lt;h3 id="配置步骤">配置步骤
&lt;/h3>&lt;ol>
&lt;li>
&lt;h4 id="配置-ip-地址-略">配置 IP 地址 （略）
&lt;/h4>&lt;/li>
&lt;li>
&lt;h4 id="配置-isp-底层-igp-以-isp-1-为例isp2-同理">配置 ISP 底层 IGP （以 ISP 1 为例，ISP2 同理）
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">!--- R1 commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">int ran e 0/0,e0/3,lo0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip os 100 a 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!--- R2 commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">int ran e0/0-1,e0/3,lo0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip os 100 a 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!--- R3 commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">int ran e 0/1,e0/3,lo0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip os 100 a 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!--- R11 commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">int ran e 0/1-3,lo0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip os 100 a 0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>**验证：**查看 OSPF 邻居，查看 OSPF 路由，以 R2 为例&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">!--- R2 output.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#sh ip os nei
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Neighbor ID Pri State Dead Time Address Interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">11.11.11.11 1 FULL/BDR 00:00:39 112.1.1.11 Ethernet0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3.3.3.3 1 FULL/DR 00:00:30 23.1.1.3 Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1.1.1.1 1 FULL/BDR 00:00:39 12.1.1.1 Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#sh ip route ospf | b Gate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Gateway of last resort is not set
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1.0.0.0/32 is subnetted, 1 subnets
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">O 1.1.1.1 [110/11] via 12.1.1.1, 02:06:04, Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3.0.0.0/32 is subnetted, 1 subnets
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">O 3.3.3.3 [110/11] via 23.1.1.3, 02:05:54, Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 11.0.0.0/32 is subnetted, 1 subnets
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">O 11.11.11.11 [110/11] via 112.1.1.11, 02:05:54, Ethernet0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 111.0.0.0/24 is subnetted, 1 subnets
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">O 111.1.1.0 [110/20] via 12.1.1.1, 02:06:04, Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 113.0.0.0/24 is subnetted, 1 subnets
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">O 113.1.1.0 [110/20] via 23.1.1.3, 02:05:54, Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;h4 id="配置-isp-启用-mpls-ldp-以-isp-1-为例isp2-同理">配置 ISP 启用 MPLS LDP （以 ISP 1 为例，ISP2 同理）
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">!--- R1 commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">int ran e 0/0,e0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!--- R2 commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">int ran e0/0-1,e0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!--- R3 commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">int ran e 0/1,e0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!--- R11 commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">int ran e 0/1-3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls ip
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>验证：&lt;/strong> 查看 LDP 接口和 ldp 会话，以 R2 为例&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">!--- R2 output.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#sh mpls interfaces
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Interface IP Tunnel BGP Static Operational
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ethernet0/0 Yes (ldp) No No No Yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ethernet0/1 Yes (ldp) No No No Yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ethernet0/3 Yes (ldp) No No No Yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#sh mpls ldp dis
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#sh mpls ldp discovery
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Local LDP Identifier:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2.2.2.2:0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Discovery Sources:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Interfaces:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Ethernet0/0 (ldp): xmit/recv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> LDP Id: 1.1.1.1:0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Ethernet0/1 (ldp): xmit/recv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> LDP Id: 3.3.3.3:0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Ethernet0/3 (ldp): xmit/recv
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> LDP Id: 11.11.11.11:0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;h4 id="配置-pe-的-vrf配置与-ce-互联的接口划分到-vrf">配置 PE 的 VRF，配置与 CE 互联的接口划分到 VRF
&lt;/h4>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">!---&lt;/span> &lt;span class="n">R1&lt;/span> &lt;span class="n">commands&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rd&lt;/span> &lt;span class="mi">7&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="mi">7&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">7&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="n">import&lt;/span> &lt;span class="mi">9&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">9&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">b&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rd&lt;/span> &lt;span class="mi">8&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="mi">8&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="n">import&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">17.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">b&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">18.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!---&lt;/span> &lt;span class="n">R6&lt;/span> &lt;span class="n">commands&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rd&lt;/span> &lt;span class="mi">9&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="mi">9&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">9&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="n">import&lt;/span> &lt;span class="mi">7&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">7&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">b&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rd&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="n">import&lt;/span> &lt;span class="mi">8&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">a&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">69.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.6&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">b&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">106.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.6&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.0&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>**验证：**查看 VRF 路由表，以 R1 为例&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">!---&lt;/span> &lt;span class="n">R1&lt;/span> &lt;span class="n">output&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>&lt;span class="c1">#sh ip route vrf a | b Gate&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">7.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="mf">7.7&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">7.7&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">11&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">17.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.7&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">02&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">15&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">47&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">17.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">8&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">variably&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">subnets&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">masks&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">C&lt;/span> &lt;span class="mf">17.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">directly&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">L&lt;/span> &lt;span class="mf">17.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">directly&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>&lt;span class="c1">#sh ip route vrf b | b Gate&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">8.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">8.8&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">8.8&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">18.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.8&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">02&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">16&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">08&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">18.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">8&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">variably&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">subnets&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">masks&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">C&lt;/span> &lt;span class="mf">18.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">directly&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">L&lt;/span> &lt;span class="mf">18.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">directly&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;h4 id="配置-isp-的-bgp-邻居">配置 ISP 的 BGP 邻居
&lt;/h4>&lt;p>&lt;strong>R3 与 R4 配置 IPv4 BGP 邻居，R3 宣告 1.1.1.1 和 11.11.11.11，R4 宣告 6.6.6.6 和 12.12.12.12&lt;/strong>&lt;/p>
&lt;p>&lt;strong>将 BGP 路由重分布进底层 OSPF 协议，为了学习到对端 RR 和 PE 路由，建立 MP-BGP 需要&lt;/strong>&lt;/p>
&lt;p>由于底层 OSPF 协议的运行，R3 与 R4 已经学习到这些路由，在建立 eBGP 邻居后能传递到对端&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">!--- R3 commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp log-neighbor-changes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 1.1.1.1 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 11.11.11.11 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 34.1.1.4 remote-as 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 34.1.1.4 send-label
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> redistribute bgp 100 subnets
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!--- R4 commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp log-neighbor-changes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 6.6.6.6 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 12.12.12.12 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 34.1.1.3 remote-as 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 34.1.1.3 send-label
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> redistribute bgp 200 subnets
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>验证：&lt;/strong>&lt;/p>
&lt;p>R3 与 R4 的 eBGP 邻居&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3#sh ip b summary
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP router identifier 3.3.3.3, local AS number 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 75, main routing table version 75
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4 network entries using 560 bytes of memory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4 path entries using 320 bytes of memory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4/4 BGP path/bestpath attribute entries using 576 bytes of memory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1 BGP AS-PATH entries using 24 bytes of memory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">0 BGP route-map cache entries using 0 bytes of memory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">0 BGP filter-list cache entries using 0 bytes of memory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP using 1480 total bytes of memory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP activity 4/0 prefixes, 36/32 paths, scan interval 60 secs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Neighbor V AS MsgRcvd MsgSent TblVer InQ OutQ Up/Down State/PfxRcd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">34.1.1.4 4 200 90 90 75 0 0 01:16:45 0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>R1 的 1.1.1.1 去往 R6 的 6.6.6.6 路由可达，标签路径连续&lt;/p>
&lt;p>R11 的 11.11.11.11 去往 R12 的 12.12.12.12 路由可达，标签路径连续&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1#ping 6.6.6.6 source 1.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte ICMP Echos to 6.6.6.6, timeout is 2 seconds:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Packet sent with a source address of 1.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 6/6/8 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#traceroute 6.6.6.6 source 1.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Tracing the route to 6.6.6.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">VRF info: (vrf in name/id, vrf out name/id)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 12.1.1.2 [MPLS: Label 24 Exp 0] 5 msec 6 msec 6 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2 23.1.1.3 [MPLS: Label 26 Exp 0] 6 msec 5 msec 6 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3 34.1.1.4 [MPLS: Label 27 Exp 0] 7 msec 7 msec 5 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 4 45.1.1.5 [MPLS: Label 22 Exp 0] 4 msec 5 msec 6 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 5 56.1.1.6 6 msec * 7 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R11#ping 12.12.12.12 source 11.11.11.11
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte ICMP Echos to 12.12.12.12, timeout is 2 seconds:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Packet sent with a source address of 11.11.11.11
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 3/3/4 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R11#trace 12.12.12.12 source 11.11.11.11
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Tracing the route to 12.12.12.12
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">VRF info: (vrf in name/id, vrf out name/id)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 113.1.1.3 [MPLS: Label 27 Exp 0] 4 msec 4 msec 4 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2 34.1.1.4 [MPLS: Label 25 Exp 0] 3 msec 2 msec 2 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3 124.1.1.12 4 msec * 4 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R11#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>关于send-label 命令：&lt;/strong>&lt;/p>
&lt;p>tell the router to send the lables of bgp prefix to its peer，为 BGP 路由传递标签，使用此命令后，对应接口自动配置 mpls bgp forwarding ，但是 no 掉后接口的这行配置并不会自动去掉&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">*Mar 4 05:54:10.850: %BGP_LMM-6-AUTOGEN1: The mpls bgp forwarding command has been configured on interface: Ethernet0/0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>未配置 &lt;strong>send-label&lt;/strong> 命令前，R3 去往 6.6.6.6 的标签 是空标签，R3 的动作是弹出所有标签，标签中断。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3#sh mpls forwarding-table 6.6.6.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Local Outgoing Prefix Bytes Label Outgoing Next Hop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Label Label or Tunnel Id Switched interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">26 No Label 6.6.6.6/32 0 Et0/0 34.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3#sh ip b la
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3#sh ip b labels
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop In label/Out label
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1.1.1.1/32 23.1.1.2 nolabel/nolabel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 6.6.6.6/32 34.1.1.4 nolabel/nolabel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 11.11.11.11/32 113.1.1.11 nolabel/nolabel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 12.12.12.12/32 34.1.1.4 nolabel/nolabel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3#sh ip b 6.6.6.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP routing table entry for 6.6.6.6/32, version 66
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Paths: (1 available, best #1, table default)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Not advertised to any peer
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Refresh Epoch 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 34.1.1.4 from 34.1.1.4 (4.4.4.4)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Origin IGP, metric 21, localpref 100, valid, external, best
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rx pathid: 0, tx pathid: 0x0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>配置 &lt;strong>send-label&lt;/strong> 命令后，分配 27 标签&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3#sh mpls forwarding-table 6.6.6.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Local Outgoing Prefix Bytes Label Outgoing Next Hop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Label Label or Tunnel Id Switched interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">26 27 6.6.6.6/32 0 Et0/0 34.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3#sh ip b labels
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop In label/Out label
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1.1.1.1/32 23.1.1.2 21/nolabel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 6.6.6.6/32 34.1.1.4 nolabel/27
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 11.11.11.11/32 113.1.1.11 25/nolabel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 12.12.12.12/32 34.1.1.4 nolabel/25
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3#sh ip b 6.6.6.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP routing table entry for 6.6.6.6/32, version 56
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Paths: (1 available, best #1, table default)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Not advertised to any peer
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Refresh Epoch 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 34.1.1.4 from 34.1.1.4 (4.4.4.4)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Origin IGP, metric 21, localpref 100, valid, external, best
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mpls labels in/out nolabel/27
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rx pathid: 0, tx pathid: 0x0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 在 R4 上查看到关于去往6.6.6.6 的 入向标签 27
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#sh ip bgp labels
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Network Next Hop In label/Out label
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1.1.1.1/32 34.1.1.3 nolabel/21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 6.6.6.6/32 45.1.1.5 27/nolabel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 11.11.11.11/32 34.1.1.3 nolabel/25
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 12.12.12.12/32 124.1.1.12 25/nolabel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R4#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>R1 与 R11 配置 BGP VPNV4 邻居&lt;/strong>&lt;/p>
&lt;p>注意：R3 与 R11 不建立 BGP 邻居&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">!--- R1 commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no bgp default ipv4-unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 11.11.11.11 remote-as 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 11.11.11.11 update-source Loopback0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> address-family vpnv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 11.11.11.11 activate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!--- R11 commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp log-neighbor-changes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no bgp default ipv4-unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 1.1.1.1 remote-as 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 1.1.1.1 update-source Loopback0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> address-family vpnv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 1.1.1.1 activate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 1.1.1.1 route-reflector-client
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>R6 与 R12 配置 BGP VPNV4 邻居&lt;/strong>&lt;/p>
&lt;p>注意：R4 与 R12 不建立 BGP 邻居&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">!--- R6 commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no bgp default ipv4-unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 12.12.12.12 remote-as 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 12.12.12.12 update-source Loopback0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> address-family vpnv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 12.12.12.12 activate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!--- R12 commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no bgp default ipv4-unicast
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 6.6.6.6 remote-as 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 6.6.6.6 update-source Loopback0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> address-family vpnv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 6.6.6.6 activate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 6.6.6.6 route-reflector-client
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>**验证：**VPNV4 邻居&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sh ip b vpnv4 all summary
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>R11 与 R12 建立 MP-eBGP 邻居&lt;/strong>&lt;/p>
&lt;p>设置 eBGP 多跳。不是物理直连的 eBGP 邻居&lt;/p>
&lt;p>设置下一跳不改变。R11 与 R12 建立 MP-eBGP 邻居，传递路由时默认下一跳改变成自身，这样 ISP 两侧的流量互通都流经反射器不合理，设置下一跳不改变后，R1 上去往 ISP2 CE 的路由下一跳看到的是 R6 的 6.6.6.6 ，最后再在两个 ISP 内部控制底层 IGP 的路径，使得流量不经过反射器。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">!--- R11 commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 12.12.12.12 remote-as 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 12.12.12.12 ebgp-multihop 255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 12.12.12.12 update-source Loopback0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> address-family vpnv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 12.12.12.12 activate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 12.12.12.12 next-hop-unchanged
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!--- R12 commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 11.11.11.11 remote-as 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 11.11.11.11 ebgp-multihop 255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 11.11.11.11 update-source Loopback0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> address-family vpnv4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 11.11.11.11 activate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 11.11.11.11 next-hop-unchanged
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>验证：查看 R11 上的 BGP 邻居&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R11#sh ip b vpnv4 all summary
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP router identifier 11.11.11.11, local AS number 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP table version is 67, main routing table version 67
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">6 network entries using 912 bytes of memory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">6 path entries using 480 bytes of memory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5/5 BGP path/bestpath attribute entries using 760 bytes of memory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3 BGP AS-PATH entries using 72 bytes of memory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4 BGP extended community entries using 128 bytes of memory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">0 BGP route-map cache entries using 0 bytes of memory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">0 BGP filter-list cache entries using 0 bytes of memory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP using 2352 total bytes of memory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BGP activity 6/0 prefixes, 6/0 paths, scan interval 60 secs
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Neighbor V AS MsgRcvd MsgSent TblVer InQ OutQ Up/Down State/PfxRcd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1.1.1.1 4 100 127 151 67 0 0 01:50:57 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">12.12.12.12 4 200 190 185 67 0 0 01:50:16 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R11#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;h4 id="配置-ce-和-pe-间的路由协议">配置 CE 和 PE 间的路由协议
&lt;/h4>&lt;p>以 R7，R8，R1 为例， R9，R10，R6 同理&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">!--- R7 commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">int ran e 0/0,lo0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip os 7 a 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!--- R8 commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 300
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 8.8.8.8 mask 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 18.1.1.1 remote-as 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!--- R1 commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 1 vrf a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 1.1.1.17
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 17.1.1.1 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> address-family ipv4 vrf b
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 18.1.1.8 remote-as 300
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>验证：&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">show ip os nei
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">show ip route ospf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">show ip route vrf a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">show ip route vrf b
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sh ip b summary
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;h4 id="配置-pe-上-双向重分布">配置 PE 上 双向重分布
&lt;/h4>&lt;p>以 R1 为例，只需在 VRF a&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">!--- R1 commands.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 只需在 vrf a 和 BGP ipv4 vrf a 视图下配置重分布
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># R8 - R1 之间运行的是 BGP ，在 BGP ipv4 vrf b 视图下建立邻居即可
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 1 vrf a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> redistribute bgp 100 subnets
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> address-family ipv4 vrf a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> redistribute ospf 1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;h4 id="优化isp-内部-ospf-下一跳">优化ISP 内部 OSPF 下一跳
&lt;/h4>&lt;p>查看 R1 路由表发现，去往 9.9.9.9 下一跳是 6.6.6.6&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>&lt;span class="c1">#sh ip b vpnv4 vrf a &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">BGP&lt;/span> &lt;span class="n">table&lt;/span> &lt;span class="n">version&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="mi">166&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">local&lt;/span> &lt;span class="n">router&lt;/span> &lt;span class="n">ID&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Status&lt;/span> &lt;span class="n">codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">s&lt;/span> &lt;span class="n">suppressed&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">d&lt;/span> &lt;span class="n">damped&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">h&lt;/span> &lt;span class="n">history&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">valid&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">best&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">internal&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">r&lt;/span> &lt;span class="n">RIB&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">failure&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">S&lt;/span> &lt;span class="n">Stale&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">m&lt;/span> &lt;span class="n">multipath&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">b&lt;/span> &lt;span class="n">backup&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">f&lt;/span> &lt;span class="n">RT&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">Filter&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="n">best&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">external&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">additional&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="n">RIB&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">compressed&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Origin&lt;/span> &lt;span class="n">codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">IGP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">e&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">EGP&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="err">?&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="n">incomplete&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">RPKI&lt;/span> &lt;span class="n">validation&lt;/span> &lt;span class="n">codes&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">V&lt;/span> &lt;span class="n">valid&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">I&lt;/span> &lt;span class="n">invalid&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">N&lt;/span> &lt;span class="n">Not&lt;/span> &lt;span class="n">found&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Network&lt;/span> &lt;span class="n">Next&lt;/span> &lt;span class="n">Hop&lt;/span> &lt;span class="n">Metric&lt;/span> &lt;span class="n">LocPrf&lt;/span> &lt;span class="n">Weight&lt;/span> &lt;span class="ne">Path&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Route&lt;/span> &lt;span class="n">Distinguisher&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">7&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">100&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">default&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&amp;gt;&lt;/span> &lt;span class="mf">7.7&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">7.7&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="mf">17.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.7&lt;/span> &lt;span class="mi">11&lt;/span> &lt;span class="mi">32768&lt;/span> &lt;span class="err">?&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&amp;gt;&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="mf">9.9&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">9.9&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="mf">6.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">100&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">200&lt;/span> &lt;span class="err">?&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&amp;gt;&lt;/span> &lt;span class="mf">17.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">32768&lt;/span> &lt;span class="err">?&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">*&amp;gt;&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="mf">69.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="mf">6.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">100&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">200&lt;/span> &lt;span class="err">?&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>&lt;span class="c1">#sh ip route vrf a | b Gate&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Gateway&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">last&lt;/span> &lt;span class="n">resort&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">7.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">O&lt;/span> &lt;span class="mf">7.7&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">7.7&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">110&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">11&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">17.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.7&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">04&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">21&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">39&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">9.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">9.9&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">9.9&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">200&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">6.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">03&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">42&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">17.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">8&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">variably&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">subnets&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">masks&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">C&lt;/span> &lt;span class="mf">17.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">directly&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">L&lt;/span> &lt;span class="mf">17.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">directly&lt;/span> &lt;span class="n">connected&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="mf">69.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">subnetted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">subnets&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">B&lt;/span> &lt;span class="mf">69.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mi">200&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="n">via&lt;/span> &lt;span class="mf">6.6&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">6.6&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">03&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">42&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>再查找，去往 6.6.6.6 前缀有两条路径，管理和开销都一致，负载均衡？&lt;/p>
&lt;p>这条路由是 R3 BGP 重分布进底层 IGP OSPF 而学习到的，有两条路径，管理距离110，metric 1 ，这时候需要比较forwarding metric，很不巧的是forwarding metric 也是一样，这样去往 6.6.6.6 就真负载均衡。forwarding metric 是本地到 ASBR 的 开销，修改 R11 e0/1-3 的开销。同理也需要修改 R12 的接口开销。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">O E2 12.12.12.12/32 [110/1] via 111.1.1.11, 01:37:27, Ethernet0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [110/1] via 12.1.1.2, 03:15:27, Ethernet0/0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1#sh ip route | b Gate
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Gateway of last resort is not set
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1.0.0.0/32 is subnetted, 1 subnets
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">C 1.1.1.1 is directly connected, Loopback0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2.0.0.0/32 is subnetted, 1 subnets
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">O 2.2.2.2 [110/11] via 12.1.1.2, 04:26:59, Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3.0.0.0/32 is subnetted, 1 subnets
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">O 3.3.3.3 [110/21] via 111.1.1.11, 01:37:27, Ethernet0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [110/21] via 12.1.1.2, 04:26:49, Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 6.0.0.0/32 is subnetted, 1 subnets
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">O E2 6.6.6.6 [110/1] via 111.1.1.11, 01:37:27, Ethernet0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> [110/1] via 12.1.1.2, 03:15:27, Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#sh ip route 6.6.6.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Routing entry for 6.6.6.6/32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Known via &amp;#34;ospf 100&amp;#34;, distance 110, metric 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tag 200, type extern 2, forward metric 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Last update from 12.1.1.2 on Ethernet0/0, 00:00:51 ago
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Routing Descriptor Blocks:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * 111.1.1.11, from 3.3.3.3, 00:31:15 ago, via Ethernet0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Route metric is 1, traffic share count is 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Route tag 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 12.1.1.2, from 3.3.3.3, 00:00:51 ago, via Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Route metric is 1, traffic share count is 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Route tag 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 修改 R11 R12 的接口开销
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R11(config)#int ran e 0/1-/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R11(config-if-range)#ip ospf cost 1000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R12(config-if)#int ran e 0/1-0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R12(config-if-range)#ip ospf cost 1000
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 修改 R11 R12 的接口开销后
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#sh ip route 6.6.6.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Routing entry for 6.6.6.6/32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Known via &amp;#34;ospf 100&amp;#34;, distance 110, metric 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tag 200, type extern 2, forward metric 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Last update from 12.1.1.2 on Ethernet0/0, 00:08:51 ago
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Routing Descriptor Blocks:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * 12.1.1.2, from 3.3.3.3, 00:08:51 ago, via Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Route metric is 1, traffic share count is 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Route tag 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R6#sh ip rou 1.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Routing entry for 1.1.1.1/32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Known via &amp;#34;ospf 200&amp;#34;, distance 110, metric 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Tag 100, type extern 2, forward metric 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Last update from 56.1.1.5 on Ethernet0/0, 00:02:30 ago
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Routing Descriptor Blocks:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * 56.1.1.5, from 4.4.4.4, 00:39:02 ago, via Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Route metric is 1, traffic share count is 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Route tag 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R6#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="测试">测试
&lt;/h3>&lt;p>&lt;strong>R7 和 R9 之间的 ping 操作&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R7#ping 9.9.9.9 source 7.7.7.7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte ICMP Echos to 9.9.9.9, timeout is 2 seconds:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Packet sent with a source address of 7.7.7.7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 8/8/11 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R7#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R9#ping 7.7.7.7 source 9.9.9.9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte ICMP Echos to 7.7.7.7, timeout is 2 seconds:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Packet sent with a source address of 9.9.9.9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 8/8/10 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R9#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>R8 和 R10 之间的 ping 操作&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R8#ping 10.10.10.10 source 8.8.8.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte ICMP Echos to 10.10.10.10, timeout is 2 seconds:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Packet sent with a source address of 8.8.8.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 8/9/13 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R8#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R10#ping 8.8.8.8 source 10.10.10.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sending 5, 100-byte ICMP Echos to 8.8.8.8, timeout is 2 seconds:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Packet sent with a source address of 10.10.10.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!!!!!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Success rate is 100 percent (5/5), round-trip min/avg/max = 8/9/10 ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R10#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>R7 和 R9 之间的 Traceroute 操作&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R7#traceroute 9.9.9.9 source 7.7.7.7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Tracing the route to 9.9.9.9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">VRF info: (vrf in name/id, vrf out name/id)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 17.1.1.1 1 msec 1 msec 2 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2 12.1.1.2 [MPLS: Labels 24/26 Exp 0] 8 msec 8 msec 8 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3 23.1.1.3 [MPLS: Labels 26/26 Exp 0] 8 msec 12 msec 7 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 4 34.1.1.4 [MPLS: Labels 27/26 Exp 0] 8 msec 9 msec 8 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 5 45.1.1.5 [MPLS: Labels 22/26 Exp 0] 9 msec 8 msec 8 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 6 69.1.1.6 [MPLS: Label 26 Exp 0] 9 msec 7 msec 9 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 7 69.1.1.9 9 msec * 9 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R7#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R9#traceroute 7.7.7.7 source 9.9.9.9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Tracing the route to 7.7.7.7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">VRF info: (vrf in name/id, vrf out name/id)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 69.1.1.6 2 msec 39 msec 2 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2 56.1.1.5 [MPLS: Labels 25/26 Exp 0] 10 msec 9 msec 9 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3 45.1.1.4 [MPLS: Labels 23/26 Exp 0] 12 msec 9 msec 9 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 4 34.1.1.3 [MPLS: Labels 21/26 Exp 0] 10 msec 8 msec 10 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 5 23.1.1.2 [MPLS: Labels 19/26 Exp 0] 9 msec 10 msec 11 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 6 17.1.1.1 [MPLS: Label 26 Exp 0] 7 msec 18 msec 9 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 7 17.1.1.7 8 msec * 8 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R9#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>R8 和 R10 之间的 Traceroute 操作&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R8#traceroute 10.10.10.10 source 8.8.8.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Tracing the route to 10.10.10.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">VRF info: (vrf in name/id, vrf out name/id)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 18.1.1.1 2 msec 1 msec 1 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2 12.1.1.2 [MPLS: Labels 24/28 Exp 0] 8 msec 9 msec 9 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3 23.1.1.3 [MPLS: Labels 26/28 Exp 0] 9 msec 9 msec 9 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 4 34.1.1.4 [MPLS: Labels 27/28 Exp 0] 10 msec 8 msec 10 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 5 45.1.1.5 [MPLS: Labels 22/28 Exp 0] 7 msec 9 msec 8 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 6 106.1.1.6 [MPLS: Label 28 Exp 0] 8 msec 7 msec 9 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 7 106.1.1.10 8 msec * 10 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R8#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R10#traceroute 8.8.8.8 source 10.10.10.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Type escape sequence to abort.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Tracing the route to 8.8.8.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">VRF info: (vrf in name/id, vrf out name/id)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 106.1.1.6 1 msec 2 msec 1 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2 56.1.1.5 [MPLS: Labels 25/28 Exp 0] 8 msec 8 msec 11 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3 45.1.1.4 [MPLS: Labels 23/28 Exp 0] 8 msec 28 msec 8 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 4 34.1.1.3 [MPLS: Labels 21/28 Exp 0] 8 msec 11 msec 8 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 5 23.1.1.2 [MPLS: Labels 19/28 Exp 0] 9 msec 8 msec 10 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 6 18.1.1.1 [MPLS: Label 28 Exp 0] 16 msec 6 msec 7 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 7 18.1.1.8 9 msec * 10 msec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R10#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="一个视频">一个视频
&lt;/h2>
&lt;div class="video-wrapper">
&lt;iframe src="https://player.bilibili.com/player.html?as_wide=1&amp;amp;high_quality=1&amp;amp;page=1&amp;bvid=BV1Lv4y1a7tG"
scrolling="no"
frameborder="no"
framespacing="0"
allowfullscreen="true"
>
&lt;/iframe>
&lt;/div>
&lt;h2 id="最后">最后
&lt;/h2>&lt;ul>
&lt;li>文中可能有些配置未提及或内容术语表述的不规范，请见谅。&lt;/li>
&lt;li>配置存阿里云盘了，这是链接：[&lt;a class="link" href="https://www.aliyundrive.com/s/HueqNEaKSAx" target="_blank" rel="noopener"
>分享的文件
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>]&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨。&lt;/li>
&lt;/ul></description></item><item><title>Ubuntu Server 22.04 安装 Gitlab-ce</title><link>https://weeaster.github.io/posts/ed7bc2e7/</link><pubDate>Thu, 23 Feb 2023 12:11:20 +0000</pubDate><guid>https://weeaster.github.io/posts/ed7bc2e7/</guid><description>&lt;p>本文记录&lt;code>VMware Workstation&lt;/code> 环境下&lt;code>Ubuntu server 22.04&lt;/code>系统安装&lt;code>gitlab-ce_15.8.3&lt;/code>的过程。&lt;/p>
&lt;h2 id="准备环境">准备环境
&lt;/h2>&lt;ul>
&lt;li>一台安装好 &lt;code>ubuntu server&lt;/code>的虚拟机&lt;/li>
&lt;li>ubuntu可联网&lt;/li>
&lt;li>SecureCRT软件（或其它带SSH登陆功能的工具）&lt;/li>
&lt;/ul>
&lt;h2 id="更新软件包信息和安装软件">更新软件包信息和安装软件
&lt;/h2>&lt;p>首先设置好国内更新源，在安装&lt;code>Ubuntu&lt;/code>的时候我已经填写了阿里云的站点（mirrors.aliyun.com/ubuntu），如果你没有修改这一项，登陆服务器后修改 &lt;code>/etc/apt/sources.list&lt;/code>即可&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo apt-get update
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>安装或更新以下软件&lt;/strong>（虽然安装&lt;code>Ubuntu&lt;/code>的时候勾选了&lt;code>Openssh&lt;/code>但是不是最新版本，提示升级）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> sudo apt-get install curl openssh-server ca-certificates postfix
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>命令回显&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">kir&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="nx">gitlabserver&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nx">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nx">apt&lt;/span>&lt;span class="err">$&lt;/span> &lt;span class="nx">sudo&lt;/span> &lt;span class="nx">apt&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">get&lt;/span> &lt;span class="nx">install&lt;/span> &lt;span class="nx">curl&lt;/span> &lt;span class="nx">openssh&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">server&lt;/span> &lt;span class="nx">ca&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">certificates&lt;/span> &lt;span class="nx">postfix&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Reading&lt;/span> &lt;span class="kn">package&lt;/span> &lt;span class="nx">lists&lt;/span>&lt;span class="o">...&lt;/span> &lt;span class="nx">Done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Building&lt;/span> &lt;span class="nx">dependency&lt;/span> &lt;span class="nx">tree&lt;/span>&lt;span class="o">...&lt;/span> &lt;span class="nx">Done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Reading&lt;/span> &lt;span class="nx">state&lt;/span> &lt;span class="nx">information&lt;/span>&lt;span class="o">...&lt;/span> &lt;span class="nx">Done&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">The&lt;/span> &lt;span class="nx">following&lt;/span> &lt;span class="nx">additional&lt;/span> &lt;span class="nx">packages&lt;/span> &lt;span class="nx">will&lt;/span> &lt;span class="nx">be&lt;/span> &lt;span class="nx">installed&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">libcurl4&lt;/span> &lt;span class="nx">openssh&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">client&lt;/span> &lt;span class="nx">openssh&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">sftp&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">server&lt;/span> &lt;span class="nx">ssl&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">cert&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Suggested&lt;/span> &lt;span class="nx">packages&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">keychain&lt;/span> &lt;span class="nx">libpam&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">ssh&lt;/span> &lt;span class="nx">monkeysphere&lt;/span> &lt;span class="nx">ssh&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">askpass&lt;/span> &lt;span class="nx">molly&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">guard&lt;/span> &lt;span class="nx">procmail&lt;/span> &lt;span class="nx">postfix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">mysql&lt;/span> &lt;span class="nx">postfix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">pgsql&lt;/span> &lt;span class="nx">postfix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">ldap&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">postfix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">pcre&lt;/span> &lt;span class="nx">postfix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">lmdb&lt;/span> &lt;span class="nx">postfix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">sqlite&lt;/span> &lt;span class="nx">sasl2&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">bin&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="nx">dovecot&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">common&lt;/span> &lt;span class="nx">resolvconf&lt;/span> &lt;span class="nx">postfix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">cdb&lt;/span> &lt;span class="nx">mail&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">reader&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">postfix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">mta&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">sts&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">resolver&lt;/span> &lt;span class="nx">postfix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">doc&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">The&lt;/span> &lt;span class="nx">following&lt;/span> &lt;span class="nx">NEW&lt;/span> &lt;span class="nx">packages&lt;/span> &lt;span class="nx">will&lt;/span> &lt;span class="nx">be&lt;/span> &lt;span class="nx">installed&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">postfix&lt;/span> &lt;span class="nx">ssl&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">cert&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">The&lt;/span> &lt;span class="nx">following&lt;/span> &lt;span class="nx">packages&lt;/span> &lt;span class="nx">will&lt;/span> &lt;span class="nx">be&lt;/span> &lt;span class="nx">upgraded&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">ca&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">certificates&lt;/span> &lt;span class="nx">curl&lt;/span> &lt;span class="nx">libcurl4&lt;/span> &lt;span class="nx">openssh&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">client&lt;/span> &lt;span class="nx">openssh&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">server&lt;/span> &lt;span class="nx">openssh&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">sftp&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">server&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">6&lt;/span> &lt;span class="nx">upgraded&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="nx">newly&lt;/span> &lt;span class="nx">installed&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="nx">to&lt;/span> &lt;span class="nx">remove&lt;/span> &lt;span class="nx">and&lt;/span> &lt;span class="mi">181&lt;/span> &lt;span class="nx">not&lt;/span> &lt;span class="nx">upgraded&lt;/span>&lt;span class="p">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Need&lt;/span> &lt;span class="nx">to&lt;/span> &lt;span class="nx">get&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">271&lt;/span> &lt;span class="nx">kB&lt;/span> &lt;span class="nx">of&lt;/span> &lt;span class="nx">archives&lt;/span>&lt;span class="p">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">After&lt;/span> &lt;span class="nx">this&lt;/span> &lt;span class="nx">operation&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">243&lt;/span> &lt;span class="nx">kB&lt;/span> &lt;span class="nx">of&lt;/span> &lt;span class="nx">additional&lt;/span> &lt;span class="nx">disk&lt;/span> &lt;span class="nx">space&lt;/span> &lt;span class="nx">will&lt;/span> &lt;span class="nx">be&lt;/span> &lt;span class="nx">used&lt;/span>&lt;span class="p">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Do&lt;/span> &lt;span class="nx">you&lt;/span> &lt;span class="nx">want&lt;/span> &lt;span class="nx">to&lt;/span> &lt;span class="k">continue&lt;/span>&lt;span class="err">?&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="nx">Y&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nx">n&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="nx">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Get&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="nx">http&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="c1">//mirrors.aliyun.com/ubuntu jammy-updates/main amd64 openssh-sftp-server amd64 1:8.9p1-3ubuntu0.1 [38.7 kB]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">Get&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="nx">http&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="c1">//mirrors.aliyun.com/ubuntu jammy-updates/main amd64 openssh-server amd64 1:8.9p1-3ubuntu0.1 [434 kB]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">Get&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">3&lt;/span> &lt;span class="nx">http&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="c1">//mirrors.aliyun.com/ubuntu jammy-updates/main amd64 openssh-client amd64 1:8.9p1-3ubuntu0.1 [908 kB]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="err">……&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">……&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">……&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>postfix 软件安装后会弹出一个&amp;quot;Postfix Configuration&amp;quot;向导，直接选&lt;code>No configuration&lt;/code>不进行配置（本地环境不实用）&lt;/p>
&lt;h2 id="下载和安装gitlab-ce_1583">下载和安装gitlab-ce_15.8.3
&lt;/h2>&lt;p>这个看各自网络的网速，官网下载（&lt;a class="link" href="https://packages.gitlab.com/gitlab/gitlab-ce/packages/ubuntu/jammy/gitlab-ce_15.8.3-ce.0_amd64.deb" target="_blank" rel="noopener"
>ubuntu/jammy/gitlab-ce_15.8.3-ce.0_amd64.deb - gitlab/gitlab-ce · packages.gitlab.com
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>）&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/02/23/tThZFerj2pGD1i5.jpg">
&lt;img src="https://s2.loli.net/2023/02/23/tThZFerj2pGD1i5.jpg"
loading="lazy"
alt="ScreenCaputure230223130323"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>清华镜像站下载（&lt;a class="link" href="https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/ubuntu/pool/jammy/main/g/gitlab-ce/" target="_blank" rel="noopener"
>Index of /gitlab-ce/ubuntu/pool/jammy/main/g/gitlab-ce/ | 清华大学开源软件镜像站 | Tsinghua Open Source Mirror
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>）&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/02/23/LpATQmUwvO89XCF.jpg">
&lt;img src="https://s2.loli.net/2023/02/23/LpATQmUwvO89XCF.jpg"
loading="lazy"
alt="ScreenCaputure230223130553"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>下载完成后，校验一下MD5值，对比官网提供的校验信息&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">kir@gitlabserver:~$ sudo md5sum gitlab-ce_15.8.3-ce.0_amd64.deb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">feaecd81f1b2a39600114c873b1b9085 gitlab-ce_15.8.3-ce.0_amd64.deb
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>命令回显&lt;/strong>：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">kir&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="n">gitlabserver&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">~&lt;/span>&lt;span class="err">$&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sudo&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">dpkg&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gitlab&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ce_15&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ce&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="n">_amd64&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">deb&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Selecting&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">previously&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">unselected&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">package&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gitlab&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ce&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Reading&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">database&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">...&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">73398&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">files&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">and&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">directories&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">currently&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">installed&lt;/span>&lt;span class="p">.)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Preparing&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">to&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">unpack&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gitlab&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ce_15&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ce&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="n">_amd64&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">deb&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Unpacking&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gitlab&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nf">ce&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">15&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ce&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Setting&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">up&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gitlab&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nf">ce&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">15&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ce&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">...&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">It&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">looks&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">like&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">GitLab&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">has&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">not&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">been&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">configured&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">yet&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">skipping&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">the&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">upgrade&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">script&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">***&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">***&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">*****&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*****&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="o">******&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">*******&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">********&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">********&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">,,,,,,,,,&lt;/span>&lt;span class="o">***********&lt;/span>&lt;span class="p">,,,,,,,,,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">,,,,,,,,,,,&lt;/span>&lt;span class="o">*********&lt;/span>&lt;span class="p">,,,,,,,,,,,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.,,,,,,,,,,,&lt;/span>&lt;span class="o">*******&lt;/span>&lt;span class="p">,,,,,,,,,,,,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">,,,,,,,,,&lt;/span>&lt;span class="o">*****&lt;/span>&lt;span class="p">,,,,,,,,,.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">,,,,,,,&lt;/span>&lt;span class="o">****&lt;/span>&lt;span class="p">,,,,,,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">.,,,&lt;/span>&lt;span class="o">***&lt;/span>&lt;span class="p">,,,,&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="p">,.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">_______&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">__&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">__&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">__&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">____&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">____&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">__&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">__&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">__&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">`/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">__&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">\&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">___&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="err">\&lt;/span>&lt;span class="n">____&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="err">\&lt;/span>&lt;span class="n">__&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">_____&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="err">\&lt;/span>&lt;span class="n">__&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">___&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Thank&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">you&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">installing&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">GitLab&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">GitLab&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">was&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">unable&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">to&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">detect&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">valid&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">hostname&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">your&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">instance&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Please&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">configure&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">URL&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">your&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">GitLab&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">instance&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">setting&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="n">external_url&lt;/span>&lt;span class="o">`&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">configuration&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">etc&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">gitlab&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">gitlab&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">rb&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">Then&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">you&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">can&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">start&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">your&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">GitLab&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">instance&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">by&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">running&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">the&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">following&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sudo&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">gitlab&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ctl&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">reconfigure&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="k">For&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">comprehensive&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">list&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">of&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">configuration&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">options&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">please&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">see&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">the&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Omnibus&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">GitLab&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">readme&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">gitlab&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">gitlab&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">org&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">omnibus&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">gitlab&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="kt">blob&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">master&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">README&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">md&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">Help&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">us&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">improve&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">the&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">installation&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">experience&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">let&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">us&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">know&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">how&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">we&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">did&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">with&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">a&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">minute&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">survey&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">https&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">gitlab&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">fra1&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">qualtrics&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">com&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">jfe&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">form&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">SV_6kVqZANThUQ1bZb&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="n">installation&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">omnibus&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="k">release&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">15&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="修改外部url和reconfigure">修改外部url和reconfigure
&lt;/h2>&lt;ol>
&lt;li>修改&lt;code>/etc/gitlab/&lt;/code>下的&lt;code>gitlab.rb&lt;/code>文件，external_url直接修改为&lt;code>ubuntu系统&lt;/code>的的&lt;code>IP&lt;/code>地址，如果 80 端口有冲突可在后边加上端口号&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">external_url &amp;#39;http://192.168.x.x&amp;#39;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">kir@gitlabserver:~$ cd /etc/gitlab
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@gitlabserver:/etc/gitlab$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total 148
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x 2 root root 4096 Feb 23 03:49 ./
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x 102 root root 4096 Feb 23 03:49 ../
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw------- 1 root root 140235 Feb 23 03:49 gitlab.rb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@gitlabserver:/etc/gitlab$ sudo cp gitlab.rb gitlab.rb_bak
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@gitlabserver:/etc/gitlab$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total 288
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x 2 root root 4096 Feb 23 03:50 ./
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x 102 root root 4096 Feb 23 03:49 ../
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw------- 1 root root 140235 Feb 23 03:49 gitlab.rb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw------- 1 root root 140235 Feb 23 03:50 gitlab.rb_bak
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@gitlabserver:/etc/gitlab$ sudo nano gitlab.rb
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>&lt;strong>重配置&lt;/strong>（这一步骤耗时较长）&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">kir@gitlabserver:/opt/gitlab/bin$ sudo gitlab-ctl reconfigure
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[2023-02-23T03:52:56+00:00] INFO: Started Cinc Zero at chefzero://localhost:1 with repository at /opt/gitlab/embedded (One version per cookbook)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Cinc Client, version 17.10.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Patents: https://www.chef.io/patents
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Infra Phase starting
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[2023-02-23T03:52:57+00:00] INFO: *** Cinc Client 17.10.0 ***
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[2023-02-23T03:52:57+00:00] INFO: Platform: x86_64-linux
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[2023-02-23T03:52:57+00:00] INFO: Cinc-client pid: 18551
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[2023-02-23T03:52:58+00:00] INFO: Setting the run_list to [&amp;#34;recipe[gitlab]&amp;#34;] from CLI options
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[2023-02-23T03:52:58+00:00] INFO: Run List is [recipe[gitlab]]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[2023-02-23T03:52:58+00:00] INFO: Run List expands to [gitlab]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[2023-02-23T03:52:58+00:00] INFO: Starting Cinc Client Run for gitlabserver
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[2023-02-23T03:52:58+00:00] INFO: Running start handlers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[2023-02-23T03:52:58+00:00] INFO: Start handlers complete.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Resolving cookbooks for run list: [&amp;#34;gitlab&amp;#34;]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Notes:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Default admin account has been configured with following details:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Username: root
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password: You didn&amp;#39;t opt-in to print initial root password to STDOUT.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password stored to /etc/gitlab/initial_root_password. This file will be cleaned up in first reconfigure run after 24 hours.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NOTE: Because these credentials might be present in your log files in plain text, it is highly recommended to reset the password following https://docs.gitlab.com/ee/security/reset_user_password.html#reset-your-root-password.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gitlab Reconfigured!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>&lt;strong>重启gitlab&lt;/strong>&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">kir&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="n">gitlabserver&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">opt&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">gitlab&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">bin&lt;/span>&lt;span class="o">$&lt;/span> &lt;span class="n">sudo&lt;/span> &lt;span class="n">gitlab&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">ctl&lt;/span> &lt;span class="n">restart&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ok&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">alertmanager&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">pid&lt;/span> &lt;span class="mi">21046&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ok&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">gitaly&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">pid&lt;/span> &lt;span class="mi">21058&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ok&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">gitlab&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">exporter&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">pid&lt;/span> &lt;span class="mi">21077&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ok&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">gitlab&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">kas&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">pid&lt;/span> &lt;span class="mi">21085&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ok&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">gitlab&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">workhorse&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">pid&lt;/span> &lt;span class="mi">21095&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ok&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">logrotate&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">pid&lt;/span> &lt;span class="mi">21107&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ok&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">nginx&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">pid&lt;/span> &lt;span class="mi">21115&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ok&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">node&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">exporter&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">pid&lt;/span> &lt;span class="mi">21123&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ok&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">postgres&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">exporter&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">pid&lt;/span> &lt;span class="mi">21129&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ok&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">postgresql&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">pid&lt;/span> &lt;span class="mi">21144&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ok&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">prometheus&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">pid&lt;/span> &lt;span class="mi">21153&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ok&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">puma&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">pid&lt;/span> &lt;span class="mi">21166&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ok&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">redis&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">pid&lt;/span> &lt;span class="mi">21171&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ok&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">redis&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">exporter&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">pid&lt;/span> &lt;span class="mi">21177&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ok&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">run&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">sidekiq&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">pid&lt;/span> &lt;span class="mi">21260&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="n">s&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="修改-root-密码">&lt;strong>修改 root 密码&lt;/strong>
&lt;/h2>&lt;p>根据&lt;code>重配置&lt;/code>步骤后的提示&lt;code>Password stored to /etc/gitlab/initial_root_password. This file will be cleaned up in first reconfigure run after 24 hours.&lt;/code>，root的初始密码储存在&lt;code>initial_root_password&lt;/code>，文件在第一次reconfigure 24小时后清除。&lt;/p>
&lt;ol>
&lt;li>使用&lt;code>initial_root_password&lt;/code>文件里的密码 web登陆，&amp;ldquo;Edit profile&amp;rdquo;&amp;ndash;&amp;ldquo;Panssword&amp;quot;修改&lt;/li>
&lt;/ol>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/02/23/ucU9k3tOLToKnsi.jpg">
&lt;img src="https://s2.loli.net/2023/02/23/ucU9k3tOLToKnsi.jpg"
loading="lazy"
alt="ScreenCaputure230223133138"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ol start="2">
&lt;li>使用命令修改&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">kir@gitlabserver:/etc/gitlab$ sudo gitlab-rake &amp;#34;gitlab:password:reset[root]&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enter password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Confirm password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password successfully updated for user with username root.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@gitlabserver:/etc/gitlab$
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>控制台修改&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">切换路径
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cd /opt/gitlab/bin/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@gitlabserver:/opt/gitlab/bin$ sudo gitlab-rails console -e production
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Ruby: ruby 2.7.7p221 (2022-11-24 revision 168ec2b1e5) [x86_64-linux]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> GitLab: 15.8.3 (22f43167474) FOSS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> GitLab Shell: 14.15.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PostgreSQL: 13.8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">------------------------------------------------------------[ booted in 90.93s ]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Loading production environment (Rails 6.1.6.1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">irb(main):001:0&amp;gt; u=User.where(id:1).first
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">irb(main):001:0&amp;gt; u=User.where(id:1).first
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">=&amp;gt; #&amp;lt;User id:1 @root&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">irb(main):002:0&amp;gt; u.password=12345678
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">=&amp;gt; 12345678
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">irb(main):003:0&amp;gt; u.password_confirmation=12345678
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">=&amp;gt; 12345678
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">irb(main):004:0&amp;gt; u.save!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">=&amp;gt; true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">irb(main):005:0&amp;gt; quit
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="注册和登陆gitlab">注册和登陆Gitlab
&lt;/h2>&lt;p>在启动gitlab后，直接用浏览器登陆可能出现下图所示502错误，等一会儿再打开就ok了，猜测是服务没有完全运行起来，也有可能是我物理机配置差劲。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/02/23/XNk16rxecUfpKEG.jpg">
&lt;img src="https://s2.loli.net/2023/02/23/XNk16rxecUfpKEG.jpg"
loading="lazy"
alt="ScreenCaputure230223121024"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ol>
&lt;li>注册，由于是本地使用，之前也没配置邮件Postfix，填上舒服的信息即可&lt;/li>
&lt;/ol>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/02/23/6VkKojL49PCDX2z.jpg">
&lt;img src="https://s2.loli.net/2023/02/23/6VkKojL49PCDX2z.jpg"
loading="lazy"
alt="ScreenCaputure230223121304"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ol start="2">
&lt;li>注册完后登陆出错，看提示是账号被挂起，使用root管理员账户登陆进行审批通过即可&lt;/li>
&lt;/ol>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/02/23/ealpAjghxZ2d3w4.jpg">
&lt;img src="https://s2.loli.net/2023/02/23/ealpAjghxZ2d3w4.jpg"
loading="lazy"
alt="ScreenCaputure230223122038"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ol start="3">
&lt;li>登陆管理员账户进行审批通过&lt;/li>
&lt;/ol>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/02/23/eKQHUtWXu8CjYwz.jpg">
&lt;img src="https://s2.loli.net/2023/02/23/eKQHUtWXu8CjYwz.jpg"
loading="lazy"
alt="ScreenCaputure230223123908"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/02/23/Xm7auVMRgS6Exvj.jpg">
&lt;img src="https://s2.loli.net/2023/02/23/Xm7auVMRgS6Exvj.jpg"
loading="lazy"
alt="ScreenCaputure230223123923"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/02/23/C5UvfrQnHxSL9Yw.jpg">
&lt;img src="https://s2.loli.net/2023/02/23/C5UvfrQnHxSL9Yw.jpg"
loading="lazy"
alt="ScreenCaputure230223123957"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/02/23/Drnp8B4sWuemOfo.jpg">
&lt;img src="https://s2.loli.net/2023/02/23/Drnp8B4sWuemOfo.jpg"
loading="lazy"
alt="ScreenCaputure230223124009"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/02/23/K1C9nwf5TdPARBi.jpg">
&lt;img src="https://s2.loli.net/2023/02/23/K1C9nwf5TdPARBi.jpg"
loading="lazy"
alt="ScreenCaputure230223124018"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ol start="4">
&lt;li>退出管理员登陆，使用刚才注册的账号登陆，确认后，选择一个角色&lt;/li>
&lt;/ol>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/02/23/jqkSmRvPwy7BQlh.jpg">
&lt;img src="https://s2.loli.net/2023/02/23/jqkSmRvPwy7BQlh.jpg"
loading="lazy"
alt="ScreenCaputure230223124141"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2023/02/23/6S8RON2sDP147fn.jpg">
&lt;img src="https://s2.loli.net/2023/02/23/6S8RON2sDP147fn.jpg"
loading="lazy"
alt="ScreenCaputure230223124150"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="最后">最后
&lt;/h2>&lt;ul>
&lt;li>为什么写这篇文，因为我的一块硬盘报废了，整块硬盘直接奔溃，各种尝试后放弃了，因为这块500G的硬盘是大学时候台式电脑的，间接原因是使用时间和寿命，直接原因是电脑死机强制关机。&lt;/li>
&lt;li>然后京东购了一块固态盘，一看价格现在同容量的固态硬盘比机械硬盘还便宜了。都说固态硬盘一坏文件全扑街，机械硬盘还有抢救的机会，这个只能靠自己掌控了，临近使用寿命或电脑出现异常就要考虑换硬盘了，最好的方法是做备份。&lt;/li>
&lt;li>虽然这块盘报废了，也丢失了一些文件，但是由于我把重要的文件都做有备份，但是像这种虚拟机的环境一般都不留备份（文件太大太多）。&lt;/li>
&lt;li>得益于硬盘报废，实操了一把前面文章写的&lt;a class="link" href="https://kiraster.github.io/posts/310ece77.html" target="_blank" rel="noopener"
>自动备份Hexo源文件到私有仓库
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>和&lt;a class="link" href="https://kiraster.github.io/posts/567e6fc3.html" target="_blank" rel="noopener"
>Hexo环境新电脑环境重构
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>，博客源文件回来了。&lt;/li>
&lt;li>&lt;strong>备份很重要-备份很重要-备份很重要&lt;/strong>&lt;/li>
&lt;/ul></description></item><item><title>Hexo环境新电脑环境重构</title><link>https://weeaster.github.io/posts/567e6fc3/</link><pubDate>Wed, 07 Dec 2022 15:05:53 +0000</pubDate><guid>https://weeaster.github.io/posts/567e6fc3/</guid><description>&lt;p>在上上篇博文中描述了如何将博客源文件推送到&lt;code>GitHub&lt;/code>私有仓库备份，这篇文将讲述如何从&lt;code>GitHub&lt;/code>私有仓库clone至本地重构 Hexo 环境来写博客&lt;/p>
&lt;p>网上也有很多文章描述如何操作，也可以去参考，我记录我的操作过程如下&lt;/p>
&lt;h2 id="下载安装git-和-nodejs">下载安装Git 和 node.js
&lt;/h2>&lt;ul>
&lt;li>去官网下载软件包&lt;a class="link" href="https://www.git-scm.com/" target="_blank" rel="noopener"
>Git (git-scm.com)
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>，&lt;a class="link" href="https://nodejs.org/zh-cn/download/releases/" target="_blank" rel="noopener"
>以往的版本 | Node.js (nodejs.org)
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/li>
&lt;li>Git 版本可安装最新的或保持和原环境一致版本&lt;/li>
&lt;li>Hexo 版本和原环境的保持一致（npm安装@指定版本号：npm install -g &lt;a class="link" href="mailto:hexo-cli@4.x.x" >hexo-cli@4.x.x
&lt;/a>）&lt;/li>
&lt;li>node.js 版本保持和原环境一致，因为 Hexo 版本 对 node.js 版本有要求&lt;/li>
&lt;li>安装过程基本点“下一步”，注意环境变量的“Add to PATH”勾上&lt;/li>
&lt;/ul>
&lt;h2 id="克隆私有仓库至本地">克隆私有仓库至本地
&lt;/h2>&lt;h3 id="添加本地-git-配置">添加本地 Git 配置
&lt;/h3>&lt;p>**注意：**因为是私有仓库，克隆需要验证权限，安装完成 Git 后先配置用户、邮箱、ssh keys&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">我使用的全局配置用户，对于同时推送代码到不同网站的，请按照多用户多仓库的方法配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git config --global user.name &amp;#34;xxx&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git config --global user.email &amp;#34;xxx@xxx.com&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="生成公钥添加-github-ssh-keys">生成公钥，添加 Github SSH Keys
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">生成公钥
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh-keygen -t &amp;#34;选一个官方的算法&amp;#34; -C xxx@xxx.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">然后接下来的你应该懂了，复制公钥内容--&amp;gt;&amp;gt;粘贴到Github的 SSH Keys --&amp;gt;&amp;gt; 添加
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">测试连接
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">$ ssh -T git@github.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Hi xxxx! You&amp;#39;ve successfully authenticated, but GitHub does not provide shell access.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">有上面的提示说明成功了
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="克隆私有仓库至本地-1">克隆私有仓库至本地
&lt;/h3>&lt;p>git clone 命令跟一个本地路径，克隆下来的文件就在这个目录了，不加目录克隆的话克隆下来的是包含你私有仓库名称的一个文件夹&lt;/p>
&lt;p>**注意：**命令后跟的本地路径，不要手动创建，否则会提示目录已存在，克隆失败&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">git clone git@github.com:kiraster/xxxx-xx.git &amp;#34;D:\Blog&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="安装-hexo-和-其他npm插件">安装 Hexo 和 其他npm插件
&lt;/h2>&lt;p>**注意：**重构 Hexo 环境只需以下的文件，但是其他文件也可以存在&lt;/p>
&lt;p>&lt;code>package-lock.json&lt;/code>这个文件如果执行下一步提示报错就删掉，或者直接删掉&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">_config.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">package.json
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">scaffolds/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">source/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">themes/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="安装-hexo-和-其他插件">安装 Hexo 和 其他插件
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">安装 Hexo 保持和原电脑的版本一致
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 查看版本
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hexo -v
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 安装
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">npm install -g hexo-cli@4.x.x
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 安装后查看版本
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hexo -v
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">安装npm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 修改npm 淘宝镜像
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">npm confg set http://registry.npm.taobao.org
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 查看设置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">npm config list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 安装 npm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">npm install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">若这一步报错ERROR Try running: &amp;#39;rm -rf node_modules &amp;amp;&amp;amp; npm install --force&amp;#39; 按照提示操作
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rm -rf node_modules &amp;amp;&amp;amp; npm install --force
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">npm会按照 package.json 这个文件的内容自动按照插件，你也可以记事本打开这个文件查看安装的插件
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>注意：&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>一些插件提示不再更新维护支持之类的，取决于主题使用到的插件和旧版本 Hexo 使用的插件，大家自己决定&lt;/li>
&lt;li>一些插件可能需要从 GitHub 公共仓库下载文件，保障新电脑网络环境能联网&lt;/li>
&lt;li>我的环境就是有个文件下载不来，所以去手动下载，拷贝到对应的目录&lt;/li>
&lt;li>大家可以看提示错误，按提示操作，查缺补漏，少的模块文件&lt;/li>
&lt;/ol>
&lt;h2 id="本地启动预览">本地启动预览
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">hexo clean &amp;amp;&amp;amp; hexo g &amp;amp;&amp;amp; hexo s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol>
&lt;li>观察启动过程，是否有报错信息，按提示解决对象报错，不明的可以去搜索引擎&lt;/li>
&lt;li>&lt;code> scripts/&lt;/code>下的脚本，如果新电脑和原电脑路径等不一致记得修改&lt;/li>
&lt;li>完成这一步骤，基本上就大功告成了&lt;/li>
&lt;/ol>
&lt;h2 id="推送至-github-仓库">推送至 GitHub 仓库
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">hexo clean &amp;amp;&amp;amp; hexo g &amp;amp;&amp;amp; hexo d
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>因为这一步我的环境有 自动备份源文件到 私有仓库的脚本所以要按照上上篇文章的方式操作一轮&lt;/p>
&lt;p>设置本地 Hexo 目录的 Git&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">git init
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git branch -M main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git remote add origin git@github.com:kiraster/xxxx-xx.git
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>完结。&lt;/p></description></item><item><title>Hexo 几个bat脚本</title><link>https://weeaster.github.io/posts/e1203792/</link><pubDate>Mon, 05 Dec 2022 14:53:35 +0000</pubDate><guid>https://weeaster.github.io/posts/e1203792/</guid><description>&lt;p>自己日常操作的几个脚本&lt;/p>
&lt;ul>
&lt;li>bat启动 Hexo 本地服务&lt;/li>
&lt;li>bat 推送至 Github&lt;/li>
&lt;li>自动打开markdown编辑器&lt;/li>
&lt;/ul>
&lt;h2 id="bat启动-hexo-本地服务">bat启动 Hexo 本地服务
&lt;/h2>&lt;p>前提条件：已完成博客搭建。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">@echo off
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">:: 切换至博客源文件目录
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">d:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cd D:\blog5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">:: 执行 清除缓存文件&amp;amp;&amp;amp;生成静态文件&amp;amp;&amp;amp;启用本地服务
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hexo clean &amp;amp;&amp;amp; hexo g &amp;amp;&amp;amp; hexo s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol>
&lt;li>新建后缀为bat的脚本文件&lt;/li>
&lt;li>复制以上命令粘贴（注意修改路径 ），保存&lt;/li>
&lt;li>双击此脚本运行的结果相当于在你的博客路径下右键 “Git Bash Here” 并输入 “hexo clean &amp;amp;&amp;amp; hexo g &amp;amp;&amp;amp; hexo s” 运行.&lt;!--more-->&lt;/li>
&lt;/ol>
&lt;h2 id="bat-推送至-github">bat 推送至 Github
&lt;/h2>&lt;p>前提条件：已完成博客搭建和推送 Github 的设置。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">@echo off
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">:: 切换至博客源文件目录
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">d:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cd D:\blog5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">:: 执行 清除缓存文件&amp;amp;&amp;amp;生成静态文件&amp;amp;&amp;amp;部署网站
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hexo clean &amp;amp;&amp;amp; hexo g &amp;amp;&amp;amp; hexo d
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol>
&lt;li>新建后缀为 bat 的脚本文件&lt;/li>
&lt;li>复制以上命令粘贴（注意修改路径 ），保存&lt;/li>
&lt;li>双击此脚本运行的结果相当于在你的博客路径下右键 “Git Bash Here” 并输入 “hexo clean &amp;amp;&amp;amp; hexo g ” 运行，如果只执行 “hexo clean &amp;amp;&amp;amp; hexo g &amp;amp;&amp;amp; hexo d “ ，当命令执行完后会自动关闭命令窗口，后边加”hexo s“启用本地服务保持窗口不关闭（由于还有自动推送博客源文件的步骤，我不加这个），运行完成后确认是否推送成功，Ctrl+C结束即可&lt;/li>
&lt;/ol>
&lt;h2 id="自动打开markdown编辑器">自动打开markdown编辑器
&lt;/h2>&lt;p>在执行&lt;code>hexo n xxxx&lt;/code>后自动打开 markdown 编辑器打开 md 文件，在博客目录下的&lt;code>scripts&lt;/code>目录新建&lt;code>js&lt;/code>文件（我使用的是&lt;code>Typora&lt;/code>）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="k">var&lt;/span> &lt;span class="n">spawn&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">require&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;child_process&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">exec&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">hexo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">on&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;new&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">spawn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;start &amp;#34;D:\Program Files\Typora\Typora.exe&amp;#34; &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol>
&lt;li>新建后缀为 js 的脚本文件&lt;/li>
&lt;li>复制以上命令粘贴（注意修改路径 ），保存&lt;/li>
&lt;/ol></description></item><item><title>自动备份Hexo源文件到私有仓库</title><link>https://weeaster.github.io/posts/310ece77/</link><pubDate>Mon, 05 Dec 2022 12:55:52 +0000</pubDate><guid>https://weeaster.github.io/posts/310ece77/</guid><description>&lt;p>Hexo 部署到&lt;code>Github&lt;/code>的文件不包含主题文件，md文件，模版，配置文件等，在新电脑要重新部署相同环境写博客就要拷贝这些文件过去，可以通过文件共享，U盘拷贝，云盘等手段&lt;/p>
&lt;p>还有一种方法就是把这些文件也推送到&lt;code>Github&lt;/code>仓库，网上看到有一个&lt;code>hexo-git-backup&lt;/code>可以把源码推送到仓库分支实现备份。但是我觉得这样不妥，由于部署到&lt;code>Github&lt;/code>的静态网站仓库是公开的，把源文推送这个分支，意味着所有人都可以看到源文件的配置，包括一些个人的信息，可能有网站统计，收录的&lt;code>token&lt;/code>，这样就不太好&lt;/p>
&lt;p>看到一篇博文（https://0skyu.cn/p/a8bd.html） 就整的非常好，其中原理过程可以自行去研究&lt;/p>
&lt;p>我参考这篇文章记录我自己的过程和操作&lt;/p>
&lt;hr>
&lt;h2 id="新建github私有仓库">新建Github私有仓库
&lt;/h2>&lt;p>不用初始化创建&lt;code>README&lt;/code>文件，&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/12/05/xJtCgXsklf2FdRP.jpg">
&lt;img src="https://s2.loli.net/2022/12/05/xJtCgXsklf2FdRP.jpg"
loading="lazy"
alt="ScreenCaputure221205140509"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/12/05/cma2PJ1HUtDXhr9.jpg">
&lt;img src="https://s2.loli.net/2022/12/05/cma2PJ1HUtDXhr9.jpg"
loading="lazy"
alt="ScreenCaputure221205140926"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="本地hexo目录git设置">本地Hexo目录git设置
&lt;/h2>&lt;p>…or create a new repository on the command line&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">echo &amp;#34;# hexo-source-backup&amp;#34; &amp;gt;&amp;gt; README.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git init
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git add README.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git commit -m &amp;#34;first commit&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git branch -M main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git remote add origin git@github.com:kiraster/hexo-source-backup.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git push -u origin main
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>使用上面的命令进行设置，进行第一次push推送，到 Github 网页端查看是否有文件上传&lt;/p>
&lt;p>出现 &lt;code>error: failed to push some refs to&lt;/code> 错误，使用强制命令&lt;code>git pull origin master --allow-unrelated-historie&lt;/code>，如果还有其他命令报错自行查看文档或 Google，都是简单的小问题搜索引擎第一页就有&lt;/p>
&lt;p>网上很多文章说要修改或创建一个名称为&lt;code>.gitignore&lt;/code>的文件，其实这个在你部署静态文件到公共仓库就会有，保持默认就行&lt;/p>
&lt;p>除此之外，有些主题在主题目录下有&lt;code>.gitignore&lt;/code>文件，一般主题作者不会把主题配置文件&lt;code>_config.yml&lt;/code>上传，这里要把这行去掉，使之上传到私有仓库&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">.DS_Store
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Thumbs.db
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">db.json
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*.log
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">node_modules/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">public/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">.deploy*/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">_multiconfig.yml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="安装-shelljs-模块">安装 shelljs 模块
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">npm install --save shelljs
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="自动备份脚本">自动备份脚本
&lt;/h2>&lt;p>创建一个&lt;code>js&lt;/code>脚本文件，保存在博客目录下的&lt;code>scripts&lt;/code>目录，文件名称自己定&lt;/p>
&lt;p>第 38 行 的双引号提交信息 任意修改&lt;/p>
&lt;p>第 15 和 41 行 的分支名称注意 保持和第二步骤中的保持一致，有些用人喜欢用&lt;code>main&lt;/code>有些人喜欢用&lt;code>master&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">require&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;shelljs/global&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">logger&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">require&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;hexo-log&amp;#39;&lt;/span>&lt;span class="p">)();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/*
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">危险操作，注意查看控制台提示！！！
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">*/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">hexo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">on&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;generateBefore&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Start pulling\n==================================================&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">pullToLocal&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">function&lt;/span> &lt;span class="nx">pullToLocal&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">exec&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;git stash&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">code&lt;/span> &lt;span class="o">!==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;暂时存放出错，请查看提示处理&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">exec&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;git pull origin main&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">code&lt;/span> &lt;span class="o">!==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;同步到本地出错，请检查网络连接查看提示处理&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">exec&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;git stash pop&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">code&lt;/span> &lt;span class="o">!==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;重新应用缓存的stash出错，请查看提示处理&amp;#39;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">process&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">exit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Pull done\n==================================================&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">try&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">hexo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">on&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;deployAfter&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kd">function&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Start pushing\n==================================================&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">pushToPrivateRepo&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">e&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;博客源码推送至私有仓库异常，错误提示：&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nx">e&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">toString&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">function&lt;/span> &lt;span class="nx">pushToPrivateRepo&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">exec&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;git add .&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">code&lt;/span> &lt;span class="o">!==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">warn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;添加文件到暂存区出错&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">exec&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;git commit -m &amp;#34;Auto backup&amp;#34;&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">code&lt;/span> &lt;span class="o">!==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">warn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;没有提交的新内容或提交暂存区到本地仓库错误&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">exec&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;git push origin main&amp;#39;&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="nx">code&lt;/span> &lt;span class="o">!==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">warn&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;推送代码至github main 主分支出错&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Push done\n==================================================&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Ctrl + C 退出或关闭窗口退出或60秒后自动退出&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">setTimeout&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;q&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="mi">60000&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="推送">推送
&lt;/h2>&lt;p>执行&lt;code>hexo clean &amp;amp;&amp;amp; hexo g &amp;amp;&amp;amp; hexo d&lt;/code>会自动调用这个脚本&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Start pulling
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">==================================================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Saved working directory and index state WIP on main: 4978dc8 Auto backup
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">From github.com:kiraster/xxxx-xx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * branch main -&amp;gt; FETCH_HEAD
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Already up to date.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">On branch main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Changes not staged for commit:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> (use &amp;#34;git add &amp;lt;file&amp;gt;...&amp;#34; to update what will be committed)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> (use &amp;#34;git restore &amp;lt;file&amp;gt;...&amp;#34; to discard changes in working directory)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> modified: source/_posts/xxxx-xx.md
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">no changes added to commit (use &amp;#34;git add&amp;#34; and/or &amp;#34;git commit -a&amp;#34;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Dropped refs/stash@{0} (ce84730faef3bc908459561ad81e352ec3daeda6)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Pull done
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">==================================================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Deploy done: git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Start pushing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">==================================================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[main 0f532bb] Auto backup
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 file changed, 1 insertion(+), 1 deletion(-)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">To github.com:kiraster/xxxx-xx.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 4481470..0f532bb main -&amp;gt; main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INFO Push done
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">==================================================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ctrl + C 退出或关闭窗口退出或60秒后自动退出
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>注意：&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>出现没有提交新内容到缓冲区，推送等错误，按提示排查错误即可&lt;/li>
&lt;li>看到原博客出现要切换到博客目录的这一行脚本命令，我觉得在推送博客的时候你就已经切换到博客目录，去掉这一行&lt;/li>
&lt;/ul></description></item><item><title>Hexo推送提示输入账号密码问题</title><link>https://weeaster.github.io/posts/5826b49/</link><pubDate>Thu, 01 Dec 2022 23:57:08 +0000</pubDate><guid>https://weeaster.github.io/posts/5826b49/</guid><description>&lt;p>今天推送 &lt;code>Github Pages&lt;/code> 博客发现需要输入账号密码，网页端检查&lt;code>SSH Keys &lt;/code>和本地检查&lt;code>公钥pub&lt;/code>都没问题&lt;/p>
&lt;p>最后通过搜索引擎助力，修改 https 方式为 git 方式，成功推送&lt;/p>
&lt;p>&lt;strong>方法&lt;/strong>：修改博客目录下的&lt;code>_config.yml&lt;/code>文件配置（不是主题目录下的配置文件）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># Deployment
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## Docs: https://hexo.io/docs/one-command-deployment
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deploy:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type: git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # repo: https://github.com/kiraster/kiraster.github.io.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # 20221201发现使用https方式需要输入验证账号密码，修改为git方式后正常推送
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> repo: git@github.com:kiraster/kiraster.github.io.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> branch: master
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>H3C 防火墙（v7）提取导出安全策略至表格</title><link>https://weeaster.github.io/posts/f285fb93/</link><pubDate>Thu, 01 Dec 2022 21:01:44 +0000</pubDate><guid>https://weeaster.github.io/posts/f285fb93/</guid><description>&lt;p>当前日期时间： &lt;code>20221201&lt;/code> 版本:&lt;code>H3C Comware Software, Version 7.1.064, Release 9628P2416&lt;/code>还没有安全策略导出到表格的功能，而有时确实有实际需求导出安全策略到表格，无论是存档还是提交报告&lt;/p>
&lt;p>本文介绍使用&lt;code>python&lt;/code>脚本语言编写一个根据&lt;code>display&lt;/code>回显内容提取安全策略和对象组到表格的方法&lt;/p>
&lt;p>&lt;strong>环境介绍：&lt;/strong>&lt;/p>
&lt;p>{% blockquote %}&lt;/p>
&lt;p>Python 3.9.7&lt;/p>
&lt;p>openpyxl 3.0.10&lt;/p>
&lt;p>HCL 3.0.1 （现网环境都为敏感内容，勉为其难用模拟器）&lt;/p>
&lt;p>VScode 1.73.1&lt;/p>
&lt;p>{% endblockquote %}&lt;/p>
&lt;h2 id="提取工作过程">提取工作过程
&lt;/h2>&lt;h3 id="命令行登陆设备导出display回显内容">命令行登陆设备导出display回显内容
&lt;/h3>&lt;p>利用&lt;code>SecureCRT&lt;/code>的&lt;code>Log Session&lt;/code>(记录日志)功能生成一个包含回显内容的&lt;code>log文件&lt;/code>，放置在与脚本文件相同目录&lt;/p>
&lt;p>本次使用的是&lt;code>205550.log'&lt;/code>，在下面代码中更换为自己的文件名称&lt;/p>
&lt;p>&lt;strong>使用的命令&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 查看安全策略
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dis security-policy ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 查看地址对象组
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dis object-group ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 查看服务对象组
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dis object-group service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;Core_FW&amp;gt;dis security-policy ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Security-policy ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 2 name management-local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> action pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source-zone management
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination-zone local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;Core_FW&amp;gt;dis object-group ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ip address object group api.test.com: 1 object(in use)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0 network host name api.test.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;Core_FW&amp;gt;dis object-group service
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Service object group A服务器端口服务: 3 objects(in use)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0 service tcp destination eq 1433
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 10 service tcp destination range 300 3010
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 20 service udp destination eq 2222
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Service object group 访问test.comAPI接口: 2 objects(in use)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0 service tcp destination eq 443
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 10 service tcp destination range 9000 9100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;Core_FW&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="运行的代码">运行的代码
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">openpyxl&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Workbook&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">openpyxl.styles&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">PatternFill&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">openpyxl&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">datetime&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">datetime&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">class&lt;/span> &lt;span class="nc">SecPolicy2XLSX&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 初始化参数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="fm">__init__&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 文件名时间部分，用于区别新旧&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">create_time&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">datetime&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;%Y%m&lt;/span>&lt;span class="si">%d&lt;/span>&lt;span class="s2">%H%M%S&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 读取文件，填写同目录从防火墙命令巴拉下来的文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">export_cfg&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;205550.log&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">export_cfg&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;r&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 表格 - 表头数据&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sheet1_th&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;名称&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;ID&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;源安全域&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;目的安全域&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;类型&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;描述&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;源地址&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> \
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;目的地址&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;服务&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;用户&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;动作&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;内容安全&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;记录日志&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;策略匹配统计&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;启用&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sheet2_th&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[[&lt;/span>&lt;span class="s1">&amp;#39;对象组名称和被引用&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;对象&amp;#39;&lt;/span>&lt;span class="p">]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 表格初始数据&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Workbook&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">active&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;安全策略&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">create_sheet&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;地址对象组&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">create_sheet&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;服务对象组&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 写入表头&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sheet1_th&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sheet2_th&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 提取安全策略信息&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">sp_comtent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 保存单条策略内容的字典&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 保存以下几项内容的字典，原因在于命令行中显示为多个（每个一行）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">src_zone_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dst_zone_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">src_ip_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dst_ip_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">service_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="kc">True&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cfg_line&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">readline&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;rule&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">id&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">()[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;id&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">id&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;source-zone&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">src_zone_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">()[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;profile&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">profile_type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">()[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;_&amp;#39;&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;profile_type&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">profile_type&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;description&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">desc&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()[&lt;/span>&lt;span class="mi">12&lt;/span>&lt;span class="p">:]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;desc&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">desc&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;destination-zone&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dst_zone_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">()[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;source-ip&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">src_ip_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;destination-ip&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dst_ip_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;action&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">action&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">()[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;action&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">action&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;logging &amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">logg&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">()[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;logg&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">logg&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;counting &amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">()[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;count&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">count&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;disable&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># enable = cfg_line.strip()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;enable&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;disable&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;service&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">service_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># display 回显的内容 空行分割一条安全策略&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 把最终列表拼接到字符串&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">src_zone&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;,&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">src_zone_list&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dst_zone&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;,&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dst_zone_list&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">src_ip&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;,&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">src_ip_list&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dst_ip&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;,&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dst_ip_list&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">service&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;,&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">service_list&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 把最终列表拼接到字符串写入comtent_dict字典&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;src_zone&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">src_zone&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;dst_zone&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">dst_zone&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;src_ip&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">src_ip&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;dst_ip&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">dst_ip&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;service&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">service&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 返回值是单条安全策略的字典&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">comtent_dict&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 提取地址对象组信息&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">ip_obj_comtent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">networw_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="kc">True&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cfg_line&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">readline&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;Ip address object group&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;network &amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">networw_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">networw_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;,&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">networw_list&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;networw_list&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">networw_list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 返回值是单个地址对象组的字典&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">comtent_dict&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 提取服务对象组信息&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">service_obj_comtent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">service_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="kc">True&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cfg_line&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">readline&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;Service object group&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;service tcp&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span> &lt;span class="ow">or&lt;/span> &lt;span class="s1">&amp;#39;service udp&amp;#39;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">service_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">cfg_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">service_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;,&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">service_list&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_dict&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;service_list&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">service_list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 返回值是单个服务对象组的字典&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">comtent_dict&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 循环 返回全部安全策略的生成器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">more_sp_comtent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 找到文件末 的指针，用于判断是否读取完整个文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">eof&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seek&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seek&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="kc">True&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sp_comtent&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">yield&lt;/span> &lt;span class="n">res&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tell&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="n">eof&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 循环 返回全部地址对象组的生成器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">more_ip_comtent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">eof&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seek&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seek&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="kc">True&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ip_obj_comtent&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">yield&lt;/span> &lt;span class="n">res&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tell&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="n">eof&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 循环 返回全部服务对象组的生成器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">more_service_comtent&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">eof&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seek&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seek&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="kc">True&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">service_obj_comtent&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">yield&lt;/span> &lt;span class="n">res&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tell&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="n">eof&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 安全策略，移除和填充内容字典元素&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">sp_fill_task&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 生成器 转 列表套字典&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">more_sp_comtent&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 移除不相干元素，列表套字典中字典不包含 &amp;#39;name&amp;#39; 键的字典&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">index_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">comtent_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">key_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">keys&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">key_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 字典中不包含 &amp;#39;name&amp;#39; 键的字典在comtent_list列表的索引值&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">index_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">comtent_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 索引列表去重--&amp;gt;&amp;gt;降序排列--&amp;gt;&amp;gt;删元素&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">index_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nb">set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">index_list&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">index_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sort&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">reverse&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">index_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">pop&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># comtent_list列表去重&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ret_comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">comtent_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">ret_comtent_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ret_comtent_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 去头&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ret_comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ret_comtent_list&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">:]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 添加一些默认值，一些安全策略值在display回显的内容不显示&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">ret_comtent_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;user&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;Any&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 一般应用安全都是使用默认配置文件中default策略，如有自定义的配置文件就增加一个提取函数&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ap_profile&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;default&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">setdefault&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;desc&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;-&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 安全策略没有启用显示disable，启用了display没有显示&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">setdefault&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;enable&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;enable&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># IPv4 网络环境默认&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">setdefault&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;profile_type&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;IPv4&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 命中计数和流量统计，没有启用不在display显示&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">setdefault&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;count&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;disable&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 记录日志&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">setdefault&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;logg&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;enable&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># print(i)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 键的值为空则替换为 Any&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ret_comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[{&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">v&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">v&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">k&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="s1">&amp;#39;desc&amp;#39;&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="s1">&amp;#39;Any&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">k&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">v&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">items&lt;/span>&lt;span class="p">()}&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">ret_comtent_list&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 最后一条拒绝所有策略的描述&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ret_comtent_list&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">][&lt;/span>&lt;span class="s1">&amp;#39;desc&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ret_comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ret_comtent_list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 返回一个完整的列表套字典&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ret_comtent_list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 地址对象组，移除和填充内容字典元素&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">ip_fill_task&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 生成器 转 列表套字典&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">more_ip_comtent&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 列表去重&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ret_comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">comtent_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">ret_comtent_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ret_comtent_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 去头&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ret_comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ret_comtent_list&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">:]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ret_comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ret_comtent_list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ret_comtent_list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">service_fill_task&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 生成器 转 列表套字典&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">res&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">more_service_comtent&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">res&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 列表去重&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ret_comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">comtent_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">ret_comtent_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ret_comtent_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 去头&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ret_comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ret_comtent_list&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">:]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ret_comtent_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ret_comtent_list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 在此处关闭文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ret_comtent_list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 写入数据到表格 - 安全策略工作表&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">write2ws1&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 从第二行开始写入&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">big_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sp_fill_task&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">big_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;id&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;src_zone&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;dst_zone&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;profile_type&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;desc&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;src_ip&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;dst_ip&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">9&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;service&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">10&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;user&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">11&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;action&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">12&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;ap_profile&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">13&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;logg&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">14&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;count&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">15&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;enable&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 写入数据到表格 - 地址对象组工作表&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">write2ws2&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">big_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ip_fill_task&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">big_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;networw_list&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 写入数据到表格 - 地址对象组工作表&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">write2ws3&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">big_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">service_fill_task&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">big_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;name&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;service_list&amp;#39;&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">row&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 调整表格显示 保存xlsx表格&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">def&lt;/span> &lt;span class="nf">save_to_file&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 修改ws1列宽&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;A&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">50&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;B&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;C&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">46&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;D&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">38&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;F&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">50&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;G&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">50&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;H&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">50&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;I&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">50&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;N&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 修改ws2列宽&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;A&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">50&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;B&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 修改ws3列宽&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;A&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">50&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">column_dimensions&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s1">&amp;#39;B&amp;#39;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 修改列 垂直居中 自动换行，表头背景色 ，冻结首行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">freeze_panes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;A2&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">freeze_panes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;A2&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">freeze_panes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;A2&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">th_color_fill&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">PatternFill&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;solid&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">fgColor&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;D3D3D3&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">col&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">16&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fill&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">th_color_fill&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">col&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fill&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">th_color_fill&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">col&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">range&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws3&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">cell&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">column&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">col&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fill&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">th_color_fill&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">r&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws1&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">r&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">alignment&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">openpyxl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">styles&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Alignment&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">vertical&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;center&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">wrapText&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">r&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws2&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">r&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">alignment&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">openpyxl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">styles&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Alignment&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">vertical&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;center&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">wrapText&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">r&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">ws3&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">c&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">r&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">c&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">alignment&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">openpyxl&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">styles&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Alignment&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">vertical&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;center&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">wrapText&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 保存并生成文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">wb&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">save&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s1">&amp;#39;XXX防火墙安全策略统计&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="bp">self&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">create_time&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s1">.xlsx&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="vm">__name__&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s1">&amp;#39;__main__&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 类实例化&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">SecPolicy2XLSX&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># res = x.sp_comtent()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># res = x.more_comtent()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># res = x.more_ip_comtent()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># for i in res:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># print(i)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># x.ip_fill_task()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write2ws1&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write2ws2&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write2ws3&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">save_to_file&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;搞快点--&amp;gt;&amp;gt;搞快点--&amp;gt;&amp;gt;&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="导出的表格">导出的表格
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/12/01/cNp1hXCz5uKmWFf.jpg">
&lt;img src="https://s2.loli.net/2022/12/01/cNp1hXCz5uKmWFf.jpg"
loading="lazy"
alt="ScreenCaputure221201214539"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/12/01/WvI5YhTPaqpdbzB.jpg">
&lt;img src="https://s2.loli.net/2022/12/01/WvI5YhTPaqpdbzB.jpg"
loading="lazy"
alt="ScreenCaputure221201214703"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/12/01/TSWYCOPrbImcez3.jpg">
&lt;img src="https://s2.loli.net/2022/12/01/TSWYCOPrbImcez3.jpg"
loading="lazy"
alt="ScreenCaputure221201214728"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/12/01/tygZYhBfMFrmjQS.png">
&lt;img src="https://s2.loli.net/2022/12/01/tygZYhBfMFrmjQS.png"
loading="lazy"
alt="20221201220702"
>
&lt;/a>
&lt;/div>
&lt;/p></description></item><item><title>Ubuntu 22.04 安装iNode管理中心和定制客户端</title><link>https://weeaster.github.io/posts/4eda38e9/</link><pubDate>Sat, 26 Nov 2022 16:34:36 +0000</pubDate><guid>https://weeaster.github.io/posts/4eda38e9/</guid><description>&lt;p>&lt;code>Ubuntu 22.04&lt;/code>安装&lt;code>iNode&lt;/code>管理中心和定制客户端，如题&lt;/p>
&lt;h2 id="官网下载安装文件">官网下载安装文件
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>从官网下载 iNode PC(PC客户端)（https://www.h3c.com/cn/Service/Document_Software/Software_Download/IP_Management/&lt;/p>
&lt;/li>
&lt;li>
&lt;p>解压后将&lt;code>Linux&lt;/code>目录下的&lt;code>iNodeManager_H3C_Linux64_7.30(E0598).tar.gz&lt;/code>上传至 &lt;code>Ubuntu &lt;/code>Downloads目录&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/OL74h15fEz9Wp3D.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/OL74h15fEz9Wp3D.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="解压和安装">解压和安装
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>解压文件，并将解压后的文件夹所有者更改为当前用户，&lt;/p>
&lt;/li>
&lt;li>
&lt;p>移动文件夹至 &lt;code>/home&lt;/code> 目录&lt;/p>
&lt;/li>
&lt;li>
&lt;p>修改文件夹下 &lt;code>install64.sh &lt;/code>的权限&lt;/p>
&lt;/li>
&lt;li>
&lt;p>安装文件&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">执行命令：
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/Downloads$ sudo tar -zxvf iNodeManager_H3C_Linux64_7.30&lt;span class="se">\(&lt;/span>E0598&lt;span class="se">\)&lt;/span>.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/Downloads$ sudo chown -R kir iNodeManager
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/Downloads$ sudo mv iNodeManager /home/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/Downloads$ &lt;span class="nb">cd&lt;/span> /home/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home$ &lt;span class="nb">cd&lt;/span> iNodeManager/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager$ sudo chmod u+x install64.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager$ sudo sh install64.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">操作步骤记录：
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~$
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~$ &lt;span class="nb">pwd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/home/kir
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~$ &lt;span class="nb">cd&lt;/span> Downloads/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/Downloads$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">44368&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">2&lt;/span> kir kir &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 11:40 ./
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-x--- &lt;span class="m">16&lt;/span> kir kir &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 01:51 ../
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir kir &lt;span class="m">45422267&lt;/span> 6月 &lt;span class="m">30&lt;/span> 22:10 &lt;span class="s1">&amp;#39;iNodeManager_H3C_Linux64_7.30(E0598).tar.gz&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/Downloads$
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/Downloads$ sudo tar -zxvf iNodeManager_H3C_Linux64_7.30&lt;span class="se">\(&lt;/span>E0598&lt;span class="se">\)&lt;/span>.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>sudo&lt;span class="o">]&lt;/span> password &lt;span class="k">for&lt;/span> kir:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/7za
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/template/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/template/iNodeClient_Linux64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/install64.sh.bak
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/Resources/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/Resources/Language_en.xml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/Resources/Language_zh.xml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/uninstall64.sh.bak
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/qt_zh_CN.qm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/uninstall64.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/install64.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/makeDeb.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/imageformats/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/imageformats/libqmng.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/imageformats/libqjpeg.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/imageformats/libqsvg.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/imageformats/libqico.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/imageformats/libqtga.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/imageformats/libqwbmp.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/imageformats/libqtiff.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/imageformats/libqgif.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/platforms/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/platforms/libqoffscreen.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/platforms/libqminimal.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/platforms/libqxcb.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/platforms/libqlinuxfb.so
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/lib64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/iNodeManager
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./iNodeManager/iNode.vif
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/Downloads$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">44372&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">3&lt;/span> kir kir &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 13:29 ./
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-x--- &lt;span class="m">16&lt;/span> kir kir &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 01:51 ../
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x &lt;span class="m">6&lt;/span> &lt;span class="m">500&lt;/span> &lt;span class="m">500&lt;/span> &lt;span class="m">4096&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 iNodeManager/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir kir &lt;span class="m">45422267&lt;/span> 6月 &lt;span class="m">30&lt;/span> 22:10 &lt;span class="s1">&amp;#39;iNodeManager_H3C_Linux64_7.30(E0598).tar.gz&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/Downloads$ sudo chown -R kir iNodeManager
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/Downloads$ sudo mv iNodeManager /home/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:~/Downloads$ &lt;span class="nb">cd&lt;/span> /home/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">16&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">4&lt;/span> root root &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 13:30 ./
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">20&lt;/span> root root &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 01:28 ../
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x &lt;span class="m">6&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">4096&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 iNodeManager/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-x--- &lt;span class="m">16&lt;/span> kir kir &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 01:51 kir/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home$ &lt;span class="nb">cd&lt;/span> iNodeManager/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">19712&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x &lt;span class="m">6&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">4096&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 ./
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">4&lt;/span> root root &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 13:30 ../
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">1125104&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 7za
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x &lt;span class="m">2&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">4096&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 imageformats/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rwxrwxr-x &lt;span class="m">1&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">810603&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 iNodeManager*
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">300&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 iNode.vif
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">63&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 install64.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">959&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 install64.sh.bak
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">18079733&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 lib64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">926&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 makeDeb.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x &lt;span class="m">2&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">4096&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 platforms/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">117337&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 qt_zh_CN.qm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x &lt;span class="m">2&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">4096&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 Resources/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x &lt;span class="m">2&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">4096&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 template/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">41&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 uninstall64.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">924&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:13 uninstall64.sh.bak
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager$ sudo chmod u+x install64.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager$
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager$ sudo sh install64.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5DBus.so.5.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5DBus.so.5.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5DBus.so.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libicudata.so.51.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libicudata.so.51
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libicui18n.so.51.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libicui18n.so.51
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Core.so.5.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Core.so.5.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Core.so.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Gui.so.5.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Xml.so.5.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Xml.so.5.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Xml.so.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libicuuc.so.51.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libicuuc.so.51
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Network.so.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Gui.so.5.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Gui.so.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Widgets.so.5.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Network.so.5.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Widgets.so.5.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Widgets.so.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lib64/libQt5Network.so.5.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager$
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="启动管理中心和定制客户端">启动管理中心和定制客户端
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>启动管理中心（图形化界面操作），路径位于&lt;code>/home/iNodeManager&lt;/code>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/vAKgpmnkNDEJX1T.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/vAKgpmnkNDEJX1T.jpg"
loading="lazy"
alt="ScreenCaputure221126133607"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>仅勾选 SSL VPN 一项（按需勾选），点击 &lt;code>Advanced&lt;/code>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/S1sOGcjepK2TwdF.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/S1sOGcjepK2TwdF.jpg"
loading="lazy"
alt="ScreenCaputure221126133741"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>添加 网关地址 （与防火墙上配置的网关 SSLVPNGW 一致），点击 &lt;code>OK&lt;/code>，点击 &lt;code>Finish&lt;/code>&lt;/p>
&lt;table>
&lt;tr>
&lt;td>&lt;img src="https://s2.loli.net/2022/11/26/9ZIKPc5pN2zVJjL.jpg">&lt;/td>
&lt;td>&lt;img src="https://s2.loli.net/2022/11/26/Wrno8feNdcQVXvg.jpg">&lt;/td>
&lt;/tr>
&lt;/table>
&lt;/li>
&lt;li>
&lt;p>填写一个标题，勾选第一项&lt;/p>
&lt;table>
&lt;tr>
&lt;td>&lt;img src="https://s2.loli.net/2022/11/26/vsLUmVpIjHY9aFN.jpg">&lt;/td>
&lt;td>&lt;img src="https://s2.loli.net/2022/11/26/jGFohdwHKceC1Vk.jpg">&lt;/td>
&lt;/tr>
&lt;/table>
&lt;table>
&lt;tr>
&lt;td>&lt;img src="https://s2.loli.net/2022/11/26/367FWRI9YAbTCQf.jpg">&lt;/td>
&lt;td>&lt;img src="https://s2.loli.net/2022/11/26/TsykZ6xc2qaMzUL.jpg">&lt;/td>
&lt;/tr>
&lt;/table>
&lt;/li>
&lt;li>
&lt;p>定制完成后 生成的客户端文件位于&lt;code>/home/iNodeManager/iNodeSetup&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager$ &lt;span class="nb">cd&lt;/span> iNodeSetup/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager/iNodeSetup$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">25260&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x &lt;span class="m">2&lt;/span> kir kir &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 13:39 ./
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x &lt;span class="m">11&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 13:39 ../
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir kir &lt;span class="m">25857547&lt;/span> 11月 &lt;span class="m">26&lt;/span> 13:39 &lt;span class="s1">&amp;#39;iNodeClient_Linux64_7.3 (E0598).tar.gz&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager/iNodeSetup$
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="安装-inode-客户端">安装 iNode 客户端
&lt;/h2>&lt;ol>
&lt;li>将&lt;code>iNodeClient_Linux64_7.3 (E0598).tar.gz&lt;/code>文件解压，并移动&lt;code> iNodeClient&lt;/code> 文件夹至&lt;code>/home&lt;/code>目录&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager/iNodeSetup$
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager/iNodeSetup$ sudo tar -zxvf iNodeClient_Linux64_7.3&lt;span class="se">\ \(&lt;/span>E0598&lt;span class="se">\)&lt;/span>.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager/iNodeSetup$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">25264&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x &lt;span class="m">3&lt;/span> kir kir &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 13:44 ./
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x &lt;span class="m">11&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 13:39 ../
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">9&lt;/span> kir kir &lt;span class="m">4096&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:07 iNodeClient/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> kir kir &lt;span class="m">25857547&lt;/span> 11月 &lt;span class="m">26&lt;/span> 13:39 &lt;span class="s1">&amp;#39;iNodeClient_Linux64_7.3 (E0598).tar.gz&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager/iNodeSetup$ sudo mv iNodeClient /home/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeManager/iNodeSetup$ &lt;span class="nb">cd&lt;/span> /home/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home$ ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">5&lt;/span> root root &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 13:46 ./
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">20&lt;/span> root root &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 01:28 ../
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">9&lt;/span> kir kir &lt;span class="m">4096&lt;/span> 6月 &lt;span class="m">30&lt;/span> 20:07 iNodeClient/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxrwxr-x &lt;span class="m">11&lt;/span> kir &lt;span class="m">500&lt;/span> &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 13:39 iNodeManager/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-x--- &lt;span class="m">16&lt;/span> kir kir &lt;span class="m">4096&lt;/span> 11月 &lt;span class="m">26&lt;/span> 01:51 kir/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home$
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>
&lt;p>切换至&lt;code>iNodeClient &lt;/code>文件夹 ，执行&lt;code> sh install_64.sh&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">kir@kir:/home$ &lt;span class="nb">cd&lt;/span> iNodeClient/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kir@kir:/home/iNodeClient$ sudo sh install_64.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Nothing special &lt;span class="k">for&lt;/span> Ubuntu 22.04.1 LTS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="se">\l&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Starting AuthenMngService: OK
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="启动-inode-客户端">启动 iNode 客户端
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>图形界面 进入&lt;code>/home/iNodeClient/.iNode&lt;/code>目录（看不到&lt;code>.iNode &lt;/code>文件夹，先勾选显示隐藏文件）&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/M3O8v12pEfXNYUI.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/M3O8v12pEfXNYUI.jpg"
loading="lazy"
alt="ScreenCaputure221126134844"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/MfgB95kP7UC4yib.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/MfgB95kP7UC4yib.jpg"
loading="lazy"
alt="ScreenCaputure221126134939"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>双击&lt;code>iNodeClient&lt;/code>启动，创建一个连接（填写name,Username,Password)&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/gBDXQ95F4whp3RS.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/gBDXQ95F4whp3RS.jpg"
loading="lazy"
alt="ScreenCaputure221126135901"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/ZRIyCsTw6mjMXOF.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/ZRIyCsTw6mjMXOF.jpg"
loading="lazy"
alt="ScreenCaputure221126145223"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>SSLVPN 拨号&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/3nfAhOgMoV1d6Xr.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/3nfAhOgMoV1d6Xr.jpg"
loading="lazy"
alt="ScreenCaputure221126141137"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;li>
&lt;p>查看获取到的客户端地址，并测试&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/UrCdGAZOYIV7Rqh.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/UrCdGAZOYIV7Rqh.jpg"
loading="lazy"
alt="ScreenCaputure221126141240"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/QMwqivFmZukJTzB.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/QMwqivFmZukJTzB.jpg"
loading="lazy"
alt="ScreenCaputure221126141546"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/DORpjqgZY2L6VPw.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/DORpjqgZY2L6VPw.jpg"
loading="lazy"
alt="ScreenCaputure221126142757"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="防火墙查看-sslvpn-会话信息">防火墙查看 SSLVPN 会话信息
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/cPgnirQuTqz81wI.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/cPgnirQuTqz81wI.jpg"
loading="lazy"
alt="ScreenCaputure221126142906"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="最后">最后
&lt;/h2>&lt;ul>
&lt;li>我电脑Windows + Ubuntu 22.04 双系统，在现网环境中都可正常使用 SSLVPN&lt;/li>
&lt;li>Ubuntu 截图和写Markdown发博客不方便（最重要的 HCL 没有Linux版本），所以拉了个虚拟机&lt;/li>
&lt;li>按照官方的安装指导手册以普通用户安装，最后定制生成客户端会&lt;code>无法生成文件&lt;/code>，需要在解压后将&lt;code>iNodeManager&lt;/code>文件夹所有者更改为当前普通用户&lt;/li>
&lt;li>在客户端创建新连接时，认证类型要选择 &lt;code>Local&lt;/code>，否则拨号后提示网关参数错误&lt;/li>
&lt;li>在定制客户端最后一步有三个选项
&lt;ul>
&lt;li>Generate customized client setup program(生成一个安装包，常用)&lt;/li>
&lt;li>Generate customized client upgrade package(升级包，使用前本地已经安装有旧版本，理解为增量升级包)&lt;/li>
&lt;li>Generate lightweight client upgrade package(用于放在服务端，在防火墙的&lt;code>SSL VPN&lt;/code>&amp;ndash;&amp;raquo;&lt;code>全局配置&lt;/code>&amp;ndash;&amp;raquo;&lt;code>上传客户端文件&lt;/code>位置，在浏览器输入&lt;code>SSLVPNGW:4443&lt;/code>可已打开页面，底下一行有下载的链接，就是下载这个文件)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul></description></item><item><title>H3C 防火墙（v7）SSLVPN 实验配置</title><link>https://weeaster.github.io/posts/ed57c1e2/</link><pubDate>Sat, 26 Nov 2022 15:12:31 +0000</pubDate><guid>https://weeaster.github.io/posts/ed57c1e2/</guid><description>&lt;p>本文使用华三 HCL 模拟器搭建拓扑，实现 H3C 防火墙（v7）SSLVPN 实验&lt;/p>
&lt;p>后一篇文章中描述 在 &lt;code>Ubuntu 22.04&lt;/code> 中安装 &lt;code>iNode&lt;/code> 客户端拨号测试&lt;/p>
&lt;p>本来只想写 Ubuntu 安装 iNode 的，想想还是一起记录下来&lt;/p>
&lt;p>文中的所有操作方法都可在华三官网和搜索引擎找到&lt;/p>
&lt;h2 id="拓扑图">拓扑图
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/PgNxjMhaKEzsO2i.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/PgNxjMhaKEzsO2i.jpg"
loading="lazy"
alt="ScreenCaputure221126120646"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="基操">基操
&lt;/h2>&lt;ol>
&lt;li>配置接口 IP 地址&lt;/li>
&lt;li>接口划入安全域（untrust，trust），新建安全域 SSLVPN&lt;/li>
&lt;li>配置路由（FW&amp;ndash;&amp;raquo; ROUTER:172.16.1.0/24，ROUTER&amp;ndash;&amp;raquo;FW:0.0.0.0/0）&lt;/li>
&lt;li>配置安全策略互通（any）&lt;/li>
&lt;/ol>
&lt;h2 id="防火墙配置-sslvpn">防火墙配置 SSLVPN
&lt;/h2>&lt;h3 id="配置-sslvpn-网关">配置 SSLVPN 网关
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>Gateway Name: SSLVPNGW&lt;/p>
&lt;/li>
&lt;li>
&lt;p>IP Address: 172.31.100.234&lt;/p>
&lt;/li>
&lt;li>
&lt;p>port: 4443&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/2P1gsbxBkRCm3af.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/2P1gsbxBkRCm3af.jpg"
loading="lazy"
alt="ScreenCaputure221126121833"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="配置-ip-接入接口">配置 IP 接入接口
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>安全域： SSLVPN&lt;/p>
&lt;/li>
&lt;li>
&lt;p>指定IP地址：172.31.200.254/24&lt;/p>
&lt;/li>
&lt;li>
&lt;p>本机接收可不选&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/vHMoJfWuPDIN8mQ.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/vHMoJfWuPDIN8mQ.jpg"
loading="lazy"
alt="ScreenCaputure221126121924"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/D19bwngVfWil3rQ.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/D19bwngVfWil3rQ.jpg"
loading="lazy"
alt="ScreenCaputure221126122310"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="创建ssl--vpn客户端地址池">创建SSL VPN客户端地址池
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>地址池名称： SSLVPNPOOL&lt;/p>
&lt;/li>
&lt;li>
&lt;p>172.31.200.10 - 172.31.200.100&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/9StT357Dfmk2lj8.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/9StT357Dfmk2lj8.jpg"
loading="lazy"
alt="ScreenCaputure221126122347"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="配置ssl-vpn访问实例">配置SSL VPN访问实例
&lt;/h3>&lt;ul>
&lt;li>访问实例： KIRIP&lt;/li>
&lt;li>关联网关：SSLVPNGW&lt;/li>
&lt;li>url acl: None&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/CJVZL3STvasDp2G.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/CJVZL3STvasDp2G.jpg"
loading="lazy"
alt="ScreenCaputure221126122432"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/e6ghlcyE2nKuYkj.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/e6ghlcyE2nKuYkj.jpg"
loading="lazy"
alt="ScreenCaputure221126122521"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>
&lt;p>IP业务：&lt;/p>
&lt;ul>
&lt;li>
&lt;p>​ IP接入接口：SSLVPN-AC1 INTERFACE&lt;/p>
&lt;/li>
&lt;li>
&lt;p>​ 客户端地址池：SSLVPNPOOL&lt;/p>
&lt;/li>
&lt;li>
&lt;p>IP接入资源：添加要被VPN接入客户端访问的网络 : ROUTERLIST:&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>​ 172.16.1.0/24&lt;/p>
&lt;p>​ ……&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/tpb9CPyxr3kuRsI.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/tpb9CPyxr3kuRsI.jpg"
loading="lazy"
alt="ScreenCaputure221126122536"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/KhsJiqZn4afRIQ1.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/KhsJiqZn4afRIQ1.jpg"
loading="lazy"
alt="ScreenCaputure221126122634"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/iynU2qlutawKPsF.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/iynU2qlutawKPsF.jpg"
loading="lazy"
alt="ScreenCaputure221126122716"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/MWqR9i7eynPNrAH.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/MWqR9i7eynPNrAH.jpg"
loading="lazy"
alt="ScreenCaputure221126122723"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/ukL5VOaitIjWpch.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/ukL5VOaitIjWpch.jpg"
loading="lazy"
alt="ScreenCaputure221126122747"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>
&lt;p>不配置快捷方式，next&lt;/p>
&lt;/li>
&lt;li>
&lt;p>配置资源组&lt;/p>
&lt;ul>
&lt;li>资源组名称：RESOURCEGROUP&lt;/li>
&lt;li>指定路由接入VPN：子网资源&lt;/li>
&lt;li>客户端地址池：SSLVPNPOOL&lt;/li>
&lt;li>客户端掩码：24&lt;/li>
&lt;li>acl：3999 (新建acl，rule permit ip)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>完成配置，使能访问实例（勾上）&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/zoRQuITFqvtxka4.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/zoRQuITFqvtxka4.jpg"
loading="lazy"
alt="ScreenCaputure221126122917"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="创建-sslvpn-用户">创建 SSLVPN 用户
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>填写用户名&amp;ndash;&amp;raquo;勾选SSL VPN&lt;/p>
&lt;/li>
&lt;li>
&lt;p>授权属性： SSL VPN 策略组： resourcegroup&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/1Imh2gkDJCzUjZ5.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/1Imh2gkDJCzUjZ5.jpg"
loading="lazy"
alt="ScreenCaputure221126124924"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/n6vmYPWJdAyFX8D.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/n6vmYPWJdAyFX8D.jpg"
loading="lazy"
alt="ScreenCaputure221126124934"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="windows平台-inode-客户端测试">Windows平台 iNode 客户端测试
&lt;/h2>&lt;ul>
&lt;li>新建场景&amp;ndash;&amp;raquo;创建连接&lt;/li>
&lt;/ul>
&lt;table>
&lt;tr>
&lt;td>&lt;img src="https://s2.loli.net/2022/11/26/YIEbLd4NcaSzHFm.jpg">&lt;/td>
&lt;td>&lt;img src="https://s2.loli.net/2022/11/26/fd7ImtU6VzkhTvg.png">&lt;/td>
&lt;/tr>
&lt;/table>
&lt;ul>
&lt;li>查看连接状态和分配到的客户端地址&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/rfRhxltUH9MN2AX.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/rfRhxltUH9MN2AX.jpg"
loading="lazy"
alt="ScreenCaputure221126125942"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>访问资源和跟踪路径&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/26/C3F8pRToXzd9yi2.jpg">
&lt;img src="https://s2.loli.net/2022/11/26/C3F8pRToXzd9yi2.jpg"
loading="lazy"
alt="ScreenCaputure221126130413"
>
&lt;/a>
&lt;/div>
&lt;/p></description></item><item><title>H3C防火墙（v7）CVE2015-0204/CVE1999-0524</title><link>https://weeaster.github.io/posts/6d4cdc14/</link><pubDate>Sun, 13 Nov 2022 16:27:57 +0000</pubDate><guid>https://weeaster.github.io/posts/6d4cdc14/</guid><description>&lt;p>深信服漏洞扫描系统（基线核查）执行漏扫任务，检测出华三 F5060 防火墙存在&lt;code>CVE 2015-0204&lt;/code>,&lt;code>CVE 1999-0524&lt;/code>漏洞，处理过程记录。&lt;/p>
&lt;h2 id="ssltls已弃用的tlsv10和tlsv11协议检测cve-2015-0204">SSL/TLS:已弃用的TLSv1.0和TLSv1.1协议检测(CVE-2015-0204)
&lt;/h2>&lt;p>{% blockquote %}&lt;/p>
&lt;p>漏洞描述：&lt;/p>
&lt;p>CVE-2015-0204:OpenSSL是OpenSSL团队开发的一个开源的能够实现安全套接层（SSL v2/v3）和安全传输层（TLS v1）协议的通用加密库，它支持多种加密算法，包括对称密码、哈希算法、安全散列算法等. OpenSSL的s3_clnt.c文件中的‘ssl3_get_key_exchange’函数存在安全漏洞.远程攻击者可通过提供临时的RSA密钥利用该漏洞实施RSA-to-EXPORT_RSA降级攻击，加快暴力破解进度.以下版本受到影响：OpenSSL 0.9.8zd之前版本，1.0.0p之前1.0.0版本，1.0.1k之前1.0.1版本.&lt;/p>
&lt;p>{% endblockquote %}&lt;/p>
&lt;p>分析处理：&lt;/p>
&lt;ul>
&lt;li>根据描述是某些 TLS 版本存在该漏洞，那么解决思路就指向：把这些有漏洞的 TLS 版本不启用不就完事了。事实也是如此&lt;/li>
&lt;li>待按步骤操作完后，iNode 客户端就拨不上了（配置了 SSLVPN 服务），提示找不到网关&lt;/li>
&lt;li>起初以为是加密套件去掉的太多了（还有其他漏洞，诸如：CVE-2002-20001，CVE-2016-2183，CVE-2016-2183,，CVE-2016-6329，CVE-2013-2566，CVE-2015-2808， CVE-2015-4000，CVE-2015-0204），处理上面这些漏洞，看着漏洞描述去除了一些加密套件&lt;/li>
&lt;li>又把这些去掉的加密套件加上测试了一轮，客户端还是拨号失败，直到把 TLS 1.0 加上，拨上了。&lt;/li>
&lt;li>问题指向了 iNode 客户端，经过上官网下载最新版 iNode 定制了一个新版本客户端，无意中发现有个 TLS 版本的选项（只有TLS 1.0 和 TLS1.2可选），瞬间拨云见雾&lt;/li>
&lt;li>大概率是这个防火墙自带的客户端版本默认使用了 TLS 1.0，而这个TLS 1.0 刚好处在漏洞描述中的受影响版本内&lt;/li>
&lt;li>一轮操作后，漏扫设备不再检测出这个漏洞&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="icmp权限许可和访问控制问题漏洞cve-1999-0524">ICMP权限许可和访问控制问题漏洞(CVE-1999-0524)
&lt;/h2>&lt;p>{% blockquote %}&lt;/p>
&lt;p>漏洞描述：&lt;/p>
&lt;p>ICMP信息如netmask和timestamp允许任意主机访问.&lt;/p>
&lt;p>{% endblockquote %}&lt;/p>
&lt;p>分析处理：&lt;/p>
&lt;ul>
&lt;li>
&lt;p>根据描述，此漏洞属于信息级别，不在低危漏洞及以上范围&lt;/p>
&lt;/li>
&lt;li>
&lt;p>网络上已经有很多文章描述和处理这个漏洞&lt;/p>
&lt;/li>
&lt;li>
&lt;p>按照这个时间看，&lt;code>1999&lt;/code> 年 CVE 收录和确认的漏洞，为什么过了20年 ICMP 协议还不处理？亦或是无法处理？&lt;/p>
&lt;/li>
&lt;li>
&lt;p>解决方法有两个&lt;/p>
&lt;ul>
&lt;li>配置一条安全策略阻断攻击者发送的 ICMP TYPE 13 CODE0 和 ICMP TYPE 17 CODE 0 的报文到达设备&lt;/li>
&lt;li>配置高级 ACL 阻断攻击者发送的 ICMP TYPE 13 CODE0 和 ICMP TYPE 17 CODE 0 的报文到达设备&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>防火墙的本地IP地址有多个，使用 ACL 的话会繁琐，所以配置了安全策略&lt;/p>
&lt;/li>
&lt;li>
&lt;p>交换机和路由器设备，可以使用配置高级 ACL 的方式进行规避&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 配置高级 ACL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl advanced 3456
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> description FIX_FOR_CVE-1999-0524
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 0 deny icmp icmp-type timestamp-request
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 5 deny icmp icmp-type 17 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 10 permit ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 接口过滤调用
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan-interface XXX
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> packet-filter 3456 inbound hardware-count
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul></description></item><item><title>关于组网中使用默认MSTP的问题</title><link>https://weeaster.github.io/posts/8eea84ef/</link><pubDate>Fri, 04 Nov 2022 13:28:31 +0000</pubDate><guid>https://weeaster.github.io/posts/8eea84ef/</guid><description>&lt;p>在一个项目中，或者说在一个不使用 VRRP 组网并且没有进行负载分担的核心网络中，项目初始时并没有刻意的去规划 生成树 这个协议。以华三设备为例，交换机默认开启了 MSTP 协议，所以在建设时有意或者无意的导致交换机的环路并不会使整个网络因此瘫痪.&lt;/p>
&lt;p>关于生成树协议的工作原理，不在本文的要说明的范围内，可以自行Google或到各厂商官网查询，本文中用到的术语以华三厂商为例，可能与其他厂商叫法不一样，但是我想看这篇文的观众都知道，生成树协议不是私有协议（MSTP由IEEE制定的802.1s标准定义）。&lt;/p>
&lt;p>写这篇文是想探讨一下一个网络中使用默认的 MSTP 可能导致的一些问题和关于生成树的调整&lt;/p>
&lt;p>下面使用 HCL 搭建了一个经典的 核心/汇聚/接入 的三层网络，刻意构造的一个环路。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/11/04/d3u6pEmq2SGYfwJ.png">
&lt;img src="https://s2.loli.net/2022/11/04/d3u6pEmq2SGYfwJ.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="分析网络中的生成树">分析网络中的生成树
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>在实际项目中，是很难确定最小的mac的交换机就是核心交换机，这样导致的结果就是生成树的根桥不一定就在核心交换机上，上图的实验拓扑中也刻意的把mac大的两台交换机放在了核心上&lt;/p>
&lt;/li>
&lt;li>
&lt;p>通过命令查看，核心交换机 (CORE_SW1) 聚合组101 为 ROOT 根端口，根桥是 32768.186d-08c1-0100&lt;/p>
&lt;p>{% blockquote %}&lt;/p>
&lt;p>根端口
所谓根端口，是指非根桥设备上离根桥最近的端口。根端口负责与根桥进行通信。非根桥设备上有且只有一个根端口，根桥上没有根端口。&lt;/p>
&lt;p>{% endblockquote %}&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;CORE_SW1&amp;gt;dis stp brief
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> MST ID Port Role STP State Protection
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0 Bridge-Aggregation101 ROOT FORWARDING NONE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0 Bridge-Aggregation102 DESI FORWARDING NONE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;CORE_SW1&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;CORE_SW1&amp;gt;dis stp ro
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;CORE_SW1&amp;gt;dis stp root
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> MST ID Root Bridge ID ExtPathCost IntPathCost Root Port
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0 32768.186d-08c1-0100 58 0 BAGG101
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;CORE_SW1&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>为什么会出现这种情况&lt;/p>
&lt;p>首先根据 MST 域 的定义，结合 H3C 官网说明，判断出上图中每个交换机都是不同 MST 域，上面拓扑图中本质就由 6 个 MST 域组成，尽管它们域的配置除了域名不一样，其他参数都一样。剩下的就是 MST 域与 MST 域 的生成树关系。&lt;/p>
&lt;p>{% blockquote %}&lt;/p>
&lt;p>MST域
MST域（Multiple Spanning Tree Regions，多生成树域）是由交换网络中的多台设备以及它们之间的网段所构成。这些设备具有下列特点：
· 都开启了生成树协议。
· 域名相同。
· VLAN与MSTI间映射关系的配置相同。
· MSTP修订级别的配置相同。
· 这些设备之间有物理链路连通&lt;/p>
&lt;p>{% endblockquote %}&lt;/p>
&lt;p>{% blockquote %}&lt;/p>
&lt;p>CIST
CIST（Common and Internal Spanning Tree，公共和内部生成树）是一棵连接交换网络内所有设备的单生成树，所有MST域的IST再加上CST就共同构成了整个交换网络的一棵完整的单生成树，即CIST。&lt;/p>
&lt;p>CIST生成树的计算
通过比较BPDU后，在整个网络中选择一个优先级最高的设备作为CIST的根桥。在每个MST域内MSTP通过计算生成IST；同时MSTP将每个MST域作为单台设备对待，通过计算在域间生成CST。CST和IST构成了整个网络的CIST。&lt;/p>
&lt;p>{% endblockquote %}&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="可能导致的问题">可能导致的问题
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>依照上面拓扑图搭建网络会出现什么问题&lt;/p>
&lt;p>查看 AGGE_SW1 生成树信息，发现汇聚交换机下联接入交换机的端口是 Alternate Port 角色，不转发业务流量。造成的具体表现就是从核心交换机方向的流量要回到 ACC_SW1 上的终端设备会绕道 ACC_SW2 再到 ACC_SW1 的终端。是不是很不合理&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;AGGE_SW1&amp;gt;dis stp brief
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> MST ID Port Role STP State Protection
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0 Bridge-Aggregation23 DESI FORWARDING NONE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0 GigabitEthernet1/0/1 ALTE DISCARDING NONE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0 GigabitEthernet1/0/2 ROOT FORWARDING NONE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;AGGE_SW1&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h2 id="解决之道">解决之道
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>要扭转 &lt;strong>说2&lt;/strong> 中这种不合理的流量路径，方法也很简单，保证核心交换机是根桥即可&lt;/p>
&lt;/li>
&lt;li>
&lt;p>配置核心交换机为根桥&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[CORE_SW1]stp instance 0 root primary
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h2 id="最后">最后
&lt;/h2>&lt;ul>
&lt;li>文中可能有些配置未提及或内容术语表述的不规范，请见谅。&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨。&lt;/li>
&lt;/ul></description></item><item><title>工业交换机电源线缆选择</title><link>https://weeaster.github.io/posts/cadda170/</link><pubDate>Sat, 30 Jul 2022 22:53:41 +0000</pubDate><guid>https://weeaster.github.io/posts/cadda170/</guid><description>&lt;h3 id="交流供电端至独立电源交流电源线">交流供电端至独立电源（交流电源线）
&lt;/h3>&lt;h4 id="标准">标准
&lt;/h4>&lt;p>&lt;strong>通信机房用阻燃软结构电缆，标识（RVVZ（ZRVVR))&lt;/strong>&lt;/p>
&lt;p>RVVZ电缆是采用细丝合股多层复绞形式，具有良好的柔软性，弯曲性能高，同时具有高阻燃性能。
R——软
V——聚氯乙烯护套
V——聚氯乙烯绝缘
Z——阻燃
RVVZ电缆常见型号
RVZ&amp;ndash;铜芯阻燃聚氯乙烯绝缘软电缆　　　
RVVZ&amp;ndash;铜芯阻燃聚氯乙烯绝缘和护套软电缆
RVVZ22&amp;ndash;铜芯阻燃聚氯乙烯绝缘和护套钢带铠装软电缆
RVFH&amp;ndash;铜芯阻燃聚氯乙烯绝缘防火软电缆
RVVFH&amp;ndash;铜芯阻燃聚氯乙烯绝缘和护套防火软电缆
RVVFH22&amp;ndash;铜芯阻燃聚氯乙烯绝缘和护套钢带铠装防火软电缆&lt;/p>
&lt;p>&lt;strong>电压等级&lt;/strong>
RVVZ、RVVZ22、RVVFH、RVVFH22型号的电缆为&lt;strong>0.6/1KV&lt;/strong>。&lt;/p>
&lt;p>&lt;strong>适用范围&lt;/strong>
适用于电信、邮电、铁路、化工、消防、通信等&lt;strong>通信机房配电系统的内部连接线&lt;/strong>，既适合于固定敷设也可做移动电缆使用，在特殊环境中尤为适用，本产品适用于通信机房、移动机站及高层建筑等电源的输、配电系统中**．交流额定电压**O.6／1kV及以下阻燃、耐火软电缆。&lt;/p>
&lt;p>&lt;strong>RVV和RVVZ的区别&lt;/strong>&lt;/p>
&lt;p>1、RVV一般叫做软电线，RVVZ(ZR-VVR)一般叫软电缆。&lt;/p>
&lt;p>2、电压等级：RVV：300/500V， RVVZ：0.6/1KV&lt;/p>
&lt;p>3、使用场合&lt;/p>
&lt;p>​ RVV：主要应用于电器、仪表和电子设备及自动化装置用电源线、控制线及信号传输线，具体可用于防盗报警系统、楼宇对讲系统等。&lt;/p>
&lt;p>​ &lt;strong>RVVZ：适用于交流额定电压为0.6/1KV及以下对柔软度要求非常高的的输配电线路上。&lt;/strong>&lt;/p>
&lt;h4 id="选用建议">选用建议
&lt;/h4>&lt;ul>
&lt;li>选用 &lt;strong>3 芯 RVVZ&lt;/strong> 标准的线缆用于供电插座至 H3C DG-30-S24II 电源的交流供电。&lt;/li>
&lt;/ul>
&lt;h4 id="线缆标识">线缆标识：
&lt;/h4>$$
RVVZ--O.6／1kV --3* 1.0 m{m}^2
$$&lt;hr>
&lt;h3 id="独立电源至工业交换机接入端直流电源线">独立电源至工业交换机接入端（直流电源线）
&lt;/h3>&lt;h4 id="标准-1">标准
&lt;/h4>&lt;p>&lt;strong>根据官网资料查询，直流电源线的要求:&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>铜制线缆&lt;/p>
&lt;/li>
&lt;li>
&lt;p>线径：0.5mm^2 或 20AWG&amp;ndash;3mm^2 或 12 AWG&lt;/p>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">美国线规（英文是American wire gauge，缩写为AWG），是一种区分导线直径的标准，又被称为 Brown &amp;amp; Sharpe线规。这种标准化线规系统于1857年起在美国开始使用。导线的直径与导线承载电流的能力有很大关系。线规数字越小，表示线材直径越粗，所能承载的电流就越大；反之，线规数字越大，表示线材直径越细，所能承载的电流就越小。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">AWG表适用于单根、实心、圆形的导线。
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="选用建议cwg-标准选购">选用建议(CWG 标准选购)
&lt;/h4>&lt;p>&lt;strong>线芯&lt;/strong>：最小截面积为0.5mm^2， 最大截面积 3mm^2 的范围内选购线缆&lt;/p>
&lt;p>&lt;strong>线芯数&lt;/strong>： 2芯&lt;/p>
&lt;p>&lt;strong>套线&lt;/strong>： RVV软护套线&lt;/p>
&lt;h4 id="线缆标识-1">线缆标识
&lt;/h4>$$
RVV - 2* 1.0 m{m}^2
$$</description></item><item><title>CDN_error</title><link>https://weeaster.github.io/posts/ded21811/</link><pubDate>Wed, 08 Jun 2022 15:07:03 +0000</pubDate><guid>https://weeaster.github.io/posts/ded21811/</guid><description>&lt;p>最近发现我这个小破博客网站访问贼慢 ，FancyBox下的图片打开不是显示相册的模式而是跳转到图床网站显示，起初以为是网络不稳定，平时也不怎么关注，今天才注意到是cdn资源访问异常。&lt;/p>
&lt;p>{% colorquote info %}
Thank you all for your tests, feedback and support. I am personally sorry for the issues we had today.&lt;/p>
&lt;p>We can consider the issue as resolved, now its a question of DNS propagation getting to everyone.&lt;/p>
&lt;p>Our official announcement regarding the problems today:&lt;/p>
&lt;p>Unfortunately today jsDelivr unexpectedly lost its ICP license in China. As effect the regional CDN disabled our account.&lt;/p>
&lt;p>This resulted in the extended outage we had in mainland China and Taiwan.&lt;/p>
&lt;p>Other regions were unaffected.&lt;/p>
&lt;p>We understand how difficult it was for our users to experience this unique situation.&lt;/p>
&lt;p>From now on all Chinese traffic will be served by &amp;ldquo;near China&amp;rdquo; locations provided by global CDN providers.&lt;/p>
&lt;p>This will have the additional benefit of better failover logic in the future.
{% endcolorquote %}&lt;/p>
&lt;p>以上大概意思是 jsDelivr ICP 证书在中国大陆失效，无法访问jsDelivr资源。&lt;/p>
&lt;p>再看看github上的说法，GFW 巴拉巴拉……&lt;/p>
&lt;p>通过搜索引擎发现，当然还是有解决方法能处理这种情况。&lt;/p>
&lt;p>心情好了再弄吧，心累。&lt;/p>
&lt;p>……&lt;/p></description></item><item><title>H3C_Python_SSH_Config_Auto_2</title><link>https://weeaster.github.io/posts/2699eb47/</link><pubDate>Fri, 13 May 2022 13:59:08 +0000</pubDate><guid>https://weeaster.github.io/posts/2699eb47/</guid><description>&lt;ul>
&lt;li>针对上一版的脚本进行改进&lt;/li>
&lt;li>增加嵌套一层 ‘ Try……finally: ’ ，代码执行末尾提示 “按任意键退出”&lt;/li>
&lt;li>修改代码中预定义的登陆账号密码为 input 和 getpass 手动输入&lt;/li>
&lt;li>修改文件当前目录为代码自动获取 os.getcwd()&lt;/li>
&lt;li>修改执行完成后显示 “A log file is available in……” 记录log路径&lt;/li>
&lt;li>想改多线程，threading 模块逻辑没搞清楚&lt;/li>
&lt;/ul>
&lt;h2 id="两个脚本">两个脚本
&lt;/h2>&lt;h3 id="01">01
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># File： py_net.py&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Time： 2022/05/13 12:20:35&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Author： Kir&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Ver： 2.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Description： AutoOutput/SSH/Log&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">time&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">netmiko&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">ConnectHandler&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">NetMikoAuthenticationException&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">NetMikoTimeoutException&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">os&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">re&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">msvcrt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">getpass&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 校验账户交给netmiko模块，仅输入&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">login_user&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">input&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Login:&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">login_pwd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">getpass&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">getpass&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Passwd:&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 时间格式蒸鹅心，冒号不能用做文件名字符&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%Y%m&lt;/span>&lt;span class="si">%d&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H%M%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H:%M:%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 获取当前工作目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">getcwd&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">time_str1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># mkdir path &amp;amp; touch file&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">new_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">title&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="se">\\&lt;/span>&lt;span class="s2">configuration_backup&amp;#34;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">new_path&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">isdir&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">new_path&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">makedirs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">new_path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">isdir&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config_path&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">makedirs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config_path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 创建日志文件，记录运行结果&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log_fo&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="se">\\&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="s1">.log&amp;#39;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">config_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time_str1&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;a+&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;utf-8&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;==========START TIME &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;=========&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 读取 ip_list.txt 里的 ip 地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;ip_list.txt&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;r&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ascii&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip_addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ip_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">readlines&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># display 命令&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cmd_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;cmd_list.txt&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;r&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ascii&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cmd_line&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cmd_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">readlines&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cmd_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 遍历 ip_addr 列表里面的 ip 进行连接&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">iter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ip_addr&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">S5130&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;device_type&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;hp_comware&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">ip&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;username&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">login_user&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;password&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">login_pwd&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">net_connect&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ConnectHandler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">**&lt;/span>&lt;span class="n">S5130&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 禁用输出屏幕分屏&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">screen_d&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net_connect&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send_command&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;screen-length disable&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># current_time as part of filename&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H%M%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># sysname as part of fielname&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sysn&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net_connect&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send_command&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;dis cur | inc sysname&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># split 空格分割回显内容&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sysn&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">re&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;[ ]+&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sysn&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sysn&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">sysn&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 创建文件, 格式为 sysname + time_str2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config_fo&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="se">\\&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="s1">_&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="s1">_config.txt&amp;#39;&lt;/span> &lt;span class="o">%&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">config_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sysn&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time_str2&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;a&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;utf-8&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H:%M:%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">time_str1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;_&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39; Successfully connected to &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">time_str1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;_&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39; Successfully connected to &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">ip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">cmd&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">iter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cmd_line&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 发送 cmd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cmd_result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net_connect&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send_command&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cmd&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cmd&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cmd_result&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;===================================================================&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;===================================================================&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">cmd&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">cmd_result&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">net_connect&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">disconnect&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="ne">EOFError&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">NetMikoTimeoutException&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Can not connect to Device &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">ip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H:%M:%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">time_str1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;_&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39; Can not connect to Device &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">ip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="ne">EOFError&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">NetMikoAuthenticationException&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;username/password wrong! &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">ip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H:%M:%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">time_str1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;_&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39; username/password wrong! &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">ip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str4&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H:%M:%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;==========END TIME &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time_str4&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;==========&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;A log file is available in &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\&amp;#34;&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">config_path&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\\&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;.log&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\&amp;#34;&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">finally&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Press any key to quit program.&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">ord&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">msvcrt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">getch&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="02">02
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># File： py_net_config.py&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Time： 2022/05/13 12:19:59&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Author： Kir&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Ver： 2.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Description：AutoConfig/SSH/Log&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">time&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">netmiko&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">ConnectHandler&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">NetMikoAuthenticationException&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">NetMikoTimeoutException&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">os&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">re&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">msvcrt&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">getpass&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 校验账户交给netmiko模块，仅输入&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">login_user&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">input&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Login:&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">login_pwd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">getpass&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">getpass&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Passwd:&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 时间格式蒸鹅心，冒号不能用做文件名字符&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%Y%m&lt;/span>&lt;span class="si">%d&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H%M%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H:%M:%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 获取当前工作目录&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">getcwd&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">time_str1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># mkdir path &amp;amp; touch file&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">new_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">title&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="se">\\&lt;/span>&lt;span class="s2">configure_device&amp;#34;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">new_path&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">isdir&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">new_path&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">makedirs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">new_path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">isdir&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config_path&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">makedirs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config_path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 创建日志文件，记录运行结果&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log_fo&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="se">\\&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="s1">.log&amp;#39;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">config_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time_str1&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;a+&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;utf-8&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;==========START TIME &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;=========&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 读取 ip_list.txt 里的 ip 地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;ip_list.txt&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;r&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ascii&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip_addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ip_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">readlines&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 读取 cmd_config_list.txt 文件的配置命令&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cmd_config_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;cmd_config_list.txt&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;r&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ascii&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cmd_line&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cmd_config_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">readlines&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;AddCommand-line: &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nb">str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cmd_line&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cmd_config_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 遍历 ip_addr 列表里面的 ip 进行连接&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">iter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ip_addr&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">S5130&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;device_type&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;hp_comware&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">ip&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;username&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">login_user&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;password&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">login_pwd&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">net_connect&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ConnectHandler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">**&lt;/span>&lt;span class="n">S5130&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 禁用输出屏幕分屏&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">screen_d&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net_connect&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send_command&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;screen-length disable&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># current_time as part of filename&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H%M%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># sysname as part of fielname&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sysn&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net_connect&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send_command&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;dis cur | inc sysname&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># split 空格分割回显内容&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sysn&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">re&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;[ ]+&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sysn&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sysn&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">sysn&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 创建文件, 格式为 sysname + time_str2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config_fo&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="se">\\&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="s1">_&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="s1">_add_config.txt&amp;#39;&lt;/span> &lt;span class="o">%&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">(&lt;/span>&lt;span class="n">config_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sysn&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time_str2&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;a&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;utf-8&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H:%M:%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">time_str1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;_&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39; Successfully connected to &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39; Configuring...&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">time_str1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;_&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39; Configuration complete: &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39; Successfully connected to &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">ip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 发送 cmd_line&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cmd_result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net_connect&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send_config_set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cmd_line&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cmd_result&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;===================================================================&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;===================================================================&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">cmd_result&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">net_connect&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">disconnect&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="ne">EOFError&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">NetMikoTimeoutException&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Can not connect to Device &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">ip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H:%M:%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">time_str1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;_&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39; Configuration Fail: &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39; Can not connect to Device! &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">ip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="ne">EOFError&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">NetMikoAuthenticationException&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;username/password wrong! &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">ip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H:%M:%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">time_str1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;_&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39; Configuration Fail: &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39; username/password wrong! &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">ip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str4&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H:%M:%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;==========END TIME &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time_str4&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;==========&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;A log file is available in &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\&amp;#34;&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">config_path&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\\&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;.log&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\&amp;#34;&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">finally&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Press any key to quit program.&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">ord&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">msvcrt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">getch&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="参考资料">参考资料:
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">- Python-交换机自动化巡检脚本笔记 by 02EVA on 2021-04-22 : https://blog.csdn.net/weixin_42065669/article/details/116009445
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-「Python 网络自动化」Netmiko ——Netmiko 常用方法 by 某呆啊 on 2021-02-04 : https://blog.csdn.net/q965844841qq/article/details/113619281
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Python 逐行读取txt 文件并生成列表 by 诺亚方包 on 2020-05-19 : https://blog.csdn.net/weixin_40973138/article/details/106209020
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Python 使用 Netmiko 连接 H3C 网络设备 by 某呆 on 2021-02-03 : https://555.xdai.vip/posts/26e9de3c.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- H3C交换机python命令下发脚本 by xuwenfang1989 on 2018-08-27 : https://blog.51cto.com/u_1339643/2164819
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Python实现“按任意键返回”和无回显输入 by dongfuguo on 2020-03-25 : https://blog.csdn.net/dongfuguo/article/details/105103446
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Python3文件路径/目录获取教程 by 诸子流 on 2020-07-09 : `https://www.cnblogs.com/lsdb/p/13265688.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- 如何让python不打印转义字符串？by 流芳 on 2020-07-07 : https://www.py.cn/jishu/jichu/19480.html
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>H3C_Python_SSH_Config_Auto</title><link>https://weeaster.github.io/posts/54cb8229/</link><pubDate>Wed, 11 May 2022 17:50:10 +0000</pubDate><guid>https://weeaster.github.io/posts/54cb8229/</guid><description>&lt;ul>
&lt;li>Python 脚本 SSH 登陆华三设备，使用定义好的 display 脚本批量导出配置和一些设备状态&lt;/li>
&lt;li>Python 脚本 SSH 登陆华三设备，使用定义好的配置命令批量增加配置&lt;/li>
&lt;li>主要使用的是 netmiko 这个模块里的 ConnectHandler 命令&lt;/li>
&lt;li>单线程&lt;/li>
&lt;li>脚本运行完成后输出 成功和失败的记录log&lt;/li>
&lt;li>ip_list.txt，cmd_list.txt，cmd_config_list.txt 格式简单，修改方便&lt;/li>
&lt;li>未做多账号密码的 if 语句判断&lt;/li>
&lt;li>肯定有冗余繁重的代码&lt;/li>
&lt;/ul>
&lt;h2 id="脚本文件">脚本文件
&lt;/h2>&lt;h3 id="py01py">&lt;strong>py01.py&lt;/strong>
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">time&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">netmiko&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">ConnectHandler&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">NetMikoAuthenticationException&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">NetMikoTimeoutException&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">os&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">re&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">time_str1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%Y_%m_&lt;/span>&lt;span class="si">%d&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">time_str2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H%M%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">time_str3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H:%M:%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;F:&lt;/span>&lt;span class="se">\\&lt;/span>&lt;span class="s2">XXXXX&lt;/span>&lt;span class="se">\\&lt;/span>&lt;span class="s2">py_net&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">time_str1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># mkdir path &amp;amp; touch file&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">new_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">title&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="se">\\&lt;/span>&lt;span class="s2">configuration_backup&amp;#34;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">new_path&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">isdir&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">new_path&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">makedirs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">new_path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">isdir&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config_path&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">makedirs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config_path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 创建日志文件，记录运行结果&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">log_fo&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="se">\\&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="s1">.log&amp;#39;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">config_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time_str1&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="s1">&amp;#39;a+&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;utf-8&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">log_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;==========START TIME &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;=========&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 读取 ip_list.txt 里的 ip 地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;ip_list.txt&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;r&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ascii&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip_addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ip_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">readlines&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># display 命令&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cmd_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;cmd_list.txt&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;r&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ascii&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cmd_line&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cmd_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">readlines&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cmd_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 遍历 ip_addr 列表里面的 ip 进行连接&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">iter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ip_addr&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">S5130&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;device_type&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;hp_comware&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">ip&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;username&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;admin&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;password&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;xxxxxxxxxx&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">net_connect&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ConnectHandler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">**&lt;/span>&lt;span class="n">S5130&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 禁用输出屏幕分屏&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">screen_d&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net_connect&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send_command&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;screen-length disable&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># current_time as part of filename&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H%M%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># sysname as part of fielname&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sysn&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net_connect&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send_command&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;dis cur | inc sysname&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># split 空格分割回显内容&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sysn&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">re&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;[ ]+&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sysn&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sysn&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">sysn&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 创建文件, 格式为 sysname + time_str2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config_fo&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="se">\\&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="s1">_&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="s1">_config.txt&amp;#39;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">config_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sysn&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time_str2&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="s1">&amp;#39;a&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;utf-8&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H:%M:%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">time_str1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;_&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39; Successfully connected to &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">ip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">time_str1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;_&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39; Successfully connected to &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">ip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">cmd&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">iter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cmd_line&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cmd_result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net_connect&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send_command&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cmd&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cmd&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cmd_result&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;===================================================================&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;===================================================================&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="n">cmd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="n">cmd_result&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">net_connect&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">disconnect&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="ne">EOFError&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">NetMikoTimeoutException&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Can not connect to Device &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">ip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H:%M:%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">time_str1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;_&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39; Can not connect to Device &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">ip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="ne">EOFError&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">NetMikoAuthenticationException&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;username/password wrong! &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">ip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H:%M:%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">time_str1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;_&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39; username/password wrong! &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">ip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">time_str4&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H:%M:%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">log_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;==========END TIME &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time_str4&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;==========&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">log_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">log_fo&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="py02py">&lt;strong>py02.py&lt;/strong>
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">time&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">netmiko&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">ConnectHandler&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">NetMikoAuthenticationException&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">NetMikoTimeoutException&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">os&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">re&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">time_str1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%Y_%m_&lt;/span>&lt;span class="si">%d&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">time_str2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H%M%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">time_str3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H:%M:%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;F:&lt;/span>&lt;span class="se">\\&lt;/span>&lt;span class="s2">XXXXX&lt;/span>&lt;span class="se">\\&lt;/span>&lt;span class="s2">py_net&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">title&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">time_str1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># mkdir file &amp;amp; touch file&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">new_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">title&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">config_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="se">\\&lt;/span>&lt;span class="s2">configure_device&amp;#34;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">new_path&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">isdir&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">new_path&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">makedirs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">new_path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">isdir&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config_path&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">makedirs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config_path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 创建日志文件，记录运行结果&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">log_fo&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="se">\\&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="s1">.log&amp;#39;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">config_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time_str1&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="s1">&amp;#39;a+&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;utf-8&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">log_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;==========START TIME &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;=========&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 读取 ip_list.txt 里的 ip 地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;ip_list.txt&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;r&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ascii&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip_addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ip_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">readlines&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 读取 cmd_config_list.txt 文件的配置命令&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cmd_config_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;cmd_config_list.txt&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;r&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;ascii&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cmd_line&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">cmd_config_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">readlines&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cmd_line&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">cmd_config_list&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 遍历 ip_addr 列表里面的 ip 进行连接&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">iter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ip_addr&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">S5130&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;device_type&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;hp_comware&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;ip&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">ip&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;username&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;admin&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s1">&amp;#39;password&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;xxxxxxxxxx&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">net_connect&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ConnectHandler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">**&lt;/span>&lt;span class="n">S5130&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 禁用输出屏幕分屏&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">screen_d&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net_connect&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send_command&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;screen-length disable&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># current_time as part of filename&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H%M%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># sysname as part of fielname&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sysn&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net_connect&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send_command&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;dis cur | inc sysname&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># split 空格分割回显内容&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sysn&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">re&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s2">&amp;#34;[ ]+&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sysn&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sysn&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">sysn&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 创建文件, 格式为 sysname + time_str2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config_fo&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="se">\\&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="s1">_&lt;/span>&lt;span class="si">%s&lt;/span>&lt;span class="s1">_add_config.txt&amp;#39;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">config_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sysn&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time_str2&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="s1">&amp;#39;a&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;utf-8&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H:%M:%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">time_str1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;_&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39; Successfully connected to &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39; Configuring...&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">time_str1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;_&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39; Configuration complete: &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39; Successfully connected to &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">ip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cmd_result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">net_connect&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">send_config_set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cmd_line&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cmd_result&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;===================================================================&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;===================================================================&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="n">cmd_result&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">net_connect&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">disconnect&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="ne">EOFError&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">NetMikoTimeoutException&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;Can not connect to Device &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">ip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H:%M:%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">time_str1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;_&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39; Configuration Fail: &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39; Can not connect to Device! &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">ip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="ne">EOFError&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">NetMikoAuthenticationException&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;username/password wrong! &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">ip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H:%M:%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">log_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">time_str1&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;_&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time_str3&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39; Configuration Fail: &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39; username/password wrong! &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">ip&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">time_str4&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strftime&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%H:%M:%S&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">time&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">localtime&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">log_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;==========END TIME &amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">time_str4&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;==========&amp;#34;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">log_fo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">log_fo&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="运行环境">运行环境
&lt;/h2>&lt;ol>
&lt;li>Python3，理论上 Python3 版本都可运行，没看到新版本更新日志说哪里有变动
&lt;ul>
&lt;li>在 win7 系统 3.8.10 版本运行测试无问题&lt;/li>
&lt;li>在 win10 系统 3.9.7 版本运行测试无问题&lt;/li>
&lt;li>在 win10 系统 3.10.4 版本运行测试无问题&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>安装 netmiko&lt;/li>
&lt;li>测试连接 HCL_Setup_V3.0.1 模拟器设备无问题&lt;/li>
&lt;li>测试连接真实 H3C 设备，无问题&lt;/li>
&lt;li>运行速度取决与设备的连接反应和脚本行数&lt;/li>
&lt;/ol>
&lt;h2 id="三个文件">三个文件
&lt;/h2>&lt;p>&lt;strong>ip_list.txt&lt;/strong> （faker）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">10.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">10.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">10.1.1.3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">10.1.1.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">10.1.1.5
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>cmd_list.txt&lt;/strong> （faker）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">display&lt;/span> &lt;span class="n">cur&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">display&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">interface&lt;/span> &lt;span class="n">brief&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">display&lt;/span> &lt;span class="n">interface&lt;/span> &lt;span class="n">brief&lt;/span> &lt;span class="n">des&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">display&lt;/span> &lt;span class="n">vlan&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">display&lt;/span> &lt;span class="n">vlan&lt;/span> &lt;span class="n">brief&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">display&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">routing&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">table&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">display&lt;/span> &lt;span class="n">version&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">display&lt;/span> &lt;span class="n">cpu&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">usage&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">display&lt;/span> &lt;span class="n">memory&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">display&lt;/span> &lt;span class="n">power&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">display&lt;/span> &lt;span class="n">fan&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">display&lt;/span> &lt;span class="n">device&lt;/span> &lt;span class="n">manuinfo&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">display&lt;/span> &lt;span class="n">device&lt;/span> &lt;span class="n">verbose&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">display&lt;/span> &lt;span class="n">environment&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">dir&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">display&lt;/span> &lt;span class="n">irf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">display&lt;/span> &lt;span class="n">irf&lt;/span> &lt;span class="n">configuration&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">display&lt;/span> &lt;span class="n">irf&lt;/span> &lt;span class="n">link&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">display&lt;/span> &lt;span class="n">irf&lt;/span> &lt;span class="n">topology&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">display&lt;/span> &lt;span class="n">link&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">aggregation&lt;/span> &lt;span class="n">summary&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">display&lt;/span> &lt;span class="n">link&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">aggregation&lt;/span> &lt;span class="n">member&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">port&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">display&lt;/span> &lt;span class="n">link&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">aggregation&lt;/span> &lt;span class="n">verbose&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">display&lt;/span> &lt;span class="n">current&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">configuration&lt;/span> &lt;span class="n">configuration&lt;/span> &lt;span class="n">system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">display&lt;/span> &lt;span class="n">boot&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">loader&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">save&lt;/span> &lt;span class="n">force&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>cmd_config_list.txt&lt;/strong> （faker）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">vlan 22
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">des MMT22
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dis th
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">int vlan 22
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">des MMT22
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip add 192.168.22.22 24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dis th
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="运行过程">运行过程
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>&lt;strong>py01.py&lt;/strong> 运行结束后会在 本 &lt;strong>py01.py&lt;/strong> 文件所在的目录创建一个名为 20xx_xx_xx （运行此脚本当日年月日）的文件夹&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>py02.py&lt;/strong> 运行结束后会在 本 &lt;strong>py02.py&lt;/strong> 文件所在的目录创建一个名为 20xx_xx_xx（运行此脚本当日年月日） 的文件夹&lt;/p>
&lt;/li>
&lt;li>
&lt;p>以上创建的文件夹，脚本会判断是否存在，如存在则跳过；不存在则创建&lt;/p>
&lt;/li>
&lt;li>
&lt;p>假设已经各运行完成一次以上两个脚本，则名为 20xx_xx_xx 的文件夹下会创建 “configuration_backup” 和 “configure_device”两个文件夹&lt;/p>
&lt;ul>
&lt;li>
&lt;p>configuration_backup 保存导出的配置和一些设备状态信息&lt;/p>
&lt;/li>
&lt;li>
&lt;p>configure_device 保存批量增加配置的记录过程&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/05/11/AGgbNWjTlzyr5FS.png">
&lt;img src="https://s2.loli.net/2022/05/11/AGgbNWjTlzyr5FS.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>
&lt;p>“configuration_backup” 和 “configure_device”两个文件夹下，会生成文件名称为 “ 20xx_xx_xx.log”（当天日期）的文件，用来记录执行成功和执行失败的log&lt;/p>
&lt;/li>
&lt;li>
&lt;p>“configuration_backup” 和 “configure_device”两个文件夹下，有文件名称为 “sysname + time_str2_config.txt” （设备名+创建时间）的 TXT 文件，或 “sysname + time_str2_add_config.txt” （设备名+创建时间）的 TXT 文件&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/05/11/uRM4ScqWdgn2Dep.png">
&lt;img src="https://s2.loli.net/2022/05/11/uRM4ScqWdgn2Dep.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/05/11/vej59thDfGEsQW6.png">
&lt;img src="https://s2.loli.net/2022/05/11/vej59thDfGEsQW6.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="参考资料">参考资料:
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">- Python-交换机自动化巡检脚本笔记 by 02EVA on 2021-04-22 : https://blog.csdn.net/weixin_42065669/article/details/116009445
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-「Python 网络自动化」Netmiko ——Netmiko 常用方法 by 某呆啊 on 2021-02-04 : https://blog.csdn.net/q965844841qq/article/details/113619281
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Python 逐行读取txt 文件并生成列表 by 诺亚方包 on 2020-05-19 : https://blog.csdn.net/weixin_40973138/article/details/106209020
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- Python 使用 Netmiko 连接 H3C 网络设备 by 某呆 on 2021-02-03 : https://555.xdai.vip/posts/26e9de3c.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- H3C交换机python命令下发脚本 by xuwenfang1989 on 2018-08-27 : https://blog.51cto.com/u_1339643/2164819
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>HCL_FW_IRF_LAB</title><link>https://weeaster.github.io/posts/a89a05d3/</link><pubDate>Tue, 03 May 2022 01:09:15 +0000</pubDate><guid>https://weeaster.github.io/posts/a89a05d3/</guid><description>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/05/03/5tMa692q4rmN1Yu.png">
&lt;img src="https://s2.loli.net/2022/05/03/5tMa692q4rmN1Yu.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="实验目的">实验目的
&lt;/h2>&lt;ul>
&lt;li>验证 H3C 防火墙 IRF 堆叠和主备模式&lt;/li>
&lt;li>基于项目中部分核心网络的模拟器测试&lt;/li>
&lt;li>线路交叉互联的问题&lt;/li>
&lt;/ul>
&lt;h2 id="实验描述">实验描述
&lt;/h2>&lt;h3 id="ip-地址规划和端口互联">IP 地址规划和端口互联
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: left">互联设备&lt;/th>
&lt;th style="text-align: left">&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: left">核心防火墙&amp;lt;&amp;ndash;&amp;gt;核心交换机&lt;/td>
&lt;td style="text-align: left">10.1.1.0/30&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">核心防火墙&amp;lt;&amp;ndash;&amp;gt;服务器汇聚&lt;/td>
&lt;td style="text-align: left">10.1.1.4/30&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: left">核心防火墙&amp;lt;&amp;ndash;&amp;gt;外联交换机&lt;/td>
&lt;td style="text-align: left">VLAN10:192.168.10.254&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>A端设备&lt;/th>
&lt;th>端口&lt;/th>
&lt;th>B端设备&lt;/th>
&lt;th>端口&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>FW1&lt;/td>
&lt;td>GE0/23&lt;/td>
&lt;td>FW2&lt;/td>
&lt;td>GE0/23&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FW1&lt;/td>
&lt;td>GE0/1&lt;/td>
&lt;td>SW5&lt;/td>
&lt;td>GE0/1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FW1&lt;/td>
&lt;td>GE0/2&lt;/td>
&lt;td>SW6&lt;/td>
&lt;td>GE0/2&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FW1&lt;/td>
&lt;td>GE0/3&lt;/td>
&lt;td>SW3&lt;/td>
&lt;td>GE0/3&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FW1&lt;/td>
&lt;td>GE0/4&lt;/td>
&lt;td>SW4&lt;/td>
&lt;td>GE0/4&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FW1&lt;/td>
&lt;td>GE0/11&lt;/td>
&lt;td>SW7&lt;/td>
&lt;td>GE0/1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FW2&lt;/td>
&lt;td>GE0/1&lt;/td>
&lt;td>SW6&lt;/td>
&lt;td>GE0/1&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FW2&lt;/td>
&lt;td>GE0/2&lt;/td>
&lt;td>SW5&lt;/td>
&lt;td>GE0/2&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FW2&lt;/td>
&lt;td>GE0/3&lt;/td>
&lt;td>SW4&lt;/td>
&lt;td>GE0/3&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FW2&lt;/td>
&lt;td>GE0/4&lt;/td>
&lt;td>SW3&lt;/td>
&lt;td>GE0/4&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>FW2&lt;/td>
&lt;td>GE0/11&lt;/td>
&lt;td>SW7&lt;/td>
&lt;td>GE0/2&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="防火墙安全域划分">防火墙安全域划分
&lt;/h3>&lt;p>核心交换机：Trust&lt;/p>
&lt;p>服务器汇聚：Server&lt;/p>
&lt;p>外联交换机：Untrust&lt;/p>
&lt;h2 id="配置思路">配置思路
&lt;/h2>&lt;ol>
&lt;li>FW1 与 FW2 之间 IRF 堆叠；SW3 与 SW4 之间 IRF 堆叠；SW5 与 SW6 之间 IRF 堆叠；&lt;/li>
&lt;li>设备互联的端口聚合配置，配置系统优先级和端口优先级，使流量优先流经“主”用设备&lt;/li>
&lt;li>配置互联地址，确保逻辑直连的互通&lt;/li>
&lt;li>配置防火墙安全域和安全策略&lt;/li>
&lt;li>配置 PC IP地址确保与网关的连通性&lt;/li>
&lt;li>配置静态路由确保网络互通&lt;/li>
&lt;li>进行倒换倒回观察网络连通性&lt;/li>
&lt;li>模拟线路故障观察网络连通性&lt;/li>
&lt;/ol>
&lt;h2 id="配置文件">配置文件
&lt;/h2>&lt;ul>
&lt;li>见文末&lt;/li>
&lt;/ul>
&lt;h2 id="聊点什么">聊点什么
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>就线路交叉互联问题，与老友交谈，据他说这种互联方式可能导致丢包现象，例如，流量分别从SW3的G0/3接口和SW4的G0/4接口进入FW1，G0/4的流量会被认为非法流量而丢弃，盲猜是因为会话状态机模式设为严格模式，而运行中出现了来回路径不一致的问题导致丢包。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>就这个交叉互联问题与华三400聊了近半小时，对方给出的方案是按完美的主备处理方式进行组网，（在网络正常的情况下）即流量永远只走一边，只要防火墙上有一个端口出现故障，冗余组全部切换到备。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>主备模式下，设置冗余组，主成员下的端口有任一出现问题，就会整体切换到备，而备设备如在整体切换就有部分端口故障，此时主成员设备的UP状态的端口会在 DOWN 和 DOWN(redundancy down) 之间反复恒跳，而Status出现两个 Secondary，Slot1 的Track优先级也会随着端口的两个 DOWN 状态不同而变化。注意，此时网络并没有中断。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Redundancy group 11 (ID 1):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Node ID Slot Priority Status Track weight
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 Slot1 1 Secondary -1020
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2 Slot2 1 Secondary -255
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>要严格控制流量走一边的情况，就需要接入层网上的设备互联都使用双线互联。而万一“主”设备上联到上一层“主”设备的线路故障了，那么恭喜你可能网络瘫痪了，举个例子，拓扑中SW3与SW11的G0/1接口down，因为SW11上联的两根线路做了聚合，SW11上联的流量会通过G0/2向上走，相当于在核心交换机的SW4上接了一台 PC ，你觉得流量再往上层该怎么走？走到FW2备成员？而FW2是备用状态不处理流量。写到这我才想起来原来华三400建议做两个聚合组是有道理的，SW4 G0/4和G0/3做一个聚合组，就可以人为限制流量又走到FW1，秒啊。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>继续上一条，不使用两组聚合的方式，关闭IRF的本地优先转发，核心交换机上就出现跨框流量，即进入SW4的流量要往上走，要绕道SW3上去，这明显不合理了。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>继续上一条，假如使用核心交换机上联防火墙4根线做一个三层聚合组，FW1往下回流量的时候，由于负载分担的方式，又有可能把流量回给SW4。综合一下，在聚合组配置selected-port maximum 1 同时配置lacp的端口优先级呢，是不是觉得这个方法又蠢又无奈又有用。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>对于要把外联区（SW7）的网关设置在防火墙上的问题，还有一种方式是用 RETH 接口，但是我模拟器配置了，且SW7 查看arp都能看到网关的条目了，就是不通，希望是模拟器bug了，有机会去真机上测试一下再回来聊聊。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>不知道是不是我的错觉，用HCL模拟器做这种冗余类实验，老是出现一些不能理解的问题，这边十万八千里shutdown个端口，那边会受影响那种。&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="ending">Ending
&lt;/h2>&lt;ul>
&lt;li>文中可能有些配置未提及或内容术语表述的不规范，请见谅。&lt;/li>
&lt;li>配置存阿里云盘了，这是链接：[&lt;a class="link" href="https://www.aliyundrive.com/s/1waTfsXdwdm" target="_blank" rel="noopener"
>分享的文件
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>]&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨。&lt;/li>
&lt;/ul></description></item><item><title>IPv6 各隧道Tunnel使用Lab</title><link>https://weeaster.github.io/posts/2e964a67/</link><pubDate>Sun, 03 Apr 2022 07:18:36 +0000</pubDate><guid>https://weeaster.github.io/posts/2e964a67/</guid><description>&lt;p>最近看了很多关于 IPv6 的内容。老早前，大概2000年前后运营商就开始研究推进发展 IPv6 网络技术了，可能是是由于某些我等不知道的原因，这个推进的进程所演化出的表象让我等普通网民没什么感觉。部分科研机构、高校、金融、IT 大厂已经在使用了，一个比较大的使用群体也就是家用部分普及的不大开（我猜的，没有依据）。&lt;/p>
&lt;p>IPv6 相对于 IPv4 有种种的优势，我最有印象的几个是没有广播这个概念、“真 万物互联”、良好的包扩展结构，相对于 IPv4 不存在把什么什么封装进 IPv4 头部后面的字节……巴拉巴拉&lt;/p>
&lt;p>既然是实验，先上图：&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/05/02/WqsFfpynmbOgCe1.png">
&lt;img src="https://s2.loli.net/2022/05/02/WqsFfpynmbOgCe1.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;hr>
&lt;h2 id="start">Start
&lt;/h2>&lt;p>介绍一下这个拓扑包含的内容：&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>A head&lt;/strong> 部分&lt;/p>
&lt;ul>
&lt;li>从运营商处申请到 240E:0:0:1500::/60 前缀，互联地址为静态 IPv6 ：240E:0:0:15::&lt;/li>
&lt;li>PC 网关在 SW19 / SW20，配置负载分担 （HSRP）；使用 MST ；PC 地址为无状态获取，同时获取除地址外的其他 DHCP 参数&lt;/li>
&lt;li>核心交换机与 R5 运行 OSPFv3,&lt;/li>
&lt;li>A head 和 A branch1 / A branch2 组建基于 IPv6 的 DMVPN (mGRE)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>A branch1&lt;/strong> 部分&lt;/p>
&lt;ul>
&lt;li>从运营商处申请到 2409:0:0:2600::/60 前缀，互联地址为静态 IPv6 2409:0:0:26::&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>A branch2 / B head&lt;/strong> 部分&lt;/p>
&lt;ul>
&lt;li>使用 PPPOE 拨号接入 ISP ，WAN 动态 IPv6 地址，并且获取到 PD 用于内部网络&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>其他站点如图所示&lt;/p>
&lt;ul>
&lt;li>R3 为 ISP IPv4 接入路由器，连接 R3 的三个站点除配置了 Tunnel 外，还支持 NAT 访问互联网&lt;/li>
&lt;li>为什么是就配置了这三个站点的 NAT，因为本人电脑内存不够（运行 NAT 的路由器要分配更多内存）&lt;/li>
&lt;li>6RD 的站点内部为 IPv6 网络&lt;/li>
&lt;li>IPv6 Over IPv4 的 站点互通配置了静态或者动态路由协议&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>为了测试，ISP 网络中均配置了环回接口的 IPv4/IPv6 地址，例如：&lt;/p>
&lt;ul>
&lt;li>
&lt;p>R2&lt;/p>
&lt;p>interface Loopback0
ip address 10.2.2.2 255.255.255.255
ipv6 address 2008::2/128&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>除 Manual 和 GRE Tunnel 外，站点所有 IPv6 地址均可互通&lt;/p>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="design--configuration">Design &amp;amp; Configuration
&lt;/h2>&lt;p>&lt;strong>Note：ISP Network 内部运行 OSPF/OSPFv3，不展开说明。&lt;/strong>&lt;/p>
&lt;h3 id="a-head-配置">&lt;strong>A head&lt;/strong> 配置
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! -- R5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Loopback0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.5.5.5 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address FD00::5/128 // 惟一本地地址，不可在互联上路由
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 ospf 100 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address 240E:0:0:15::5/64 // 与 ISP 互联地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 ospf 100 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 ospf network point-to-point
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 ospf 100 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 ospf network point-to-point
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 router ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 10.5.5.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default-information originate // OSPFv3 下发默认路由
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 route ::/0 240E:0:0:15::1 // 指向 ISP 的默认路由
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! -- DMVPN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> description DMVPN_HUB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address FD00:A::1/64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 eigrp 90
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 nhrp network-id 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel source Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel mode gre multipoint ipv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 router eigrp 90 // HUB 与 SPOKE 之间运行 EIGRP,IPv6 multicast over mGRE tunnel is not supported.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor FE80::A8BB:CCFF:FE00:600 Tunnel1 // 手动指邻居
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor FE80::A8BB:CCFF:FE00:700 Tunnel1 // 手动指邻居
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> eigrp router-id 10.5.5.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> redistribute ospf 100 metric 10000 100 255 1 1500 // 重分布 OSPF 进 EIGRP 便于分支站点访问总部网络
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! -- SW19
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 dhcp pool O-POOL // DHCP 参数
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns-server 2008::1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns-server 2008::2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> domain-name a.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spanning-tree mode mst // mst 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spanning-tree mst configuration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name a.com.hub
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> revision 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> instance 10 vlan 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> instance 20 vlan 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spanning-tree mst 10 priority 24576 // 实例 10 的主根桥
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spanning-tree mst 20 priority 28672 // 实例 20 的备根桥
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Loopback0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.19.19.19 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address FD00::19/128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 ospf 100 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Port-channel1 // SW19 SW20 之间的端口聚合
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk allowed vlan 10,20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk encapsulation dot1q
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport mode trunk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport access vlan 519 // 与 R5 互联端口
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk allowed vlan 10,20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk encapsulation dot1q
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport mode trunk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk allowed vlan 10,20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk encapsulation dot1q
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport mode trunk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> channel-group 1 mode active
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk allowed vlan 10,20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk encapsulation dot1q
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport mode trunk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> channel-group 1 mode active
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> standby version 2 // HSRP 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> standby 10 ipv6 autoconfig
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> standby 10 priority 120 // 优先级120，设置为 Active 端
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> standby 10 preempt delay minimum 30 // 抢占延迟 30s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address 240E:0:0:1501::1/64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 nd other-config-flag // O 位
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 dhcp server O-POOL // 分配给终端 DHCP 其他参数
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 ospf 100 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 ospf network point-to-point
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> standby version 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> standby 20 ipv6 autoconfig
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> standby 20 preempt delay minimum 30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address 240E:0:0:1502::1/64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 nd other-config-flag
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 dhcp server O-POOL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 ospf 100 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 ospf network point-to-point
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan519 // 与 R5 互联建立 OSPFV4 邻居
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 ospf 100 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 ospf network point-to-point
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 router ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 10.19.19.19
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! -- SW20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 dhcp pool O-POOL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns-server 2008::1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns-server 2008::2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> domain-name a.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spanning-tree mode mst
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spanning-tree extend system-id
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spanning-tree mst configuration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name a.com.hub
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> revision 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> instance 10 vlan 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> instance 20 vlan 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spanning-tree mst 10 priority 28672
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spanning-tree mst 20 priority 24576
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Loopback0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.20.20.20 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address FD00::20/128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 ospf 100 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Port-channel1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk allowed vlan 10,20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk encapsulation dot1q
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport mode trunk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport access vlan 520
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk allowed vlan 10,20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk encapsulation dot1q
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport mode trunk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> channel-group 1 mode passive
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk allowed vlan 10,20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk encapsulation dot1q
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport mode trunk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> channel-group 1 mode passive
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> standby version 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> standby 10 ipv6 autoconfig
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> standby 10 preempt delay minimum 30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address 240E:0:0:1501::2/64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 nd other-config-flag
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 dhcp server O-POOL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 ospf 100 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 ospf network point-to-point
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> standby version 2 // HSRP 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> standby 20 ipv6 autoconfig
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> standby 20 priority 120 // 优先级120，设置为 Active 端
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> standby 20 preempt delay minimum 30 // 抢占延迟 30s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address 240E:0:0:1502::2/64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 nd other-config-flag
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 dhcp server O-POOL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 ospf 100 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 ospf network point-to-point
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan520
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 ospf 100 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 ospf network point-to-point
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 router ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 10.20.20.20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! -- SW21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spanning-tree mode mst
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spanning-tree mst configuration
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name a.com.hub
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> revision 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> instance 10 vlan 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> instance 20 vlan 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk allowed vlan 10,20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk encapsulation dot1q
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport mode trunk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk allowed vlan 10,20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk encapsulation dot1q
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport mode trunk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport access vlan 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport access vlan 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="a-branch1-配置">&lt;strong>A branch1&lt;/strong> 配置
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! -- R6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 dhcp pool O-POOL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns-server 2008::1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns-server 2008::2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> domain-name a.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel1 // DMVPN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> description DMVPN_BRANCH_1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address FD00:A::2/64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 eigrp 90 // EIGRP 启用
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 nhrp map FD00:A::1/64 240E:0:0:15::5 // 映射 FD00:A::1 R5 的公网 IPv6 地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 nhrp map multicast 240E:0:0:15::5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 nhrp network-id 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 nhrp nhs FD00:A::1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel source Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel mode gre multipoint ipv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> duplex auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address 2409:0:0:26::6/64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address autoconfig default //生成指向 ISP 默认路由
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> duplex auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address 2409:0:0:2600::6/64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 nd other-config-flag
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 eigrp 90 // EIGRP 启用
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 dhcp server O-POOL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 router eigrp 90 //运行 EIGRP,IPv6 multicast over mGRE tunnel is not supported.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor FE80::A8BB:CCFF:FE00:500 Tunnel1 // 手动指邻居
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor FE80::A8BB:CCFF:FE00:700 Tunnel1 // 手动指邻居
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> eigrp router-id 10.6.6.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="a-branch2--b-head-配置">&lt;strong>A branch2 / B head&lt;/strong> 配置
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! -- R7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 dhcp pool O-POOL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns-server 2008::1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns-server 2008::2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> domain-name a.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel1 // DMVPN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> description DMVPN_BRANCH_2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address FD00:A::3/64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 eigrp 90 // EIGRP 启用
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 nhrp map FD00:A::1/64 240E:0:0:15::5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 nhrp map multicast 240E:0:0:15::5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 nhrp network-id 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 nhrp nhs FD00:A::1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel source Dialer1 // 出接口为 Dialer
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel mode gre multipoint ipv6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> duplex auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pppoe enable group global
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pppoe-client dial-pool-number 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> duplex auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address INTRA_PD ::7/64 // 使用获取到的前缀配置接口IPv6地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 nd other-config-flag
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 eigrp 90 // EIGRP 启用
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 dhcp server O-POOL // DHCP 参数下发
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Dialer1 // PPPOE 拨号
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mtu 1492
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> encapsulation ppp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dialer pool 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dialer-group 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address dhcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address autoconfig default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 mtu 1492
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 dhcp client pd INTRA_PD //获取前缀，命名 INTRA_PD
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ppp authentication pap callin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ppp pap sent-username user1 password 0 user1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 router eigrp 90 // 运行 EIGRP,IPv6 multicast over mGRE tunnel is not supported.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor FE80::A8BB:CCFF:FE00:500 Tunnel1 // 手动指邻居
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor FE80::A8BB:CCFF:FE00:600 Tunnel1 // 手动指邻居
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> eigrp router-id 10.7.7.7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-----------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! -- R8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 dhcp pool O-POOL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns-server 2008::1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dns-server 2008::2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> domain-name b.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> duplex auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pppoe enable group global
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pppoe-client dial-pool-number 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> duplex auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address INTRA_PD ::8/64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 nd other-config-flag
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 dhcp server O-POOL // DHCP 参数下发
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Dialer1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mtu 1492
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> encapsulation ppp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dialer pool 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dialer-group 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address dhcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address autoconfig default
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 mtu 1492
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 dhcp client pd INTRA_PD
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ppp authentication pap callin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ppp pap sent-username user2 password 0 user2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! -- R2 PPPOE SERVER
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 dhcp pool DHCPV6POOL //配置 PD 池
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> prefix-delegation pool POOL-2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">username user1 password 0 user1 // 用于 PPPOE 拨号认证
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">username user2 password 0 user2 // 用于 PPPOE 拨号认证
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bba-group pppoe GROUP-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> virtual-template 1 // 绑定模版1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Loopback11 // 这个地址用于复用，不知道Cisco为什么这般设计，直接在模版下配不就行了
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address 2409:0:0:2::2/60
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> duplex auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pppoe enable group GROUP-1 // 调用
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Virtual-Template1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> description PPPOE-GROUP-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mtu 1492
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> peer default ipv6 pool PPPOE-PEER-POOL // 为拨号客户端对端配置 IPv6 的地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 unnumbered Loopback11 // 复用
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 mtu 1492
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 nd managed-config-flag
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ipv6 nd ra suppress
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 dhcp server DHCPV6POOL // PD 下发
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ppp authentication pap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 local pool POOL-2 2409:0:0:2780::/60 64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 local pool PPPOE-PEER-POOL 2409:0:0:2220::/60 64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="isatap-tunnel">ISATAP Tunnel
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! -- R9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel1 // ISATAP Tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip redirects
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address 2409:0:0:2900::/64 eui-64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ipv6 nd ra suppress
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel source Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel mode ipv6ip isatap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> duplex auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address 2409:0:0:29::9/64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.9.254 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> duplex auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 route ::/0 2409:0:0:29::2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="gre-tunnel">GRE Tunnel
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! -- R15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel1 // GRE Tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 ospf 100 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel source Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel destination 200.1.103.10 // R10 WAN 地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 200.1.154.15 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> duplex auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.15.254 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> duplex auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address FD00:F::F/64 // 惟一本地地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 ospf 100 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route 0.0.0.0 0.0.0.0 200.1.154.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 router ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 10.15.15.15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">--&lt;/span> &lt;span class="n">R10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Tunnel1&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="n">GRE&lt;/span> &lt;span class="n">Tunnel&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">no&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ipv6&lt;/span> &lt;span class="n">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ipv6&lt;/span> &lt;span class="n">ospf&lt;/span> &lt;span class="mi">100&lt;/span> &lt;span class="n">area&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">tunnel&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">tunnel&lt;/span> &lt;span class="n">destination&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">154.15&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="n">R15&lt;/span> &lt;span class="n">WAN&lt;/span> &lt;span class="err">地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">103.10&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">outside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">virtual&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">reassembly&lt;/span> &lt;span class="ow">in&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">duplex&lt;/span> &lt;span class="n">auto&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">10.254&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">virtual&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">reassembly&lt;/span> &lt;span class="ow">in&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">duplex&lt;/span> &lt;span class="n">auto&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ipv6&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="n">FD00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">A&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">A&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">64&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="err">惟一本地&lt;/span>&lt;span class="n">IPv6地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ipv6&lt;/span> &lt;span class="n">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ipv6&lt;/span> &lt;span class="n">ospf&lt;/span> &lt;span class="mi">100&lt;/span> &lt;span class="n">area&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="n">list&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="n">overload&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="n">IPv4&lt;/span> &lt;span class="n">NAT&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">103.3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ipv6&lt;/span> &lt;span class="n">router&lt;/span> &lt;span class="n">ospf&lt;/span> &lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">router&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">id&lt;/span> &lt;span class="mf">10.10&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">10.10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">access&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">10.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="6to4-tunnel-and-realy">6to4 Tunnel and Realy
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! -- R14
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel1 // 6to4 Tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip redirects
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 unnumbered Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel source Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel mode ipv6ip 6to4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 200.1.144.14 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> duplex auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address 2408:0:0:E4::E/64 // 与 R4 互联的 IPv6 地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> duplex auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address 2002:C801:900E::E/64 // 6to4 地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route 0.0.0.0 0.0.0.0 200.1.144.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 route 2002::/16 Tunnel1 // 站点互通
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 route ::/0 2408:0:0:E4::4 // 访问 ISP IPv6 网络
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">--&lt;/span> &lt;span class="n">R11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Tunnel1&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="n">to4&lt;/span> &lt;span class="n">Tunnel&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">no&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">no&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">redirects&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ipv6&lt;/span> &lt;span class="n">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">tunnel&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">tunnel&lt;/span> &lt;span class="n">mode&lt;/span> &lt;span class="n">ipv6ip&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="n">to4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">113.11&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">outside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">virtual&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">reassembly&lt;/span> &lt;span class="ow">in&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">duplex&lt;/span> &lt;span class="n">auto&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">11.254&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">virtual&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">reassembly&lt;/span> &lt;span class="ow">in&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">duplex&lt;/span> &lt;span class="n">auto&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ipv6&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mi">2002&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">C801&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">710&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">B&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">64&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="n">to4&lt;/span> &lt;span class="err">地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ipv6&lt;/span> &lt;span class="n">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="n">list&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="n">overload&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="n">IPv4&lt;/span> &lt;span class="n">NAT&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">113.3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ipv6&lt;/span> &lt;span class="n">route&lt;/span> &lt;span class="mi">2002&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">16&lt;/span> &lt;span class="n">Tunnel1&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="err">站点互通&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ipv6&lt;/span> &lt;span class="n">route&lt;/span> &lt;span class="p">::&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="mi">2002&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">C801&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">900&lt;/span>&lt;span class="n">E&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">E&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="err">访问&lt;/span>&lt;span class="n">IPv6&lt;/span> &lt;span class="err">互联&lt;/span> &lt;span class="err">下一跳&lt;/span> &lt;span class="err">到&lt;/span> &lt;span class="n">R14&lt;/span> &lt;span class="err">中继&lt;/span> &lt;span class="err">转发&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">access&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">11.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="manual-tunnel">Manual Tunnel
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! -- R13
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel1 // Manual Tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 rip RIPNG enable // 启用 RIPNG
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel source Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel mode ipv6ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel destination 200.1.123.12
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 200.1.134.13 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> duplex auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> duplex auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address FC00:D::D/64 // 惟一本地IPv6地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 rip RIPNG enable // 启用 RIPNG
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route 0.0.0.0 0.0.0.0 200.1.134.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 router rip RIPNG // 站点互通 RIPNG
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">--&lt;/span> &lt;span class="n">R12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Tunnel1&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="n">Manual&lt;/span> &lt;span class="n">Tunnel&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">no&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ipv6&lt;/span> &lt;span class="n">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ipv6&lt;/span> &lt;span class="n">rip&lt;/span> &lt;span class="n">RIPNG&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="err">启用&lt;/span> &lt;span class="n">RIPNG&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">tunnel&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">tunnel&lt;/span> &lt;span class="n">mode&lt;/span> &lt;span class="n">ipv6ip&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">tunnel&lt;/span> &lt;span class="n">destination&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">134.13&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">123.12&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">outside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">virtual&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">reassembly&lt;/span> &lt;span class="ow">in&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">duplex&lt;/span> &lt;span class="n">auto&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">12.254&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">virtual&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">reassembly&lt;/span> &lt;span class="ow">in&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">duplex&lt;/span> &lt;span class="n">auto&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ipv6&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="n">FC00&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">C&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">C&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">64&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="err">惟一本地&lt;/span>&lt;span class="n">IPv6地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ipv6&lt;/span> &lt;span class="n">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ipv6&lt;/span> &lt;span class="n">rip&lt;/span> &lt;span class="n">RIPNG&lt;/span> &lt;span class="n">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="n">list&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="n">overload&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="n">IPv4&lt;/span> &lt;span class="n">NAT&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">123.3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ipv6&lt;/span> &lt;span class="n">router&lt;/span> &lt;span class="n">rip&lt;/span> &lt;span class="n">RIPNG&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="err">站点互通&lt;/span> &lt;span class="n">RIPNG&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">access&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">12.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="6rd-tunnel">6RD Tunnel
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! -- R16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 general-prefix 6RD 6rd Tunnel1 // 从Tunnel 1 获取 ISP 通用前缀 命名为6RD
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel1 // 6RD Tunnel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip redirects
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address 6RD ::/128 // 通过命名为6RD 的通用前缀构建 IPv6 地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel source Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel mode ipv6ip 6rd // 模式
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel 6rd ipv4 prefix-len 16 // IPv4 通用前缀 ，不设置通用后缀
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel 6rd prefix 2408:1617::/32 //ISP 设定的 IPv6 前缀
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel 6rd br 200.1.4.4 // BR 地址，位于 ISP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 200.1.164.16 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> duplex auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> duplex auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address 2408:1617:A410:F::F/64 // 通过 ISP 设定的前缀 + IPv4 通用前缀构造，IPv4通用前缀占去16位，而通用后缀没有设置，所以就是164.16，转16进制
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route 0.0.0.0 0.0.0.0 200.1.164.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 route 2408:1617::/32 Tunnel1 // 站点互访
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 route ::/0 Tunnel1 2408:1617:404:: // 访问 IPv6 互联网
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! -- R17
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 general-prefix 6RD 6rd Tunnel1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip redirects
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address 6RD ::/128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel source Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel mode ipv6ip 6rd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel 6rd ipv4 prefix-len 16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel 6rd prefix 2408:1617::/32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel 6rd br 200.1.4.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 200.1.174.17 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> duplex auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> duplex auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address 2408:1617:AE11:11::11/64 // // 通过 ISP 设定的前缀 + IPv4 通用前缀构造，IPv4通用前缀占去16位，而通用后缀没有设置，所以就是174.17，转16进制
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route 0.0.0.0 0.0.0.0 200.1.174.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 route 2408:1617::/32 Tunnel1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 route ::/0 Tunnel1 2408:1617:404::
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! -- R4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 general-prefix 6RD 6rd Tunnel1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Loopback1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 200.1.4.4 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip address
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no ip redirects
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 address 6RD ::/128
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ipv6 enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel source Loopback1 // 指定源，6RD 网络 IPv4 可达，还有一种说法是，可以配置anycast，6RD 网络就近访问
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel mode ipv6ip 6rd
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel 6rd ipv4 prefix-len 16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel 6rd prefix 2408:1617::/32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ipv6 route 2408:1617::/32 Tunnel1 // 站点访问IPv6 网络 返回流量
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h2 id="test---observation">Test &amp;amp; Observation
&lt;/h2>&lt;p>&lt;strong>PC 23&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ping PC 24&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/04/03/wdq98eSpnQIomMu.png">
&lt;img src="https://s2.loli.net/2022/04/03/wdq98eSpnQIomMu.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>ping R5 Loopback0&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/04/03/pNRlmzbMueHx4ci.png">
&lt;img src="https://s2.loli.net/2022/04/03/pNRlmzbMueHx4ci.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>ping 位于 ISP Network 的 R3 Loopback0&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/04/03/T6NrPOZoiJQsqcG.png">
&lt;img src="https://s2.loli.net/2022/04/03/T6NrPOZoiJQsqcG.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>ping 位于 A branch1 的 PC 25&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/04/03/KZQrajkhO8iqm2R.png">
&lt;img src="https://s2.loli.net/2022/04/03/KZQrajkhO8iqm2R.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>ping 位于 B head 的 PC 26&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/04/03/3FZM1b8tQGxf7js.png">
&lt;img src="https://s2.loli.net/2022/04/03/3FZM1b8tQGxf7js.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>ping 位于 6to4 Tunnel site2 的 PC 28&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/04/03/zGR5jO2XhyDNk9w.png">
&lt;img src="https://s2.loli.net/2022/04/03/zGR5jO2XhyDNk9w.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>ping 位于 6RD Tunnel site1 的 PC 30&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/04/03/pt6MgExKAVrh7Jc.png">
&lt;img src="https://s2.loli.net/2022/04/03/pt6MgExKAVrh7Jc.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>&lt;strong>PC 25&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ping 位于 A head 的 PC 24&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/04/03/EiJG1AeWxF2Chwp.png">
&lt;img src="https://s2.loli.net/2022/04/03/EiJG1AeWxF2Chwp.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>ping 位于 A branch2 的 E0/1 接口&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/04/03/lCnirqdHXLAPzOI.png">
&lt;img src="https://s2.loli.net/2022/04/03/lCnirqdHXLAPzOI.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>&lt;strong>PC 26&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ping 位于 ISP Network 的 R4 Loopback0&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/04/03/CpJV95worZjDeq6.png">
&lt;img src="https://s2.loli.net/2022/04/03/CpJV95worZjDeq6.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>ping 位于 A head 的 PC 24&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/04/03/Pogt8efnYlw7hVS.png">
&lt;img src="https://s2.loli.net/2022/04/03/Pogt8efnYlw7hVS.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>ping 位于 6RD Tunnel site1 的 PC 30&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/04/03/OgaZPtVnw1ovWqm.png">
&lt;img src="https://s2.loli.net/2022/04/03/OgaZPtVnw1ovWqm.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>&lt;strong>PC 27&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ping GRE Tunnel site1 的 E0/1 接口&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/04/03/dJxVzWU75PaS4pM.png">
&lt;img src="https://s2.loli.net/2022/04/03/dJxVzWU75PaS4pM.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>ping 位于 ISP Network 的 R1 Loopback0 （IPv4）&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/04/03/4kKtLZCPviFn1XE.png">
&lt;img src="https://s2.loli.net/2022/04/03/4kKtLZCPviFn1XE.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>&lt;strong>PC 28&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ping 位于 6to4 Tunnel site1 E0/1 接口&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/04/03/UrGM7mXeSuRFJOx.png">
&lt;img src="https://s2.loli.net/2022/04/03/UrGM7mXeSuRFJOx.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>ping 位于 ISP Network 的 R1 Loopback0 （IPv6）&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/04/03/LSMXYa1GTCRV85A.png">
&lt;img src="https://s2.loli.net/2022/04/03/LSMXYa1GTCRV85A.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>ping 位于 ISP Network 的 R1 Loopback0 （IPv4）&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/04/03/kjEiPofQ8HVKc3t.png">
&lt;img src="https://s2.loli.net/2022/04/03/kjEiPofQ8HVKc3t.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>&lt;strong>PC 29&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ping 位于 Manual Tunnel site1 E0/1 接口&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/04/03/kfljUI6ZwMCFcBm.png">
&lt;img src="https://s2.loli.net/2022/04/03/kfljUI6ZwMCFcBm.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>ping 位于 ISP Network 的 R1 Loopback0 （IPv4）&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/04/03/MvtomBCDQfGwuZ9.png">
&lt;img src="https://s2.loli.net/2022/04/03/MvtomBCDQfGwuZ9.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>&lt;strong>PC 30&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ping 位于 6RD Tunnel site2 E0/1 接口&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/04/03/b9VUl7PrZRnWM1K.png">
&lt;img src="https://s2.loli.net/2022/04/03/b9VUl7PrZRnWM1K.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>ping 位于 ISP Network 的 R1 Loopback0 （IPv6）&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/04/03/x8Bg5QzJmsL6fUP.png">
&lt;img src="https://s2.loli.net/2022/04/03/x8Bg5QzJmsL6fUP.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;hr>
&lt;h2 id="ending">Ending
&lt;/h2>&lt;ul>
&lt;li>文中可能有些配置未提及或内容术语表述的不规范，请见谅。&lt;/li>
&lt;li>配置存阿里云盘了，这是链接：[&lt;a class="link" href="https://www.aliyundrive.com/s/L2WMMmcVR1A" target="_blank" rel="noopener"
>分享的文件
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>]&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨。&lt;/li>
&lt;/ul></description></item><item><title>BGP综合实验拓扑</title><link>https://weeaster.github.io/posts/48f55792/</link><pubDate>Fri, 25 Feb 2022 01:32:49 +0000</pubDate><guid>https://weeaster.github.io/posts/48f55792/</guid><description>&lt;p>在B站看了一个UP主（&lt;a class="link" href="https://space.bilibili.com/455975406" target="_blank" rel="noopener"
>155和150
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>）上传的视频，感觉挺有意思的，就搭拓扑玩一玩。现在这个视频已经不见了，视频里使用的eNSP模拟器搭建的，我用PNET搭建，模拟器类型不关键。已经删减了一些内容，并加了一些实验需求。&lt;/p>
&lt;p>实验主要涉及到的BGP技术的运用，包括有BGP邻居建立、路由加载、路由传递、BGP联盟、路由聚合、路由拆分、团体属性、路由选路、正则表达式、路由过滤、BGP特性、路由阻尼等。&lt;/p>
&lt;p>拓扑如图：&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2022/02/24/6S5qGjeiQCaPcHb.jpg">
&lt;img src="https://s2.loli.net/2022/02/24/6S5qGjeiQCaPcHb.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="实验需求">实验需求
&lt;/h2>&lt;h3 id="bgp邻居建立">BGP邻居建立
&lt;/h3>&lt;ol>
&lt;li>eBGP之间使用接口建立(联盟内部子AS eBGP除外)，iBGP使用环回接口Lo0建立&lt;/li>
&lt;li>R2、R7、R9使用对等体组方式配置&lt;/li>
&lt;li>R4、R7、R9为路由反射器&lt;/li>
&lt;/ol>
&lt;h3 id="bgp路由加载">BGP路由加载
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>R5将ISIS重分布进BGP，R6、R7、R8将ISIS重分布进BGP&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> redistribute isis level-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R6、R7、R8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> redistribute isis level-2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>R5能够正常接收到100.1.1.X的路由，R4不能使用next-hop-self&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map SET_NH permit 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set ip next-hop 120.1.4.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor iBGP route-map SET_NH out
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="bgp路由传递">BGP路由传递
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>100.1.1.x之间可以通信&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">neighbor 200.1.103.10 as-override
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">neighbor 200.1.116.11 as-override
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">neighbor 200.1.127.12 as-override
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>R3、R6、R7针对AS 64520移除私有AS号&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.103.10 remove-private-as all replace-as
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.116.11 remove-private-as all replace-as
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.127.12 remove-private-as all replace-as
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>AS 64540 内部联邦配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R11
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64530
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp log-neighbor-changes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp confederation identifier 64540
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp confederation peers 64531
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.12 remote-as 64531
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.12 disable-connected-check
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.12 update-source Loopback0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.12 next-hop-self
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.116.6 remote-as 64200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R12
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64531
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp log-neighbor-changes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp confederation identifier 64540
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp confederation peers 64530
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> redistribute eigrp 90
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.11 remote-as 64530
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.11 disable-connected-check
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.11 update-source Loopback0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.11 next-hop-self
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.13 remote-as 64531
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.13 update-source Loopback0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.13 next-hop-self
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.127.7 remote-as 64200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R13
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64531
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp log-neighbor-changes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp confederation identifier 64540
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 111.1.2.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 111.1.3.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> aggregate-address 111.1.0.0 255.255.0.0 as-set summary-only
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.12 remote-as 64531
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 100.1.1.12 update-source Loopback0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="bgp路由聚合路由拆分">BGP路由聚合、路由拆分
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>R5、R6、R7、R8对AS内的互联地址与主机路由汇总为子网掩码为16位的聚合路由（例如：120.1.0.0/16），并防止路由回愦&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> aggregate-address 123.1.0.0 255.255.0.0 as-set summary-only
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> aggregate-address 120.1.0.0 255.255.0.0 as-set summary-only
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R6、R7、R8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> aggregate-address 145.1.0.0 255.255.0.0 as-set summary-only
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> aggregate-address 140.1.0.0 255.255.0.0 as-set summary-only
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>R5的汇总主机路由，不抑制120.1.4.4/32和 120.1.5.5/32&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip prefix-list UNSUPPRESS seq 5 permit 120.1.4.4/32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip prefix-list UNSUPPRESS seq 10 permit 120.1.5.5/32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map UNSUPPRESS permit 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address prefix-list UNSUPPRESS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 120.1.4.4 unsuppress-map UNSUPPRESS
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>R6、R7、R8的汇总主机路由，仅抑制145.1.9.9/32 ，并调整聚合路由起源属性为 igp&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R6、R7、R8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip prefix-list SUPPRESS seq 5 permit 140.1.9.9/32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map SUPPRESS permit 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address prefix-list SUPPRESS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map SET_IGP permit 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set origin igp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> aggregate-address 140.1.0.0 255.255.0.0 as-set summary-only attribute-map SET_IGP suppress-map SUPPRESS
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>R1去往111.1.0.0/24和111.1.1.0/24下一跳走R5；R2去往111.1.2.0/24和111.1.3.0/24下一跳走R8&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">SOURCE_AS64100&lt;/span> &lt;span class="n">seq&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">15.5&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">huizong&lt;/span> &lt;span class="n">seq&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">111.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">16&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">mingxi&lt;/span> &lt;span class="n">seq&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">111.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">mingxi&lt;/span> &lt;span class="n">seq&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">111.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">mingxi&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">set&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">mingxi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">set&lt;/span> &lt;span class="n">community&lt;/span> &lt;span class="n">no&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">export&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">huizong&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">match&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">huizong&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">match&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">source&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">SOURCE_AS64100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">router&lt;/span> &lt;span class="n">bgp&lt;/span> &lt;span class="mi">64520&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bgp&lt;/span> &lt;span class="n">inject&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">mingxi&lt;/span> &lt;span class="n">exist&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">huizong&lt;/span> &lt;span class="n">copy&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">attributes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">SOURCE_AS64200&lt;/span> &lt;span class="n">seq&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">28.8&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">huizong&lt;/span> &lt;span class="n">seq&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">111.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">16&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">mingxi&lt;/span> &lt;span class="n">seq&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">111.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">2.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">mingxi&lt;/span> &lt;span class="n">seq&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">111.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">3.0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">mingxi&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">set&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">mingxi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">set&lt;/span> &lt;span class="n">community&lt;/span> &lt;span class="n">no&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">export&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">huizong&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">match&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">huizong&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">match&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">source&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">SOURCE_AS64200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">router&lt;/span> &lt;span class="n">bgp&lt;/span> &lt;span class="mi">64520&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">bgp&lt;/span> &lt;span class="n">inject&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">mingxi&lt;/span> &lt;span class="n">exist&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">huizong&lt;/span> &lt;span class="n">copy&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">attributes&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="bgp选路medas-pathlocal-pref">BGP选路(MED、AS-Path、Local-Pref)
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>R8上配置，实现AS 64200访问 120.1.X.X，X为偶数，走R4和R8互联链路；X为奇数，走R3和R6互联链路&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">access-list 10 permit 120.1.0.0 0.0.254.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">access-list 20 permit 120.1.1.1 0.0.254.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map SET_LP permit 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set local-preference 120
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map SET_LP permit 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set local-preference 99
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map SET_LP permit 30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.48.4 route-map SET_LP in
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>R6、R8上配置，实现AS 64100 访问 140.1.X.X/32，X为偶数，走R4和R8互联链路；X为奇数，走R3和R6互联链路&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">access-list 30 permit 140.1.0.0 0.0.254.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">access-list 40 permit 140.1.1.1 0.0.254.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map SET_MED permit 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address 30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set metric 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map SET_MED permit 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address 40
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set metric 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map SET_MED permit 30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.36.3 route-map SET_MED out
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">access-list 30 permit 140.1.0.0 0.0.254.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">access-list 40 permit 140.1.1.1 0.0.254.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map SET_MED permit 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address 30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set metric 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map SET_MED permit 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address 40
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set metric 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map SET_MED permit 30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.48.4 route-map SET_MED out
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>R1上对起始于AS 64540的任意前缀，AS 64520总是通过R2转发（路由拆分的明细条目除外）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">配置 ip as-path列表，匹配AS 64540 开头的路径路由条目，route-map 设置追加AS号使路径变长
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip as-path access-list 100 permit _64540$
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map AS_PREPEND permit 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match as-path 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set as-path prepend last-as 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64520
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.15.5 route-map AS_PREPEND in
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="bgp路由过滤">BGP路由过滤
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>R6、R7仅通告 200.1.XY.0/24 与 100.1.1.X/32的路由到 R11、R12&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">route-map 设置匹配，向R11，R12通告路由进行过滤
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip prefix-list ADV_TO_64540 seq 5 permit 200.1.0.0/16 le 24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip prefix-list ADV_TO_64540 seq 10 permit 100.1.1.0/24 le 32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map ADV_TO_64540 permit 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address prefix-list ADV_TO_64540
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.116.11 route-map ADV_TO_64540 out
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip prefix-list ADV_TO_64540 seq 5 permit 200.1.0.0/16 le 24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip prefix-list ADV_TO_64540 seq 10 permit 100.1.1.0/24 le 32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map ADV_TO_64540 permit 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address prefix-list ADV_TO_64540
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.127.12 route-map ADV_TO_64540 out
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>R3、R10上配置ORF，使AS 64100仅通告 200.1.XY.0/24 与 100.1.1.X/32的前缀到R10&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">通过向对等体通告ORF能力可以激活这一feature。表示接受从对等体来的，前缀列表，并把这个前缀列表应用到针对对等体的出站方向。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip prefix-list FROM_64100 seq 5 permit 200.1.0.0/16 le 24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip prefix-list FROM_64100 seq 10 permit 100.1.1.0/24 le 32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64540
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.103.3 capability orf prefix-list send
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.103.3 prefix-list FROM_64100 in
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> neighbor 200.1.103.10 capability orf prefix-list receive
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="bgp-特性">BGP 特性
&lt;/h3>&lt;ol>
&lt;li>
&lt;p>AS 64520 不作为传输型AS 不能使用BGP路由过滤&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">no&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">export团体属性&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">SET_COMM&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">set&lt;/span> &lt;span class="n">community&lt;/span> &lt;span class="n">no&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">export&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">router&lt;/span> &lt;span class="n">bgp&lt;/span> &lt;span class="mi">64520&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">neighbor&lt;/span> &lt;span class="mf">10.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">2.2&lt;/span> &lt;span class="n">send&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">community&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">neighbor&lt;/span> &lt;span class="mf">10.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">2.2&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">SET_COMM&lt;/span> &lt;span class="n">out&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">SET_COMM&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">set&lt;/span> &lt;span class="n">community&lt;/span> &lt;span class="n">no&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">export&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">router&lt;/span> &lt;span class="n">bgp&lt;/span> &lt;span class="mi">64520&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">neighbor&lt;/span> &lt;span class="mf">10.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span> &lt;span class="n">send&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">community&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">neighbor&lt;/span> &lt;span class="mf">10.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">SET_COMM&lt;/span> &lt;span class="n">out&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>R1与R2之间的iBGP邻居启用MD5认证，密码为cisco&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">R1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">neighbor 10.1.1.1 password cisco
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">neighbor 10.1.2.2 password cisco
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>R3上配置，若100.1.1.10/32不稳定，震荡2次抑制传递，并在5min后自动恢复&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">配置BGP路由惩罚
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">R3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip prefix-list DAMPENING seq 5 permit 100.1.1.10/32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map DAMPENING permit 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address prefix-list DAMPENING
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set dampening 4 750 2000 16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router bgp 64100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bgp dampening route-map DAMPENING
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>R1上配置，若100.1.1.10路由条目存在，通告默认路由到R2&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">R1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">EXIST_10&lt;/span> &lt;span class="n">seq&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">100.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.10&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">32&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">DEFAULT_CONDITION&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">match&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="n">EXIST_10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">set&lt;/span> &lt;span class="n">community&lt;/span> &lt;span class="n">no&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">export&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">router&lt;/span> &lt;span class="n">bgp&lt;/span> &lt;span class="mi">64520&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">neighbor&lt;/span> &lt;span class="mf">10.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">2.2&lt;/span> &lt;span class="n">default&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">originate&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">map&lt;/span> &lt;span class="n">DEFAULT_CONDITION&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h3 id="ending">Ending
&lt;/h3>&lt;ul>
&lt;li>文中可能有些配置未提及或内容术语表述的不规范，请见谅。&lt;/li>
&lt;li>配置存阿里云盘了，这是链接：[&lt;a class="link" href="https://www.aliyundrive.com/s/ekTf1JRqVFa" target="_blank" rel="noopener"
>分享的文件
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>]&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨。&lt;/li>
&lt;/ul></description></item><item><title>来自非网管交换机的教训</title><link>https://weeaster.github.io/posts/e906be86/</link><pubDate>Mon, 27 Dec 2021 16:33:28 +0000</pubDate><guid>https://weeaster.github.io/posts/e906be86/</guid><description>&lt;p>来自 &lt;a class="link" href="https://zh.wikipedia.org/wiki/%E4%BB%A5%E5%A4%AA%E7%BD%91%E5%B8%A7%E6%A0%BC%E5%BC%8F" target="_blank" rel="noopener"
>以太网帧格式
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2021/12/27/GwcA6SRtdFZoB7C.jpg">
&lt;img src="https://s2.loli.net/2021/12/27/GwcA6SRtdFZoB7C.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;/blockquote>
&lt;p>{% blockquote %}&lt;/p>
&lt;blockquote>
&lt;p>以太帧类型&lt;/p>
&lt;p>以太帧有很多种类型。不同类型的帧具有不同的格式和MTU值。但在同种物理媒体上都可同时存在。&lt;/p>
&lt;p>以太网第二版[note 3] 或者称之为Ethernet II 帧，DIX帧，是最常见的帧类型。并通常直接被IP协议使用。&lt;/p>
&lt;p>Novell的非标准IEEE 802.3帧变种。&lt;/p>
&lt;p>IEEE 802.2 逻辑链路控制 (LLC) 帧&lt;/p>
&lt;p>子网接入协议(SNAP)帧&lt;/p>
&lt;p>所有四种以太帧类型都可包含一个IEEE 802.1Q选项来确定它属于哪个 VLAN 以及他的IEEE 802.1p优先级(QoS)。这个封装由IEEE 802.3ac定义并将帧大小从64字节扩充到1522字节(注：不包含7个前导字节和1个字节的帧开始符以及12个帧间距字节)。&lt;/p>
&lt;p>IEEE 802.1Q标签，如果出现，需要放在源地址字段和以太类型或长度字段的中间。这个标签的前两个字节是标签协议标识符(TPID)值0x8100。这与没有标签帧的以太类型/长度字段的位置相同，所以以太类型0x8100就表示包含标签的帧，而实际的以太类型/长度字段则放在Q-标签的后面。TPID后面是两个字节的标签控制信息(TCI)。(IEEE 802.1p 优先级(QoS)和 VLAN ID)。Q标签后面就是通常的帧内容。&lt;/p>
&lt;p>Ethernet II&lt;/p>
&lt;p>以太 II 帧 (也称作DIX以太网，是以这个设计的主要成员，DEC,Intel和Xerox的名字命名的。[1]),把紧接在目标和源MAC地址后面的这个两字节定义为以太网帧数据类型字段。&lt;/p>
&lt;p>例如，一个0x0800的以太类型说明这个帧包含的是IPv4数据报。同样的，一个0x0806的以太类型说明这个帧是一个ARP帧，0x8100说明这是一个IEEE 802.1Q帧，而0x86DD说明这是一个IPv6帧。&lt;/p>
&lt;p>当这个工业界的标准通过正式的IEEE标准化过程后，在802.3标准中以太类型字段变成了一个(数据)长度字段。(最初的以太包通过包括他们的帧来确定它们的长度，而不是以一个明确的数值。)但是包的接收层仍需知道如何解析包，因此标准要求将IEEE802.2头跟在长度字段后面，定义包的类型。多年之后，802.3x-1997标准，一个802.3标准的后继版本，正式允许两种类型的数据包同时存在。实际上，两种数据包都被广泛使用，而最初的以太数据包在以太局域网中被广泛应用，因为他的简便和低开销。&lt;/p>
&lt;p>为了允许一些使用以太II版本的数据报和一些使用802.3封装的最初版本的数据包能够在同一个以太网段使用，以太类型值必须大于等于1536(0x0600)。这个值比802.3数据包的最大长度1500byte (0x05DC)要更大。因此如果这个字段的值大于等于1536，则这个帧是以太II帧，而那个字段是类型字段。否则(小于1500而大于46字节)，他是一个IEEE 802.3帧，而那个字段是长度字段。1500～1536(不包含)的数值未定义。[2]
{% endblockquote %}&lt;/p>
&lt;/blockquote>
&lt;h2 id="part-2">Part 2
&lt;/h2>&lt;p>前阵子去处理一个无线局域网的接入故障问题，组网结构是二层旁挂隧道转发组网，反映的问题是无线终端接入慢，甚至连接不上 WIFI，在查看了设备后，发现有大量的无线终端获取不到IP地址，我想问题的根本在此。
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://s2.loli.net/2021/12/27/Cp6J9cWRTvOSXkh.jpg">
&lt;img src="https://s2.loli.net/2021/12/27/Cp6J9cWRTvOSXkh.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
组网结构如上图，AP地址段 VLAN 和 STA 地址段 VLAN 不同，AP 的 STA 的 DHCP server 在汇聚交换机上（DHCP 的网关均设置在汇聚交换机上？），汇聚连接各楼层的非网管 PoE 交换机，查看了汇聚交换机配置，虽说是隧道转发，但连接楼层交换机的接口全放行了业务 STA 的 VLAN（我觉得这是个错误配置），&lt;/p>
&lt;p>决定改直接转发，扩大 STA 地址池范围，修改租期为更短时间，手动调优一次（该单位因装修调整过线路和AP，再加上AP布放相当不合理（壁挂安装，楼层里 AP 相隔两三米斜对角线安装））&lt;/p>
&lt;p>修改完配置后，问题更大了，仅有少数无线终端能获取IP正常接入，绝大多无线终端无法接入无线网络，长时间处在获取 IP 地址，然而修改成隧道转发后，可正常接入。最终排查出最大的可能性是这非网管交换机的问题，无法转发透传包含两个及以上的 802.1Q 的数据帧到汇聚交换机，这就触及本人知识盲区了，折腾了许久。&lt;/p>
&lt;p>接下来有两种方案，一是修改 AP 和 STA 的地址网段和 VLAN 为同一个，二是还是使用隧道转发，第一个方案改动太大了，最终使用第二方案。&lt;/p>
&lt;p>回来后一顿搜索非网管交换机的工作原理，有说非网管交换机所有口都是属于 VLAN 1 的说法，这简直是胡说八道的。有说能否转发带 VLAN tag 数据和该交换机支持转发的最大传输单元（MTU）有关系，我查了各大非网管交换机的特性参数，均没有提及这一个参数。理论上这个参数确实会影响转发，就是说非网管交换机设定了一个转发的最大帧长度，当交换机接收到大于这个设定的帧长度就丢弃不转发，毕竟支持更大帧转发意味着消耗更多的硬件资源，基于成本控制我是可以理解硬件厂商这么做的原因。而且像 Jambo frame 这种格式在我接触到的项目中毕竟小众，使用场景比标准的802.3要少的多。&lt;/p>
&lt;p>也翻看了一些做了测试的网站文章，也没有一个定论说肯定支持转发或不支持转发802.1q的数据帧，看多了都使我抑郁了，更多的是论坛下的一些讨论。&lt;/p>
&lt;p>长教训了，这哪怕换成工作在物理层的 HUB 都能正常工作，反而……，看来将来再遇到这种非网管PoE交换机接入的情况要相当注意了，别再踩坑了。&lt;/p>
&lt;p>还有个别 AP 未上线问题，查看原因 &lt;strong>Negotiation CAPWAP tunnel failed&lt;/strong> ，就去检查物理线路吧，特别是使用光收发这种设备的，【能不能通，能通有丢包，AP就是不上线】&lt;/p>
&lt;h2 id="ending">Ending
&lt;/h2>&lt;ul>
&lt;li>文中可能有些内容术语表述的不规范，请见谅。&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨。&lt;/li>
&lt;/ul></description></item><item><title>几种重分发方式可能带来的问题和处理</title><link>https://weeaster.github.io/posts/1b6d0fec/</link><pubDate>Sun, 28 Nov 2021 15:10:27 +0000</pubDate><guid>https://weeaster.github.io/posts/1b6d0fec/</guid><description>&lt;p>最近翻看 《CCNP ROUTE(642-902)学习指南 》，没错就是 2015 年之前 CCNP 改版前的那本，现在最新的认证考试已不是这个编号和课程了。诶，不聊这些，这不重要。&lt;/p>
&lt;p>现在把时间线拉回当年那个技术发展的时候，你要是说技术过时了，不好意思今年我还在某现网中看到设备运行 RIPv2 和 OSPF 两种协议的重分发。这也不重要。&lt;/p>
&lt;p>本文权当自己学习和回忆。&lt;/p>
&lt;h2 id="part-1">Part 1
&lt;/h2>&lt;p>&lt;strong>单点单向重分发&lt;/strong>&lt;/p>
&lt;p>下图所示 ，在 R1 上进行单向重分发（RIP 重分发进入 OSPF），R2 不进行重分发操作。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/28/HwmqiykMruAxldG.jpg">
&lt;img src="https://i.loli.net/2021/11/28/HwmqiykMruAxldG.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>观察 R2 上的路由表发现去往 RIP 外部网络 10.0.0.0 的路由下一跳地址是 R1 的 12.1.1.1 ，产生了次优路由。正确路径的下一跳应是 R3 的 23.1.1.3 。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/28/4zPy9MbFkonw28D.jpg">
&lt;img src="https://i.loli.net/2021/11/28/4zPy9MbFkonw28D.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>产生这条次优路由的原因是 R1 进行的重分发，产生 5 类 LSA 传递到 R2 上，最终 Cisco 路由器根据对比管理距离大小选择加载了 OSPF (110) 的路由。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/28/7lk5v3xDAZFgBUC.jpg">
&lt;img src="https://i.loli.net/2021/11/28/7lk5v3xDAZFgBUC.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>既然知道了加载这条路由的原因，解决方法有：1、阻断重分发而来的 LSA ，使 R2 自始至终只有 RIP 的路由，这么做虽然能临时使 R2 选择最优路径，但是当 R2 和 R3 之间的链路出现问题，通过 R2 去往 10.0.0.0 外部网络将不可达，不是一个好方法；2、修改 OSPF 外部路由的管理距离，使之大于 RIP （120），这样处理就可以使 R2 选择加载 RIP 学习到的路由，这是可行的。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! -- 方式 1 ，定义 ACL 匹配外部网络，在 OSPF 进程下针对该 ACL 修改管理距离
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">access-list 10 permit 10.0.0.0 0.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> distance 121 0.0.0.0 255.255.255.255 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! -- 方式 2 ，直接在 OSPF 进程下针对外部网络修改管理距离
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> distance ospf external 121
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>无论使用哪种方式，都会得到下图所示路由表。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/28/OoFESgzdmCWBpiG.jpg">
&lt;img src="https://i.loli.net/2021/11/28/OoFESgzdmCWBpiG.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="part-2">Part 2
&lt;/h2>&lt;p>&lt;strong>多点单向重分发&lt;/strong>&lt;/p>
&lt;p>下图所示 ，在 R1 和 R2 上进行单向重分发（RIP 重分发进入 OSPF）。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/28/aJ6fuZ2vhNwQ7yc.jpg">
&lt;img src="https://i.loli.net/2021/11/28/aJ6fuZ2vhNwQ7yc.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>观察 R2 上的路由表发现去往 RIP 外部网络 10.0.0.0 的路由下一跳地址是 R1 的 12.1.1.1 ，产生了次优路由。正确路径的下一跳应是 R3 的 23.1.1.3 。R1 上执行 &lt;em>&lt;strong>clear ip ospf redistribution&lt;/strong>&lt;/em> 命令，再观察 R1 路由表发现去往 RIP 外部网络 10.0.0.0 的路由下一跳地址是 R1 的 12.1.1.2 ，产生了次优路由。正确路径的下一跳应是 R3 的 13.1.1.3 。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/28/hdbmjRwiTvepCa4.gif">
&lt;img src="https://i.loli.net/2021/11/28/hdbmjRwiTvepCa4.gif"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>产生次优路由的原因和 &lt;em>&lt;strong>Part 1&lt;/strong>&lt;/em> 中是类似的，解决方法类似。&lt;/p>
&lt;h2 id="part-3">Part 3
&lt;/h2>&lt;p>&lt;strong>多点多向重分发&lt;/strong>&lt;/p>
&lt;p>下图所示 ，在 R1 和 R2 上进行双向重分发。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/28/HsXxUZ3JLcBWpja.jpg">
&lt;img src="https://i.loli.net/2021/11/28/HsXxUZ3JLcBWpja.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>观察 R1 和 R2 去往 EIGRP 外部网络 192.168.1.0 和 192.168.2.0 的路由表项，发现 R1 上去往外部网络路径下一跳是 R2 ，R2 上去往外部网络路径下一跳是 R1 ，出现了&lt;strong>次优路由&lt;/strong>和&lt;strong>路由环路&lt;/strong>。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/28/AwWzrbkBn8mQtIl.jpg">
&lt;img src="https://i.loli.net/2021/11/28/AwWzrbkBn8mQtIl.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/28/JiAYCQ571LOSoFg.jpg">
&lt;img src="https://i.loli.net/2021/11/28/JiAYCQ571LOSoFg.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/28/eBifcXS3QyoEFY8.gif">
&lt;img src="https://i.loli.net/2021/11/28/eBifcXS3QyoEFY8.gif"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>产生上述问题的原因是，在 R1 上把 EIGRP 重分发进 OSPF ，R2 上又把重分发进 OSPF 的路由重分发回 EIGRP ，R1 上收到 R2 和 R3 发过来关于 192.168.1.0/192.168.2.0 的外部路由更新，对比度量值后，选取度量值小的加载到路由表。R1 上查看输出：&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/28/pe1M8UgSCrvo3n7.jpg">
&lt;img src="https://i.loli.net/2021/11/28/pe1M8UgSCrvo3n7.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>**解决方法：**阻断重分发进对方路由域的路由更新再次重分发回原路由域 。定义名称为 &lt;strong>in2ospf&lt;/strong> 的 route-map ，序号 10 的语句对匹配 TAG 为 &lt;strong>100&lt;/strong> 的路由条目拒绝重分发；序号 20 的语句对 TAG 不是 &lt;strong>100&lt;/strong> 的路由条目设置 TAG 为 200 。定义名称为 &lt;strong>in2eigrp&lt;/strong> 的 route-map ，序号 10 的语句对匹配 TAG 为 &lt;strong>200&lt;/strong> 的路由条目拒绝重分发；序号 20 的语句对 TAG 不是 &lt;strong>200&lt;/strong> 的路由条目设置 TAG 为 100 。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! -- R2 上定义 route-map ，R1 上也做这样的操作
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map in2ospf deny 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match tag 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map in2ospf permit 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set tag 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map in2eigrp deny 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match tag 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map in2eigrp permit 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set tag 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! -- 重分发时调用 route-map ，R1 上也做这样的操作
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router eigrp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> redistribute ospf 100 metric 10000 100 255 1 1500 route-map in2eigrp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> redistribute eigrp 100 metric 100 subnets route-map in2ospf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>还可以使用更精简的方式&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! -- R2 上定义 route-map ，R1 上也做这样
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map R-TAGS deny 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match tag 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map R-TAGS permit 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set tag 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! -- 重分发时调用 route-map ，R1 上也做这样的操作
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router eigrp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> redistribute ospf 100 metric 10000 100 255 1 1500 route-map R-TAGS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> redistribute eigrp 100 metric 100 subnets route-map R-TAGS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>做完以上步骤后，查看 R1 和 R2 的路由表，发现环路路由问题解决了，但是还存在次优路由。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/29/9FjXYtfGx5sinKD.jpg">
&lt;img src="https://i.loli.net/2021/11/29/9FjXYtfGx5sinKD.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/29/nSZVpNFzc1Ti78M.jpg">
&lt;img src="https://i.loli.net/2021/11/29/nSZVpNFzc1Ti78M.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>修改 OSPF 外部路由的管理距离，使之大于 EIGRP 外部路由 （170），这样处理就可以使路由器选择加载 EIGRP 学习到的外部路由。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! -- 方式 1 ，定义 ACL 匹配外部网络，在 OSPF 进程下针对该 ACL 修改管理距离
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">access-list 10 permit 192.168.1.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">access-list 10 permit 192.168.2.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> distance 171 0.0.0.0 255.255.255.255 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! -- 方式 2 ，直接在 OSPF 进程下针对外部网络修改管理距离
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> distance ospf external 171
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>最终解决问题&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/29/noHTCkGxhsVfl9A.jpg">
&lt;img src="https://i.loli.net/2021/11/29/noHTCkGxhsVfl9A.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/29/okR8upbOfKC3Tz6.jpg">
&lt;img src="https://i.loli.net/2021/11/29/okR8upbOfKC3Tz6.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="ending">Ending
&lt;/h2>&lt;ul>
&lt;li>做路由重分发的时候要考虑到操作后是否产生环路路由、次优路由和网络不可达的情况。&lt;/li>
&lt;li>对于产生环路路由、次优路由和网络不可达的情况，要是合理使用 route-map、修改管理距离等手段修正。&lt;/li>
&lt;li>当然合理的规划网络也很重要。必要的进行路由汇总，设置 passive-interface ……，使设备路由表尽可能的精简而又能高效的完成转发工作，这是很好的思路。&lt;/li>
&lt;li>文中可能有些配置未提及或内容术语表述的不规范，请见谅。&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨。&lt;/li>
&lt;/ul></description></item><item><title>把组装机主板塞到品牌机机箱</title><link>https://weeaster.github.io/posts/1f544ac3/</link><pubDate>Tue, 23 Nov 2021 18:35:54 +0000</pubDate><guid>https://weeaster.github.io/posts/1f544ac3/</guid><description>&lt;p>前段时间我的台式机电源嗝屁了，不得不掏出吃灰近四年的旧电源来顶一顶，祸不单行，这旧电源也出毛病，目测是供电不足，挂载了三块硬盘，开个 VMware 虚拟机做实验，老是自动频繁的弹出一块机械硬盘，望了望旁边还有一个联想品牌机的机箱（带电源，最大功率只有 280W ），想想要不给它个机会，抱着试一试的想法拆下来插上电，居然能带的动（其实我查过整机功率了，是带的动，显卡用亮机卡了不解释），所以进行了一场“岁土转生”。&lt;/p>
&lt;p>首先感谢的是，品牌机没有对电源插口做特殊化，主板和 CPU 供电接口通用，看了看电源标签上的参数也通用。唯一的问题是主板连接前面板跳线的插口，联想搞了自己个标准。&lt;/p>
&lt;p>图：电源、重启、指示灯跳线的插头&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/24/FN9oPIm31AzbpCs.jpg">
&lt;img src="https://i.loli.net/2021/11/24/FN9oPIm31AzbpCs.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>图：前面板音频插头&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/24/fMduPomV7CaFKnh.jpg">
&lt;img src="https://i.loli.net/2021/11/24/fMduPomV7CaFKnh.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>图：前面板 USB 插头&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/24/cKdQjDqmSaHu8Cg.jpg">
&lt;img src="https://i.loli.net/2021/11/24/cKdQjDqmSaHu8Cg.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>这……完全不对劲啊，首先针座和针头就对不上。这时候就要动脑和搜索引擎里遨游了。首先查找到联想机箱原主板的针脚，看下图，列出了各针脚的说明。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/23/SUgCk5O7sDQR1Bn.jpg">
&lt;img src="https://i.loli.net/2021/11/23/SUgCk5O7sDQR1Bn.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>用根牙签把联想机箱跳线插座上的线头挑出来，然后对应组装机主板的说明进行排列组合使之在组装机主板能使用（见下图），第一次我把电源指示灯正负接反了（这也不能怪我，联想的板子上没标正负），调换过后就正常了。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/23/tMQljEr87xvXBWL.jpg">
&lt;img src="https://i.loli.net/2021/11/23/tMQljEr87xvXBWL.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>其实在这个正负问题上我还折腾了好一会儿，一开始以为都是按左边针脚是正，右边针脚是负来对应的，打开机箱头部查看电路板发现指示灯也没有正负标识，查了 LED 哪个针脚是正负，查到了，LED 灯珠里小的那一边是正（涨知识了）&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/24/7tWBpuMq8ejbiYA.jpg">
&lt;img src="https://i.loli.net/2021/11/24/7tWBpuMq8ejbiYA.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/24/t9voikRXlgIFuJY.jpg">
&lt;img src="https://i.loli.net/2021/11/24/t9voikRXlgIFuJY.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>接下来处理前面板的音频插口跳线，查看网上的介绍说明（搜索引擎搜：&lt;strong>联想前置音频13针转9针&lt;/strong>），满满的都是复制粘贴的内容，我就不贴出来了，一番操作后得到如下图样式插头。总是有妖，明明照着教程撸的，测试的时候左右声道反了，又返工对换一对线。^*^&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/24/sgljUt1wFPiNSym.jpg">
&lt;img src="https://i.loli.net/2021/11/24/sgljUt1wFPiNSym.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>接下来处理前置 USB 线，查看网上的介绍说明（&lt;a class="link" href="https://zhidao.baidu.com/question/244344946.html" target="_blank" rel="noopener"
>联想USB接口11针的怎么接主板9针接口？
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">联想前置USB接口接法：
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">市面上普通主板九针接法
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">VCC，DATA-，DATA+，GND 空
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">VCC，DATA-，DATA+，GND
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">线的颜色是:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">红 白 绿 黑
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">红 白 绿 黑
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">联想主板上的F-usb 11针前置接法又不同了, 经常会遇到联想机箱+组装主板 ，一不小心，将前置线接上组装主板上,结果烧坏了前置usb控制板.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1 2 9 10 都是黑线，3 5 7依次是红白绿，4 6 8依次是棕蓝黄,11是空着的.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">顺次是这个的
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1 3 5 7 9 11
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2 4 6 8 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">⑴⑵⑼⑽是地线，⑶⑷是VCC，也就是电源正极，⑸⑹是DATA－，⑺⑻是DATA+，⑾是空针
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>按照这个说明，只需把插头的 3-5-7-8 这四列对应接到主板针脚上即可，不需要改插座头。为了安全起见，我还是掏出了万用表测量了一下自己的组装机主板是否对应这个正负输出（接错线的话确实有点小危险，5 V 直接短路可是要冒烟的）。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/24/FNMyc5LTBAY3a9i.jpg">
&lt;img src="https://i.loli.net/2021/11/24/FNMyc5LTBAY3a9i.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>终于折腾完了，把组装机的主板塞进了品牌机的机箱，目前前面板各项功能正常。由于使用了这个 280 W 的电源，这就彻底使我和大型网游“绝缘”了，不过也有好些年不抡游戏了。值得说一句，联想10年前的机箱用料十足，机箱的设计也挺好，给个好评她。这么一折腾才发现处处是学问，不能轻视电脑组装拧螺丝。&lt;/p></description></item><item><title>No.004 Simple Case</title><link>https://weeaster.github.io/posts/1fa3e02b/</link><pubDate>Thu, 18 Nov 2021 13:10:41 +0000</pubDate><guid>https://weeaster.github.io/posts/1fa3e02b/</guid><description>&lt;p>红茶三杯的原文 ：&lt;a class="link" href="http://blog.sina.com.cn/s/blog_5ec353710102vmgc.html" target="_blank" rel="noopener"
>【有点儿意思系列 02】哎哟喂停不下来了
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a> ，看完原文描述，我想到的是用 NAT 转换目的地址的方式解决，经过实验验证后，也说明了这个方法是可行的。做完实验后又想还有没有其他方法实现呢，想到用霸道的 PBR ，也能实现，不过这个方法我个人觉得比较傻。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/18/s2KaDPXMNwSLiWT.jpg">
&lt;img src="https://i.loli.net/2021/11/18/s2KaDPXMNwSLiWT.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>&lt;strong>背景描述：&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>R1、R2为两台出口路由器，分别连接电信及网通的广域网出口线路；&lt;/li>
&lt;li>R1、R2、SW1、SW2运行OSPF，R1配置指向网通的静态路由并部署静态路由到OSPF的路由重发布，R2则向OSPF域发布缺省路由。换而言之，内网访问网通的流量缺省走R1，而访问其他Internet资源的流量走R2出去；&lt;/li>
&lt;li>内网有两种服务器：一是向网通公网用户提供服务的服务器，以及向电信公网用户提供服务的服务器。为了使得这两台服务器能够被外网访问，在R1上将网通服务器映射到网通公网地址220.12.15.x/27，而在R2上把电信服务器映射到电信公网地址202.112.12.x/24。&lt;/li>
&lt;li>完成上述部署后，网通的公网用户使用目的地址220.12.15.x可以访问网通服务器，电信外网用户通过202.112.12.x可以访问电信服务器。但是电信外网用户使用220.12.15.x地址却无法正常访问网通服务器。请分析原因，并提出解决方案。&lt;/li>
&lt;/ol>
&lt;h2 id="solution">Solution
&lt;/h2>&lt;h3 id="part-1">Part 1
&lt;/h3>&lt;p>详细的配置我就不贴文中了，可到文章末尾链接自取。&lt;/p>
&lt;p>先说明一下拓扑在中的设备：CNC_User 和 Telecom_User 是用 PNETLab 的 &lt;em>Docker Chrome Node&lt;/em> 设备（打开界面是是一个 Chrome 浏览器，用命令行登陆发现是个 Linux 系统），内网服务器用的是 &lt;em>Docker Apache&lt;/em> （命令行登后发现是 Linux 系统，开启了 Apache 服务）。本次实验模拟外网客户端访问内网映射到公网的 HTTP 服务。&lt;/p>
&lt;p>首先，日常配置 VLAN、VRRP、OSPF、NAT……&lt;/p>
&lt;p>一顿操作后，实现上面提到的 &lt;em>&lt;strong>1 - 3&lt;/strong>&lt;/em> 的需求及 &lt;em>&lt;strong>4&lt;/strong>&lt;/em> 中的前半部分需求。*电信外网用户使用220.12.15.x地址却无法正常访问网通服务器。*原因在于电信用户访问220.12.15.x地址来回路径不一致导致 TCP 会话超时（拓扑中模拟访问 HTTP）,解决方案就是使来回路径一致（皮）。&lt;/p>
&lt;h3 id="part-2">Part 2
&lt;/h3>&lt;p>没有添加配置前，查看 Telecom_User 访问网通服务器 的情况。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/18/YGjhp9nl4iNoyMv.jpg">
&lt;img src="https://i.loli.net/2021/11/18/YGjhp9nl4iNoyMv.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>从图中可以看出 Telecom_User （202.112.13.2）电信用户向网通服务器映射地址（220.12.15.1）发出目的端口为 80 的 TCP 的数据包，而 R2 上电信的公网 IP （202.112.12.1）回应了 TCP ，证实了前面提到的 来回路径不一致（其实从内网路由表也可看出），后面数据包逐渐黑化了。&lt;/p>
&lt;p>在 R1 上添加公网访问网通服务器的目的地址 NAT 转换配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! -- R1 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! -- 配置公网访问网通服务器转换的 NAT 地址池
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip nat pool to_cnc_server 172.16.1.100 172.16.1.110 netmask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! -- 配置（outside list）任一公网地址访问 R1 上公网 IP 的 80 端口
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">access-list 101 permit tcp any host 220.12.15.1 eq www
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! -- 配置目的地址 NAT 转换
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip nat outside source list 101 pool to_cnc_server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! -- 配置 NAT 地址池网段静态路由，用于回程触发 NAT 转换
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route 172.16.1.0 255.255.255.0 220.12.15.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>配置完成测试结果如下：&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/18/2XpYlNcgE3ISKmC.jpg">
&lt;img src="https://i.loli.net/2021/11/18/2XpYlNcgE3ISKmC.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/18/iLsfHeNT4pO3mkx.jpg">
&lt;img src="https://i.loli.net/2021/11/18/iLsfHeNT4pO3mkx.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>电信外网用户使用220.12.15.x地址正常访问网通服务器。&lt;/p>
&lt;p>查看 R1 NAT 映射表，有目的地址 NAT 转换，注意观察 Outside local 和 Outside global&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/18/Bondgqwj7SvMT41.jpg">
&lt;img src="https://i.loli.net/2021/11/18/Bondgqwj7SvMT41.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>原理就是让 网通服务器 回程的数据包从 R1 出去。在 R1 上配置目的地址 NAT 转换。这时从网通服务上看就是源地址为 172.16.1.100 - 172.16.1.110 的地址访问的自身，回包也就回这个地址段。待回包至 R1 ，查找路由表发现 172.16.1.0 网段下一跳地址是 220.12.15.2 （手动配置的静态路由），触发 NAT 转换（此处查找 NAT 映射表项），源地址转成 R1 网通公网 IP地址回包最终至电信用户。此处配置的 172.16.1.0 网段静态路由是触发 NAT 转换，如果不配置，R1 就把网通服务器发过来的数据包丢弃了。&lt;/p>
&lt;p>普及一下 NAT 执行的顺序，查看思科官网(&lt;a class="link" href="https://www.cisco.com/c/en/us/support/docs/ip/network-address-translation-nat/6209-5.html?referring_site=bodynav" target="_blank" rel="noopener"
>NAT Order of Operation
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>)&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/18/3VtGKEm9P8WZjTU.jpg">
&lt;img src="https://i.loli.net/2021/11/18/3VtGKEm9P8WZjTU.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="part-3">Part 3
&lt;/h3>&lt;p>&lt;em>&lt;strong>Part 2&lt;/strong>&lt;/em> 中使用 目的地址 NAT 转换的手段使得来回路径一致，那有什么办法能使网通服务器回包强制从 R1 的公网 IP 地址端口出去呢？— &lt;strong>PBR&lt;/strong>。从 SW1 上就开始把网通服务器回包路径扭到 R1 上，R1 再把数据强行从公网接口丢出去。&lt;/p>
&lt;p>清除 &lt;em>&lt;strong>Part 2&lt;/strong>&lt;/em> 增加的配置，SW1、R1 添加如下配置：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! -- SW1 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">access-list 101 permit ip host 192.168.10.1 any
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map acc_telecom_remote permit 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address 101
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set ip next-hop 10.10.10.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip policy route-map acc_telecom_remote
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! -- R1 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">access-list 102 permit ip host 192.168.10.1 any
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map acc_telecom_remote permit 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address 102
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set ip next-hop 220.12.15.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip policy route-map acc_telecom_remote
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>配置完成测试结果如下：&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/18/PU7eDJI1X9YLZCT.jpg">
&lt;img src="https://i.loli.net/2021/11/18/PU7eDJI1X9YLZCT.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>电信外网用户使用220.12.15.x地址正常访问网通服务器。&lt;/p>
&lt;p>查看 R1 NAT 映射表，没有目的地址 NAT 转换，但是触发了正常流量上网的 PAT，注意观察 Outside local 和 Outside global&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/18/U4wzxdgM56Wy2oE.jpg">
&lt;img src="https://i.loli.net/2021/11/18/U4wzxdgM56Wy2oE.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="ending">Ending
&lt;/h2>&lt;ul>
&lt;li>原文后边加两台防火墙的测试我就不做了（古董 AMD 台式机跑不起 ASAv），大概的考察点还是 数据包来回路径一致的问题&lt;/li>
&lt;li>文中可能有些配置未提及或内容术语表述的不规范，请见谅。&lt;/li>
&lt;li>配置存阿里云盘了，这是链接：[&lt;a class="link" href="https://www.aliyundrive.com/s/3sWzTdiL5TG" target="_blank" rel="noopener"
>分享的文件
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>]&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨。&lt;/li>
&lt;/ul></description></item><item><title>No.003 Simple Case</title><link>https://weeaster.github.io/posts/62d0e673/</link><pubDate>Thu, 11 Nov 2021 13:44:43 +0000</pubDate><guid>https://weeaster.github.io/posts/62d0e673/</guid><description>&lt;p>红茶三杯的原文 ：&lt;a class="link" href="http://blog.sina.com.cn/s/blog_5ec353710102vmkk.html" target="_blank" rel="noopener"
>【有点儿意思系列 04】哎哟喂停不下来了
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a> ，根据问题延续中的表述， 实验拓扑增加了两台出口路由器，两台防火墙，一台服务器。本次拓扑实验依托上一个拓扑演变而来，大部分基础配置与上一个相同，如果您是初次看到本文，请参阅上文 &lt;strong>【&lt;a class="link" href="https://kiraster.github.io/posts/2da7a7a9.html" target="_blank" rel="noopener"
>No.002 Simple Case
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>】&lt;/strong>，本文不在赘述。&lt;/p>
&lt;p>可能你看到拓扑中防火墙名称就懵了，我解释一下，由于我这是台古董级 AMD CPU 的电脑，跑不起 Cisco ASAv 的镜像（报错：Unsupport CPU type，无限重启），再加上内存有限，就不折腾了，考虑到文中只提到 NAT 的需求，我就用两台路由器换个图标和名称代替了。最终实现了原文中源地址转换及静态映射的需求，虽然牺牲了安全策略配置和 HA 配置。&lt;/p>
&lt;p>极致极简，拓扑中的 Open_Server 同样是用路由器模拟的，实验中将实现 Open_Server 的 SSH 服务映射到公网地址提供访问。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/11/VWlKy1fZaJ2eBEM.jpg">
&lt;img src="https://i.loli.net/2021/11/11/VWlKy1fZaJ2eBEM.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="part-1">Part 1
&lt;/h2>&lt;h3 id="step-1修改-core-sw1-和-core-sw2-配置">Step 1：修改 Core-SW1 和 Core-SW2 配置
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- Core-SW1 配置，增加与 Faker_FW1 互联地址，OSPF 宣告互联地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no switchport
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip vrf forwarding vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.100.5 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 200 vrf vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 192.168.100.5 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- Core-SW2 配置，增加与 Faker_FW2 互联地址，OSPF 宣告互联地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no switchport
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip vrf forwarding vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.100.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 200 vrf vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 192.168.100.1 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="step-2修改-obr-sw1-和-obr-sw2-配置">Step 2：修改 OBR-SW1 和 OBR-SW2 配置
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- OBR-SW1 配置，配置与 R1 互联地址，OSPF 宣告互联地址,去除原先的 NAT 相关配置和去除 OSPF 注入默认路由
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no switchport
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip vrf forwarding vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 20.20.20.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf network point-to-point
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 200 vrf vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 20.20.20.1 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- OBR-SW2 配置，配置与 R2 互联地址，OSPF 宣告互联地址,去除原先的 NAT 相关配置和去除 OSPF 注入默认路由
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> no switchport
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip vrf forwarding vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 20.20.20.10 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf network point-to-point
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 200 vrf vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 20.20.20.10 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="step-3配置-r1-和-r2">Step 3：配置 R1 和 R2
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">---&lt;/span> &lt;span class="n">R1&lt;/span> &lt;span class="err">配置，配置互联地址，&lt;/span>&lt;span class="n">OSPF&lt;/span> &lt;span class="err">宣告互联地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">---&lt;/span> &lt;span class="err">配置中包含了&lt;/span> &lt;span class="n">NAT&lt;/span> &lt;span class="err">配置，当两台防火墙宕机后仍可保持内网与互联网通信&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">vpn_internet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rd&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="mi">200&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="n">import&lt;/span> &lt;span class="mi">200&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">vpn_internet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.248&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">outside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">virtual&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">reassembly&lt;/span> &lt;span class="ow">in&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">duplex&lt;/span> &lt;span class="n">auto&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">vpn_internet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">20.20&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">20.2&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">virtual&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">reassembly&lt;/span> &lt;span class="ow">in&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">ospf&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="n">point&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">point&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">duplex&lt;/span> &lt;span class="n">auto&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">vpn_internet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">20.20&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">20.5&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">virtual&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">reassembly&lt;/span> &lt;span class="ow">in&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">ospf&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="n">point&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">point&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">duplex&lt;/span> &lt;span class="n">auto&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">router&lt;/span> &lt;span class="n">ospf&lt;/span> &lt;span class="mi">200&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">vpn_internet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">router&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">id&lt;/span> &lt;span class="mf">111.111&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">111.111&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">network&lt;/span> &lt;span class="mf">20.20&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">20.2&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="n">area&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">network&lt;/span> &lt;span class="mf">20.20&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">20.5&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="n">area&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">network&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="n">area&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">information&lt;/span> &lt;span class="n">originate&lt;/span> &lt;span class="n">metric&lt;/span> &lt;span class="mi">11&lt;/span> &lt;span class="n">metric&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="n">list&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">vpn_internet&lt;/span> &lt;span class="n">overload&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">vpn_internet&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.6&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">access&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">50.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">---&lt;/span> &lt;span class="n">R2&lt;/span> &lt;span class="err">配置，配置互联地址，&lt;/span>&lt;span class="n">OSPF&lt;/span> &lt;span class="err">宣告互联地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">---&lt;/span> &lt;span class="err">配置中包含了&lt;/span> &lt;span class="n">NAT&lt;/span> &lt;span class="err">配置，当两台防火墙宕机后仍可保持内网与互联网通信&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">vpn_internet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">20.20&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">20.9&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">virtual&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">reassembly&lt;/span> &lt;span class="ow">in&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">ospf&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="n">point&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">point&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">duplex&lt;/span> &lt;span class="n">auto&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">vpn_internet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.248&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">outside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">virtual&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">reassembly&lt;/span> &lt;span class="ow">in&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">duplex&lt;/span> &lt;span class="n">auto&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">vpn_internet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">20.20&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">20.6&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">virtual&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">reassembly&lt;/span> &lt;span class="ow">in&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">ospf&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="n">point&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">point&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">duplex&lt;/span> &lt;span class="n">auto&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">router&lt;/span> &lt;span class="n">ospf&lt;/span> &lt;span class="mi">200&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">vpn_internet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">router&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">id&lt;/span> &lt;span class="mf">222.222&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">222.222&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">network&lt;/span> &lt;span class="mf">20.20&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">20.6&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="n">area&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">network&lt;/span> &lt;span class="mf">20.20&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">20.9&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="n">area&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">network&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="n">area&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">default&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">information&lt;/span> &lt;span class="n">originate&lt;/span> &lt;span class="n">metric&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">metric&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="n">list&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">vpn_internet&lt;/span> &lt;span class="n">overload&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">vpn_internet&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.6&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">access&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">50.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="step-4internet-配置faker_fw1faker_fw2-基础配置">Step 4：Internet 配置，Faker_FW1、Faker_FW2 基础配置
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- Internet 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Loopback0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 1.2.3.4 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport access vlan 123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 200.1.1.6 255.255.255.248
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- Faker_FW1 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! --- 200.1.1.3 是 NAT 和 映射使用的公网地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Loopback0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 200.1.1.3 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.100.6 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- Faker_FW2 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! --- 200.1.1.4 是 NAT 和 映射使用的公网地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Loopback0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 200.1.1.4 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.100.2 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="part-2">Part 2
&lt;/h2>&lt;ol>
&lt;li>配置完第一部分， Biz_B_PC 可以 ping 通 Internet 的 1.2.3.4，路径是： &lt;strong>Core-SW2 -&amp;gt; OBR-SW2 -&amp;gt; R2&lt;/strong>，而从 Internet 开启 debug ip icmp 观察到：Internet 返回 reply 报文远端地址是 R2 的外网接口 IP 地址（200.1.1.2）。&lt;/li>
&lt;/ol>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/11/j46XPe2TpvLVhNk.gif">
&lt;img src="https://i.loli.net/2021/11/11/j46XPe2TpvLVhNk.gif"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ol start="2">
&lt;li>
&lt;p>根据原文中的描述，“ &lt;em>防火墙与核心交换机为仅有一条物理线路。另外，由于增加了防火墙，因此将原先部署在出口路由器（拓扑中没有画出来）上的NAT下沉到防火墙上，由防火墙来部署源地址转换及静态映射。防火墙出公网的下一跳是OBR-SW交换机，两者使用私有IP地址三层对接。&lt;/em>”&lt;/p>
&lt;p>也就是 NAT 和映射的功能交给了防火墙设备，然后防火墙出公网的下一跳是出口设备，联想到防火墙与出口路由器之间创建一条隧道，内网去往公网的 inside source IP 地址在防火墙上进行 NAT 后直接走隧道至出口路由器，再路由出去。我在两台防火墙上配置的环回接口地址就是转换用的。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="step-1配置-faker_fw-与出口路由器建立-gre-隧道">Step 1：配置 Faker_FW 与出口路由器建立 GRE 隧道
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">---&lt;/span> &lt;span class="n">Faker_FW2&lt;/span> &lt;span class="err">配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">---&lt;/span> &lt;span class="n">NAT&lt;/span> &lt;span class="err">和&lt;/span> &lt;span class="err">映射使用的公网地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Loopback0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">---&lt;/span> &lt;span class="err">使用&lt;/span> &lt;span class="n">e0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="err">接口地址与&lt;/span> &lt;span class="n">R2&lt;/span> &lt;span class="err">的&lt;/span> &lt;span class="n">e0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="err">接口地址建立隧道，并配置&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">outside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Tunnel0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">outside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">virtual&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">reassembly&lt;/span> &lt;span class="ow">in&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">tunnel&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">100.2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">tunnel&lt;/span> &lt;span class="n">destination&lt;/span> &lt;span class="mf">20.20&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">20.9&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">---&lt;/span> &lt;span class="err">配置&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">---&lt;/span> &lt;span class="err">配置&lt;/span> &lt;span class="n">NAT&lt;/span> &lt;span class="n">overload&lt;/span> &lt;span class="err">和&lt;/span> &lt;span class="err">静态映射（将内网&lt;/span> &lt;span class="n">Open_Server&lt;/span> &lt;span class="err">的&lt;/span> &lt;span class="n">SSH&lt;/span> &lt;span class="err">端口映射到公网的&lt;/span> &lt;span class="mi">2222&lt;/span> &lt;span class="err">端口）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">pool&lt;/span> &lt;span class="n">nat&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">pat&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">length&lt;/span> &lt;span class="mi">29&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="n">list&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">pool&lt;/span> &lt;span class="n">nat&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">pat&lt;/span> &lt;span class="n">overload&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">tcp&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">50.200&lt;/span> &lt;span class="mi">22&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.4&lt;/span> &lt;span class="mi">2222&lt;/span> &lt;span class="n">extendable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">---&lt;/span> &lt;span class="err">配置默认路由和必要的静态路由&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="n">Tunnel0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span> &lt;span class="mf">20.20&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">20.8&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">100.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">50.0&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.0&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">100.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">---&lt;/span> &lt;span class="err">配置&lt;/span> &lt;span class="n">inside&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="n">list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">access&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">50.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- R2 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! --- 使用 e0/0 接口地址与 Faker_FW2 的 e0/0 接口地址建立隧道
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip vrf forwarding vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 1.1.1.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel source 20.20.20.9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel destination 192.168.100.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel vrf vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! --- 配置需要走隧道的 VRF 静态路由，内网地址回程路由 track 跟踪
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route vrf vpn_internet 192.168.50.0 255.255.255.0 Tunnel0 track 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route vrf vpn_internet 200.1.1.4 255.255.255.255 Tunnel0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! --- 配置 SLA 监测隧道对端的连通性
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip sla 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> icmp-echo 192.168.100.2 source-interface Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrf vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip sla schedule 1 life forever start-time now
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">track 1 ip sla 1 reachability
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">---&lt;/span> &lt;span class="n">Faker_FW1&lt;/span> &lt;span class="err">配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">---&lt;/span> &lt;span class="n">NAT&lt;/span> &lt;span class="err">和&lt;/span> &lt;span class="err">映射使用的公网地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Loopback0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.3&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">---&lt;/span> &lt;span class="err">使用&lt;/span> &lt;span class="n">e0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="err">接口地址与&lt;/span> &lt;span class="n">R1&lt;/span> &lt;span class="err">的&lt;/span> &lt;span class="n">e0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="err">接口地址建立隧道，并配置&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">outside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Tunnel0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">2.2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">2.1&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">outside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">virtual&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">reassembly&lt;/span> &lt;span class="ow">in&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">tunnel&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">100.6&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">tunnel&lt;/span> &lt;span class="n">destination&lt;/span> &lt;span class="mf">20.20&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">20.2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">---&lt;/span> &lt;span class="err">配置&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">---&lt;/span> &lt;span class="err">配置&lt;/span> &lt;span class="n">NAT&lt;/span> &lt;span class="n">overload&lt;/span> &lt;span class="err">和&lt;/span> &lt;span class="err">静态映射&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">pool&lt;/span> &lt;span class="n">nat&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">pat&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.3&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.3&lt;/span> &lt;span class="n">prefix&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">length&lt;/span> &lt;span class="mi">29&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="n">list&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">pool&lt;/span> &lt;span class="n">nat&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">pat&lt;/span> &lt;span class="n">overload&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">tcp&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">50.200&lt;/span> &lt;span class="mi">22&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.3&lt;/span> &lt;span class="mi">2222&lt;/span> &lt;span class="n">extendable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">---&lt;/span> &lt;span class="err">配置默认路由和必要的静态路由&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="n">Tunnel0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span> &lt;span class="mf">20.20&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">20.0&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">100.5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">50.0&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.0&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">100.5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">---&lt;/span> &lt;span class="err">配置&lt;/span> &lt;span class="n">inside&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="n">list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">access&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">50.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- R1 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! --- 使用 e0/1 接口地址与 Faker_FW2 的 e0/0 接口地址建立隧道
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Tunnel0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip vrf forwarding vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 2.2.2.2 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel source 20.20.20.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel destination 192.168.100.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tunnel vrf vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! --- 配置需要走隧道的 VRF 静态路由，内网地址回程路由 track 跟踪
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route vrf vpn_internet 192.168.50.0 255.255.255.0 Tunnel0 track 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route vrf vpn_internet 200.1.1.3 255.255.255.255 Tunnel0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! --- 配置 SLA 监测隧道对端的连通性
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip sla 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> icmp-echo 192.168.100.6 source-interface Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrf vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip sla schedule 1 life forever start-time now
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">track 1 ip sla 1 reachability
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="step-2配置-core-sw-静态路由使上网流量下一跳设备为防火墙">Step 2：配置 Core-SW 静态路由使上网流量下一跳设备为防火墙
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- Core-SW1 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route vrf vpn_internet 0.0.0.0 0.0.0.0 192.168.100.6 track 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip sla 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> icmp-echo 192.168.100.6 source-interface Ethernet0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrf vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> frequency 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">track 1 ip sla 1 reachability
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- Core-SW2 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route vrf vpn_internet 0.0.0.0 0.0.0.0 192.168.100.2 track 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip sla 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> icmp-echo 192.168.100.2 source-interface Ethernet0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrf vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> frequency 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">track 1 ip sla 1 reachability
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>完成配置到这个步骤，再观察内网到 Internet 的流量路径,： &lt;strong>Core-SW2 -&amp;gt; Faker_FW2 -&amp;gt; R2&lt;/strong>，而从 Internet 开启 debug ip icmp 观察到：Internet 返回的 reply 报文远端地址是 &lt;strong>Faker_FW2&lt;/strong> 配置的 NAT 转换地址（200.1.1.4）。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/11/TktXihfwbMCjx9d.gif">
&lt;img src="https://i.loli.net/2021/11/11/TktXihfwbMCjx9d.gif"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>配置 Open_Server 和测试公网 SSH 访问&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- Open_Server 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.50.200 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route 0.0.0.0 0.0.0.0 192.168.50.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! --- 配置 SSH SERVICES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip domain name test.com
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">crypto key generate rsa
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1024
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip ssh version 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">line vty 0 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> login local
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> transport input ssh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">username cisco password 0 cisco
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">enable password cisco
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>NAT 静态映射已在 【&lt;em>&lt;strong>Part 2 &amp;ndash; Step 1&lt;/strong>&lt;/em>】 中配置，将 Open_Server 的 22 端口映射到被访问公网 IP 地址的 2222 端口。测试结果如图：&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/11/ciU36EwAlCWsIzG.gif">
&lt;img src="https://i.loli.net/2021/11/11/ciU36EwAlCWsIzG.gif"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="part-3">Part 3
&lt;/h2>&lt;p>&lt;strong>网络冗余的设计&lt;/strong>&lt;/p>
&lt;p>本实验中探讨的是在网络中某段线路通断的情况下 Biz_B_PC 访问 Internet 环回接口地址 1.2.3.4 的路径切换。网络正常情况下，访问路径如下图：&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/11/FR9PMsbqgIQNjzV.jpg">
&lt;img src="https://i.loli.net/2021/11/11/FR9PMsbqgIQNjzV.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>情况 1：&lt;/strong>（假设 Faker_FW1、Core-SW1、OBR-SW1、R1 设备都正常，线路也正常 ）&lt;/p>
&lt;p>当 Core-SW2 的 e0/3 状态为 DOWN；&lt;/p>
&lt;p>当 Core-SW2 的 e0/0 状态为 DOWN；&lt;/p>
&lt;p>当 OBR-SW2 的 e0/0 状态为 DOWN；&lt;/p>
&lt;p>当 Core-SW2 的 e1/3 链路协议 DOWN；&lt;/p>
&lt;p>以上四个条件有一个为真，即其中出现一个接口为 DOWN 状态， Core-SW2 降低 内网 VRRP 组的优先级， 同时将内网 VRRP 组切换至 Backup 状态，内网上网流量路径切换至 Core-SW1 进行转发。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>情况 2：&lt;/strong>（假设 Faker_FW2、 Core-SW2、OBR-SW2、R2 设备都正常，线路也正常 ）&lt;/p>
&lt;p>当 Core-SW1 的 e0/3 状态为 DOWN；&lt;/p>
&lt;p>当 Core-SW1 的 e0/0 状态为 DOWN；&lt;/p>
&lt;p>当 OBR-SW1 的 e0/1 状态为 DOWN；&lt;/p>
&lt;p>当 Core-SW1 的 e1/3 链路协议 DOWN；&lt;/p>
&lt;p>以上四个条件有一个为真，即其中出现一个接口为 DOWN 状态， Core-SW1 降低 内网 VRRP 组的优先级，不进行 VRRP 状态切换。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>情况 3：&lt;/strong>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/11/SidCgVkOe76LKAo.jpg">
&lt;img src="https://i.loli.net/2021/11/11/SidCgVkOe76LKAo.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>当 A 组条件任一条件为真和 B 组任一条件为真时，此时 Core-SW1 和 Core-SW2 都降低 VRRP 组优先级，由于设置了 Core-SW2 的 VRRP 优先级为 120 （ Core-SW1 默认优先级 100），两台设备同时降低相同的优先级 21 。此时的 VRRP Master 设备是 Core-SW2 ，上网流量路径：&lt;strong>Core-SW2&lt;/strong> -&amp;gt; &lt;strong>OBR-SW2&lt;/strong> -&amp;gt; &lt;strong>R2&lt;/strong> ，在 &lt;strong>R2&lt;/strong> 上进行 &lt;strong>NAT&lt;/strong> 最终出公网；当 B 组中的条件是：&lt;strong>OBR-SW2 的 e0/0 状态为 DOWN&lt;/strong>，上网流量路径：&lt;strong>Core-SW2&lt;/strong> -&amp;gt; &lt;strong>OBR-SW2&lt;/strong> -&amp;gt; &lt;strong>OBR-SW1&lt;/strong>-&amp;gt; &lt;strong>R1&lt;/strong>，在 &lt;strong>R1&lt;/strong> 上进行 &lt;strong>NAT&lt;/strong> 最终出公网。&lt;/p>
&lt;p>分别手动 &lt;strong>shutdown&lt;/strong> 以上任一条件中的接口（以 Core-SW2 的 e0/3 和 e1/3 为例），观察 Track 和 VRRP 状态的变化如下图：&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/11/tjePOHGadCIg1mN.jpg">
&lt;img src="https://i.loli.net/2021/11/11/tjePOHGadCIg1mN.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- Core-SW2 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip sla 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> icmp-echo 192.168.100.2 source-interface Ethernet0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrf vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> frequency 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip sla 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> icmp-echo 10.10.10.9 source-interface Ethernet0/0.200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrf vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> frequency 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip sla 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> icmp-echo 20.20.20.10 source-interface Ethernet0/0.200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrf vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> frequency 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip sla group schedule 11 1-3 schedule-together start-time now life forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">track 1 ip sla 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">track 2 ip sla 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">track 3 ip sla 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">track 4 interface Ethernet1/3 line-protocol
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">track 11 list boolean and
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> object 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> object 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> object 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> object 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp 50 priority 120
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp 50 track 11 decrement 21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- Core-SW1 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip sla 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> icmp-echo 192.168.100.6 source-interface Ethernet0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrf vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> frequency 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip sla 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> icmp-echo 10.10.10.1 source-interface Ethernet0/0.200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrf vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> frequency 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip sla 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> icmp-echo 20.20.20.1 source-interface Ethernet0/0.200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrf vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> frequency 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip sla group schedule 11 1-3 schedule-together start-time now life forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">track 1 ip sla 1 reachability
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">track 2 ip sla 2 reachability
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">track 3 ip sla 3 reachability
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">track 4 interface Ethernet1/3 line-protocol
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">track 11 list boolean and
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> object 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> object 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> object 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> object 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp 50 ip 192.168.50.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp 50 track 11 decrement 21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="ending">Ending
&lt;/h2>&lt;ul>
&lt;li>码完字了，还是那句话（挺耗时间的）。尽管还有不满意的地方，比如还可以再完善配置，添加更多的配置参数，考虑更多扩展需求想解决思路，但是这是个“无底洞”。&lt;/li>
&lt;li>文中可能有些配置未提及或内容术语表述的不规范，请见谅。&lt;/li>
&lt;li>配置存阿里云盘了，这是链接：[&lt;a class="link" href="https://www.aliyundrive.com/s/HaEJNPJZEjq" target="_blank" rel="noopener"
>分享的文件
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>]&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨。&lt;/li>
&lt;/ul></description></item><item><title>No.002 Simple Case</title><link>https://weeaster.github.io/posts/2da7a7a9/</link><pubDate>Wed, 10 Nov 2021 11:37:50 +0000</pubDate><guid>https://weeaster.github.io/posts/2da7a7a9/</guid><description>&lt;p>来自红茶三杯的原文:&lt;a class="link" href="http://blog.sina.com.cn/s/blog_5ec353710102vmkk.html" target="_blank" rel="noopener"
>【有点儿意思系列 04】哎哟喂停不下来了
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/p>
&lt;p>当时看完 Case 的需求我是不想理会的，不就是 VRF 隔离么，我压根没往配置 ACL 这个方向去，其实看需求已经暗示的非常明显了，“始终”，“完全隔离” 等等字眼。再加上 VRRP（远离思科设备多年，不玩 HSRP 了，模拟器做不了堆叠啊） 的冗余方案。但是 “问题后续” 这段话引起了我的兴趣，还是从这个拓扑开始吧（其实我已经做完两个拓扑在码这篇文章的时候），话不多说，开干。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/11/PMKamjJfoEgb8G4.jpg">
&lt;img src="https://i.loli.net/2021/11/11/PMKamjJfoEgb8G4.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="step-1配置接入层交换机sw5sw6sw7">Step 1：配置接入层交换机（SW5、SW6、SW7）
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>创建 VLAN ，上联 Core-SW 的端口配置 Trunk 放行 VLAN，把连接 PC 的端口划入对应 VLAN&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! -- SW5 配置， 根据需求业务 A 有多个 VLAN ，就敷衍一下配置VLAN10,VLAN20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vlan 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vlan 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk allowed vlan 10,20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk encapsulation dot1q
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport mode trunk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk allowed vlan 10,20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk encapsulation dot1q
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport mode trunk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport access vlan 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>SW6、SW7 如法炮制即可。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="step-2配置-core_sw1-和-core_sw2">Step 2：配置 Core_SW1 和 Core_SW2
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>创建 VLAN10、VLAN20、VLAN50，创建 VRF 定义为 vpn_biz 和 vpn_internet&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">---&lt;/span> &lt;span class="n">Core_SW1&lt;/span> &lt;span class="err">和&lt;/span> &lt;span class="n">Core_SW2&lt;/span> &lt;span class="err">配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">vlan&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">vlan&lt;/span> &lt;span class="mi">20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">vlan&lt;/span> &lt;span class="mi">50&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">---&lt;/span> &lt;span class="err">其实用不到&lt;/span> &lt;span class="n">RD&lt;/span> &lt;span class="err">和&lt;/span> &lt;span class="n">RT&lt;/span> &lt;span class="err">，在&lt;/span> &lt;span class="n">MPLS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">VPN&lt;/span> &lt;span class="err">引入的时候才用，为了看起来好看点&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">vpn_biz&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rd&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="n">import&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">vpn_internet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rd&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="mi">200&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="n">import&lt;/span> &lt;span class="mi">200&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>配置 Core-SW1 与 Core-SW2 之间的 Port-channel，配置 Core-SW 和下联 SW5、SW6、SW7 的 Trunk&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- Core_SW1 和 Core_SW2 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Port-channel1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk allowed vlan 10,20,50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk encapsulation dot1q
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport mode trunk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk allowed vlan 10,20,50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk encapsulation dot1q
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport mode trunk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> channel-group 1 mode active
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk allowed vlan 10,20,50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk encapsulation dot1q
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport mode trunk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> channel-group 1 mode active
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk allowed vlan 10,20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk encapsulation dot1q
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport mode trunk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet1/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk allowed vlan 10,20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk encapsulation dot1q
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport mode trunk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet1/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk allowed vlan 50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk encapsulation dot1q
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport mode trunk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>创建 VLAN 接口并绑定 VRF，配置 IP 地址，配置 VRRP&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- Core_SW1 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip vrf forwarding vpn_biz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.10.252 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp 10 ip 192.168.10.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp 10 priority 120
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip vrf forwarding vpn_biz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.20.252 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp 20 ip 192.168.20.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp 20 priority 120
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip vrf forwarding vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.50.252 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp 50 ip 192.168.50.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- Core_SW2 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip vrf forwarding vpn_biz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.10.253 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp 10 ip 192.168.10.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip vrf forwarding vpn_biz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.20.253 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp 20 ip 192.168.20.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan50
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip vrf forwarding vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.50.253 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp 50 ip 192.168.50.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp 50 priority 120
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>配置 Core-SW1 与 OBR-SW1 ，Core-SW2 与 OBR-SW2 互联的接口 IP 地址，并配置 OSPF 网络类型为点对点&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- Core_SW1 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0.100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> encapsulation dot1Q 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip vrf forwarding vpn_biz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.10.10.2 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf network point-to-point
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0.200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> encapsulation dot1Q 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip vrf forwarding vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.10.10.2 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf network point-to-point
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- Core_SW2 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0.100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> encapsulation dot1Q 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip vrf forwarding vpn_biz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.10.10.10 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf network point-to-point
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0.200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> encapsulation dot1Q 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip vrf forwarding vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.10.10.10 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf network point-to-point
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="step-3配置-obr-sw1-和-obr-sw2">Step 3：配置 OBR-SW1 和 OBR-SW2
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>配置创建 VRF 定义为 vpn_biz 和 vpn_internet，配置互联接口 IP 地址&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">---&lt;/span> &lt;span class="n">OBR&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">SW1&lt;/span> &lt;span class="err">配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">vpn_biz&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rd&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="n">import&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">vpn_internet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rd&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="mi">200&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="n">import&lt;/span> &lt;span class="mi">200&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">no&lt;/span> &lt;span class="n">switchport&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">vpn_biz&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">100.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">ospf&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="n">point&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">point&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">no&lt;/span> &lt;span class="n">switchport&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">vpn_internet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">2.100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">encapsulation&lt;/span> &lt;span class="n">dot1Q&lt;/span> &lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">vpn_biz&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">10.10&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">10.5&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">ospf&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="n">point&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">point&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">2.200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">encapsulation&lt;/span> &lt;span class="n">dot1Q&lt;/span> &lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">vpn_internet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">10.10&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">10.5&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">ospf&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="n">point&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">point&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">3.100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">encapsulation&lt;/span> &lt;span class="n">dot1Q&lt;/span> &lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">vpn_biz&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">10.10&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">10.1&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">ospf&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="n">point&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">point&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">3.200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">encapsulation&lt;/span> &lt;span class="n">dot1Q&lt;/span> &lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">vpn_internet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">10.10&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">10.1&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">ospf&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="n">point&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">point&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">---&lt;/span> &lt;span class="n">OBR&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">SW2&lt;/span> &lt;span class="err">配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">vpn_biz&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rd&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="n">import&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">vpn_internet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rd&lt;/span> &lt;span class="mi">20&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">20&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="mi">200&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="n">import&lt;/span> &lt;span class="mi">200&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">no&lt;/span> &lt;span class="n">switchport&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">vpn_internet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">200.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">no&lt;/span> &lt;span class="n">switchport&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">vpn_biz&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">100.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.5&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">ospf&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="n">point&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">point&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">2.100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">encapsulation&lt;/span> &lt;span class="n">dot1Q&lt;/span> &lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">vpn_biz&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">10.10&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">10.6&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">ospf&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="n">point&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">point&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">2.200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">encapsulation&lt;/span> &lt;span class="n">dot1Q&lt;/span> &lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">vpn_internet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">10.10&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">10.6&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">ospf&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="n">point&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">point&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">3.100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">encapsulation&lt;/span> &lt;span class="n">dot1Q&lt;/span> &lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">vpn_biz&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">10.10&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">10.9&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">ospf&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="n">point&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">point&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">3.200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">encapsulation&lt;/span> &lt;span class="n">dot1Q&lt;/span> &lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">vpn_internet&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">10.10&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">10.9&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">ospf&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="n">point&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">point&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="step-4配置-biz_a_remote">Step 4：配置 Biz_A_Remote
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>配置创建 VRF 定义为 vpn_biz，配置互联接口 IP 地址，配置环回接口作为测试地址&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">---&lt;/span> &lt;span class="n">Biz_A_Remote&lt;/span> &lt;span class="err">配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">vpn_biz&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rd&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="k">export&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">target&lt;/span> &lt;span class="n">import&lt;/span> &lt;span class="mi">100&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Loopback0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">vpn_biz&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">30.111&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">ospf&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="n">point&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">point&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">no&lt;/span> &lt;span class="n">switchport&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">vpn_biz&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">100.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">ospf&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="n">point&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">point&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">no&lt;/span> &lt;span class="n">switchport&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">vrf&lt;/span> &lt;span class="n">forwarding&lt;/span> &lt;span class="n">vpn_biz&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">100.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.6&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">ospf&lt;/span> &lt;span class="n">network&lt;/span> &lt;span class="n">point&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">to&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">point&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="step-5配置-internet">Step 5：配置 Internet
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>配置接口 IP 地址和环回接口即可，现实环境中，运营商的设备控制不了&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- Internet 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Loopback0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 1.2.3.4 255.255.255.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 200.1.1.2 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> duplex auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 200.1.1.6 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> duplex auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="step-6配置-ospf">Step 6：配置 OSPF
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>为了简化配置过程，我全网使用 Area 0 ，生产环境中该划分区域的不要偷懒。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- Core_SW1 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 100 vrf vpn_biz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 1.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 10.10.10.2 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 192.168.10.252 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 192.168.20.252 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 200 vrf vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 1.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 10.10.10.2 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 192.168.50.252 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- Core_SW2 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 100 vrf vpn_biz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 2.2.2.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 10.10.10.10 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 192.168.10.253 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 192.168.20.253 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 200 vrf vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 2.2.2.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 10.10.10.10 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 192.168.50.253 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- OBR-SW1 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 100 vrf vpn_biz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 11.11.11.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 10.10.10.1 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 10.10.10.5 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.1.1.1 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 200 vrf vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 11.11.11.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 10.10.10.1 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 10.10.10.5 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default-information originate always
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route vrf vpn_internet 0.0.0.0 0.0.0.0 200.1.1.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- OBR-SW2 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 100 vrf vpn_biz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 22.22.22.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 10.10.10.6 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 10.10.10.9 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.1.1.5 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 200 vrf vpn_internet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 22.22.22.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 10.10.10.6 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 10.10.10.9 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default-information originate always
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route vrf vpn_internet 0.0.0.0 0.0.0.0 200.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- Biz_A_Remote 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 100 vrf vpn_biz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> router-id 3.3.3.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.1.1.2 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.1.1.6 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 192.168.30.111 0.0.0.0 area 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ul>
&lt;h2 id="step-7配置-nat">Step 7：配置 NAT
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>其实在生产环境中用核心交换机作为互联网出口的情况不常见（我没见过），核心交换机的上行可能会有行为管理器、安全设备、路由器等设备，具体情况就要看客户单位对网络有什么样的需求和预算了。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>到这还有个问题，思科 CEF 和 NAT 貌似有冲突，去思科论坛看巴拉巴拉一大通大概是软件版本和硬件和处理器的类型等等问题，我这个是虚拟环境，不好判断是什么原因，放出看过的链接。各位如果知道是什么原因的请知会我，万分感谢。&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;a class="link" href="https://learningnetwork.cisco.com/s/question/0D53i00000Kt7C1/nat-not-working-with-cef" target="_blank" rel="noopener"
>NAT not working with CEF
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://www.cisco.com/c/en/us/support/docs/ip/network-address-translation-nat/26704-nat-faq-00.html" target="_blank" rel="noopener"
>Network Address Translation (NAT) FAQ
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a class="link" href="https://learningnetwork.cisco.com/s/question/0D53i00000Kt6em/nat-cef-punted-packets" target="_blank" rel="noopener"
>NAT: CEF Punted packets
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>对于上述问题，经过试验可行的方法是在需要配置 NAT 参数的接口关闭路由高速缓存&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">---&lt;/span> &lt;span class="n">OBR&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">SW1&lt;/span> &lt;span class="err">配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">outside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">no&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cache&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">2.200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">no&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cache&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">3.200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">no&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cache&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">access&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">50.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="n">list&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="n">overload&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span> &lt;span class="o">---&lt;/span> &lt;span class="n">OBR&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">SW2&lt;/span> &lt;span class="err">配置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">outside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">no&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cache&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">2.200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">no&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cache&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">3.200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">no&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cache&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">access&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">list&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">50.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ip&lt;/span> &lt;span class="n">nat&lt;/span> &lt;span class="n">inside&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="n">list&lt;/span> &lt;span class="mi">10&lt;/span> &lt;span class="n">interface&lt;/span> &lt;span class="n">Ethernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="n">overload&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="step-8test">Step 8：Test
&lt;/h2>&lt;ol>
&lt;li>Biz_A_PC 和 Biz_B_PC 测试，发现两个网络之间不能互通。Biz_A_PC 能 ping 通 Biz_A_Remote 的环回地址 192.168.30.111；Biz_B_PC 能 ping 通 Internet 的环回地址 1.2.3.4&lt;/li>
&lt;/ol>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/11/wfSlNJc7AarQi8v.gif">
&lt;img src="https://i.loli.net/2021/11/11/wfSlNJc7AarQi8v.gif"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/11/57yVOWh2RKnEwrG.gif">
&lt;img src="https://i.loli.net/2021/11/11/57yVOWh2RKnEwrG.gif"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ol start="2">
&lt;li>
&lt;p>冗余测试&lt;/p>
&lt;ul>
&lt;li>
&lt;p>由于这个拓扑实验和我写的下一篇文章有大量重叠部分，故放在下一篇文章中表述，本文中也没有添加配置。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>大概思路思路是通过 Track 关联降低 VRRP 的优先级使其成为 VRRP 的 Backup 组，流量路径自动切换至另一台设备。举个例子：当 Core-SW1 以出接口 e0/0 监测到与 OBR-SW1 直连线路不通或监测到 Biz_A_Remote 的 e0/0 不通(这是个 and 的关系，用编程语言的描述就是：条件 A 和条件 B 同时为 True，结果才为 True)，此时 SLA 监测状态为 Time-out ，在 VRRP 与 Track 联动下降低 VRRP 优先级使其成为 Backup 状态，Biz_A_PC 去往 Biz_A_Remote 的流量路径切换至 Core-SW2 ，途径：Core-SW2 &amp;ndash;&amp;gt; OBR-SW2 最终到达 Biz_A_Remote ，如图所示：&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/11/YJWEOwKAsa9Xq4v.jpg">
&lt;img src="https://i.loli.net/2021/11/11/YJWEOwKAsa9Xq4v.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="ending">Ending
&lt;/h2>&lt;ul>
&lt;li>总算码完了，其实还挺耗时间的写文章，但是对做拓扑实验做了梳理，其中还包含怎么清晰的表达我的思路和想表达的意思。&lt;/li>
&lt;li>配置存阿里云盘了，这是链接：[&lt;a class="link" href="https://www.aliyundrive.com/s/k8tnrEpqc46" target="_blank" rel="noopener"
>分享的文件
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>]&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨。&lt;/li>
&lt;li>下一篇文更有意思^_^，To be continued.&lt;/li>
&lt;/ul></description></item><item><title>No.001 Simple Case</title><link>https://weeaster.github.io/posts/8ac5ac4a/</link><pubDate>Sun, 07 Nov 2021 00:31:11 +0000</pubDate><guid>https://weeaster.github.io/posts/8ac5ac4a/</guid><description>&lt;p>上文提到要 po 一篇文，现在发表一下自己的思路和配置。原文:&lt;a class="link" href="http://blog.sina.com.cn/s/blog_5ec353710102w64i.html" target="_blank" rel="noopener"
>【有点儿意思系列 06】一个看起来简单的案例
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>，再上图。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/05/aV6ElzprdKjscFt.jpg">
&lt;img src="https://i.loli.net/2021/11/05/aV6ElzprdKjscFt.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="request-and-solution">Request and Solution
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>PC1、PC2 分属 VLAN10 和 VLAN20；DHCP 服务器属 VLAN30 ，PC1 和 PC2 从 DHCP 服务器自动获取地址。&lt;/p>
&lt;p>&lt;strong>S&lt;/strong>：根据上下文需求，确定 R3 和 R4 是热备组网。R3 和 R4 上配置子接口，配置 VRRP ；业务地址段和 DHCPServer 不在同一网段，所以需要在业务网段的网关上配置 DHCP 中继。实验中使用一台路由器模拟 DHCPServer，上面配置分配给 VLAN10,VLAN20 的地址池。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- DHCPServer 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip dhcp excluded-address 10.1.10.252 10.1.10.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip dhcp excluded-address 10.1.20.252 10.1.20.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip dhcp pool vlan10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 10.1.10.0 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default-router 10.1.10.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip dhcp pool vlan20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 10.1.20.0 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> default-router 10.1.20.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- R3 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/1.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> encapsulation dot1Q 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.1.10.252 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip helper-address 10.1.30.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp 10 ip 10.1.10.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp 10 priority 120
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp 10 track 1 decrement 21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/1.20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> encapsulation dot1Q 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.1.20.252 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip helper-address 10.1.30.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp 20 ip 10.1.20.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/1.30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> encapsulation dot1Q 30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.1.30.252 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp 30 ip 10.1.30.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp 30 priority 120
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp 30 track 1 decrement 21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! --- 网管地址网关
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/1.99
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> encapsulation dot1Q 99
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 20.1.1.252 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp 99 ip 20.1.1.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp 99 priority 120
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp 99 track 1 decrement 21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;li>
&lt;p>SW4 是内网用户接入交换机（仅具二层功能），要求内网两个网段的用户均能 telnet 到该设备。&lt;/p>
&lt;p>&lt;strong>S&lt;/strong>：配置 VLAN ，划分接口，配置 Trunk，配置默认网关和远程网管&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- SW4 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk allowed vlan 10,20,30,99
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk encapsulation dot1q
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport mode trunk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk allowed vlan 10,20,30,99
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport trunk encapsulation dot1q
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport mode trunk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet1/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport access vlan 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet1/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport access vlan 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet1/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> switchport access vlan 30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! --- 网管IP地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan99
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 20.1.1.10 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! -- 本想使用 ip default-gateway，但是不起作用，下面这条效果是一样
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip route 0.0.0.0 0.0.0.0 20.1.1.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! --- 网管配置 略
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">……
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>由于 VPCS 不支持 Telnet ，此处使用 DHCPServer 做测试。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/07/cuPSatd6w2E18Hq.jpg">
&lt;img src="https://i.loli.net/2021/11/07/cuPSatd6w2E18Hq.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ol start="3">
&lt;li>
&lt;p>R3 和 R4 作为内网用户的网关设备，互为热备份。&lt;/p>
&lt;p>&lt;strong>S&lt;/strong>：这一条前面提过了，整个拓扑完整配置后边发，我打个包。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>R3、R4、SW2 及 SW3 上不允许出现任何手工配置的静态路由条目。&lt;/p>
&lt;p>&lt;strong>S&lt;/strong>：好的，满足你。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>SW1 采用重发布的方式，将直连的服务器网段路由（如10.1.100.0/24）注入 EIGRP。&lt;/p>
&lt;p>&lt;strong>S&lt;/strong>：好的，满足你。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>内网用户（PC1、PC2）访问核心服务器 Server（10.1.100.1）的数据流走向如下：&lt;/p>
&lt;p>PC1 访问 Server：R3 &amp;gt; R1 &amp;gt; SW2 &amp;gt; SW1 &amp;gt; Server；&lt;/p>
&lt;p>PC2 访问 Server：R4 &amp;gt; R2 &amp;gt; SW3 &amp;gt; SW1 &amp;gt; Server；&lt;/p>
&lt;p>沿途任何设备上到达 Server 的路由不允许出现负载均衡，且 PC 访问 Server 的流量往返路径一致。&lt;/p>
&lt;p>&lt;strong>S&lt;/strong>：在配置完路由协议后，查看沿途设备路由表发现到达 Server 的路由出现负载均衡是正常现象，旁观大局，逐个处理就行。&lt;/p>
&lt;p>但是有一个现象我不知是模拟器的 Bug 还是镜像的问题，查看 SW3 和 SW4 ，总有一台设备到达 Server 的路由是这样的：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">D EX 10.1.100.0/24 [170/307200]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>另一台学习到去往 Server 网段的路由是从上面这台学习到的外部路由，重启两台交换机的 OSPF 进程，这条路由又可能显示在第二台了。我又用 GNS3 做了测试，也是这种情况，按理说加载到路由表的不应该是管理距离为 110 的 OSPF 外部路由么？&lt;/p>
&lt;p>我思考了一番，可能是 OSPF 进程启动先后顺序的问题，先启动的交换机 OSPF 进程加载了 EIGRP 外部路由，而后启动的交换机 OSPF 进程学习到 EIGRP 外部路由和 OSPF 外部路由，按照规则选择了管理距离值较小的 OSPF 路由条目。&lt;/p>
&lt;p>&lt;strong>PC1 访问 Server：R3 &amp;gt; R1 &amp;gt; SW2 &amp;gt; SW1 &amp;gt; Server；&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- R1 配置，修改 OSPF 入向接口的 cost ，使从 e0/0 收到去往10.1.100.0网段的路由更优
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf cost 11
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- SW2 配置, 在 OSPF 进程下过滤入方向收到的去往 10.1.100.0 网段的条目，为什么这么做呢，从后面需求看，断掉 SW2/SW3 与 SW1 的线路之一，去往 Server的流量就不需要经过断掉线路这台交换机，而且断掉线路还要流量经过这台设备，走了个直角线路，并不是最优路径
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router ospf 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> distribute-list 10 in
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">access-list 10 deny 10.1.100.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">access-list 10 permit any
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>PC2 访问 Server ：R4 &amp;gt; R2 &amp;gt; SW3 &amp;gt; SW1 &amp;gt; Server；&lt;/strong>&lt;/p>
&lt;p>思路和 PC1 访问 Server 一样，逆推一下即可，不占用篇幅了（懒得码字）&lt;/p>
&lt;p>&lt;strong>PC1 访问 Server 回程路径： Server&amp;gt; SW1 &amp;gt; SW2 &amp;gt; R1 &amp;gt;R3 ；&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- SW1 配置，观察到去往内网网段的路由条目是负载均衡，配置偏移列表和指定入向接口，增加希望不要出现在路由表里的条目 metric 偏移，影响路由表加载
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">router eigrp 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> offset-list 20 in 1024 Ethernet0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> offset-list 10 in 1024 Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">access-list 10 permit 10.1.20.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">access-list 20 permit 10.1.10.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> !
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- SW2 配置，修改 e0/3 接口 cost，使得从该接口学习到去往 10.1.10.0 和 10.1.20.0 网段的路由不是最优路由
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip ospf cost 11
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>PC2 访问 Server 回程路径： Server&amp;gt; SW1 &amp;gt; SW3 &amp;gt; R2 &amp;gt;R3 ；&lt;/strong>&lt;/p>
&lt;p>思路和 PC1 访问 Server 回程路径一样，逆推一下即可，不占用篇幅了（懒得码字）&lt;/p>
&lt;/li>
&lt;li>
&lt;p>要求 SW2 和 SW3 访问 Server 都走最优路径，即 SW2 前往 Server 的数据流走 SW1，SW3 前往 Server 的数据流也直接到 SW1。&lt;/p>
&lt;p>&lt;strong>S&lt;/strong>：这一条也佐证了我在上面说到的流量走直角路径不是最优的想法。说的通俗一点就是：SW1 上的有流量要去往 Server 只能从 e0/1 出去，不走直角。即使 SW1 上的出口线路故障了也不走，走的路径是：拓扑上的对角线。退一步来说当 SW2/SW3 的出口线路故障了，下联的 R1/R2 不会从 SW2/SW3 学习到去往 Server 的路由条目。SW2 也是这个道理。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/07/VG6mjtd1Ww49iSv.jpg">
&lt;img src="https://i.loli.net/2021/11/07/VG6mjtd1Ww49iSv.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ol start="8">
&lt;li>
&lt;p>SW1 上关于 10.1.10.0/24 和 10.1.20.0/24 的路由不应该出现等价负载均衡，正常情况下访问 10.0/24 网段的数据流走 SW2，访问2 0.0/24 网段的数据流走 SW3。&lt;/p>
&lt;p>&lt;strong>S&lt;/strong>：在 PC1/PC2 访问 Server 的回程路径时候已经解决这一条，不占用篇幅了（懒得码字）。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>当 SW1-SW2 之间的链路 DOWN 掉时，PC1 访问 Server 的数据流切换至路径： R3&amp;gt;R1&amp;gt;SW3&amp;gt;SW1&amp;gt;Server，且往返路径一致。而当 SW1-SW3 之间的链路 DOWN 掉时，PC2 应该仍然能够访问 Server，情况类似。&lt;/p>
&lt;p>&lt;strong>S&lt;/strong>：正如我前面所说的：当 SW2/SW3 的出口线路故障了，下联的 R1/R2 也不会从 SW2/SW3 学习到去往 Server 的路由条目。此时去往 Server 的流量已经在 R1/R2 通过走对角线的路径来到 SW3/SW2 上。&lt;/p>
&lt;p>重点解决回程的路径。因为前面已经修改了 SW2 和 SW3 上的 e0/3 的 cost ，这就使得当 SW1-SW2 之间的链路 DOWN 掉或者 SW1-SW3 之间的链路 DOWN 掉时，SW3/SW2 去往 10.1.10.0 和 10.1.20.0 网段都是直线往下经过 R2 或者 R1 回程到业务网段，并不符合需求。需要添加策略路由 PBR 实现往返路径一致。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- SW2 配置，配置匹配去往 10.1.20.0 网段的 ACL，配置 route-map 匹配 ACL ，设置去往10.1.20.0 网段的下一跳地址，配置 SLA 监测，最后在 e0/1 调用
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">access-list 101 permit ip any 10.1.20.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">route-map pbr_20.0 permit 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> match ip address 101
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> set ip next-hop verify-availability 10.1.254.105 1 track 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip sla 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> icmp-echo 10.1.254.105 source-interface Ethernet0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> frequency 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">! 设置 delay 是为了及时观察现象，实际生产环境不需这么做
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> track 1 ip sla 1 reachability
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> delay down 5 up 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip sla schedule 1 life forever start-time now
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip policy route-map pbr_20.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>当SW1-SW3之间的链路DOWN掉时，PC2应该仍然能够访问Server，情况类似。解决思路和上面一样，懒-码-字。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>当 SW2-R1 之间的链路 DOWN 掉时，PC1 访问 Server 的数据流切换至路径：R3&amp;gt;R1&amp;gt;SW3&amp;gt;SW1&amp;gt;Server，此时不要求流量往返路径完全一致。当 SW3-R2 之间的链路 DOWN 掉时，PC2 应该仍能够访问到 Server。&lt;/p>
&lt;p>&lt;strong>S&lt;/strong>：当 SW2-R1 之间的链路 DOWN 掉时，R1 是能够从 SW3 学习到去往 Server 的路由的，只是回程的时候路径是： Server&amp;gt; SW1 &amp;gt; SW2 &amp;gt; R2 &amp;gt;R4 ，不要求流量往返路径完全一致，本条需求已经自动实现了。当SW3-R2之间的链路DOWN掉时同理。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>R3、R4 任意一台路由器与内网交换机直连链路 DOWN 掉，不影响内网 PC 访问外网。&lt;/p>
&lt;p>&lt;strong>S&lt;/strong>：配置的 VRRP 可以实现。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>【可选】若 R3 的出口 DOWN 或 R1 的两条上联链路都 DOWN，以上两种情况，R3 都能检测到，要求此两种情况发生时内网用户访问 SERVER 都不受影响，R4 同理。&lt;/p>
&lt;p>&lt;strong>S&lt;/strong>：R3 的出口 DOWN 或 R1 的两条上联链路都 DOWN，明显要求配置 SLA 特性，我的做法是在 SW3 和 SW2 上配置一个环回地址，R3/R4 检测这个地址的可达性。举例：当 R3 配置了监测 SW3 的环回地址可达性，无论是 R3 的出口 DOWN 或 R1 的两条上联链路都 DOWN 其中一个条件达成，都会导致监测失败不可达，再在相应的内网子接口下配置 Track 联动降低 VRRP 组的优先级，使其成为 Backup 状态，另一台路由器成为 Master ，此时内网用户访问 Server 路径自动切换不受影响（其实还是会掉包的，取决于你配置的监测周期，抢占延时，生成树协议）。R4 同理。&lt;/p>
&lt;p>（11月10日发现，可以使用 &lt;strong>Track list&lt;/strong> 的方式实现）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">! --- R3 配置
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Ethernet0/1.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vrrp 10 track 1 decrement 21
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip sla 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> icmp-echo 33.33.33.33 source-interface Ethernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> frequency 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip sla schedule 1 life forever start-time now
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">track 1 ip sla 1 reachability
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> delay down 5 up 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;/li>
&lt;/ol>
&lt;h2 id="ending">Ending
&lt;/h2>&lt;ul>
&lt;li>配置存阿里云盘了，这是链接：[&lt;a class="link" href="https://www.aliyundrive.com/s/VsEkNTBjuxy" target="_blank" rel="noopener"
>分享的文件
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>]&lt;/li>
&lt;li>欢迎“&lt;del>来电&lt;/del>”来函探讨。&lt;/li>
&lt;/ul></description></item><item><title>PNETLab试用</title><link>https://weeaster.github.io/posts/13f1a9a7/</link><pubDate>Fri, 05 Nov 2021 18:43:23 +0000</pubDate><guid>https://weeaster.github.io/posts/13f1a9a7/</guid><description>&lt;p>&lt;strong>PNETLab&lt;/strong> &lt;strong>(&lt;em>Packet Network Emulator Tool Lab&lt;/em>&lt;/strong>)is a platform that allows you to download and share labs with the community. 这句话摘抄自&lt;a class="link" href="https://pnetlab.com/pages/documentation" target="_blank" rel="noopener"
>官网
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>介绍，这是链接：&lt;a class="link" href="https://pnetlab.com/pages/documentation" target="_blank" rel="noopener"
>What is PNETLab?
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/p>
&lt;p>上网冲浪发现这个大宝贝，看完介绍心理痒痒就搞一搞，有个帖子介绍挺好，原文：&lt;a class="link" href="https://community.cisco.com/t5/%E7%BD%91%E7%BB%9C%E5%8D%9A%E5%AE%A2/%E5%8E%9F%E5%88%9B-%E8%B6%85%E7%BA%A7%E6%8E%A8%E8%8D%90-%E7%BD%91%E5%B7%A5%E5%BF%85%E5%A4%87%E6%A8%A1%E6%8B%9F%E5%99%A8pnetlab-%E9%99%84%E4%B8%8B%E8%BD%BD%E9%93%BE%E6%8E%A5-%E5%85%A8%E7%90%83%E7%AC%AC%E4%B8%80%E7%AF%87%E6%9C%80%E4%BC%98%E8%B4%A8%E7%9A%84%E5%B8%96%E5%AD%90/ba-p/4383377" target="_blank" rel="noopener"
>【原创】超级推荐：网工必备模拟器PNETLab，附下载链接，全球第一篇最优质的帖子
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>。&lt;/p>
&lt;h2 id="experience">Experience
&lt;/h2>&lt;p>不能说和 EVE-NG “一模一样”，我对比过（可能是使用方法不规范，也可能是其他原因），之前用EVE-NG可以跑起整张 CCIE V5 H1 的拓扑（电脑的 CPU 和 RAM 未变动，系统换 WIN10 ，加了固态硬盘做系统盘），现在装了 PNETLab 只能跑 31台 还是 32 台设备（原谅老年人健忘）。&lt;/p>
&lt;h3 id="hardware-requirements">Hardware requirements
&lt;/h3>&lt;p>看了官网文档，我这古董 AMD CPU 不在硬件支持范围内（是不是这个原因跑不了那么多设备呢？），当看到这些说明的时候，我差点就把正在下载中的文件给取消了。最后安上了，我若安不好，当天便可以多睡几小时。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">PC/Laptop HW requirements
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CPU：Intel i5/i7 (4 Logical processors), Enabled Intel virtualization in BIOS
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RAM：8Gb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">HDD Space：40Gb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Network：LAN/WLAN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">----------------------------------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PNETLab Virtual machine requirements
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CPU：4/1 (Number of processors/Number of cores per processor) Enabled Intel VT-x/EPT virtualization engine
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RAM：6Gb or more
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">HDD：40Gb or more
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Network：VMware NAT or Bridged network adapter
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Unsupported hardware and systems
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The following are currently not supported:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">• AMD CPU based PC or Server
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">• VirtualBox virtualization
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">• Citrix XenServer
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">• Microsoft HyperV
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">• Ubuntu 17.X or 18.x as platform
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="pnetlab-supported-images">PNETLab Supported Images
&lt;/h3>&lt;p>查看支持的镜像，还是挺多的，不知为何 H3C 不在列表里，看B站 UP 主视频把 H3C 的防火墙设备弄进去了，不过我挺少用 QEMU 的镜像（太吃内存了），Huawei/H3C 的实验还是用官方的模拟器。&lt;/p>
&lt;p>还有个事，就是现在 &lt;a class="link" href="https://user.pnetlab.com/store/labs/view" target="_blank" rel="noopener"
>&lt;em>PNETLab Store&lt;/em>
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a> 商店下载Lab不附带一起下载镜像了，要自己找镜像上传到目录，还好可以找之前 EVE-NG 的资源上传。&lt;/p>
&lt;h3 id="language--汉化">Language &amp;amp; 汉化
&lt;/h3>&lt;p>看到 B 站视频有 UP 主用了汉化，我就还好，看这些英文不头疼。其实也简单，就是把里边的英文包复制一份到电脑，再打开里面的 &lt;strong>JSON 文件&lt;/strong>，里面有两列，左边属性，右边 Web 界面显示的字符，把右边填上中文保存上传到 Chinese 的文件夹，再切换一下即可。&lt;/p>
&lt;h3 id="how-to-console-to-devices">How to console to devices
&lt;/h3>&lt;p>有两种方式，跟 EVE-NG 不知道是哪个版本的方式一样。&lt;/p>
&lt;ul>
&lt;li>使用 &lt;strong>HTML Console&lt;/strong>，在拓扑界面弹出一个小窗的方式，我个人就不太喜欢这么搞，不舒畅。&lt;/li>
&lt;li>使用 &lt;strong>Default Console&lt;/strong>，调用系统自带的默认程序打开，例如把 CRT 软件设置成系统默认，跟 EVE-NG 的 &lt;strong>EVE-NG-Win-Client-Pack&lt;/strong> 这玩意儿“一模一样”。&lt;/li>
&lt;/ul>
&lt;h2 id="ending">Ending
&lt;/h2>&lt;p>欢乐的时光特别短，又到时候说88，还有很多需要探索的地方，不谈了，开饭。&lt;/p>
&lt;p>接下来我将用 PNETLab 搞一个实验，来自大佬&lt;a class="link" href="http://blog.sina.com.cn/vinsoney" target="_blank" rel="noopener"
>红茶三杯
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>博客的原文:&lt;a class="link" href="http://blog.sina.com.cn/s/blog_5ec353710102w64i.html" target="_blank" rel="noopener"
>【有点儿意思系列 06】一个看起来简单的案例
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>，弄完了写一篇文 po 出来，先看图。&lt;/p>
&lt;p>下一篇文链接： &lt;a class="link" href="https://kiraster.github.io/posts/8ac5ac4a.html" target="_blank" rel="noopener"
>No.001 Simple Case - Kir&amp;rsquo;s Blog
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/11/05/aV6ElzprdKjscFt.jpg">
&lt;img src="https://i.loli.net/2021/11/05/aV6ElzprdKjscFt.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p></description></item><item><title>TI10</title><link>https://weeaster.github.io/posts/fae4c6b8/</link><pubDate>Mon, 18 Oct 2021 15:44:23 +0000</pubDate><guid>https://weeaster.github.io/posts/fae4c6b8/</guid><description>&lt;p>Ti10 结束了，LGD 再次倒在了总决赛&lt;/p>
&lt;p>相信包括我在内的许多人都坚信今年的总冠军是 LGD，但是……&lt;/p>
&lt;p>回忆起之前，一到周末约上两条友肝这游戏到天亮的时光，就很快乐&lt;/p>
&lt;p>我已经基本不玩这游戏，因为这游戏太耗费时间了，成了云玩家&lt;/p>
&lt;p>赛事结束后看到微博上各种“哀嚎”，“愤怒”，“”谩骂“，“惋惜”，“揣测”……&lt;/p>
&lt;p>尽管各种情绪，但理智的思考后只有一句话：技不如人，甘拜下风&lt;/p>
&lt;p>你也别说什么五年了，该 CN DOTA 举一次盾了&lt;/p>
&lt;p>巧了，独联体区的玩家也是这么这么认为的&lt;/p>
&lt;p>最终该区的战队在第一次夺冠后隔了十年才再次夺冠&lt;/p>
&lt;p>……&lt;/p>
&lt;p>只希望有勇敢的追梦人继续追逐他们的梦想&lt;/p></description></item><item><title>H3C_连接L2TP的客户端设置(图片)</title><link>https://weeaster.github.io/posts/ab889e59/</link><pubDate>Sat, 16 Oct 2021 11:49:23 +0000</pubDate><guid>https://weeaster.github.io/posts/ab889e59/</guid><description>&lt;h2 id="inode-客户端设置">iNode 客户端设置
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/6tObaIvM4sT8LQH.jpg">
&lt;img src="https://i.loli.net/2021/10/16/6tObaIvM4sT8LQH.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/Dfh7wak1BMEGAzF.jpg">
&lt;img src="https://i.loli.net/2021/10/16/Dfh7wak1BMEGAzF.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/xeio4aJEXTwj32c.jpg">
&lt;img src="https://i.loli.net/2021/10/16/xeio4aJEXTwj32c.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/Nr5fvnBb1iMymWX.jpg">
&lt;img src="https://i.loli.net/2021/10/16/Nr5fvnBb1iMymWX.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/u9LWMGB8kblwQNc.jpg">
&lt;img src="https://i.loli.net/2021/10/16/u9LWMGB8kblwQNc.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/uqZ67QnwrOc3Pb9.jpg">
&lt;img src="https://i.loli.net/2021/10/16/uqZ67QnwrOc3Pb9.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/2udqBsEzFVnJWpw.jpg">
&lt;img src="https://i.loli.net/2021/10/16/2udqBsEzFVnJWpw.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/MtpabHJN3GWx6sQ.jpg">
&lt;img src="https://i.loli.net/2021/10/16/MtpabHJN3GWx6sQ.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/ahRQEToFxqCgjYw.jpg">
&lt;img src="https://i.loli.net/2021/10/16/ahRQEToFxqCgjYw.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="windows-端配置网络中心添加">windows 端配置—网络中心添加
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/sc7ZTg9qI4z6QGC.jpg">
&lt;img src="https://i.loli.net/2021/10/16/sc7ZTg9qI4z6QGC.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/qnu39EMLNT5YWsH.jpg">
&lt;img src="https://i.loli.net/2021/10/16/qnu39EMLNT5YWsH.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/9VFMLRE4DkuCKTe.jpg">
&lt;img src="https://i.loli.net/2021/10/16/9VFMLRE4DkuCKTe.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/MTipvRdDfh5ztJS.jpg">
&lt;img src="https://i.loli.net/2021/10/16/MTipvRdDfh5ztJS.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/7KN6uextv8WQyLO.jpg">
&lt;img src="https://i.loli.net/2021/10/16/7KN6uextv8WQyLO.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/KceAM7gHX6IESUR.jpg">
&lt;img src="https://i.loli.net/2021/10/16/KceAM7gHX6IESUR.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/6VDYJ5jbspS9wiu.jpg">
&lt;img src="https://i.loli.net/2021/10/16/6VDYJ5jbspS9wiu.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/pa1LGCK3qebd4fy.jpg">
&lt;img src="https://i.loli.net/2021/10/16/pa1LGCK3qebd4fy.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/dG2CNP1lnI94AxH.jpg">
&lt;img src="https://i.loli.net/2021/10/16/dG2CNP1lnI94AxH.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/iLPUBrnG8hyaNvV.jpg">
&lt;img src="https://i.loli.net/2021/10/16/iLPUBrnG8hyaNvV.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p></description></item><item><title>H3C_线路测试脚本</title><link>https://weeaster.github.io/posts/60e83b3d/</link><pubDate>Sat, 16 Oct 2021 01:17:37 +0000</pubDate><guid>https://weeaster.github.io/posts/60e83b3d/</guid><description>&lt;p>之前做了一个割接网络的项目，在过程中要测试网点和中心的几百条专线线路，心想要逐个 ping 测试个对端IP地址，在时间上，操作上根本不可行，整个割接时间有限定，又是在凌晨时间……限制比较多，刚好那段时间在玩 Python，就想着能不能做个脚本自己跑，最后实现了，而且生成 Excel 表格统计测试成功和测试失败的信息。&lt;/p>
&lt;h2 id="操作">操作
&lt;/h2>&lt;h3 id="记录会话日志log-session">记录会话日志（log session）
&lt;/h3>&lt;ul>
&lt;li>设置会话属性参数（可单独设置串口会话、telnet 会话和 ssh 会话，右键会话属性修改即可）&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/N17ytdC6MGSKu4e.jpg">
&lt;img src="https://i.loli.net/2021/10/16/N17ytdC6MGSKu4e.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>设置 log file 参数（设置保存路径，选项，日志的开头和结束位置插入信息（脚本用于判断结束的位置））&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/zIWMxF45NcX3Lli.jpg">
&lt;img src="https://i.loli.net/2021/10/16/zIWMxF45NcX3Lli.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="制作端口和-ip-信息的-txt-文件">制作端口和 IP 信息的 txt 文件
&lt;/h3>&lt;p>说明：第一列为网络中心路由器接口，第二列为对端网点设备的 IP 地址（接口和IP我已经处理过了，假的，真的不会贴出来）&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/qN5caRwgkxTWeC7.jpg">
&lt;img src="https://i.loli.net/2021/10/16/qN5caRwgkxTWeC7.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="编写-ping-测试-python-脚本">编写 ping 测试 Python 脚本
&lt;/h3>&lt;ul>
&lt;li>脚本内容&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># $language = &amp;#34;python&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># $interface = &amp;#34;1.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">os&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">SecureCRT&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">():&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">crt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Screen&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Synchronous&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">True&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;F:/SR66_Test/SR66.txt&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;r&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">rfile&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ping_list&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">rfile&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">readlines&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 遍历SR66文件里的每一行，把第1列赋值给 port_info，第二列赋值给 ping_ip&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">ping_info&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">ping_list&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">port_info&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ping_info&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">()[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ping_ip&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ping_info&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">()[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">crt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Screen&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Send&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\r&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 在路由器命令行界面输入#+port_info并回车，例如：#GE4/1/0.111&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">crt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Screen&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Send&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;#&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">port_info&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\r&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 在路由器命令行界面输入ping -c + ping_ip并回车，例如：ping -c 3 100.10.142.30&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">crt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Screen&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Send&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;ping -c 3 &amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">ping_ip&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\r&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">main&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>SceureCRT 登陆路由器，点击 “Script” –&amp;gt; “Run” 选择脚本，运行脚本。运行时间取决于线路的正常连通和测试的数量&lt;/li>
&lt;/ul>
&lt;h3 id="编写结果统计-python-脚本">编写结果统计 Python 脚本
&lt;/h3>&lt;ol>
&lt;li>处理 ping 测试后的 log session 日志记录&lt;/li>
&lt;li>提取 ping 测试的结果信息（会同时生成一个 result.txt 的文件）&lt;/li>
&lt;li>对 result.txt 文件的信息进行处理生成 Excel 表格&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>脚本内容：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Author：KIRASTER&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Time：2021/x/x x:x&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Description：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">os&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">re&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">xlsxwriter&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">xw&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">xlsxwriter&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">Workbook&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">filename&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;F:/SR66_Test/xxx.log&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">resultfilename&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;F:/SR66_Test/result.txt&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">exists&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">resultfilename&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">remove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">resultfilename&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">result_txt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;F:/SR66_Test/result.txt&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;a&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">filename&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;r&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">file_to_read&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="kc">True&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lines&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">file_to_read&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">readline&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s2">&amp;#34;GE&amp;#34;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># # 提取GE开头的行，也就是端口和IP信息的txt文件里的第一列，并且换行符替换制表符&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">re&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;^.*?#_&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line1&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">result_line1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_txt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s2">&amp;#34;--- Ping statistics&amp;#34;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 提取包含“--- Ping statistics”这一行，替换成“ping + IP”，并且换行符替换制表符&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">re&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;^.*?for&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;ping&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">result_line2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;-&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line2&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">result_line2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_txt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lines&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">next&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file_to_read&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 提取下一行，替换成“result: 0.0% packet loss”&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line3&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">re&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">sub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;^.*?received,&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;result:&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_txt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_txt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">flush&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s2">&amp;#34;结束记录时间&amp;#34;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 遍历到“结束记录时间”这行，中断循环&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">workbook&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Workbook&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">xw&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Workbook&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;F:/SR66_Test/result.xlsx&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sheet0&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">workbook&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_worksheet&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;测试结果&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">centered&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">workbook&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_format&lt;/span>&lt;span class="p">({&lt;/span>&lt;span class="s1">&amp;#39;align&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;center&amp;#39;&lt;/span>&lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">red_style&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">workbook&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_format&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;fg_color&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;red&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;align&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;center&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;bold&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">True&lt;/span>&lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">green_style&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">workbook&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_format&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;fg_color&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;green&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;align&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;center&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;bold&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">True&lt;/span>&lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">blue_style&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">workbook&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">add_format&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;fg_color&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;#8DB4E2&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="s1">&amp;#39;align&amp;#39;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s1">&amp;#39;center&amp;#39;&lt;/span>&lt;span class="p">})&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sheet0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;检测端口&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">blue_style&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sheet0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;对端IP地址&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">blue_style&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sheet0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;返回结果&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">blue_style&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sheet0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;检测结果&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">blue_style&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sheet0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;线路正常&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">green_style&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># sheet0.write(0, 5, &amp;#39;&amp;#39;, green_style)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sheet0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;检测失败&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">red_style&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># sheet0.write(0, 7, &amp;#39;&amp;#39;, red_style)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sheet0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">set_column&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">20&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sheet0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">set_column&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">24&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sheet0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">set_column&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">28&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sheet0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">set_column&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">12.38&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sheet0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">set_column&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">4&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">12.38&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sheet0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">set_column&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sheet0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">set_column&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">6&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mf">12.38&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sheet0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">set_column&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">7&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sheet0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">freeze_panes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">8&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">top_row&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># sheet0.filter_column_list(&amp;#34;D&amp;#34;, [&amp;#39;正常&amp;#39;, &amp;#39;检测失败&amp;#39;])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sheet0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">filter_column_list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;x = &amp;#34;正常&amp;#34;&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sheet0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write_formula&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;D2&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;{=IF(ISNUMBER(FIND(&amp;#34;100.0%&amp;#34;,C2)),&amp;#34;检测失败&amp;#34;,IF(ISNUMBER(FIND(&amp;#34;0.0%&amp;#34;,C2)),&amp;#34;正常&amp;#34;))}&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sheet0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write_formula&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;F1&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;{=SUMPRODUCT((D2:D999=&amp;#34;正常&amp;#34;)*1)}&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sheet0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write_formula&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;H1&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;{=SUMPRODUCT((D2:D999=&amp;#34;检测失败&amp;#34;)*1)}&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;D:/SR6608_Test/result.txt&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">file_object&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lines&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">file_object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">readlines&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file_object&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> &lt;span class="n">xls_line&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s2">&amp;#34;GE&amp;#34;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">xls_line&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">xls_line&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">xls_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">xls_line&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">xls_line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">xls_line&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">port_info&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">xls_line&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip_addr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">xls_line&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">return_info&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">xls_line&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sheet0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">port_info&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sheet0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">ip_addr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sheet0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">return_info&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># sheet0.write_formula(x, 3, &amp;#39;=IF(ISNUMBER(FIND(&amp;#34;100.0%&amp;#34;,C2)),&amp;#34;正常&amp;#34;,IF(ISNUMBER(FIND(&amp;#34;0.0%&amp;#34;,C2)),&amp;#34;检测失败&amp;#34;))&amp;#39;)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">i&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">x&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">workbook&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>ping 测试的 log session 文件&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/CLrzYM5tlVOENs3.jpg">
&lt;img src="https://i.loli.net/2021/10/16/CLrzYM5tlVOENs3.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>生成的 result.txt 文件&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/3kAIXCifLcr9jTa.jpg">
&lt;img src="https://i.loli.net/2021/10/16/3kAIXCifLcr9jTa.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>生成的 Exce 表格&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/3VRdct6raI8Nu7h.jpg">
&lt;img src="https://i.loli.net/2021/10/16/3VRdct6raI8Nu7h.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p></description></item><item><title>我的一些blog常用小操作</title><link>https://weeaster.github.io/posts/c1906682/</link><pubDate>Thu, 14 Oct 2021 23:03:52 +0000</pubDate><guid>https://weeaster.github.io/posts/c1906682/</guid><description>&lt;p>自己日常操作的一些小命令和插件。&lt;/p>
&lt;h3 id="bat启动-hexo-本地服务">bat启动 hexo 本地服务
&lt;/h3>&lt;p>前提条件：已完成博客搭建。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">@echo off
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">start D:\Program&amp;#34; &amp;#34;Files\Git\git-bash.exe --cd=D:/blog/blog -c &amp;#34;hexo clean &amp;amp;&amp;amp; hexo g &amp;amp;&amp;amp; hexo s&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol>
&lt;li>新建后缀为bat的脚本文件&lt;/li>
&lt;li>复制以上命令粘贴（注意修改路径 ），保存&lt;/li>
&lt;li>双击此脚本运行的结果相当于在你的 blog 路径下右键 “Git Bash Here” 并输入 “hexo clean &amp;amp;&amp;amp; hexo g &amp;amp;&amp;amp; hexo s” 运行.&lt;/li>
&lt;/ol>
&lt;h3 id="bat-推送至-github">bat 推送至 github
&lt;/h3>&lt;p>前提条件：已完成博客搭建和推送github的设置。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">@echo off
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">start D:\Program&amp;#34; &amp;#34;Files\Git\git-bash.exe --cd=D:/blog3/blog -c &amp;#34;hexo clean &amp;amp;&amp;amp; hexo g &amp;amp;&amp;amp; hexo d &amp;amp;&amp;amp; hexo s&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol>
&lt;li>新建后缀为bat的脚本文件&lt;/li>
&lt;li>复制以上命令粘贴（注意修改路径 ），保存&lt;/li>
&lt;li>双击此脚本运行的结果相当于在你的blog路径下右键 “Git Bash Here” 并输入 “hexo clean &amp;amp;&amp;amp; hexo g &amp;amp;&amp;amp; hexo d &amp;amp;&amp;amp; hexo s” 运行（如果只输入 “hexo clean &amp;amp;&amp;amp; hexo g &amp;amp;&amp;amp; hexo d “ ，当命令执行完后会自动关闭命令窗口，无法得知推送是否成功，所以后边加”hexo s“，运行完成后确认推送成功，Ctrl+C结束即可）&lt;/li>
&lt;/ol>
&lt;h3 id="文章页图片放大灯箱效果">文章页图片放大（灯箱效果）
&lt;/h3>&lt;p>&lt;strong>相关链接&lt;/strong>：https://github.com/fancyapps/fancybox&lt;/p>
&lt;ol>
&lt;li>添加 js/css 到网站代码中，每个博客的存放代码的文件和位置可能不一样，有的是在 styl 文件中，有的可能在 EJS/PUG/SWIG 文件中，我使用的模版是在主题目录下的 _config.yml 文件中&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">css:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">js:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>在 .md 文件里插入图片，添加代码&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-html" data-lang="html">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">a&lt;/span> &lt;span class="na">data-fancybox&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;gallery&amp;#34;&lt;/span> &lt;span class="na">href&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;big_1.jpg&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">img&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;small_1.jpg&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">a&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 其中 big_1.jpg 和 small_1.jpg 可以是一致的，可以设置 width 参数来设置网页图片显示为小图。例如:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">a&lt;/span> &lt;span class="na">data-fancybox&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;gallery&amp;#34;&lt;/span> &lt;span class="na">href&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;https://i.loli.net/xxxxx.jpg&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">img&lt;/span> &lt;span class="na">src&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;https://i.loli.net/xxxxx.jpg&amp;#34;&lt;/span> &lt;span class="na">width&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;61.8%&amp;#34;&lt;/span> &lt;span class="p">/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">a&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="404-页面">404 页面
&lt;/h3>&lt;p>&lt;strong>相关链接&lt;/strong>：https://www.qq.com/404/&lt;/p>
&lt;p>虽然 blog 网站简单，访问出现 404 页面机会极少（除非在网址栏乱输入），但是还是操作一下。&lt;/p>
&lt;p>具体设置点上面网址。&lt;/p>
&lt;h3 id="添加文章链接-abbrlink">添加文章链接 abbrlink
&lt;/h3>&lt;ul>
&lt;li>安装插件&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">npm&lt;/span> &lt;span class="nx">install&lt;/span> &lt;span class="nx">hexo&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">abbrlink&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="nx">save&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">npm&lt;/span> &lt;span class="nx">install&lt;/span> &lt;span class="nx">eslint&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="mf">4.&lt;/span>&lt;span class="nx">x&lt;/span> &lt;span class="nx">babel&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">eslint&lt;/span>&lt;span class="err">@&lt;/span>&lt;span class="mi">8&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="nx">save&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">dev&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>修改&lt;strong>网站根目录&lt;/strong>配置文件 _config_yml&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">permalink&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">posts&lt;/span>&lt;span class="o">/:&lt;/span>&lt;span class="nx">abbrlink&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">html&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">abbrlink&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">alg&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">crc32&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">rep&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">hex&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>alg 和 rep 不同组合生成的链接&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">crc16&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="nx">hex&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">https&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="c1">//xx.github.io/posts/1234.html
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">crc16&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="nx">dec&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">https&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="c1">//xx.github.io/posts/12345.html
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">crc32&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="nx">hex&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">https&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="c1">//xx.github.io/posts/12345678.html
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">crc32&lt;/span> &lt;span class="o">&amp;amp;&lt;/span> &lt;span class="nx">dec&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">https&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="c1">//xx.github.io/posts/123456789a.html
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>hexo g 生成后，md 文件的 Front-matter 增加 abbrlink 属性，值为生成的 ID 链接，发布文章后文章链接不随改变文章内容而改变。&lt;/p></description></item><item><title>关于新主题博客</title><link>https://weeaster.github.io/posts/f2af2fdc/</link><pubDate>Tue, 12 Oct 2021 01:39:36 +0000</pubDate><guid>https://weeaster.github.io/posts/f2af2fdc/</guid><description>&lt;p>我为什么要启用一个新 hexo 主题呢，没有什么特别的原因，单纯的想玩玩。而为什么要迁移到 GitHub 呢，这就故事很多了，下文详说。换主题换站点搞了好几天，对于不是专业搞代码的我确实折腾，不过乐在其中。看着浏览器历史里拉不到底的搜索记录和自己提的 To-Do List，我真是自己玩自己。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/12/wAtgkVYCODvu387.jpg">
&lt;img src="https://i.loli.net/2021/10/12/wAtgkVYCODvu387.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="感谢">感谢
&lt;/h2>&lt;p>先感谢上一个主题的作者（&lt;a class="link" href="https://tridiamond.tech" target="_blank" rel="noopener"
>三·钻 TriDiamond
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a> ）让我搭了博客，再感谢现在这个主题（&lt;a class="link" href="https://phower.me/" target="_blank" rel="noopener"
>Le Phower&amp;rsquo;s
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>）的作者。&lt;/p>
&lt;h2 id="关于-giteepages">关于 GiteePages
&lt;/h2>&lt;p>大概是四五月份，GiteePages上突然出了个公告说维护，一停就到八九月份。九月份我再去点开启服务，好家伙直接提示页面违规？我按提示去检查页面是 category 页面违规，what？ 一个文章分类页提示违规？自问没有什么敏感词在里头，页面加起来就几十个汉字，代码违规我就不懂了。我直接去生成的静态 html 页面把代码清空再发布就可以了，wtf？气不过的我直接关了服务晾了几个星期，后来有点空闲时间我开始折腾起来，就是弄现在的这个博客主题。直到我把内容制作好，再次启用 Pages 服务并截几张图做留念，就把博客仓库的文件清空了，当我把现在的代码上传到 Gitee 后点击启动服务，弹出实名认证，姓名，身份证正反面，手持身份证正反面，而没清空前可以发布成功，真是双标，你要是一视同仁我敬重你。我去查了邮箱没有收到任何通知，包括 Pages 服务停用的事情，这种办事方式我个人是不认同的，不尊重用户。随即我个人做出了抵制的举动，我清空了所有仓库（虽然也没什么太多内容），签名留下一句话，就去找注销账户的页面，再次震惊了我，流程（见图片），按照格式写封邮件&amp;ndash;加 QQ 群联系管理员&amp;ndash;再人工审核三五天，真 QQ 办公……想想算了，我嫌麻烦，还要耗费时间打交道。
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/12/HFrU5xyjnD3OKMI.jpg">
&lt;img src="https://i.loli.net/2021/10/12/HFrU5xyjnD3OKMI.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="obsidian-主题页面留念">Obsidian 主题页面留念
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/12/QJlZR58bizGd4VU.jpg">
&lt;img src="https://i.loli.net/2021/10/12/QJlZR58bizGd4VU.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/12/epGrIlb4F1vcNmn.jpg">
&lt;img src="https://i.loli.net/2021/10/12/epGrIlb4F1vcNmn.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/12/iQ5TS3yqlvZs1eR.jpg">
&lt;img src="https://i.loli.net/2021/10/12/iQ5TS3yqlvZs1eR.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/12/1tolf749segZz6c.jpg">
&lt;img src="https://i.loli.net/2021/10/12/1tolf749segZz6c.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/12/P5ruo3QzU46kbWD.jpg">
&lt;img src="https://i.loli.net/2021/10/12/P5ruo3QzU46kbWD.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p></description></item><item><title>大梦初醒 荒唐了一生</title><link>https://weeaster.github.io/posts/2703fb4a/</link><pubDate>Fri, 08 Oct 2021 00:24:02 +0000</pubDate><guid>https://weeaster.github.io/posts/2703fb4a/</guid><description>&lt;p>&lt;em>&lt;strong>“大梦初醒 荒唐了一生” &amp;ndash;马頔&lt;/strong>&lt;/em>&lt;/p>
&lt;p>刚开始听到这首歌是一个混实习的关系户女孩，QQ 资料界面一直挂着这首歌&lt;/p>
&lt;p>当时只是觉得很平的一首歌，跟《董小姐》《成都》一个路数&lt;/p>
&lt;p>现在再听和看视频里原唱在舞台上一人一吉他的表演，才发现我自己大意了&lt;/p>
&lt;p>带感情的演唱，好像作者在表达不为人知的情感&lt;/p>
&lt;p>每个人听到一首歌，可能都会有自己的看法，或者没有看法只觉得：爽&lt;/p>
&lt;p>这是主观上的看法，都要尊重与自己不同观点的人的看法，你可以不同意，没必要去勉强、要求&lt;/p>
&lt;p>特意去翻了一下抖音上隐私设置里的黑名单：484&lt;/p>
&lt;p>有时候看短视频，看到讨厌的就不辞麻烦的点点点拉黑了&lt;/p>
&lt;p>有时候为了不误判还点进主页多看几个视频，确认无误后才动手&lt;/p>
&lt;p>你要问我为什么拉黑，我回答不喜欢&lt;/p>
&lt;p>你要问我什么原因，同上&lt;/p>
&lt;p>不解释，我自己心里有一些抽象的名词&lt;/p>
&lt;p>原则、底线、信仰、情感……&lt;/p>
&lt;p>……&lt;/p></description></item><item><title>H3C_S5500-52C-EI升级步骤</title><link>https://weeaster.github.io/posts/e765d177/</link><pubDate>Tue, 14 Sep 2021 11:03:03 +0000</pubDate><guid>https://weeaster.github.io/posts/e765d177/</guid><description>&lt;p>&lt;strong>准备工作&lt;/strong>&lt;/p>
&lt;p>下载升级所需要的两个文件：&lt;/p>
&lt;p>&lt;strong>S5500EI-BTM-721.btm&lt;/strong>（新版本 Bootrom 程序）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">名称: S5500EI-BTM-721.btm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">大小: 483732 字节 (472 KiB)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CRC32: 4B9436E9
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CRC64: 928CB6227DE9AF69
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SHA256: C0EDB2FA02C5F8804E8D983F4DD197F1D321C21C317ED5BB10BF002CB4973CE8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SHA1: F8B345BC2012C8183CE01F092E4181FC15495867
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BLAKE2sp: 6A5E362D8A4DA8FA74B6A9F4568627FA07C53126DB67F5FF287C9BE893C33502
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>S5500EI-CMW520-R2222P12.bin&lt;/strong>（新版本主机软件）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">名称: S5500EI-CMW520-R2222P12.bin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">大小: 14386411 字节 (13 MiB)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CRC32: D2E2387E
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CRC64: 5806015C822E9D46
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SHA256: 33F9948CF29DEEE01C2449DEC499E35AC1721331F6E73644526F9D2BF9B6C2E0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SHA1: 8D50B9BAD0E80F6DCE14E3C941D3E74CA8D72B96
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BLAKE2sp: 7510F4902CE03E9ABF44E480C4DF642782818AAF9F400E8E8716AFC7F18C6BE2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/ua79omSMlvEptZe.png">
&lt;img src="https://i.loli.net/2021/10/16/ua79omSMlvEptZe.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="登陆查看版本信息和-flash-空间">登陆查看版本信息和 Flash 空间
&lt;/h2>&lt;h3 id="查看当前主机软件版本和-bootrom-版本">查看当前主机软件版本和 Bootrom 版本
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;XX-XX-S5500-1&amp;gt;display version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">H3C Comware Platform Software
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Comware Software, Version 5.20, Release 2202
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Copyright (c) 2004-2010 Hangzhou H3C Tech. Co., Ltd. All rights reserved.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">H3C S5500-52C-EI uptime is 5 weeks, 3 days, 20 hours, 9 minutes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">H3C S5500-52C-EI with 1 Processor
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">256M bytes SDRAM
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">32768K bytes Flash Memory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Hardware Version is REV.C
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CPLD Version is 002
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Bootrom Version is 609
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[SubSlot 0] 48GE+4SFP Hardware Version is REV.C
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="查看-flash-剩余空间">查看 Flash 剩余空间
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;XX-XX-S5500-1&amp;gt;dir
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Directory of flash:/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0 -rw- 10436470 Aug 11 2010 15:04:09 s5500ei-cmw520-r2202.bin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 -rw- 17880 Sep 07 2021 15:25:30 startup.cfg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">31496 KB total (21277 KB free)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>确保Flash有&lt;strong>14.1&lt;/strong>M以上剩余空间（新版本软件共14.1M）&lt;/p>
&lt;h2 id="通过-ftp-实现远程加载文件">通过 FTP 实现远程加载文件
&lt;/h2>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/10/16/XyuBs1QNEGqOZzb.jpg">
&lt;img src="https://i.loli.net/2021/10/16/XyuBs1QNEGqOZzb.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>如 图 所示，FTP Server 与配置计算机是同一台计算机。远程登录到交换机上，执行FTP命令，从 FTP Server 上（假定IP地址为 2.2.2.1）下载主机程序 &lt;strong>S5500EI-CMW520-R2222P12.bin&lt;/strong> 和 BOOTROM 程序 &lt;strong>S5500EI-BTM-721.btm&lt;/strong>。&lt;/p>
&lt;p>&lt;strong>备份 Flash 文件&lt;/strong>&lt;/p>
&lt;p>加载文件前使用 FTP 命令备份文件&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;XX-XX-S5500-1&amp;gt;ftp 2.2.2.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Trying 2.2.2.1 ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press CTRL+K to abort
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Connected to 2.2.2.1.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">220 3Com 3CDaemon FTP 2.0 ready for new user
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">User(2.2.2.1:(none)):123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">331 Give me your password, please
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Password:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">230 Logged in successfully
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[ftp]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[ftp] put s5500ei-cmw520-r2202.bin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[ftp] put startup.cfg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[ftp] put ......
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="第一步通过-ftp-的相关命令将软件下载到本地交换机上">第一步：通过 FTP 的相关命令将软件下载到本地交换机上。
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[ftp] get S5500EI-BTM-721.btm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">227 ÕýÔÚ½øÈë±»¶¯Ä£Ê½ (2,2,2,1,195,132)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">125 ÕýÔÚÊ¹ÓÃÏÖ´æµÄÊý¾ÝÁ¬½Ó
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">......226 ÕýÔÚ¹Ø±ÕÊý¾ÝÁ¬½Ó; ÎÄ¼þ´«Êä³É¹¦Íê³É.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">FTP: 483732 byte(s) received in 7.111 second(s), 68.00K byte(s)/sec.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[ftp]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[ftp] get S5500EI-CMW520-R2222P12.bin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">227 ÕýÔÚ½øÈë±»¶¯Ä£Ê½ (2,2,2,1,195,133)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">125 ÕýÔÚÊ¹ÓÃÏÖ´æµÄÊý¾ÝÁ¬½Ó
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...............................................226 ÕýÔÚ¹Ø±ÕÊý¾ÝÁ¬½Ó; ÎÄ¼þ´«Êä³É¹¦Íê³É.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">FTP: 14386411 byte(s) received in 197.289 second(s), 72.00K byte(s)/sec.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[[ftp] bye
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="第二步在交换机上升级-bootrom">第二步：在交换机上升级 BOOTROM。
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;XX-XX-S5500-1&amp;gt;bootrom update file flash:/s5500ei-btm-721.btm slot 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> This command will update bootrom file on the specified board(s), Continue? [Y/N]:y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Now updating bootrom, please wait...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Succeeded to update bootrom of Board 1.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="第三步在交换机上升级主机软件">第三步：在交换机上升级主机软件。
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">XX&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">XX&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">S5500&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">boot&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">loader&lt;/span> &lt;span class="n">file&lt;/span> &lt;span class="n">flash&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">s5500ei&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cmw520&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">r2222p12&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">bin&lt;/span> &lt;span class="n">slot&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">main&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">This&lt;/span> &lt;span class="n">command&lt;/span> &lt;span class="n">will&lt;/span> &lt;span class="n">set&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">boot&lt;/span> &lt;span class="n">file&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">specified&lt;/span> &lt;span class="n">board&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Continue&lt;/span>&lt;span class="err">?&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">Y&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">N&lt;/span>&lt;span class="p">]:&lt;/span>&lt;span class="n">y&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">The&lt;/span> &lt;span class="n">specified&lt;/span> &lt;span class="n">file&lt;/span> &lt;span class="n">will&lt;/span> &lt;span class="n">be&lt;/span> &lt;span class="n">used&lt;/span> &lt;span class="n">as&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">main&lt;/span> &lt;span class="n">boot&lt;/span> &lt;span class="n">file&lt;/span> &lt;span class="n">at&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">next&lt;/span> &lt;span class="n">reboot&lt;/span> &lt;span class="n">on&lt;/span> &lt;span class="n">slot&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">XX&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">XX&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">S5500&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="n">dis&lt;/span> &lt;span class="n">boot&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">loader&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Slot&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">The&lt;/span> &lt;span class="n">current&lt;/span> &lt;span class="n">boot&lt;/span> &lt;span class="n">app&lt;/span> &lt;span class="n">is&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">flash&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">s5500ei&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cmw520&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">r2202&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">bin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">The&lt;/span> &lt;span class="n">main&lt;/span> &lt;span class="n">boot&lt;/span> &lt;span class="n">app&lt;/span> &lt;span class="n">is&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">flash&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">s5500ei&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">cmw520&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">r2222p12&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">bin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">The&lt;/span> &lt;span class="n">backup&lt;/span> &lt;span class="n">boot&lt;/span> &lt;span class="n">app&lt;/span> &lt;span class="n">is&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">flash&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">/&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="第四步重新启动交换机">第四步：重新启动交换机。
&lt;/h3>&lt;ul>
&lt;li>重起前请确认其他配置是否保存，防止重启后造成配置信息丢失。&lt;/li>
&lt;li>重启设备后即可完成 BOOTROM 和主机软件的加载。&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;XX-XX-S5500-1&amp;gt;reboot
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Start to check configuration with next startup configuration file, please wait.........DONE!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> This command will reboot the device. Continue? [Y/N]:y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#Sep 14 15:51:46:49 2021 XX-XX-S5500-1 DEV/1/REBOOT:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Reboot device by command.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">%Sep 14 15:51:46:163 2021 XX-XX-S5500-1 DEV/4/SYSTEM REBOOT:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> System is rebooting now.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Starting......
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ***********************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * *
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * H3C S5500-52C-EI BOOTROM, Version 721 *
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * *
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ***********************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Copyright (c) 2004-2013 Hangzhou H3C Tech. Co., Ltd.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Creation date : Nov 12 2013, 01:59:13
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CPU Clock Speed : 533MHz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> BUS Clock Speed : 133MHz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Memory Size : 256MB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Mac Address : 3822d60cd0f8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press Ctrl-B to enter Boot Menu... 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Auto-booting...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Decompress Image.........................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................OK!
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">User interface aux0 is available.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Press ENTER to get started.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="查看升级后的版本信息">查看升级后的版本信息
&lt;/h2>&lt;p>查看主机软件版本和 Bootrom 程序版本&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;XX-XX-S5500-1&amp;gt;dis version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">H3C Comware Platform Software
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Comware Software, Version 5.20, Release 2222P12
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Copyright (c) 2004-2018 New H3C Technologies Co., Ltd. All rights reserved.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">H3C S5500-52C-EI uptime is 0 week, 0 day, 0 hour, 2 minutes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">H3C S5500-52C-EI with 1 Processor
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">256M bytes SDRAM
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">32768K bytes Flash Memory
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Hardware Version is REV.C
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CPLD Version is 002
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Bootrom Version is 721
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[SubSlot 0] 48GE+4SFP Hardware Version is REV.C
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="删除旧主机软件">删除旧主机软件
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;XX-XX-S5500-1&amp;gt;dir
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Directory of flash:/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0 -rw- 10436470 Aug 11 2010 15:04:09 s5500ei-cmw520-r2202.bin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 -rw- 17952 Sep 14 2021 15:36:21 startup.cfg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2 -rw- 483732 Sep 14 2021 15:31:57 s5500ei-btm-721.btm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3 -rw- 14386411 Sep 14 2021 15:35:42 s5500ei-cmw520-r2222p12.bin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 4 drw- - Apr 26 2000 12:00:40 seclog
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">31496 KB total (6751 KB free)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;XX-XX-S5500-1&amp;gt;delete /unreserved s5500ei-cmw520-r2202.bin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The contents cannot be restored!!! Delete flash:/s5500ei-cmw520-r2202.bin?[Y/N]:y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Deleting a file permanently will take a long time. Please wait...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">........................................................................................
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">%Delete file flash:/s5500ei-cmw520-r2202.bin...Done.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;XX-XX-S5500-1&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;XX-XX-S5500-1&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;XX-XX-S5500-1&amp;gt;dir
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Directory of flash:/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0 -rw- 17952 Sep 14 2021 15:36:21 startup.cfg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 -rw- 483732 Sep 14 2021 15:31:57 s5500ei-btm-721.btm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2 -rw- 14386411 Sep 14 2021 15:35:42 s5500ei-cmw520-r2222p12.bin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3 drw- - Apr 26 2000 12:00:40 seclog
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">31496 KB total (16943 KB free)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="注意事项">注意事项
&lt;/h2>&lt;ul>
&lt;li>加载主机软件必须通过 reboot 命令重起交换机后才能使加载成功。&lt;/li>
&lt;li>如果 Flash 空间不够，可以先删除 Flash 中的无用文件，再进行软件的下载。&lt;/li>
&lt;li>在加载过程中不可断电。&lt;/li>
&lt;/ul></description></item><item><title>HCL_VPN不同实例互通实验</title><link>https://weeaster.github.io/posts/eb7e5d69/</link><pubDate>Tue, 27 Apr 2021 11:35:32 +0000</pubDate><guid>https://weeaster.github.io/posts/eb7e5d69/</guid><description>&lt;p>&lt;strong>实验拓扑和需求&lt;/strong>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/04/27/Zf26CX97SRQzrvu.jpg">
&lt;img src="https://i.loli.net/2021/04/27/Zf26CX97SRQzrvu.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>实验模拟的是一个总部和一个分支站点的网络，网络中总部和分支相同 VPN 实例网络互通，不同 VPN 实例网络相互隔离，总部 VPN2 中特殊主机 PC_8 需要访问位于分支网络中的 VPN1 网络&lt;/p>
&lt;hr>
&lt;h2 id="思路和解决方法">&lt;strong>思路和解决方法&lt;/strong>
&lt;/h2>&lt;ul>
&lt;li>
&lt;p>网络设备中配置 VPN instance 用来隔离不同网络数据&lt;/p>
&lt;/li>
&lt;li>
&lt;p>在不做特殊配置的情况下，不同 VPN 实例的网络是不能互相通信的&lt;/p>
&lt;/li>
&lt;li>
&lt;p>然而在设备上 VPN 实例引入其他 VPN 实例网络又会造成不同实例间网络能互通的情况，进而要做各种 ACL 限制&lt;/p>
&lt;/li>
&lt;li>
&lt;p>实验中并不涉及 MPLS VPN 的场景，有点类似 H3C 文档中 MCE 的情况，但是不涉及 CE、PE、RD、RT……&lt;/p>
&lt;/li>
&lt;li>
&lt;p>RD 是用来做路由区分的，RT 是 BGP 协议中团体属性的内容，本实验中都不涉及，本来也考虑使用 MPLS VPN 的方式做，但是就当前这个场景完全不需要，客户只需要把原有不同的几套网络隔离，还要考虑到设备特性，设备性能等等&lt;/p>
&lt;/li>
&lt;li>
&lt;p>实验中在路由经过的下一跳的设备上都要配置 VPN 实例，核心下联的二层设备不需要配置&lt;/p>
&lt;/li>
&lt;li>
&lt;p>由于不使用引入其他 VPN 实例的方式，需要在总部路由器和总部交换机上配置 VPN 静态路由&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="具体配置">&lt;strong>具体配置&lt;/strong>
&lt;/h2>&lt;h3 id="site_sw">&lt;strong>SITE_SW&lt;/strong>
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sysname SITE_SW
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 配置rip 100 绑定VPN1，宣告与总部互联的网络和分支VPN1的网络
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rip 100 vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> undo summary
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> version 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 10.1.1.1 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.10.254 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 配置rip 200 绑定VPN2，宣告与总部互联的网络和分支VPN2的网络
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rip 200 vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> undo summary
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> version 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 20.1.1.1 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.20.254 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 不重要的dhcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vlan 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vlan 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 不重要的dhcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dhcp server ip-pool vlan10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gateway-list 172.16.10.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.10.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 不重要的dhcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dhcp server ip-pool vlan20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gateway-list 172.16.20.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 172.16.20.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Vlan-interface10为VPN1网络网关
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan-interface10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 172.16.10.254 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># Vlan-interface20为VPN1网络网关
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan-interface20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 172.16.20.254 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 与总部互联物理接口
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port link-mode route
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 使用子接口与总部互联，绑定VPN1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/3.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.1.1.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 使用子接口与总部互联，绑定VPN2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/3.20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 20.1.1.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 不重要
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port access vlan 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> stp edged-port
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 不重要
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port access vlan 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> stp edged-port
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h3 id="hq_router">&lt;strong>HQ_ROUTER&lt;/strong>
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sysname HQ_ROUTER
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 配置rip 100 绑定VPN1，宣告与分支互联的网络，与HQ_SW互联的网络，引入手动配置的去往PC_8主机的路由
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rip 100 vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> undo summary
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> version 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 10.1.1.2 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.1.1.1 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> import-route static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 配置rip 200 绑定VPN2，宣告与分支互联的网络，与HQ_SW互联的网络
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rip 200 vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> undo summary
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> version 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 20.1.1.2 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.1.1.1 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vlan 111
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vlan 222
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 与HQ_SW VPN1 互联vlanif接口
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan-interface111
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 100.1.1.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 与HQ_SW VPN2 互联vlanif接口
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan-interface222
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 100.1.1.1 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 与分支互联物理接口
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port link-mode route
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> combo enable copper
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 使用子接口与分支互联，绑定VPN1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0.10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 10.1.1.2 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vlan-type dot1q vid 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 使用子接口与分支互联，绑定VPN2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0.20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 20.1.1.2 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vlan-type dot1q vid 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 与HQ_SW互联的物理接口
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port link-mode bridge
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port link-type trunk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port trunk permit vlan all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> combo enable copper
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 在vpn1网络中配置的去往PC_8主机的路由
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip route-static vpn-instance vpn1 192.168.40.200 32 vpn-instance vpn2 100.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h3 id="hq_sw">&lt;strong>HQ_SW&lt;/strong>
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sysname HQ_SW
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 配置rip 100 绑定VPN1，宣告与HQ_ROUTER互联的网络和总部VPN1的网络，注意有一条路由过滤，因为在HQ_ROUTER中引入了手动配置的静态的路由，而在HQ_SW VPN1网络中不需要
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rip 100 vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> undo summary
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> version 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.1.1.2 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 192.168.30.254 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> filter-policy prefix-list filter_192.168.40.200 import
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 配置rip 200 绑定VPN2，宣告与HQ_ROUTER互联的网络和总部VPN2的网络
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rip 200 vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> undo summary
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> version 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 100.1.1.2 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 192.168.40.254 0.0.0.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 不重要的dhcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> dhcp enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vlan 30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vlan 40
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vlan 111
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vlan 222
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 不重要的dhcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dhcp server ip-pool vlan30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gateway-list 192.168.30.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 192.168.30.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 不重要的dhcp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dhcp server ip-pool vlan40
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gateway-list 192.168.40.254
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> network 192.168.40.0 mask 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> forbidden-ip 192.168.40.200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># vlan30为VPN1网络网关
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan-interface30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.30.254 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># vlan40为VPN1网络网关
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan-interface40
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.40.254 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> packet-filter 3001 inbound
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 与HQ_ROUTER VPN1 互联vlanif接口
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan-interface111
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance vpn1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 100.1.1.2 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 与HQ_ROUTER VPN2 互联vlanif接口
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface Vlan-interface222
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip binding vpn-instance vpn2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 100.1.1.2 255.255.255.252
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 与HQ_ROUTER互联的物理接口
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet1/0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port link-mode bridge
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port link-type trunk
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port trunk permit vlan all
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> combo enable fiber
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 配置前缀列表，过滤从HQ_ROUTER学习到的特殊主机路由
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip prefix-list filter_192.168.40.200 index 10 deny 192.168.40.2 32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip prefix-list filter_192.168.40.200 index 20 permit 0.0.0.0 0 less-equal 32
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 配置总部VPN2网络到分支VPN1网络的路由
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip route-static vpn-instance vpn2 172.16.10.0 24 vpn-instance vpn1 100.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 限制除PC_8外去往分支VPN1网络的流量
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl advanced 3001
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 0 permit ip source 192.168.40.200 0 destination 172.16.10.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 5 deny ip source 192.168.40.0 0.0.0.255 destination 172.16.10.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 10 permit ip
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>H3C_V5_V7设备巡检信息提取</title><link>https://weeaster.github.io/posts/80e04e00/</link><pubDate>Thu, 22 Apr 2021 16:33:36 +0000</pubDate><guid>https://weeaster.github.io/posts/80e04e00/</guid><description>&lt;p>上一篇博客写到如何运行脚本导出设备信息，这一篇介绍一下怎样在海量的设备信息中提取指定信息，本文中假设要提取的信息有&lt;strong>设备名称&lt;/strong>、&lt;strong>当前软件版本&lt;/strong>、&lt;strong>设备运行时间&lt;/strong>、&lt;strong>设备 CPU 使用率&lt;/strong>、&lt;strong>设备内存使用率&lt;/strong>、&lt;strong>设备序列号&lt;/strong>。后续可以根据这些信息使用 Python 脚本写入到巡检报告或者表格中。&lt;/p>
&lt;h2 id="如何操作">&lt;strong>如何操作&lt;/strong>
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>没有提取前已导出的设备信息（保护隐私，使用 HCL 模拟器产生的设备信息）&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/04/22/GomHu92VZDfFjp1.jpg">
&lt;img src="https://i.loli.net/2021/04/22/GomHu92VZDfFjp1.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="python-脚本">Python 脚本
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Author：KIRASTER&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Time：2021/3/21 23:26&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Description：Device_info&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">os&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">re&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">filename&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;F:/111.txt&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">resultfilename&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;F:/result.txt&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">if&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">exists&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">resultfilename&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">remove&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">resultfilename&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">result_txt&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;F:/result.txt&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;a&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">filename&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;r&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;utf8&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">file_to_read&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="kc">True&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lines&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">file_to_read&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">readline&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 首行显示50个“=”号，提取设备版本信息，开头注释&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s2">&amp;#34;display version&amp;#34;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line01&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;=&amp;#39;&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="mi">50&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line02&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;Device Name:&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">re&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">findall&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;[&amp;lt;](.*?)[&amp;gt;]&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_txt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line01&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line01&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line02&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_txt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line02&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 提取设备版本信息 &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s2">&amp;#34;Comware Software&amp;#34;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line03&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;Comware Software:&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">re&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">findall&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;(?&amp;lt;=Software, ).*$&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line03&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_txt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line03&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 提取设备运行时间&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s2">&amp;#34;uptime is&amp;#34;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line04&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;Uptime:&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">re&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">findall&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;(?&amp;lt;=uptime is ).*$&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line04&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_txt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line04&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 提取设备序列号&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s2">&amp;#34;DEVICE_SERIAL_NUMBER&amp;#34;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line05&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;SN:&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">re&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">findall&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;(?&amp;lt;=:).*$&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line05&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">result_line05&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line05&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_txt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line05&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 提取设备cpu使用率方式1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s2">&amp;#34;Slot 1 CPU 0 CPU usage:&amp;#34;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line06&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">next&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file_to_read&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line06&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">result_line06&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">9&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line06&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;cpu-usage:&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">result_line06&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line06&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_txt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line06&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 提取设备cpu使用率方式2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s2">&amp;#34;Slot 1 CPU usage:&amp;#34;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line066&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">next&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file_to_read&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line066&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">result_line066&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">9&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line066&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;cpu-usage:&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">result_line066&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line066&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_txt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line066&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 提取设备cpu使用率方式3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s2">&amp;#34;Unit CPU usage:&amp;#34;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line0666&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">next&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file_to_read&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line0666&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">result_line0666&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">5&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="mi">9&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line0666&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;cpu-usage:&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">result_line0666&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line0666&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_txt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line0666&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 提取设备memory使用率方式1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s2">&amp;#34;Used Rate&amp;#34;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line07&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">4&lt;/span>&lt;span class="p">:]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line07&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;memory-usage:&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">result_line07&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line07&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_txt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line07&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># 提取设备memory使用率方式2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s2">&amp;#34;Mem:&amp;#34;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line08&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">6&lt;/span>&lt;span class="p">:]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line08&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">result_line08&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39; &amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line08&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">result_line08&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;%&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s1">&amp;#39;&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line08&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">100&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="nb">float&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line08&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line08&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="si">%.1f%%&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="n">result_line08&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_line08&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;memory-usage:&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">result_line08&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s1">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s1">&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line08&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_txt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">result_line08&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">result_txt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">flush&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="s2">&amp;#34;结束记录时间&amp;#34;&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">break&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;hr>
&lt;h3 id="生成信息">生成信息
&lt;/h3>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/04/22/9SqglxZG1N8aI7K.jpg">
&lt;img src="https://i.loli.net/2021/04/22/9SqglxZG1N8aI7K.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="其他">&lt;strong>其他&lt;/strong>
&lt;/h2>&lt;ul>
&lt;li>本文中的脚本在实际工作中使用过，设备包含华三 V5 和 V7 版本的交换机、防火墙和无线控制器等&lt;/li>
&lt;li>根据实际需要可以修改脚本中的内容提取更多信息&lt;/li>
&lt;li>生成的文件为 word 或 excel 等都是可以实现的&lt;/li>
&lt;/ul></description></item><item><title>H3C_SecureCRT巡检脚本</title><link>https://weeaster.github.io/posts/21b002a6/</link><pubDate>Sun, 18 Apr 2021 06:58:53 +0000</pubDate><guid>https://weeaster.github.io/posts/21b002a6/</guid><description>&lt;h4 id="脚本介绍和使用">&lt;strong>脚本介绍和使用&lt;/strong>
&lt;/h4>&lt;ul>
&lt;li>这是一个巡检脚本，使用 CRT 软件登陆H3C设备，点击 “Script” &amp;ndash;&amp;gt; &amp;ldquo;Run&amp;rdquo; 选择脚本，运行脚本可得到需要收集的信息（当然你要打开 log 记录日志，相信你懂）&lt;/li>
&lt;li>可以根据你的实际需要修改 “Send” 后面的内容&lt;/li>
&lt;li>好久不更博客了，最近干了一些小项目，能写的我尽量写写……&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#$language = &amp;#34;VBScript&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#$interface = &amp;#34;1.0&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">crt.Screen.Synchronous = True
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;#39; This automatically generated script may need to be
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;#39; edited in order to work correctly.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Sub Main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;#start right now&amp;#34;&amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.WaitForString &amp;#34;&amp;gt;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;screen-length disable&amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;display cur &amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;display ip interface brief&amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;display interface brief des&amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;display vlan&amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;display vlan brief&amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;display ip routing-table&amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;display version&amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;display cpu-usage&amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;display memory&amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;display device manuinfo&amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;save force&amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> crt.Screen.Send &amp;#34;save force&amp;#34; &amp;amp; chr(13)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">End Sub
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>我的母亲</title><link>https://weeaster.github.io/posts/221a99d/</link><pubDate>Fri, 12 Feb 2021 09:19:43 +0000</pubDate><guid>https://weeaster.github.io/posts/221a99d/</guid><description>&lt;p>我的母亲，一个普通的平凡的中年妇女&lt;/p>
&lt;p>可能是由于家庭环境的缘故使得她文化水平不高&lt;/p>
&lt;p>她很唠叨，做事没什么主见，总是把自己弄的很忙的样子，总喜欢这扫扫那洗洗&lt;/p>
&lt;p>跟我说话总是用疑问句的方式，整个家庭存在这种现象，我除外&lt;/p>
&lt;p>她有着固有的传统思想方式，就是别人都怎么样我也要怎么样&lt;/p>
&lt;p>闲暇之余在家总是喜欢拿着手机看电视剧，说到手机，教她用智能手机对我来说简直是世纪难题，至今她能会那么一点使用的功能是电话、万能钥匙连wifi、视频软件看剧和手机充电，除此之外我已经放弃了，她也放弃了&lt;/p>
&lt;p>一天，她对我说烟头烟灰要丢烟灰缸不要直接丢镂空不套塑料袋的垃圾筐，转身就把桌上烟灰缸往垃圾筐一倒，垃圾筐没套塑料袋&lt;/p>
&lt;p>她还喜欢“狡辩”，这是针对我爸的&lt;/p>
&lt;p>……&lt;/p></description></item><item><title>HCL_路由器双出口策略配置实验</title><link>https://weeaster.github.io/posts/4e82271c/</link><pubDate>Mon, 01 Feb 2021 14:22:41 +0000</pubDate><guid>https://weeaster.github.io/posts/4e82271c/</guid><description>&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/02/01/YN6r5C1xyvfmETd.png">
&lt;img src="https://i.loli.net/2021/02/01/YN6r5C1xyvfmETd.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="路由器出口策略配置说明">路由器出口策略配置说明
&lt;/h2>&lt;h3 id="nqa">NQA
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># 配置探测电信DNS的NQA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nqa entry admin isp_telecom_test
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type icmp-echo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination ip 202.103.224.68 //探测远端DNS地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> frequency 2000 //每间隔2秒探测一次
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> history-record enable //开启NQA历史记录保存功能
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> history-record number 5 //保存的最大历史记录个数为5条
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> next-hop ip 101.1.1.2 //探测报文经过的下一跳
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> probe count 5 //每次探测检测5次
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> probe timeout 1000 //检测超时时间1秒
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reaction 1 checked-element probe-fail threshold-type consecutive 5 action-type trigger-only //连续探测失败5次，触发其他模块联动
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source ip 101.1.1.1 //探测报文源地址
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 配置探测联通DNS的NQA
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nqa entry admin isp_unicom_test
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type icmp-echo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination ip 211.138.240.100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> frequency 2000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> history-record enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> history-record number 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> next-hop ip 202.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> probe count 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> probe timeout 1000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reaction 1 checked-element probe-fail threshold-type consecutive 5 action-type trigger-only
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source ip 202.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 当前时间起永久启用NQA监测
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nqa schedule admin isp_telecom_test start-time now lifetime forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nqa schedule admin isp_unicom_test start-time now lifetime forever
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="track-关联-nqa">track 关联 NQA
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">track 100 nqa entry admin isp_telecom_test reaction 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">track 200 nqa entry admin isp_unicom_test reaction 1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="策略路由配置联动">策略路由配置，联动
&lt;/h3>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl advanced 3002
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 0 permit ip source 192.168.20.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 指定下一跳时与track 200联动，当NQA监测失败结果时，策略路由失效，流量根据路由表转发流量
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">policy-based-route to_isp_policy permit node 10
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if-match acl 3002
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> apply next-hop 202.1.1.2 track 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 默认路由与track 100联动，当NQA监测失败结果时，该条默认路由失效，优先级为80的默认路由加载路由表，流量根据路由表转发流量
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip route-static 0.0.0.0 0 101.1.1.2 track 100
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip route-static 0.0.0.0 0 202.1.1.2 preference 80
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 内网流量入接口下调用策略路由
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">interface GigabitEthernet0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ip policy-based-route to_isp_policy
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="测试说明">测试说明：
&lt;/h2>&lt;p>外网网络正常情况，查看 nqa 监测结果，探测发出的数据包和收到的数据包数量一致&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/02/01/HvybjOQ13LX5nCd.png">
&lt;img src="https://i.loli.net/2021/02/01/HvybjOQ13LX5nCd.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>通过 debug 查看 NAT 转换信息，vlan10 去往互联网 DNS 地址的流量走101.1.1.2下一跳地址，vlan20 去往互联网 DNS 地址的流量走 202.1.1.2 下一跳地址&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/02/01/6jezdH7ZCBkfVxG.png">
&lt;img src="https://i.loli.net/2021/02/01/6jezdH7ZCBkfVxG.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="当电信网络不可用时">当电信网络不可用时
&lt;/h3>&lt;p>当电信网络不可用时，路由器日志提示 prob-fail，此时 NQA 探测收到的 icmp-reply 数据包为 0&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/02/01/QTfK8veUMG9NFnk.png">
&lt;img src="https://i.loli.net/2021/02/01/QTfK8veUMG9NFnk.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/02/01/1zrq6wU7BJvs5kS.png">
&lt;img src="https://i.loli.net/2021/02/01/1zrq6wU7BJvs5kS.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>路由表中，默认路由的下一跳为 202.1.1.2&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/02/01/EvY1ARqf8XWuNye.png">
&lt;img src="https://i.loli.net/2021/02/01/EvY1ARqf8XWuNye.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>查看 NAT 会话表，有 vlan10，vlan20 的流量会话&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/02/01/5iHdByYflu6XtOG.png">
&lt;img src="https://i.loli.net/2021/02/01/5iHdByYflu6XtOG.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>通过 debug 查看 NAT 转换信息，所有流量走联通网络出口&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/02/01/Cv84ktVDedW9sYx.png">
&lt;img src="https://i.loli.net/2021/02/01/Cv84ktVDedW9sYx.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h3 id="当联通网络不可用时">当联通网络不可用时
&lt;/h3>&lt;p>当联通网络不可用时，路由器日志提示 prob-fail，此时 NQA 探测收到的 icmp-reply 数据包为0&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/02/01/xuc7PRo9FBYpIVE.png">
&lt;img src="https://i.loli.net/2021/02/01/xuc7PRo9FBYpIVE.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/02/01/57eGLloi4RWnFkh.png">
&lt;img src="https://i.loli.net/2021/02/01/57eGLloi4RWnFkh.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>查看 NAT 会话表，有 vlan10，vlan20 的流量会话&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/02/01/8XskBLebAmqJohc.png">
&lt;img src="https://i.loli.net/2021/02/01/8XskBLebAmqJohc.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>通过 debug 查看 NAT 转换信息，所有流量走电信网络出口&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/02/01/bXINu8lvyMYDkjo.png">
&lt;img src="https://i.loli.net/2021/02/01/bXINu8lvyMYDkjo.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="路由器配置">路由器配置：
&lt;/h2>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sysname&lt;/span> &lt;span class="n">Router&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">track&lt;/span> &lt;span class="mi">100&lt;/span> &lt;span class="n">nqa&lt;/span> &lt;span class="n">entry&lt;/span> &lt;span class="n">admin&lt;/span> &lt;span class="n">isp_telecom_test&lt;/span> &lt;span class="n">reaction&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">track&lt;/span> &lt;span class="mi">200&lt;/span> &lt;span class="n">nqa&lt;/span> &lt;span class="n">entry&lt;/span> &lt;span class="n">admin&lt;/span> &lt;span class="n">isp_unicom_test&lt;/span> &lt;span class="n">reaction&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">system&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">working&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mode&lt;/span> &lt;span class="n">standard&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">xbar&lt;/span> &lt;span class="nb">load&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">single&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">password&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">recovery&lt;/span> &lt;span class="n">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lpu&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">series&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">vlan&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">policy&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">based&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">route&lt;/span> &lt;span class="n">to_isp_policy&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="n">node&lt;/span> &lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">match&lt;/span> &lt;span class="n">acl&lt;/span> &lt;span class="mi">3002&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">apply&lt;/span> &lt;span class="n">next&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">hop&lt;/span> &lt;span class="mf">202.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span> &lt;span class="n">track&lt;/span> &lt;span class="mi">200&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nqa&lt;/span> &lt;span class="n">entry&lt;/span> &lt;span class="n">admin&lt;/span> &lt;span class="n">isp_telecom_test&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span> &lt;span class="n">icmp&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">echo&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">destination&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="mf">202.103&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">224.68&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">frequency&lt;/span> &lt;span class="mi">2000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">history&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">record&lt;/span> &lt;span class="n">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">history&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">record&lt;/span> &lt;span class="n">number&lt;/span> &lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">next&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">hop&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="mf">101.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">probe&lt;/span> &lt;span class="n">count&lt;/span> &lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">probe&lt;/span> &lt;span class="n">timeout&lt;/span> &lt;span class="mi">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reaction&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">checked&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">element&lt;/span> &lt;span class="n">probe&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">fail&lt;/span> &lt;span class="n">threshold&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">consecutive&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="n">action&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">trigger&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">only&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">source&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="mf">101.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">nqa&lt;/span> &lt;span class="n">entry&lt;/span> &lt;span class="n">admin&lt;/span> &lt;span class="n">isp_unicom_test&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type&lt;/span> &lt;span class="n">icmp&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">echo&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">destination&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="mf">211.138&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">240.100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">frequency&lt;/span> &lt;span class="mi">2000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">history&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">record&lt;/span> &lt;span class="n">enable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">history&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">record&lt;/span> &lt;span class="n">number&lt;/span> &lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">next&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">hop&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="mf">202.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">probe&lt;/span> &lt;span class="n">count&lt;/span> &lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">probe&lt;/span> &lt;span class="n">timeout&lt;/span> &lt;span class="mi">1000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">reaction&lt;/span> &lt;span class="mi">1&lt;/span> &lt;span class="n">checked&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">element&lt;/span> &lt;span class="n">probe&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">fail&lt;/span> &lt;span class="n">threshold&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">consecutive&lt;/span> &lt;span class="mi">5&lt;/span> &lt;span class="n">action&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">type&lt;/span> &lt;span class="n">trigger&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">only&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">source&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="mf">202.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nqa&lt;/span> &lt;span class="n">schedule&lt;/span> &lt;span class="n">admin&lt;/span> &lt;span class="n">isp_telecom_test&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">time&lt;/span> &lt;span class="n">now&lt;/span> &lt;span class="n">lifetime&lt;/span> &lt;span class="n">forever&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nqa&lt;/span> &lt;span class="n">schedule&lt;/span> &lt;span class="n">admin&lt;/span> &lt;span class="n">isp_unicom_test&lt;/span> &lt;span class="n">start&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">time&lt;/span> &lt;span class="n">now&lt;/span> &lt;span class="n">lifetime&lt;/span> &lt;span class="n">forever&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Serial1&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Serial2&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Serial3&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">Serial4&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">NULL0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">port&lt;/span> &lt;span class="n">link&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mode&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">combo&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="n">copper&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">policy&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">based&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">route&lt;/span> &lt;span class="n">to_isp_policy&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">port&lt;/span> &lt;span class="n">link&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mode&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">combo&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="n">copper&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">101.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nat&lt;/span> &lt;span class="n">outbound&lt;/span> &lt;span class="mi">3001&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet0&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">port&lt;/span> &lt;span class="n">link&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mode&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">combo&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="n">copper&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="mf">202.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.1&lt;/span> &lt;span class="mf">255.255&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">255.252&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">nat&lt;/span> &lt;span class="n">outbound&lt;/span> &lt;span class="mi">3001&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet5&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">port&lt;/span> &lt;span class="n">link&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mode&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">combo&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="n">copper&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet5&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">port&lt;/span> &lt;span class="n">link&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mode&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">combo&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="n">copper&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet6&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">port&lt;/span> &lt;span class="n">link&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mode&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">combo&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="n">copper&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">interface&lt;/span> &lt;span class="n">GigabitEthernet6&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">port&lt;/span> &lt;span class="n">link&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">mode&lt;/span> &lt;span class="n">route&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">combo&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="n">copper&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">scheduler&lt;/span> &lt;span class="n">logfile&lt;/span> &lt;span class="n">size&lt;/span> &lt;span class="mi">16&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">line&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="n">aux&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">user&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span> &lt;span class="n">network&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">operator&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">line&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="n">console&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">user&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span> &lt;span class="n">network&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">admin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">line&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="n">tty&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">user&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span> &lt;span class="n">network&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">operator&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">line&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="n">vty&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">user&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span> &lt;span class="n">network&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">operator&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">line&lt;/span> &lt;span class="n">aux&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">user&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span> &lt;span class="n">network&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">operator&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">line&lt;/span> &lt;span class="n">con&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">user&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span> &lt;span class="n">network&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">admin&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">line&lt;/span> &lt;span class="n">vty&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mi">63&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">user&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">role&lt;/span> &lt;span class="n">network&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">operator&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mf">101.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span> &lt;span class="n">track&lt;/span> &lt;span class="mi">100&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.0&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="mf">202.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span> &lt;span class="n">preference&lt;/span> &lt;span class="mi">80&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">10.0&lt;/span> &lt;span class="mi">24&lt;/span> &lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ip&lt;/span> &lt;span class="n">route&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="k">static&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">20.0&lt;/span> &lt;span class="mi">24&lt;/span> &lt;span class="mf">1.1&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">1.2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">acl&lt;/span> &lt;span class="n">advanced&lt;/span> &lt;span class="mi">3001&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rule&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="n">ip&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">acl&lt;/span> &lt;span class="n">advanced&lt;/span> &lt;span class="mi">3002&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">rule&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="n">permit&lt;/span> &lt;span class="n">ip&lt;/span> &lt;span class="n">source&lt;/span> &lt;span class="mf">192.168&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">20.0&lt;/span> &lt;span class="mf">0.0&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mf">0.255&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">domain&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">domain&lt;/span> &lt;span class="n">default&lt;/span> &lt;span class="n">enable&lt;/span> &lt;span class="n">system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">0&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">3&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">4&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">5&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">6&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">6&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">7&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">7&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">8&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">9&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">9&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">10&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">11&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">12&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">12&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">13&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">13&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">role&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">14&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="n">Predefined&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">14&lt;/span> &lt;span class="n">role&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">user&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">group&lt;/span> &lt;span class="n">system&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">return&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Router&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>简明现代汉语语法_学习</title><link>https://weeaster.github.io/posts/51f223b9/</link><pubDate>Fri, 22 Jan 2021 17:26:57 +0000</pubDate><guid>https://weeaster.github.io/posts/51f223b9/</guid><description>&lt;p>&lt;strong>作者：重庆市江津中学校 王征老师&lt;/strong>&lt;/p>
&lt;h2 id="字词词性成分之间的关系">字词、词性、成分之间的关系
&lt;/h2>&lt;p>一般规律：&lt;/p>
&lt;ul>
&lt;li>名词和代词一般更适合做主语和宾语&lt;/li>
&lt;li>动词一般更适合做谓语&lt;/li>
&lt;li>副词和形容词一般更适合做定语和状语&lt;/li>
&lt;li>主谓宾是一般顺序&lt;/li>
&lt;li>定语一般在主语和宾语前面&lt;/li>
&lt;li>状语一般在谓语前面&lt;/li>
&lt;li>顺序颠倒了就是倒装&lt;/li>
&lt;/ul>
&lt;h2 id="词性">词性
&lt;/h2>&lt;p>实词 vs 虚词&lt;/p>
&lt;ul>
&lt;li>实词：意义编辑具体的词，包括：名词、动词、形容词、数词、量词、代词&lt;/li>
&lt;li>虚词：一般不能单独成句，意义比较抽象，有帮助造句作用的词，包括：副词、介词、连词、助词、叹词、拟声词&lt;/li>
&lt;/ul>
&lt;h3 id="名词">名词
&lt;/h3>&lt;blockquote>
&lt;p>表示人或事物名称
表示人：姑娘、青年、工人
表示具体事物：锤子、坚果、手机
表示抽象事物：理想、精神、感情
表示时间：春天、昨天、早上、下午&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>方位名词
上下左右前后左右东西南北里头外边以上之下
大多数情况下，方位名词用在其他名词性词语的后边，表示事物所在的位置和范围&lt;/p>
&lt;/blockquote>
&lt;h3 id="动词">动词
&lt;/h3>&lt;blockquote>
&lt;p>表示人或事物的动作行为、心里活动、发展变化
表示动作行为：走、跑、滚、唱、跳、打
表示心里活动：爱、恨、喜欢、讨厌、想念、忘记、佩服
表示事物发展变化：增加、减少、扩大、提高、降低、发生、出现&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>表示可能、应该、意愿
能、不能、能够、会、可能、可以、可、要、应该、应当、肯、敢、愿、愿意
这类词常放在一般动词的前面&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>表示动作趋向
下、去、来、进、出、到、过、过去、上来、回去、起来
这类动词往往放在表示动作行为的动词后边，用来表示动作行为的方向&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>表示判断：是vs不是&lt;/p>
&lt;/blockquote>
&lt;h3 id="形容词">形容词
&lt;/h3>&lt;blockquote>
&lt;p>用来描摹人或事物
表示状态：快、慢、软、硬、忙碌、悠闲、激动
表示性质：好、坏、美、丑、存粹、清脆
表示颜色：赤橙黄绿青蓝紫、苍白、绿油由、红彤彤
表示形状：大、小、宽、长、窄、笔直、弯曲&lt;/p>
&lt;/blockquote>
&lt;h4 id="一词多性">一词多性
&lt;/h4>&lt;blockquote>
&lt;p>结合语境判断&lt;/p>
&lt;/blockquote>
&lt;h3 id="数词和量词">数词和量词
&lt;/h3>&lt;blockquote>
&lt;p>数词：表示确数、序数和概数:
确数：一、八千、七万八千
概述：十来（个）、三十几（个）、八九（辆）
序数：第一、老二、初八&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>量词：表示单位
表示事物的单位：个、台、辆、条
表示度量单位：米、吨、克
表示动作行为的单位：次、回、趟，轮&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>数量：数词和量词一般结合起来使用表示数量
一个、八千次、十来吨、第一轮&lt;/p>
&lt;/blockquote>
&lt;h3 id="代词">代词
&lt;/h3>&lt;blockquote>
&lt;p>代替名词、动词、形容词、数词、量词、副词
代替人或事物：你、你们、我、我们、他、它、她、咱们、自己
具有指示作用：那、这、这里、那里、这里、这样、那么、每、各
表示疑问：哪里、什么、谁、怎样、怎么样、哪、哪呢&lt;/p>
&lt;/blockquote></description></item><item><title>HCL_一个小实验的思路</title><link>https://weeaster.github.io/posts/c7ac5477/</link><pubDate>Thu, 21 Jan 2021 08:31:24 +0000</pubDate><guid>https://weeaster.github.io/posts/c7ac5477/</guid><description>&lt;p>&lt;strong>实验说明：&lt;/strong>&lt;/p>
&lt;p>&lt;strong>设备互联线路，IP 地址、路由协议、可靠性等配置自定义&lt;/strong>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/01/21/1x5uRqEXDlGcigv.jpg">
&lt;img src="https://i.loli.net/2021/01/21/1x5uRqEXDlGcigv.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="实验效果">实验效果：
&lt;/h2>&lt;ul>
&lt;li>PC_1 网段流量经R1出互联网&lt;/li>
&lt;li>PC_2 网段流量经R2出互联网&lt;/li>
&lt;li>当任意互联网线路故障后，全部流量走另一线路出互联网&lt;/li>
&lt;/ul>
&lt;h2 id="解决思路">解决思路：
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>设备互联，IP地址规划如图&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/01/21/mHXfo1pLUrneKgs.png">
&lt;img src="https://i.loli.net/2021/01/21/mHXfo1pLUrneKgs.png"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Core_SW1、Core_SW2 做堆叠，F1/0/53 to F1/0/54堆叠口，Ten 1/0/50为 BFD 检测线&lt;/strong>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;Core_SW1&amp;gt;dis irf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">MemberID Role Priority CPU-Mac Description
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> *+1 Master 15 72f0-e201-0504 ---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2 Standby 10 72f0-e6bc-0604 ---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * indicates the device is the master.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> + indicates the device through which the user logs in.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &amp;lt;Core_SW1&amp;gt;dis irf topology
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Topology Info
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> IRF-Port1 IRF-Port2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> MemberID Link neighbor Link neighbor Belong To
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 DIS --- UP 2 72f0-e201-0504
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2 UP 1 DIS --- 72f0-e201-0504
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>核心交换机 Core_SW 与 R1, R2 之间启用三层聚合链路&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;Core_SW1&amp;gt;dis link-aggregation summary
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Aggregation Interface Type:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BAGG -- Bridge-Aggregation, BLAGG -- Blade-Aggregation, RAGG -- Route-Aggregation, SCH-B -- Schannel-Bundle
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Aggregation Mode: S -- Static, D -- Dynamic
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Loadsharing Type: Shar -- Loadsharing, NonS -- Non-Loadsharing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Actor System ID: 0x8000, 72f0-e201-0500
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">AGG AGG Partner ID Selected Unselected Individual Share
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Interface Mode Ports Ports Ports Type
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">BAGG3 S None 2 0 0 Shar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RAGG1 S None 2 0 0 Shar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RAGG2 S None 2 0 0 Shar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;Core_SW1&amp;gt;dis ip int b
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*down: administratively down
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(s): spoofing (l): loopback
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Interface Physical Protocol IP Address Description
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE1/0/1 up up -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE1/0/2 up up -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE2/0/1 up up -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE2/0/2 up up -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">MGE0/0/0 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RAGG1 up up 10.1.1.1 --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RAGG2 up up 10.1.1.5 --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Vlan10 up up 192.168.10.254 --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Vlan20 up up 192.168.20.254 --
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;R1&amp;gt;dis link-aggregation verbose
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Loadsharing Type: Shar -- Loadsharing, NonS -- Non-Loadsharing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Port: A -- Auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Port Status: S -- Selected, U -- Unselected, I -- Individual
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Flags: A -- LACP_Activity, B -- LACP_Timeout, C -- Aggregation,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> D -- Synchronization, E -- Collecting, F -- Distributing,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> G -- Defaulted, H -- Expired
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Aggregate Interface: Route-Aggregation1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Aggregation Mode: Static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Loadsharing Type: Shar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Port Status Priority Oper-Key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> GE0/1 S 32768 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> GE0/2 S 32768 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;R1&amp;gt;dis ip int b
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*down: administratively down
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(s): spoofing (l): loopback
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Interface Physical Protocol IP Address Description
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE0/0 up up 101.1.1.1 --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE0/1 up up -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE0/2 up up -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE5/0 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE5/1 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE6/0 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE6/1 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RAGG1 up up 10.1.1.2 --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ser1/0 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ser2/0 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ser3/0 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ser4/0 down down -- --
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;R2&amp;gt;dis link-aggregation verbose
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Loadsharing Type: Shar -- Loadsharing, NonS -- Non-Loadsharing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Port: A -- Auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Port Status: S -- Selected, U -- Unselected, I -- Individual
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Flags: A -- LACP_Activity, B -- LACP_Timeout, C -- Aggregation,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> D -- Synchronization, E -- Collecting, F -- Distributing,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> G -- Defaulted, H -- Expired
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Aggregate Interface: Route-Aggregation1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Aggregation Mode: Static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Loadsharing Type: Shar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Port Status Priority Oper-Key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> GE0/1 S 32768 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> GE0/2 S 32768 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;lt;R2&amp;gt;dis ip int b
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">*down: administratively down
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(s): spoofing (l): loopback
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Interface Physical Protocol IP Address Description
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE0/0 up up 201.1.1.1 --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE0/1 up up -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE0/2 up up -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE5/0 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE5/1 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE6/0 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">GE6/1 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">RAGG1 up up 10.1.1.6 --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ser1/0 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ser2/0 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ser3/0 down down -- --
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Ser4/0 down down -- --
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;strong>核心交换机 Core_SW 与 SW3 之间启用二层聚合链路&lt;/strong>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;SW3&amp;gt;dis link-aggregation verbose
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Loadsharing Type: Shar -- Loadsharing, NonS -- Non-Loadsharing
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Port: A -- Auto
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Port Status: S -- Selected, U -- Unselected, I -- Individual
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Flags: A -- LACP_Activity, B -- LACP_Timeout, C -- Aggregation,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> D -- Synchronization, E -- Collecting, F -- Distributing,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> G -- Defaulted, H -- Expired
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Aggregate Interface: Bridge-Aggregation1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Aggregation Mode: Static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Loadsharing Type: Shar
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Port Status Priority Oper-Key
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">--------------------------------------------------------------------------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> GE1/0/1 S 32768 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> GE1/0/2 S 32768 1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;strong>核心交换机 Core_SW 配置静态路由；R1、R2 配置默认路由下一跳指向 ISP 设备地址、配置回程静态路由指向 Core_SW 三层聚合接口地址&lt;/strong>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;Core_SW1&amp;gt;dis cur | inc route
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">policy-based-route vlan20nexthop permit node 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip policy-based-route vlan20nexthop
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port link-mode route
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port link-mode route
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port link-mode route
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> port link-mode route
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip route-static 0.0.0.0 0 10.1.1.2 track 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip route-static 0.0.0.0 0 10.1.1.6 preference 80
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;R1&amp;gt;dis ip routing-table pro static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Summary count : 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Static Routing table status : &amp;lt;Active&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Summary count : 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Destination/Mask Proto Pre Cost NextHop Interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">0.0.0.0/0 Static 60 0 101.1.1.2 GE0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.10.0/24 Static 60 0 10.1.1.1 RAGG1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.20.0/24 Static 60 0 10.1.1.1 RAGG1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Static Routing table status : &amp;lt;Inactive&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Summary count : 0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;R2&amp;gt;dis ip routing-table pro static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Summary count : 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Static Routing table status : &amp;lt;Active&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Summary count : 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Destination/Mask Proto Pre Cost NextHop Interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">0.0.0.0/0 Static 60 0 201.1.1.2 GE0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.10.0/24 Static 60 0 10.1.1.5 RAGG1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.20.0/24 Static 60 0 10.1.1.5 RAGG1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Static Routing table status : &amp;lt;Inactive&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Summary count : 0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;strong>核心交换机 Core_SW 配置 NQA，检测 ISP_1, ISP_2 可达性，关联 Track 与静态路由、策略路由联动&lt;/strong>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nqa entry admin isp_1_test
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type icmp-echo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination ip 101.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> frequency 2000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> history-record enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> history-record number 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> next-hop ip 10.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> probe count 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> probe timeout 1000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reaction 1 checked-element probe-fail threshold-type consecutive 3 action-type trigger-only
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source ip 10.1.1.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nqa entry admin isp_2_test
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type icmp-echo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> destination ip 201.1.1.2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> frequency 2000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> history-record enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> history-record number 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> next-hop ip 10.1.1.6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> probe count 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> probe timeout 1000
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> reaction 1 checked-element probe-fail threshold-type consecutive 3 action-type trigger-only
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> source ip 10.1.1.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nqa schedule admin isp_1_test start-time now lifetime forever
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> nqa schedule admin isp_2_test start-time now lifetime forever
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">track 1 nqa entry admin isp_2_test reaction 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">track 2 nqa entry admin isp_1_test reaction 1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip route-static 0.0.0.0 0 10.1.1.2 track 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip route-static 0.0.0.0 0 10.1.1.6 preference 80
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">policy-based-route vlan20nexthop permit node 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if-match acl 3001
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> apply next-hop 10.1.1.6 track 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">acl advanced 3001
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 5 deny ip source 192.168.20.0 0.0.0.255 destination 192.168.10.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rule 10 permit ip source 192.168.20.0 0.0.0.255
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;strong>ISP 网络设备配置 OSPF&lt;/strong>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">&amp;lt;ISP_NETWORK&amp;gt;dis ip routing-table protocol ospf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Summary count : 5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OSPF Routing table status : &amp;lt;Active&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Summary count : 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Destination/Mask Proto Pre Cost NextHop Interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">101.1.1.0/30 O_INTRA 10 2 101.1.1.5 GE0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">201.1.1.0/30 O_INTRA 10 2 201.1.1.5 GE0/2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OSPF Routing table status : &amp;lt;Inactive&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Summary count : 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Destination/Mask Proto Pre Cost NextHop Interface
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1.2.3.4/32 O_INTRA 10 0 0.0.0.0 Loop0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">101.1.1.4/30 O_INTRA 10 1 0.0.0.0 GE0/1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">201.1.1.4/30 O_INTRA 10 1 0.0.0.0 GE0/2
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>九十年代</title><link>https://weeaster.github.io/posts/8847b633/</link><pubDate>Tue, 12 Jan 2021 23:02:08 +0000</pubDate><guid>https://weeaster.github.io/posts/8847b633/</guid><description>&lt;p>在我的印象中，上个世纪九十年代对我来说是一个特别的年代，也包括我的出世&lt;/p>
&lt;p>那时候人事物，我稍微回忆一下&lt;/p>
&lt;p>老爸买的黑白电视机，带有车牌号的自行车……&lt;/p>
&lt;p>第一次骑自行车，下车的场景是等速度降到几乎为零，自行车向右方倒，岔开右腿撑着&lt;/p>
&lt;p>对了，那是亲戚的一辆山地自行车，当然那时候我还不知道分类&lt;/p>
&lt;p>那时候看电影，都是去镇上租碟，村里面稍微“富裕”的人家才买的起 VCD 机&lt;/p>
&lt;p>在我老爸没买电视机前，晚上想要看电视节目是去村里有电视的人家围观看，隐约记得晚上回来晚了，村里几乎没有灯亮着，借着月光摸黑回来，大门锁了，找到放大门钥匙的地方，蹑手蹑脚开门关门睡觉&lt;/p>
&lt;p>那时候通信是挺落后的，村里有固定电话的没多少人家，看到路边电信杠上挂着一块木制用红色油漆写着号码的才是有固定电话的，那时候普遍用的还是 BB 机，我老爸有一个&lt;/p>
&lt;p>那时候村里起房子，砖是从田里挖泥造的&lt;/p>
&lt;p>那时候贪玩，回到家会被殴打，那时候贪玩，眉弓往右眼部位被铁片扎了，万幸右眼没有失明，但是留下了疤痕，导致后来照镜子看显得有点“社会”&lt;/p>
&lt;p>小时候生病，会被老爸背去打针，当时我应该是哭了，每次打完针后，会有一碗饭馆的面吃，来抚慰幼小的我，对当时的家庭经济状况来说应该算是“大餐”&lt;/p>
&lt;p>那时的作业都是早上起来写的，晚上可能是去邻居家看电视，或者跑去看碟片电影了&lt;/p>
&lt;p>那时候班主任有一次中午去我家家访吃了个闭门羹，这是她的说法，我不记得了&lt;/p>
&lt;p>小学那时候，校园里有一个篮球场，两张乒乓球台，还有一个爬竿的地方，就这么多。小学一到三年级的教室是几间大瓦房，四到六年级是那栋走廊外面用红色油漆写着令人分裂的“团结、紧张、严肃、活泼”大字的楼，至少我后面是这么认为的，这几个词连在一起念简直了&lt;/p>
&lt;p>现在回想起来，老感觉有些记忆丢失了，可能是那时候脑子不记事，但是奇怪的是，那时候去走亲戚或者走去哪里的路走过一次，下次就记得怎么去怎么回&lt;/p>
&lt;p>……&lt;/p></description></item><item><title>我理解的费曼学习方法</title><link>https://weeaster.github.io/posts/237b6272/</link><pubDate>Sat, 09 Jan 2021 17:23:13 +0000</pubDate><guid>https://weeaster.github.io/posts/237b6272/</guid><description>&lt;p>费曼学习法是美籍犹太人 Richard Feynman 提出的一种学习知识的方法，具体介绍可以访问 &lt;a class="link" href="https://wiki.mbalib.com/wiki/%E8%B4%B9%E6%9B%BC%E5%AD%A6%E4%B9%A0%E6%B3%95" target="_blank" rel="noopener"
>Wiki费曼学习法
&lt;span style="white-space: nowrap;">&lt;svg width=".7em"
height=".7em" viewBox="0 0 21 21" xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/a>，或者你也可以自行搜索。&lt;/p>
&lt;h2 id="我的理解">我的理解①
&lt;/h2>&lt;p>在我们的学习、工作、或者生活中，或多或少的会接触了解使用一些知识。学习就不用多说，因为你学习的目标是为了使用这些知识或者应对测试。对于工作，往往自己要求或者被动的学习来提升自己的工作技能和业务水平。对于生活，学会生活。&lt;/p>
&lt;ol>
&lt;li>
&lt;p>&lt;strong>选定知识点或者概念&lt;/strong>
选定一个知识点或者概念后，试想着用正常人理解的词汇来理解它，比如你要向别人讲解一个东西的时候，不要用复杂的专业术语和你自己都不明白的词语来糊弄，用简单的词汇理解知识点，在你表达的时候听的人也更能明白。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>回顾知识点或者概念&lt;/strong>
在上面提到的方法后，自己回想这个知识点或者概念会有遗忘的内容或者不理解的点，这时候带着遗忘的内容和知识点重新学习，直到你能用简单的词汇和基本术语理解通透。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>简洁的语言组织&lt;/strong>
当自己理解后，把自己理解的知识点或者概念有逻辑有条理，尽可能用简洁的语言组织出来，这个很重要，如果不归纳总结，你自己是明白了，但你使用的时候或者对别人表达就会很混乱容易出错。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>检验&lt;/strong>
检验你的理解有没有问题，在实际工作生活中，尝试用“教”的方法向别人表达，或者面对别人能清晰的解释他的疑问。&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="我的理解-1">我的理解②
&lt;/h2>&lt;ul>
&lt;li>对于费曼学习法，是不是都适用各种学习场景呢，我觉得不是，对于有一个量化标准的为前提的检验，比如说背诵，默写……&lt;/li>
&lt;li>我觉得此法，需要花费比授课学习更多的时间，因为你不知道你要学习的这个知识点或概念的知识深度、宽度、边界，不知道理解到什么程度就可以终结&lt;/li>
&lt;/ul></description></item><item><title>ENSP_防火墙初始密码问题</title><link>https://weeaster.github.io/posts/ab67d7a4/</link><pubDate>Fri, 08 Jan 2021 01:08:52 +0000</pubDate><guid>https://weeaster.github.io/posts/ab67d7a4/</guid><description>&lt;p>在进行 ENSP 模拟器防火墙实验的发现，首次启动防火墙设备后都需要更改初始密码才能进入设备配置，着实操蛋。后面想了个办法，在启动设备前导入配置文件，设备启动后就可以使用导入配置中配置的密码进行登陆，当然还可以配置其他你想加的配置，实现与你要桥接的网卡互通。&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/01/08/bqrt8MkndcBgSuV.jpg">
&lt;img src="https://i.loli.net/2021/01/08/bqrt8MkndcBgSuV.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;h2 id="思路和实验">&lt;strong>思路和实验&lt;/strong>
&lt;/h2>&lt;ul>
&lt;li>通过设备加载初始配置跳过设备首次登陆需要更改密码&lt;/li>
&lt;li>通过修改 admin 的密码，修改 vty 配置，修改管理接口配置测试验证导入配置的实用性&lt;/li>
&lt;/ul>
&lt;h2 id="操作方法">&lt;strong>操作方法&lt;/strong>
&lt;/h2>&lt;p>&lt;strong>假设你已经会配置Cloud，并且连接好设备&lt;/strong>&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/01/08/Q5lfRmg6vSAWiwZ.jpg">
&lt;img src="https://i.loli.net/2021/01/08/Q5lfRmg6vSAWiwZ.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>&lt;strong>在电脑本地新建 xxx.cfg (后缀名为 .cfg )文件，文件内容如下&lt;/strong>&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">aaa
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> manager-user admin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> password cipher Cisco@123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service-type web terminal ssh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> level 15
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> web-manager enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> web-manager security enable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh user admin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh user admin authentication-type password
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ssh user admin service-type stelnet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">firewall zone trust
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> add interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> interface GigabitEthernet0/0/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ip address 192.168.10.2 255.255.255.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service-manage http permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service-manage https permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service-manage ping permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> service-manage ssh permit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user-interface con 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> authentication-mode aaa
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user-interface vty 0 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> authentication-mode aaa
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;strong>导入上面新建的初始配置文件，启动设备&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/01/08/dubaolKyRrAPx8w.jpg">
&lt;img src="https://i.loli.net/2021/01/08/dubaolKyRrAPx8w.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>&lt;strong>命令行登陆，提示输入用户密码，输入初始配置文件配置的密码后，可直接登陆设备&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/01/08/glNq2L9H1OCAKJr.jpg">
&lt;img src="https://i.loli.net/2021/01/08/glNq2L9H1OCAKJr.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>&lt;strong>在浏览器输入 192.168.10.2:8443 ，可跳转到防火墙登陆界面&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/01/08/dQVIhbEJsw2kqKP.jpg">
&lt;img src="https://i.loli.net/2021/01/08/dQVIhbEJsw2kqKP.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/01/08/HclTh1y8AJGOfWe.jpg">
&lt;img src="https://i.loli.net/2021/01/08/HclTh1y8AJGOfWe.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;ul>
&lt;li>&lt;strong>使用 SecureCRT 软件，可登陆到防火墙设备&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/01/08/zmrHt9JsUPMQBDw.jpg">
&lt;img src="https://i.loli.net/2021/01/08/zmrHt9JsUPMQBDw.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>
&lt;div class="post-img-view">
&lt;a data-fancybox="gallery" href="https://i.loli.net/2021/01/08/PY2NvbWklcwgaKf.jpg">
&lt;img src="https://i.loli.net/2021/01/08/PY2NvbWklcwgaKf.jpg"
loading="lazy"
>
&lt;/a>
&lt;/div>
&lt;/p>
&lt;p>​&lt;/p></description></item><item><title>关于开始扯谈</title><link>https://weeaster.github.io/posts/49183d2a/</link><pubDate>Wed, 06 Jan 2021 05:31:59 +0000</pubDate><guid>https://weeaster.github.io/posts/49183d2a/</guid><description>&lt;p>字面意思&lt;/p>
&lt;p>肚里墨水浅，蹦不出几个字&lt;/p>
&lt;p>晚上躺床，可能由于早已被破坏了的生物钟的影响&lt;/p>
&lt;p>时常辗转反侧，脑里思绪万千&lt;/p>
&lt;p>明明是身体驱使着我要睡了要睡了&lt;/p>
&lt;p>但是脑子并不协调躯体&lt;/p>
&lt;p>躺床的我使劲的翻看手机屏幕&lt;/p>
&lt;p>完全忘记了床的两大原始作用，你懂我意思吗&lt;/p>
&lt;p>最近一段时间，几乎每晚靠着罗哥调校自如的声音入睡&lt;/p>
&lt;p>喜马拉雅，定一个倒计时&lt;/p>
&lt;p>强行把自己深夜的思绪带入场景中&lt;/p>
&lt;p>也会听那个男人的语录，轻微的嘴角上扬和感悟中入睡&lt;/p>
&lt;p>眼睛一睁已是第二天的差不多日上三竿的时间&lt;/p>
&lt;p>洗洗醒醒坐坐，一天开始了&lt;/p></description></item><item><title>archive_test</title><link>https://weeaster.github.io/posts/515317e3/</link><pubDate>Mon, 26 Oct 2020 12:45:43 +0000</pubDate><guid>https://weeaster.github.io/posts/515317e3/</guid><description>&lt;p>Test Page&lt;/p>
&lt;ul>
&lt;li>This is a test page .&lt;/li>
&lt;/ul></description></item></channel></rss>